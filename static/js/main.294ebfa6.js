/*! For license information please see main.294ebfa6.js.LICENSE.txt */
!function(){var e={483:function(e,t,n){var i=n(416).default,r=n(115).default,a=n(515).default,o=n(588).default,s=n(808).default,l=n(993).default,u=n(589).default,c=n(861).default,d=n(424).default,h=n(704).default,f=n(690).default,p=n(728).default,m=n(655).default,y=n(389).default,g=n(496).default;e.exports=function(){"use strict";var e,t,n;function v(i,r){if(e)if(t){var a="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",o={};e(o),n=r(o),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(n.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}else t=r;else e=r}return v(["exports"],(function(e){var t,n,i,v="undefined"!=typeof self?self:{},_="2.15.0",x={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==t){var e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{t=null!={NODE_ENV:"production",PUBLIC_URL:"/wheres-my-class",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_MAP_BOX_TOKEN:"pk.eyJ1IjoicG9seWJlYW5kaXAiLCJhIjoiY2xrd2ZlbW94MDJ6dDNwdDQweWQyZnVsZCJ9.7L7RWu5Du9O0ZDxO8aXQow"}.API_URL_REGEX?new RegExp({NODE_ENV:"production",PUBLIC_URL:"/wheres-my-class",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_MAP_BOX_TOKEN:"pk.eyJ1IjoicG9seWJlYW5kaXAiLCJhIjoiY2xrd2ZlbW94MDJ6dDNwdDQweWQyZnVsZCJ9.7L7RWu5Du9O0ZDxO8aXQow"}.API_URL_REGEX):e}catch(v){t=e}}return t},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!x.API_URL)return null;try{var t=new URL(x.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},b={supported:!1,testSupport:function(e){!w&&i&&(k?T(e):n=e)}},w=!1,k=!1;function T(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.isContextLost())return;b.supported=!0}catch(e){}e.deleteTexture(t),w=!0}v.document&&((i=v.document.createElement("img")).onload=function(){n&&T(n),n=null,k=!0},i.onerror=function(){w=!0,n=null},i.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var E="01";function S(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var L=M;function M(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}M.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var r=this.sampleCurveX(n)-e;if(Math.abs(r)<t)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=r/a}var o=0,s=1;for(n=e,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-e)<t));i++)e>r?o=n:s=n,n=.5*(s-o)+o;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var A=S(L),C=I;function I(e,t){this.x=e,this.y=t}I.prototype={clone:function(){return new I(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),i=Math.sin(e),r=t.y+i*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-i*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},I.convert=function(e){return e instanceof I?e:Array.isArray(e)?new I(e[0],e[1]):e};var P=S(C),z=Math.PI/180,D=180/Math.PI;function R(e){return e*z}function B(e){return e*D}var F=[[0,0],[1,0],[1,1],[0,1]];function O(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function N(e,t,n,i){var r=new A(e,t,n,i);return function(e){return r.solve(e)}}var H=N(.25,.1,.25,1);function U(e,t,n){return Math.min(n,Math.max(t,e))}function j(e,t,n){return(n=U((n-e)/(t-e),0,1))*n*(3-2*n)}function V(e,t,n){var i=n-t,r=((e-t)%i+i)%i+t;return r===t?n:r}function W(e,t,n){if(!e.length)return n(null,[]);var i=e.length,r=new Array(e.length),a=null;e.forEach((function(e,o){t(e,(function(e,t){e&&(a=e),r[o]=t,0==--i&&n(a,r)}))}))}function G(e){var t=[];for(var n in e)t.push(e[n]);return t}function q(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r];for(var s in o)e[s]=o[s]}return e}var Z=1;function X(){return Z++}function K(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Y(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function J(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function $(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}function Q(e,t){return-1!==e.indexOf(t,e.length-t.length)}function ee(e,t,n){var i={};for(var r in e)i[r]=t.call(n||this,e[r],r,e);return i}function te(e,t,n){var i={};for(var r in e)t.call(n||this,e[r],r,e)&&(i[r]=e[r]);return i}function ne(e){return Array.isArray(e)?e.map(ne):"object"==typeof e&&e?ee(e,ne):e}var ie={};function re(e){ie[e]||("undefined"!=typeof console&&console.warn(e),ie[e]=!0)}function ae(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function oe(e){for(var t,n,i=0,r=0,a=e.length,o=a-1;r<a;o=r++)t=e[r],i+=((n=e[o]).x-t.x)*(t.y+n.y);return i}function se(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function le(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(e,n,i,r){var a=i||r;return t[n]=!a||a.toLowerCase(),""})),t["max-age"]){var n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}var ue=null;function ce(e){if(null==ue){var t=e.navigator?e.navigator.userAgent:null;ue=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ue}function de(e){try{var t=v[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function he(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}var fe,pe,me="mapbox-tiles",ye=500,ge=50;function ve(){try{return v.caches}catch(e){}}function _e(){ve()&&!fe&&(fe=v.caches.open(me))}function xe(e){var t=e.indexOf("?");if(t<0)return e;var n=function(e){var t=e.indexOf("?");return t>0?e.slice(t+1).split("&"):[]}(e),i=n.filter((function(e){var t=e.split("=");return"language"===t[0]||"worldview"===t[0]}));return i.length?"".concat(e.slice(0,t),"?").concat(i.join("&")):e.slice(0,t)}var be=1/0,we={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(we);var ke=function(e){m(n,e);var t=y(n);function n(e,i,r){var a;return f(this,n),401===i&&De(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),(a=t.call(this,e)).status=i,a.url=r,a}return p(n,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),n}(g(Error)),Te=se()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===v.location.protocol?v.parent:v).location.href},Ee=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(Te())&&!/^\w+:/.test(n))){if(v.fetch&&v.Request&&v.AbortController&&v.Request.prototype.hasOwnProperty("signal"))return function(e,t){var n,i=new v.AbortController,r=new v.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Te(),referrerPolicy:e.referrerPolicy,signal:i.signal}),a=!1,o=!1,s=(n=r.url).indexOf("sku=")>0&&De(n);"json"===e.type&&r.headers.set("Accept","application/json");var l=function(n,i,a){if(!o){if(n&&"SecurityError"!==n.message&&re(n.toString()),i&&a)return u(i);var l=Date.now();v.fetch(r).then((function(n){if(n.ok){var i=s?n.clone():null;return u(n,i,l)}return t(new ke(n.statusText,n.status,e.url))})).catch((function(n){"AbortError"!==n.name&&t(new Error("".concat(n.message," ").concat(e.url)))}))}},u=function(n,i,s){("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then((function(e){o||(i&&s&&function(e,t,n){if(_e(),fe){var i={status:t.status,statusText:t.statusText,headers:new v.Headers};t.headers.forEach((function(e,t){return i.headers.set(t,e)}));var r=le(t.headers.get("Cache-Control")||"");if(!r["no-store"]){r["max-age"]&&i.headers.set("Expires",new Date(n+1e3*r["max-age"]).toUTCString());var a=i.headers.get("Expires");a&&(new Date(a).getTime()-n<42e4||function(e,t){if(void 0===pe)try{new Response(new ReadableStream),pe=!0}catch(e){pe=!1}pe?t(e.body):e.blob().then(t)}(t,(function(t){var n=new v.Response(t,i);_e(),fe&&fe.then((function(t){return t.put(xe(e.url),n)})).catch((function(e){return re(e.message)}))})))}}}(r,i,s),a=!0,t(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((function(e){o||t(new Error(e.message))}))};return s?function(e,t){if(_e(),!fe)return t(null);var n=xe(e.url);fe.then((function(e){e.match(n).then((function(i){var r=function(e){if(!e)return!1;var t=new Date(e.headers.get("Expires")||0),n=le(e.headers.get("Cache-Control")||"");return t>Date.now()&&!n["no-cache"]}(i);e.delete(n),r&&e.put(n,i.clone()),t(null,i,r)})).catch(t)})).catch(t)}(r,l):l(null,null),{cancel:function(){o=!0,a||i.abort()}}}(e,t);if(se()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(e,t){var n=new v.XMLHttpRequest;for(var i in n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer"),e.headers)n.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===e.type)try{i=JSON.parse(n.response)}catch(e){return t(e)}t(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else t(new ke(n.statusText,n.status,e.url))},n.send(e.body),{cancel:function(){return n.abort()}}}(e,t)},Se=function(e,t){return Ee(q(e,{type:"arrayBuffer"}),t)};function Le(e){var t=v.document.createElement("a");return t.href=e,t.protocol===v.document.location.protocol&&t.host===v.document.location.host}var Me,Ae,Ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Me=[],Ae=0;var Ie=function e(t,n){if(b.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ae>=x.MAX_PARALLEL_IMAGE_REQUESTS){var i={requestParameters:t,callback:n,cancelled:!1,cancel:function(){this.cancelled=!0}};return Me.push(i),i}Ae++;var r=!1,a=function(){if(!r)for(r=!0,Ae--;Me.length&&Ae<x.MAX_PARALLEL_IMAGE_REQUESTS;){var t=Me.shift(),n=t.requestParameters,i=t.callback;t.cancelled||(t.cancel=e(n,i).cancel)}},o=Se(t,(function(e,t,i,r){a(),e?n(e):t&&(v.createImageBitmap?function(e,t){var n=new v.Blob([new Uint8Array(e)],{type:"image/png"});v.createImageBitmap(n).then((function(e){t(null,e)})).catch((function(e){t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}(t,(function(e,t){return n(e,t,i,r)})):function(e,t){var n=new v.Image,i=v.URL;n.onload=function(){t(null,n),i.revokeObjectURL(n.src),n.onload=null,v.requestAnimationFrame((function(){n.src=Ce}))},n.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var r=new v.Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?i.createObjectURL(r):Ce}(t,(function(e,t){return n(e,t,i,r)})))}));return{cancel:function(){o.cancel(),a()}}},Pe="NO_ACCESS_TOKEN";function ze(e){return 0===e.indexOf("mapbox:")}function De(e){return x.API_URL_REGEX.test(e)}function Re(e){return x.API_CDN_URL_REGEX.test(e)}function Be(e){return x.API_STYLE_REGEX.test(e)&&!Fe(e)}function Fe(e){return x.API_SPRITE_REGEX.test(e)}var Oe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ne(e){var t=e.match(Oe);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function He(e){var t=e.params.length?"?".concat(e.params.join("&")):"";return"".concat(e.protocol,"://").concat(e.authority).concat(e.path).concat(t)}var Ue="mapbox.eventData";function je(e){if(!e)return null;var t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(v.atob(t[1]).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(e){return null}}var Ve=function(){function e(t){f(this,e),this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}return p(e,[{key:"getStorageKey",value:function(e){var t=je(x.ACCESS_TOKEN),n="";return n=t&&t.u?v.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))}))):x.ACCESS_TOKEN||"",e?"".concat(Ue,".").concat(e,":").concat(n):"".concat(Ue,":").concat(n)}},{key:"fetchEventData",value:function(){var e=de("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{var i=v.localStorage.getItem(t);i&&(this.eventData=JSON.parse(i));var r=v.localStorage.getItem(n);r&&(this.anonId=r)}catch(e){re("Unable to read from LocalStorage")}}},{key:"saveEventData",value:function(){var e=de("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{v.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&v.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){re("Unable to write to LocalStorage")}}},{key:"processRequests",value:function(e){}},{key:"postEvent",value:function(e,t,n,i){var r=this;if(x.EVENTS_URL){var a=Ne(x.EVENTS_URL);a.params.push("access_token=".concat(i||x.ACCESS_TOKEN||""));var o={event:this.type,created:new Date(e).toISOString()},s=t?q(o,t):o,l={url:He(a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=function(e,t){return Ee(q(e,{method:"POST"}),t)}(l,(function(e){r.pendingRequest=null,n(e),r.saveEventData(),r.processRequests(i)}))}}},{key:"queueRequest",value:function(e,t){this.queue.push(e),this.processRequests(t)}}]),e}(),We=new(function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,"appUserTurnstile"))._customAccessToken=e,i}return p(n,[{key:"postTurnstileEvent",value:function(e,t){x.EVENTS_URL&&x.ACCESS_TOKEN&&Array.isArray(e)&&e.some((function(e){return ze(e)||De(e)}))&&this.queueRequest(Date.now(),t)}},{key:"processRequests",value:function(e){var t=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var n=je(x.ACCESS_TOKEN),i=n?n.u:x.ACCESS_TOKEN,r=i!==this.eventData.tokenU;J(this.anonId)||(this.anonId=K(),r=!0);var a=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),s=new Date(a),l=(a-this.eventData.lastSuccess)/864e5;r=r||l>=1||l<-1||o.getDate()!==s.getDate()}else r=!0;r?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:E,"enabled.telemetry":!1,userId:this.anonId},(function(e){e||(t.eventData.lastSuccess=a,t.eventData.tokenU=i)}),e):this.processRequests()}}}]),n}(Ve)),Ge=We.postTurnstileEvent.bind(We),qe=new(function(e){m(n,e);var t=y(n);function n(){var e;return f(this,n),(e=t.call(this,"map.load")).success={},e.skuToken="",e}return p(n,[{key:"postMapLoadEvent",value:function(e,t,n,i){this.skuToken=t,this.errorCb=i,x.EVENTS_URL&&(n||x.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(Pe)))}},{key:"processRequests",value:function(e){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var n=this.queue.shift(),i=n.id,r=n.timestamp;i&&this.success[i]||(this.anonId||this.fetchEventData(),J(this.anonId)||(this.anonId=K()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:E,skuToken:this.skuToken,userId:this.anonId},(function(e){e?t.errorCb(e):i&&(t.success[i]=!0)}),e))}}}]),n}(Ve)),Ze=qe.postMapLoadEvent.bind(qe),Xe=new(function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.call(this,"gljs.performance")}return p(n,[{key:"postPerformanceEvent",value:function(e,t){x.EVENTS_URL&&(e||x.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}},{key:"processRequests",value:function(e){if(!this.pendingRequest&&0!==this.queue.length){var t,n=this.queue.shift(),i=n.timestamp,r=function(e){var t=v.performance.getEntriesByType("resource"),n=v.performance.getEntriesByType("mark"),i=function(e){var t={};if(e)for(var n in e)if("other"!==n){var i,r=h(e[n]);try{for(r.s();!(i=r.n()).done;){var a=i.value,o="".concat(n,"ResolveRangeMin"),s="".concat(n,"ResolveRangeMax"),l="".concat(n,"RequestCount"),u="".concat(n,"RequestCachedCount");t[o]=Math.min(t[o]||1/0,a.startTime),t[s]=Math.max(t[s]||-1/0,a.responseEnd);var c=function(e){void 0===t[e]&&(t[e]=0),++t[e]};void 0!==a.transferSize&&0===a.transferSize&&c(u),c(l)}}catch(d){r.e(d)}finally{r.f()}}return t}(function(e,t){var n={};if(e){var i,r=h(e);try{for(r.s();!(i=r.n()).done;){var a=i.value,o=t(a);void 0===n[o]&&(n[o]=[]),n[o].push(a)}}catch(s){r.e(s)}finally{r.f()}}return n}(t,tt)),r=v.devicePixelRatio,a=v.navigator.connection||v.navigator.mozConnection||v.navigator.webkitConnection,o={counters:[],metadata:[],attributes:[]},s=function(e,t,n){null!=n&&e.push({name:t,value:n.toString()})};for(var l in i)s(o.counters,l,i[l]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(s(o.counters,"interactionRangeMin",e.interactionRange[0]),s(o.counters,"interactionRangeMax",e.interactionRange[1])),n)for(var u=function(){var e=d[c],t=Qe[e],i=n.find((function(e){return e.name===t}));i&&s(o.counters,t,i.startTime)},c=0,d=Object.keys(Qe);c<d.length;c++)u();return s(o.counters,"visibilityHidden",e.visibilityHidden),s(o.attributes,"style",function(e){if(e){var t,n=h(e);try{for(n.s();!(t=n.n()).done;){var i=t.value.name.split("?")[0];if(Be(i)){var r=i.split("/").slice(-2);if(2===r.length)return"mapbox://styles/".concat(r[0],"/").concat(r[1])}}}catch(a){n.e(a)}finally{n.f()}}}(t)),s(o.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),s(o.attributes,"fogEnabled",e.fogEnabled?"true":"false"),s(o.attributes,"projection",e.projection),s(o.attributes,"zoom",e.zoom),s(o.metadata,"devicePixelRatio",r),s(o.metadata,"connectionEffectiveType",a?a.effectiveType:void 0),s(o.metadata,"navigatorUserAgent",v.navigator.userAgent),s(o.metadata,"screenWidth",v.screen.width),s(o.metadata,"screenHeight",v.screen.height),s(o.metadata,"windowWidth",v.innerWidth),s(o.metadata,"windowHeight",v.innerHeight),s(o.metadata,"mapWidth",e.width/r),s(o.metadata,"mapHeight",e.height/r),s(o.metadata,"webglRenderer",e.renderer),s(o.metadata,"webglVendor",e.vendor),s(o.metadata,"sdkVersion",_),s(o.metadata,"sdkIdentifier","mapbox-gl-js"),o}(n.performanceData),a=h(r.metadata);try{for(a.s();!(t=a.n()).done;)t.value}catch(c){a.e(c)}finally{a.f()}var o,s=h(r.counters);try{for(s.s();!(o=s.n()).done;)o.value}catch(c){s.e(c)}finally{s.f()}var l,u=h(r.attributes);try{for(u.s();!(l=u.n()).done;)l.value}catch(c){u.e(c)}finally{u.f()}this.postEvent(i,r,(function(){}),e)}}}]),n}(Ve)),Ke=Xe.postPerformanceEvent.bind(Xe),Ye=new(function(e){m(n,e);var t=y(n);function n(){var e;return f(this,n),(e=t.call(this,"map.auth")).success={},e.skuToken="",e}return p(n,[{key:"getSession",value:function(e,t,n,i){var r=this;if(x.API_URL&&x.SESSION_PATH){var a=Ne(x.API_URL+x.SESSION_PATH);a.params.push("sku=".concat(t||"")),a.params.push("access_token=".concat(i||x.ACCESS_TOKEN||""));var o={url:He(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(e,t){return Ee(q(e,{method:"GET"}),t)}(o,(function(e){r.pendingRequest=null,n(e),r.saveEventData(),r.processRequests(i)}))}}},{key:"getSessionAPI",value:function(e,t,n,i){this.skuToken=t,this.errorCb=i,x.SESSION_PATH&&x.API_URL&&(n||x.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(Pe)))}},{key:"processRequests",value:function(e){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var n=this.queue.shift(),i=n.id,r=n.timestamp;i&&this.success[i]||this.getSession(r,this.skuToken,(function(e){e?t.errorCb(e):i&&(t.success[i]=!0)}),e)}}}]),n}(Ve)),Je=Ye.getSessionAPI.bind(Ye),$e=new Set,Qe={create:"create",load:"load",fullLoad:"fullLoad"},et={mark:function(e){v.performance.mark(e)},measure:function(e,t,n){v.performance.measure(e,t,n)}};function tt(e){var t=e.name.split("?")[0];return Re(t)&&t.includes("mapbox-gl.js")?"javascript":Re(t)&&t.includes("mapbox-gl.css")?"css":function(e){return x.API_FONTS_REGEX.test(e)}(t)?"fontRange":Fe(t)?"sprite":Be(t)?"style":function(e){return x.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}var nt,it,rt,at,ot=v.performance;function st(e){var t=e?e.url.toString():void 0;return ot.getEntriesByName(t)}var lt={now:function(){return void 0!==rt?rt:v.performance.now()},setNow:function(e){rt=e},restoreNow:function(){rt=void 0},frame:function(e){var t=v.requestAnimationFrame(e);return{cancel:function(){return v.cancelAnimationFrame(t)}}},getImageData:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.width,i=e.height;at||(at=v.document.createElement("canvas"));var r=at.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return(n>at.width||i>at.height)&&(at.width=n,at.height=i),r.clearRect(-t,-t,n+2*t,i+2*t),r.drawImage(e,0,0,n,i),r.getImageData(-t,-t,n+2*t,i+2*t)},resolveURL:function(e){return nt||(nt=v.document.createElement("a")),nt.href=e,nt.href},get devicePixelRatio(){return v.devicePixelRatio},get prefersReducedMotion(){return!!v.matchMedia&&(null==it&&(it=v.matchMedia("(prefers-reduced-motion: reduce)")),it.matches)}};function ut(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function ct(e,t,n){if(n&&n[e]){var i=n[e].indexOf(t);-1!==i&&n[e].splice(i,1)}}var dt=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(this,e),q(this,n),this.type=t})),ht=function(e){m(n,e);var t=y(n);function n(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f(this,n),t.call(this,"error",q({error:e},i))}return p(n)}(dt),ft=function(){function e(){f(this,e)}return p(e,[{key:"on",value:function(e,t){return this._listeners=this._listeners||{},ut(e,t,this._listeners),this}},{key:"off",value:function(e,t){return ct(e,t,this._listeners),ct(e,t,this._oneTimeListeners),this}},{key:"once",value:function(e,t){var n=this;return t?(this._oneTimeListeners=this._oneTimeListeners||{},ut(e,t,this._oneTimeListeners),this):new Promise((function(t){return n.once(e,t)}))}},{key:"fire",value:function(e,t){"string"==typeof e&&(e=new dt(e,t||{}));var n=e.type;if(this.listens(n)){e.target=this;var i,r=this._listeners&&this._listeners[n]?this._listeners[n].slice():[],a=h(r);try{for(a.s();!(i=a.n()).done;)i.value.call(this,e)}catch(d){a.e(d)}finally{a.f()}var o,s=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[],l=h(s);try{for(l.s();!(o=l.n()).done;){var u=o.value;ct(n,u,this._oneTimeListeners),u.call(this,e)}}catch(d){l.e(d)}finally{l.f()}var c=this._eventedParent;c&&(q(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),c.fire(e))}else e instanceof ht&&console.error(e.error);return this}},{key:"listens",value:function(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}},{key:"setEventedParent",value:function(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}]),e}(),pt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function mt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r];for(var s in o)e[s]=o[s]}return e}function yt(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function gt(e){if(Array.isArray(e))return e.map(gt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var n in e)t[n]=gt(e[n]);return t}return yt(e)}var vt=function(e){m(n,e);var t=y(n);function n(e,i){var r;return f(this,n),(r=t.call(this,i)).message=i,r.key=e,r}return p(n)}(g(Error)),_t=vt,xt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];f(this,e),this.parent=t,this.bindings={};var i,r=h(n);try{for(r.s();!(i=r.n()).done;){var a=d(i.value,2),o=a[0],s=a[1];this.bindings[o]=s}}catch(l){r.e(l)}finally{r.f()}}return p(e,[{key:"concat",value:function(t){return new e(this,t)}},{key:"get",value:function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error("".concat(e," not found in scope."))}},{key:"has",value:function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}]),e}(),bt=xt,wt={kind:"null"},kt={kind:"number"},Tt={kind:"string"},Et={kind:"boolean"},St={kind:"color"},Lt={kind:"object"},Mt={kind:"value"},At={kind:"collator"},Ct={kind:"formatted"},It={kind:"resolvedImage"};function Pt(e,t){return{kind:"array",itemType:e,N:t}}function zt(e){if("array"===e.kind){var t=zt(e.itemType);return"number"==typeof e.N?"array<".concat(t,", ").concat(e.N,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}var Dt=[wt,kt,Tt,Et,St,Ct,Lt,Pt(Mt),It];function Rt(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Rt(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(var n=0,i=Dt;n<i.length;n++)if(!Rt(i[n],t))return null}return"Expected ".concat(zt(e)," but found ").concat(zt(t)," instead.")}function Bt(e,t){return t.some((function(t){return t.kind===e.kind}))}function Ft(e,t){return t.some((function(t){return"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e}))}var Ot,Nt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ht(e){return(e=Math.round(e))<0?0:e>255?255:e}function Ut(e){return Ht("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function jt(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Vt(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{Ot={}.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in Nt)return Nt[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var i=n.indexOf("("),r=n.indexOf(")");if(-1!==i&&r+1===n.length){var a=n.substr(0,i),o=n.substr(i+1,r-(i+1)).split(","),s=1;switch(a){case"rgba":if(4!==o.length)return null;s=jt(o.pop());case"rgb":return 3!==o.length?null:[Ut(o[0]),Ut(o[1]),Ut(o[2]),s];case"hsla":if(4!==o.length)return null;s=jt(o.pop());case"hsl":if(3!==o.length)return null;var l=(parseFloat(o[0])%360+360)%360/360,u=jt(o[1]),c=jt(o[2]),d=c<=.5?c*(u+1):c+u-c*u,h=2*c-d;return[Ht(255*Vt(h,d,l+1/3)),Ht(255*Vt(h,d,l)),Ht(255*Vt(h,d,l-1/3)),s];default:return null}}return null}}catch(e){}var Wt=function(){function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;f(this,e),this.r=t,this.g=n,this.b=i,this.a=r}return p(e,[{key:"toString",value:function(){var e=this.toArray(),t=d(e,4),n=t[0],i=t[1],r=t[2],a=t[3];return"rgba(".concat(Math.round(n),",").concat(Math.round(i),",").concat(Math.round(r),",").concat(a,")")}},{key:"toArray",value:function(){var e=this.r,t=this.g,n=this.b,i=this.a;return 0===i?[0,0,0,0]:[255*e/i,255*t/i,255*n/i,i]}},{key:"toArray01",value:function(){var e=this.r,t=this.g,n=this.b,i=this.a;return 0===i?[0,0,0,0]:[e/i,t/i,n/i,i]}},{key:"toArray01PremultipliedAlpha",value:function(){return[this.r,this.g,this.b,this.a]}}],[{key:"parse",value:function(t){if(t){if(t instanceof e)return t;if("string"==typeof t){var n=Ot(t);return n?new e(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}}}}]),e}();Wt.black=new Wt(0,0,0,1),Wt.white=new Wt(1,1,1,1),Wt.transparent=new Wt(0,0,0,0),Wt.red=new Wt(1,0,0,1),Wt.blue=new Wt(0,0,1,1);var Gt=Wt,qt=function(){function e(t,n,i){f(this,e),this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}return p(e,[{key:"compare",value:function(e,t){return this.collator.compare(e,t)}},{key:"resolvedLocale",value:function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}]),e}(),Zt=p((function e(t,n,i,r,a){f(this,e),this.text=t.normalize?t.normalize():t,this.image=n,this.scale=i,this.fontStack=r,this.textColor=a})),Xt=function(){function e(t){f(this,e),this.sections=t}return p(e,[{key:"isEmpty",value:function(){return 0===this.sections.length||!this.sections.some((function(e){return 0!==e.text.length||e.image&&0!==e.image.name.length}))}},{key:"toString",value:function(){return 0===this.sections.length?"":this.sections.map((function(e){return e.text})).join("")}},{key:"serialize",value:function(){var e,t=["format"],n=h(this.sections);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i.image)t.push(["image",i.image.name]);else{t.push(i.text);var r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(r)}}}catch(a){n.e(a)}finally{n.f()}return t}}],[{key:"fromString",value:function(t){return new e([new Zt(t,null,null,null,null)])}},{key:"factory",value:function(t){return t instanceof e?t:e.fromString(t)}}]),e}(),Kt=function(){function e(t){f(this,e),this.name=t.name,this.available=t.available}return p(e,[{key:"toString",value:function(){return this.name}},{key:"serialize",value:function(){return["image",this.name]}}],[{key:"fromString",value:function(t){return t?new e({name:t,available:!1}):null}}]),e}();function Yt(e,t,n,i){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value [".concat([e,t,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function Jt(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Gt)return!0;if(e instanceof qt)return!0;if(e instanceof Xt)return!0;if(e instanceof Kt)return!0;if(Array.isArray(e)){var t,n=h(e);try{for(n.s();!(t=n.n()).done;)if(!Jt(t.value))return!1}catch(r){n.e(r)}finally{n.f()}return!0}if("object"==typeof e){for(var i in e)if(!Jt(e[i]))return!1;return!0}return!1}function $t(e){if(null===e)return wt;if("string"==typeof e)return Tt;if("boolean"==typeof e)return Et;if("number"==typeof e)return kt;if(e instanceof Gt)return St;if(e instanceof qt)return At;if(e instanceof Xt)return Ct;if(e instanceof Kt)return It;if(Array.isArray(e)){var t,n,i=e.length,r=h(e);try{for(r.s();!(n=r.n()).done;){var a=$t(n.value);if(t){if(t===a)continue;t=Mt;break}t=a}}catch(o){r.e(o)}finally{r.f()}return Pt(t||Mt,i)}return Lt}function Qt(e){var t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Gt||e instanceof Xt||e instanceof Kt?e.toString():JSON.stringify(e)}var en=function(){function e(t,n){f(this,e),this.type=t,this.value=n}return p(e,[{key:"evaluate",value:function(){return this.value}},{key:"eachChild",value:function(){}},{key:"outputDefined",value:function(){return!0}},{key:"serialize",value:function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Gt?["rgba"].concat(this.value.toArray()):this.value instanceof Xt?this.value.serialize():this.value}}],[{key:"parse",value:function(t,n){if(2!==t.length)return n.error("'literal' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(!Jt(t[1]))return n.error("invalid value");var i=t[1],r=$t(i),a=n.expectedType;return"array"!==r.kind||0!==r.N||!a||"array"!==a.kind||"number"==typeof a.N&&0!==a.N||(r=a),new e(r,i)}}]),e}(),tn=en,nn=function(){function e(t){f(this,e),this.name="ExpressionEvaluationError",this.message=t}return p(e,[{key:"toJSON",value:function(){return this.message}}]),e}(),rn={string:Tt,number:kt,boolean:Et,object:Lt},an=function(){function e(t,n){f(this,e),this.type=t,this.args=n}return p(e,[{key:"evaluate",value:function(e){for(var t=0;t<this.args.length;t++){var n=this.args[t].evaluate(e);if(!Rt(this.type,$t(n)))return n;if(t===this.args.length-1)throw new nn("Expected value to be of type ".concat(zt(this.type),", but found ").concat(zt($t(n))," instead."))}return null}},{key:"eachChild",value:function(e){this.args.forEach(e)}},{key:"outputDefined",value:function(){return this.args.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){var e=this.type,t=[e.kind];if("array"===e.kind){var n=e.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){t.push(n.kind);var i=e.N;("number"==typeof i||this.args.length>1)&&t.push(i)}}return t.concat(this.args.map((function(e){return e.serialize()})))}}],[{key:"parse",value:function(t,n){if(t.length<2)return n.error("Expected at least one argument.");var i,r=1,a=t[0];if("array"===a){var o,s;if(t.length>2){var l=t[1];if("string"!=typeof l||!(l in rn)||"object"===l)return n.error('The item type argument of "array" must be one of string, number, boolean',1);o=rn[l],r++}else o=Mt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);s=t[2],r++}i=Pt(o,s)}else i=rn[a];for(var u=[];r<t.length;r++){var c=n.parse(t[r],r,Mt);if(!c)return null;u.push(c)}return new e(i,u)}}]),e}(),on=an,sn=function(){function e(t){f(this,e),this.type=Ct,this.sections=t}return p(e,[{key:"evaluate",value:function(e){return new Xt(this.sections.map((function(t){var n=t.content.evaluate(e);return $t(n)===It?new Zt("",n,null,null,null):new Zt(Qt(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}},{key:"eachChild",value:function(e){var t,n=h(this.sections);try{for(n.s();!(t=n.n()).done;){var i=t.value;e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}}catch(r){n.e(r)}finally{n.f()}}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){var e,t=["format"],n=h(this.sections);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.push(i.content.serialize());var r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),t.push(r)}}catch(a){n.e(a)}finally{n.f()}return t}}],[{key:"parse",value:function(t,n){if(t.length<2)return n.error("Expected at least one argument.");var i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return n.error("First argument must be an image or text section.");for(var r=[],a=!1,o=1;o<=t.length-1;++o){var s=t[o];if(a&&"object"==typeof s&&!Array.isArray(s)){a=!1;var l=null;if(s["font-scale"]&&!(l=n.parse(s["font-scale"],1,kt)))return null;var u=null;if(s["text-font"]&&!(u=n.parse(s["text-font"],1,Pt(Tt))))return null;var c=null;if(s["text-color"]&&!(c=n.parse(s["text-color"],1,St)))return null;var d=r[r.length-1];d.scale=l,d.font=u,d.textColor=c}else{var h=n.parse(t[o],1,Mt);if(!h)return null;var f=h.type.kind;if("string"!==f&&"value"!==f&&"null"!==f&&"resolvedImage"!==f)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");a=!0,r.push({content:h,scale:null,font:null,textColor:null})}}return new e(r)}}]),e}(),ln=function(){function e(t){f(this,e),this.type=It,this.input=t}return p(e,[{key:"evaluate",value:function(e){var t=this.input.evaluate(e),n=Kt.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}},{key:"eachChild",value:function(e){e(this.input)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return["image",this.input.serialize()]}}],[{key:"parse",value:function(t,n){if(2!==t.length)return n.error("Expected two arguments.");var i=n.parse(t[1],1,Tt);return i?new e(i):n.error("No image name provided.")}}]),e}(),un={"to-boolean":Et,"to-color":St,"to-number":kt,"to-string":Tt},cn=function(){function e(t,n){f(this,e),this.type=t,this.args=n}return p(e,[{key:"evaluate",value:function(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){var t,n,i,r=h(this.args);try{for(r.s();!(i=r.n()).done;){if(t=i.value.evaluate(e),n=null,t instanceof Gt)return t;if("string"==typeof t){var a=e.parseColor(t);if(a)return a}else if(Array.isArray(t)&&!(n=t.length<3||t.length>4?"Invalid rbga value ".concat(JSON.stringify(t),": expected an array containing either three or four numeric values."):Yt(t[0],t[1],t[2],t[3])))return new Gt(t[0]/255,t[1]/255,t[2]/255,t[3])}}catch(c){r.e(c)}finally{r.f()}throw new nn(n||"Could not parse color from value '".concat("string"==typeof t?t:String(JSON.stringify(t)),"'"))}if("number"===this.type.kind){var o,s=null,l=h(this.args);try{for(l.s();!(o=l.n()).done;){if(null===(s=o.value.evaluate(e)))return 0;var u=Number(s);if(!isNaN(u))return u}}catch(c){l.e(c)}finally{l.f()}throw new nn("Could not convert ".concat(JSON.stringify(s)," to number."))}return"formatted"===this.type.kind?Xt.fromString(Qt(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Kt.fromString(Qt(this.args[0].evaluate(e))):Qt(this.args[0].evaluate(e))}},{key:"eachChild",value:function(e){this.args.forEach(e)}},{key:"outputDefined",value:function(){return this.args.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){if("formatted"===this.type.kind)return new sn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ln(this.args[0]).serialize();var e=["to-".concat(this.type.kind)];return this.eachChild((function(t){e.push(t.serialize())})),e}}],[{key:"parse",value:function(t,n){if(t.length<2)return n.error("Expected at least one argument.");var i=t[0];if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return n.error("Expected one argument.");for(var r=un[i],a=[],o=1;o<t.length;o++){var s=n.parse(t[o],o,Mt);if(!s)return null;a.push(s)}return new e(r,a)}}]),e}(),dn=cn,hn=["Unknown","Point","LineString","Polygon"],fn=function(){function e(){f(this,e),this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}return p(e,[{key:"id",value:function(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}},{key:"geometryType",value:function(){return this.feature?"number"==typeof this.feature.type?hn[this.feature.type]:this.feature.type:null}},{key:"geometry",value:function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}},{key:"canonicalID",value:function(){return this.canonical}},{key:"properties",value:function(){return this.feature&&this.feature.properties||{}}},{key:"distanceFromCenter",value:function(){if(this.featureTileCoord&&this.featureDistanceData){var e=this.featureDistanceData.center,t=this.featureDistanceData.scale,n=this.featureTileCoord,i=n.x,r=n.y;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(r*t-e[1])}return 0}},{key:"parseColor",value:function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Gt.parse(e)),t}}]),e}(),pn=function(){function e(t,n,i,r){f(this,e),this.name=t,this.type=n,this._evaluate=i,this.args=r}return p(e,[{key:"evaluate",value:function(e){return this._evaluate(e,this.args)}},{key:"eachChild",value:function(e){this.args.forEach(e)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return[this.name].concat(this.args.map((function(e){return e.serialize()})))}}],[{key:"parse",value:function(t,n){var i,r=t[0],a=e.definitions[r];if(!a)return n.error('Unknown expression "'.concat(r,'". If you wanted a literal array, use ["literal", [...]].'),0);var o,s=Array.isArray(a)?a[0]:a.type,l=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,u=l.filter((function(e){var n=d(e,1)[0];return!Array.isArray(n)||n.length===t.length-1})),f=null,p=h(u);try{for(p.s();!(o=p.n()).done;){var m=d(o.value,2),y=m[0],g=m[1];f=new Un(n.registry,n.path,null,n.scope);for(var v=[],_=!1,x=1;x<t.length;x++){var b=t[x],w=Array.isArray(y)?y[x-1]:y.type,k=f.parse(b,1+v.length,w);if(!k){_=!0;break}v.push(k)}if(!_)if(Array.isArray(y)&&y.length!==v.length)f.error("Expected ".concat(y.length," arguments, but found ").concat(v.length," instead."));else{for(var T=0;T<v.length;T++){var E=Array.isArray(y)?y[T]:y.type,S=v[T];f.concat(T+1).checkSubtype(E,S.type)}if(0===f.errors.length)return new e(r,s,g,v)}}}catch(I){p.e(I)}finally{p.f()}if(1===u.length)(i=n.errors).push.apply(i,c(f.errors));else{for(var L=(u.length?u:l).map((function(e){var t;return t=d(e,1)[0],Array.isArray(t)?"(".concat(t.map(zt).join(", "),")"):"(".concat(zt(t.type),"...)")})).join(" | "),M=[],A=1;A<t.length;A++){var C=n.parse(t[A],1+M.length);if(!C)return null;M.push(zt(C.type))}n.error("Expected arguments of type ".concat(L,", but found (").concat(M.join(", "),") instead."))}return null}},{key:"register",value:function(t,n){for(var i in e.definitions=n,n)t[i]=e}}]),e}(),mn=pn,yn=function(){function e(t,n,i){f(this,e),this.type=At,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=n}return p(e,[{key:"evaluate",value:function(e){return new qt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}},{key:"eachChild",value:function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}],[{key:"parse",value:function(t,n){if(2!==t.length)return n.error("Expected one argument.");var i=t[1];if("object"!=typeof i||Array.isArray(i))return n.error("Collator options argument must be an object.");var r=n.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,Et);if(!r)return null;var a=n.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,Et);if(!a)return null;var o=null;return i.locale&&!(o=n.parse(i.locale,1,Tt))?null:new e(r,a,o)}}]),e}(),gn=8192;function vn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function _n(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function xn(e,t){var n=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(n*r*gn),Math.round(i*r*gn)]}function bn(e,t,n){var i=e[0]-t[0],r=e[1]-t[1],a=e[0]-n[0],o=e[1]-n[1];return i*o-a*r==0&&i*a<=0&&r*o<=0}function wn(e,t){for(var n,i,r,a=!1,o=0,s=t.length;o<s;o++)for(var l=t[o],u=0,c=l.length;u<c-1;u++){if(bn(e,l[u],l[u+1]))return!1;(i=l[u])[1]>(n=e)[1]!=(r=l[u+1])[1]>n[1]&&n[0]<(r[0]-i[0])*(n[1]-i[1])/(r[1]-i[1])+i[0]&&(a=!a)}return a}function kn(e,t){for(var n=0;n<t.length;n++)if(wn(e,t[n]))return!0;return!1}function Tn(e,t,n,i){var r=i[0]-n[0],a=i[1]-n[1],o=(e[0]-n[0])*a-r*(e[1]-n[1]),s=(t[0]-n[0])*a-r*(t[1]-n[1]);return o>0&&s<0||o<0&&s>0}function En(e,t,n){var i,r,a,o,s,l,u,c=h(n);try{for(c.s();!(i=c.n()).done;)for(var d=i.value,f=0;f<d.length-1;++f)if(0!=(l=[(s=d[f+1])[0]-(o=d[f])[0],s[1]-o[1]])[0]*(u=[(a=t)[0]-(r=e)[0],a[1]-r[1]])[1]-l[1]*u[0]&&Tn(r,a,o,s)&&Tn(o,s,r,a))return!0}catch(p){c.e(p)}finally{c.f()}return!1}function Sn(e,t){for(var n=0;n<e.length;++n)if(!wn(e[n],t))return!1;for(var i=0;i<e.length-1;++i)if(En(e[i],e[i+1],t))return!1;return!0}function Ln(e,t){for(var n=0;n<t.length;n++)if(Sn(e,t[n]))return!0;return!1}function Mn(e,t,n){for(var i=[],r=0;r<e.length;r++){for(var a=[],o=0;o<e[r].length;o++){var s=xn(e[r][o],n);vn(t,s),a.push(s)}i.push(a)}return i}function An(e,t,n){for(var i=[],r=0;r<e.length;r++){var a=Mn(e[r],t,n);i.push(a)}return i}function Cn(e,t,n,i){if(e[0]<n[0]||e[0]>n[2]){var r=.5*i,a=e[0]-n[0]>r?-i:n[0]-e[0]>r?i:0;0===a&&(a=e[0]-n[2]>r?-i:n[2]-e[0]>r?i:0),e[0]+=a}vn(t,e)}function In(e,t,n,i){var r=Math.pow(2,i.z)*gn,a=[i.x*gn,i.y*gn],o=[];if(!e)return o;var s,l=h(e);try{for(l.s();!(s=l.n()).done;){var u,c=s.value,d=h(c);try{for(d.s();!(u=d.n()).done;){var f=u.value,p=[f.x+a[0],f.y+a[1]];Cn(p,t,n,r),o.push(p)}}catch(m){d.e(m)}finally{d.f()}}}catch(m){l.e(m)}finally{l.f()}return o}function Pn(e,t,n,i){var r=Math.pow(2,i.z)*gn,a=[i.x*gn,i.y*gn],o=[];if(!e)return o;var s,l,u=h(e);try{for(u.s();!(s=u.n()).done;){var c,d=s.value,f=[],p=h(d);try{for(p.s();!(c=p.n()).done;){var m=c.value,y=[m.x+a[0],m.y+a[1]];vn(t,y),f.push(y)}}catch(w){p.e(w)}finally{p.f()}o.push(f)}}catch(w){u.e(w)}finally{u.f()}if(t[2]-t[0]<=r/2){(l=t)[0]=l[1]=1/0,l[2]=l[3]=-1/0;var g,v=h(o);try{for(v.s();!(g=v.n()).done;){var _,x=g.value,b=h(x);try{for(b.s();!(_=b.n()).done;)Cn(_.value,t,n,r)}catch(w){b.e(w)}finally{b.f()}}}catch(w){v.e(w)}finally{v.f()}}return o}var zn=function(){function e(t,n){f(this,e),this.type=Et,this.geojson=t,this.geometries=n}return p(e,[{key:"evaluate",value:function(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){var n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){var a=Mn(t.coordinates,i,r),o=In(e.geometry(),n,i,r);if(!_n(n,i))return!1;var s,l=h(o);try{for(l.s();!(s=l.n()).done;)if(!wn(s.value,a))return!1}catch(p){l.e(p)}finally{l.f()}}if("MultiPolygon"===t.type){var u=An(t.coordinates,i,r),c=In(e.geometry(),n,i,r);if(!_n(n,i))return!1;var d,f=h(c);try{for(f.s();!(d=f.n()).done;)if(!kn(d.value,u))return!1}catch(p){f.e(p)}finally{f.f()}}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){var n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){var a=Mn(t.coordinates,i,r),o=Pn(e.geometry(),n,i,r);if(!_n(n,i))return!1;var s,l=h(o);try{for(l.s();!(s=l.n()).done;)if(!Sn(s.value,a))return!1}catch(p){l.e(p)}finally{l.f()}}if("MultiPolygon"===t.type){var u=An(t.coordinates,i,r),c=Pn(e.geometry(),n,i,r);if(!_n(n,i))return!1;var d,f=h(c);try{for(f.s();!(d=f.n()).done;)if(!Ln(d.value,u))return!1}catch(p){f.e(p)}finally{f.f()}}return!0}(e,this.geometries)}return!1}},{key:"eachChild",value:function(){}},{key:"outputDefined",value:function(){return!0}},{key:"serialize",value:function(){return["within",this.geojson]}}],[{key:"parse",value:function(t,n){if(2!==t.length)return n.error("'within' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(Jt(t[1])){var i=t[1];if("FeatureCollection"===i.type)for(var r=0;r<i.features.length;++r){var a=i.features[r].geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new e(i,i.features[r].geometry)}else if("Feature"===i.type){var o=i.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new e(i,i.geometry)}else if("Polygon"===i.type||"MultiPolygon"===i.type)return new e(i,i)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}}]),e}(),Dn=zn;function Rn(e){if(e instanceof mn){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Dn)return!1;var t=!0;return e.eachChild((function(e){t&&!Rn(e)&&(t=!1)})),t}function Bn(e){if(e instanceof mn&&"feature-state"===e.name)return!1;var t=!0;return e.eachChild((function(e){t&&!Bn(e)&&(t=!1)})),t}function Fn(e,t){if(e instanceof mn&&t.indexOf(e.name)>=0)return!1;var n=!0;return e.eachChild((function(e){n&&!Fn(e,t)&&(n=!1)})),n}var On=function(){function e(t,n){f(this,e),this.type=n.type,this.name=t,this.boundExpression=n}return p(e,[{key:"evaluate",value:function(e){return this.boundExpression.evaluate(e)}},{key:"eachChild",value:function(){}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return["var",this.name]}}],[{key:"parse",value:function(t,n){if(2!==t.length||"string"!=typeof t[1])return n.error("'var' expression requires exactly one string literal argument.");var i=t[1];return n.scope.has(i)?new e(i,n.scope.get(i)):n.error('Unknown variable "'.concat(i,'". Make sure "').concat(i,'" has been bound in an enclosing "let" expression before using it.'),1)}}]),e}(),Nn=On,Hn=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new bt,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];f(this,e),this.registry=t,this.path=n,this.key=n.map((function(e){return"[".concat(e,"]")})).join(""),this.scope=r,this.errors=a,this.expectedType=i}return p(e,[{key:"parse",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t?this.concat(t,n,i)._parse(e,r):this._parse(e,r)}},{key:"_parse",value:function(e,t){function n(e,t,n){return"assert"===n?new on(t,[e]):"coerce"===n?new dn(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var i=e[0];if("string"!=typeof i)return this.error("Expression name must be a string, but found ".concat(typeof i,' instead. If you wanted a literal array, use ["literal", [...]].'),0),null;var r=this.registry[i];if(r){var a=r.parse(e,this);if(!a)return null;if(this.expectedType){var o=this.expectedType,s=a.type;if("string"!==o.kind&&"number"!==o.kind&&"boolean"!==o.kind&&"object"!==o.kind&&"array"!==o.kind||"value"!==s.kind)if("color"!==o.kind&&"formatted"!==o.kind&&"resolvedImage"!==o.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(o,s))return null}else a=n(a,o,t.typeAnnotation||"coerce");else a=n(a,o,t.typeAnnotation||"assert")}if(!(a instanceof tn)&&"resolvedImage"!==a.type.kind&&jn(a)){var l=new fn;try{a=new tn(a.type,a.evaluate(l))}catch(e){return this.error(e.message),null}}return a}return this.error('Unknown expression "'.concat(i,'". If you wanted a literal array, use ["literal", [...]].'),0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof e," instead."))}},{key:"concat",value:function(t,n,i){var r="number"==typeof t?this.path.concat(t):this.path,a=i?this.scope.concat(i):this.scope;return new e(this.registry,r,n||null,a,this.errors)}},{key:"error",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r="".concat(this.key).concat(n.map((function(e){return"[".concat(e,"]")})).join(""));this.errors.push(new _t(r,e))}},{key:"checkSubtype",value:function(e,t){var n=Rt(e,t);return n&&this.error(n),n}}]),e}(),Un=Hn;function jn(e){if(e instanceof Nn)return jn(e.boundExpression);if(e instanceof mn&&"error"===e.name)return!1;if(e instanceof yn)return!1;if(e instanceof Dn)return!1;var t=e instanceof dn||e instanceof on,n=!0;return e.eachChild((function(e){n=t?n&&jn(e):n&&e instanceof tn})),!!n&&Rn(e)&&Fn(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Vn(e,t){for(var n,i,r=e.length-1,a=0,o=r,s=0;a<=o;)if(n=e[s=Math.floor((a+o)/2)],i=e[s+1],n<=t){if(s===r||t<i)return s;a=s+1}else{if(!(n>t))throw new nn("Input is not a number.");o=s-1}return 0}var Wn=function(){function e(t,n,i){f(this,e),this.type=t,this.input=n,this.labels=[],this.outputs=[];var r,a=h(i);try{for(a.s();!(r=a.n()).done;){var o=d(r.value,2),s=o[0],l=o[1];this.labels.push(s),this.outputs.push(l)}}catch(u){a.e(u)}finally{a.f()}}return p(e,[{key:"evaluate",value:function(e){var t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);var i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);var r=t.length;return i>=t[r-1]?n[r-1].evaluate(e):n[Vn(t,i)].evaluate(e)}},{key:"eachChild",value:function(e){e(this.input);var t,n=h(this.outputs);try{for(n.s();!(t=n.n()).done;)e(t.value)}catch(i){n.e(i)}finally{n.f()}}},{key:"outputDefined",value:function(){return this.outputs.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}],[{key:"parse",value:function(t,n){if(t.length-1<4)return n.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");var i=n.parse(t[1],1,kt);if(!i)return null;var r=[],a=null;n.expectedType&&"value"!==n.expectedType.kind&&(a=n.expectedType);for(var o=1;o<t.length;o+=2){var s=1===o?-1/0:t[o],l=t[o+1],u=o,c=o+1;if("number"!=typeof s)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(r.length&&r[r.length-1][0]>=s)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var d=n.parse(l,c,a);if(!d)return null;a=a||d.type,r.push([s,d])}return new e(a,i,r)}}]),e}(),Gn=Wn;function qn(e,t,n){return e*(1-n)+t*n}var Zn=Object.freeze({__proto__:null,array:function(e,t,n){return e.map((function(e,i){return qn(e,t[i],n)}))},color:function(e,t,n){return new Gt(qn(e.r,t.r,n),qn(e.g,t.g,n),qn(e.b,t.b,n),qn(e.a,t.a,n))},number:qn}),Xn=.95047,Kn=1.08883,Yn=4/29,Jn=6/29,$n=3*Jn*Jn,Qn=Jn*Jn*Jn,ei=Math.PI/180,ti=180/Math.PI;function ni(e){return e>Qn?Math.pow(e,1/3):e/$n+Yn}function ii(e){return e>Jn?e*e*e:$n*(e-Yn)}function ri(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function ai(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function oi(e){var t=ai(e.r),n=ai(e.g),i=ai(e.b),r=ni((.4124564*t+.3575761*n+.1804375*i)/Xn),a=ni((.2126729*t+.7151522*n+.072175*i)/1);return{l:116*a-16,a:500*(r-a),b:200*(a-ni((.0193339*t+.119192*n+.9503041*i)/Kn)),alpha:e.a}}function si(e){var t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,i=isNaN(e.b)?t:t-e.b/200;return t=1*ii(t),n=Xn*ii(n),i=Kn*ii(i),new Gt(ri(3.2404542*n-1.5371385*t-.4985314*i),ri(-.969266*n+1.8760108*t+.041556*i),ri(.0556434*n-.2040259*t+1.0572252*i),e.alpha)}function li(e,t,n){var i=t-e;return e+n*(i>180||i<-180?i-360*Math.round(i/360):i)}var ui={forward:oi,reverse:si,interpolate:function(e,t,n){return{l:qn(e.l,t.l,n),a:qn(e.a,t.a,n),b:qn(e.b,t.b,n),alpha:qn(e.alpha,t.alpha,n)}}},ci={forward:function(e){var t=oi(e),n=t.l,i=t.a,r=t.b,a=Math.atan2(r,i)*ti;return{h:a<0?a+360:a,c:Math.sqrt(i*i+r*r),l:n,alpha:e.a}},reverse:function(e){var t=e.h*ei,n=e.c;return si({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:li(e.h,t.h,n),c:qn(e.c,t.c,n),l:qn(e.l,t.l,n),alpha:qn(e.alpha,t.alpha,n)}}},di=Object.freeze({__proto__:null,hcl:ci,lab:ui}),hi=function(){function e(t,n,i,r,a){f(this,e),this.type=t,this.operator=n,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];var o,s=h(a);try{for(s.s();!(o=s.n()).done;){var l=d(o.value,2),u=l[0],c=l[1];this.labels.push(u),this.outputs.push(c)}}catch(p){s.e(p)}finally{s.f()}}return p(e,[{key:"evaluate",value:function(t){var n=this.labels,i=this.outputs;if(1===n.length)return i[0].evaluate(t);var r=this.input.evaluate(t);if(r<=n[0])return i[0].evaluate(t);var a=n.length;if(r>=n[a-1])return i[a-1].evaluate(t);var o=Vn(n,r),s=e.interpolationFactor(this.interpolation,r,n[o],n[o+1]),l=i[o].evaluate(t),u=i[o+1].evaluate(t);return"interpolate"===this.operator?Zn[this.type.kind.toLowerCase()](l,u,s):"interpolate-hcl"===this.operator?ci.reverse(ci.interpolate(ci.forward(l),ci.forward(u),s)):ui.reverse(ui.interpolate(ui.forward(l),ui.forward(u),s))}},{key:"eachChild",value:function(e){e(this.input);var t,n=h(this.outputs);try{for(n.s();!(t=n.n()).done;)e(t.value)}catch(i){n.e(i)}finally{n.f()}}},{key:"outputDefined",value:function(){return this.outputs.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){var e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}],[{key:"interpolationFactor",value:function(e,t,n,i){var r=0;if("exponential"===e.name)r=fi(t,e.base,n,i);else if("linear"===e.name)r=fi(t,1,n,i);else if("cubic-bezier"===e.name){var a=e.controlPoints;r=new A(a[0],a[1],a[2],a[3]).solve(fi(t,1,n,i))}return r}},{key:"parse",value:function(t,n){var i=u(t),r=i[0],a=i[1],o=i[2],s=i.slice(3);if(!Array.isArray(a)||0===a.length)return n.error("Expected an interpolation type expression.",1);if("linear"===a[0])a={name:"linear"};else if("exponential"===a[0]){var l=a[1];if("number"!=typeof l)return n.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:l}}else{if("cubic-bezier"!==a[0])return n.error("Unknown interpolation type ".concat(String(a[0])),1,0);var c=a.slice(1);if(4!==c.length||c.some((function(e){return"number"!=typeof e||e<0||e>1})))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:c}}if(t.length-1<4)return n.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(!(o=n.parse(o,2,kt)))return null;var d=[],h=null;"interpolate-hcl"===r||"interpolate-lab"===r?h=St:n.expectedType&&"value"!==n.expectedType.kind&&(h=n.expectedType);for(var f=0;f<s.length;f+=2){var p=s[f],m=s[f+1],y=f+3,g=f+4;if("number"!=typeof p)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',y);if(d.length&&d[d.length-1][0]>=p)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',y);var v=n.parse(m,g,h);if(!v)return null;h=h||v.type,d.push([p,v])}return"number"===h.kind||"color"===h.kind||"array"===h.kind&&"number"===h.itemType.kind&&"number"==typeof h.N?new e(h,r,a,o,d):n.error("Type ".concat(zt(h)," is not interpolatable."))}}]),e}();function fi(e,t,n,i){var r=i-n,a=e-n;return 0===r?0:1===t?a/r:(Math.pow(t,a)-1)/(Math.pow(t,r)-1)}var pi=hi,mi=function(){function e(t,n){f(this,e),this.type=t,this.args=n}return p(e,[{key:"evaluate",value:function(e){var t,n,i=null,r=0,a=h(this.args);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(r++,(i=o.evaluate(e))&&i instanceof Kt&&!i.available&&(t||(t=i),i=null,r===this.args.length))return t;if(null!==i)break}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"eachChild",value:function(e){this.args.forEach(e)}},{key:"outputDefined",value:function(){return this.args.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){var e=["coalesce"];return this.eachChild((function(t){e.push(t.serialize())})),e}}],[{key:"parse",value:function(t,n){if(t.length<2)return n.error("Expectected at least one argument.");var i=null,r=n.expectedType;r&&"value"!==r.kind&&(i=r);var a,o=[],s=h(t.slice(1));try{for(s.s();!(a=s.n()).done;){var l=a.value,u=n.parse(l,1+o.length,i,void 0,{typeAnnotation:"omit"});if(!u)return null;i=i||u.type,o.push(u)}}catch(d){s.e(d)}finally{s.f()}var c=r&&o.some((function(e){return Rt(r,e.type)}));return new e(c?Mt:i,o)}}]),e}(),yi=mi,gi=function(){function e(t,n){f(this,e),this.type=n.type,this.bindings=[].concat(t),this.result=n}return p(e,[{key:"evaluate",value:function(e){return this.result.evaluate(e)}},{key:"eachChild",value:function(e){var t,n=h(this.bindings);try{for(n.s();!(t=n.n()).done;)e(t.value[1])}catch(i){n.e(i)}finally{n.f()}e(this.result)}},{key:"outputDefined",value:function(){return this.result.outputDefined()}},{key:"serialize",value:function(){var e,t=["let"],n=h(this.bindings);try{for(n.s();!(e=n.n()).done;){var i=d(e.value,2),r=i[0],a=i[1];t.push(r,a.serialize())}}catch(o){n.e(o)}finally{n.f()}return t.push(this.result.serialize()),t}}],[{key:"parse",value:function(t,n){if(t.length<4)return n.error("Expected at least 3 arguments, but found ".concat(t.length-1," instead."));for(var i=[],r=1;r<t.length-1;r+=2){var a=t[r];if("string"!=typeof a)return n.error("Expected string, but found ".concat(typeof a," instead."),r);if(/[^a-zA-Z0-9_]/.test(a))return n.error("Variable names must contain only alphanumeric characters or '_'.",r);var o=n.parse(t[r+1],r+1);if(!o)return null;i.push([a,o])}var s=n.parse(t[t.length-1],t.length-1,n.expectedType,i);return s?new e(i,s):null}}]),e}(),vi=gi,_i=function(){function e(t,n,i){f(this,e),this.type=t,this.index=n,this.input=i}return p(e,[{key:"evaluate",value:function(e){var t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new nn("Array index out of bounds: ".concat(t," < 0."));if(t>=n.length)throw new nn("Array index out of bounds: ".concat(t," > ").concat(n.length-1,"."));if(t!==Math.floor(t))throw new nn("Array index must be an integer, but found ".concat(t," instead."));return n[t]}},{key:"eachChild",value:function(e){e(this.index),e(this.input)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return["at",this.index.serialize(),this.input.serialize()]}}],[{key:"parse",value:function(t,n){if(3!==t.length)return n.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));var i=n.parse(t[1],1,kt),r=n.parse(t[2],2,Pt(n.expectedType||Mt));return i&&r?new e(r.type.itemType,i,r):null}}]),e}(),xi=_i,bi=function(){function e(t,n){f(this,e),this.type=Et,this.needle=t,this.haystack=n}return p(e,[{key:"evaluate",value:function(e){var t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(null==n)return!1;if(!Ft(t,["boolean","string","number","null"]))throw new nn("Expected first argument to be of type boolean, string, number or null, but found ".concat(zt($t(t))," instead."));if(!Ft(n,["string","array"]))throw new nn("Expected second argument to be of type array or string, but found ".concat(zt($t(n))," instead."));return n.indexOf(t)>=0}},{key:"eachChild",value:function(e){e(this.needle),e(this.haystack)}},{key:"outputDefined",value:function(){return!0}},{key:"serialize",value:function(){return["in",this.needle.serialize(),this.haystack.serialize()]}}],[{key:"parse",value:function(t,n){if(3!==t.length)return n.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));var i=n.parse(t[1],1,Mt),r=n.parse(t[2],2,Mt);return i&&r?Bt(i.type,[Et,Tt,kt,wt,Mt])?new e(i,r):n.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(zt(i.type)," instead")):null}}]),e}(),wi=bi,ki=function(){function e(t,n,i){f(this,e),this.type=kt,this.needle=t,this.haystack=n,this.fromIndex=i}return p(e,[{key:"evaluate",value:function(e){var t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Ft(t,["boolean","string","number","null"]))throw new nn("Expected first argument to be of type boolean, string, number or null, but found ".concat(zt($t(t))," instead."));if(!Ft(n,["string","array"]))throw new nn("Expected second argument to be of type array or string, but found ".concat(zt($t(n))," instead."));if(this.fromIndex){var i=this.fromIndex.evaluate(e);return n.indexOf(t,i)}return n.indexOf(t)}},{key:"eachChild",value:function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}],[{key:"parse",value:function(t,n){if(t.length<=2||t.length>=5)return n.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));var i=n.parse(t[1],1,Mt),r=n.parse(t[2],2,Mt);if(!i||!r)return null;if(!Bt(i.type,[Et,Tt,kt,wt,Mt]))return n.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(zt(i.type)," instead"));if(4===t.length){var a=n.parse(t[3],3,kt);return a?new e(i,r,a):null}return new e(i,r)}}]),e}(),Ti=ki,Ei=function(){function e(t,n,i,r,a,o){f(this,e),this.inputType=t,this.type=n,this.input=i,this.cases=r,this.outputs=a,this.otherwise=o}return p(e,[{key:"evaluate",value:function(e){var t=this.input.evaluate(e);return($t(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}},{key:"eachChild",value:function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}},{key:"outputDefined",value:function(){return this.outputs.every((function(e){return e.outputDefined()}))&&this.otherwise.outputDefined()}},{key:"serialize",value:function(){var e,t=this,n=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],a={},o=h(i);try{for(o.s();!(e=o.n()).done;){var s=e.value,l=a[this.cases[s]];void 0===l?(a[this.cases[s]]=r.length,r.push([this.cases[s],[s]])):r[l][1].push(s)}}catch(g){o.e(g)}finally{o.f()}for(var u=function(e){return"number"===t.inputType.kind?Number(e):e},c=0,f=r;c<f.length;c++){var p=d(f[c],2),m=p[0],y=p[1];n.push(1===y.length?u(y[0]):y.map(u)),n.push(this.outputs[m].serialize())}return n.push(this.otherwise.serialize()),n}}],[{key:"parse",value:function(t,n){if(t.length<5)return n.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=1)return n.error("Expected an even number of arguments.");var i,r;n.expectedType&&"value"!==n.expectedType.kind&&(r=n.expectedType);for(var a={},o=[],s=2;s<t.length-1;s+=2){var l=t[s],u=t[s+1];Array.isArray(l)||(l=[l]);var c=n.concat(s);if(0===l.length)return c.error("Expected at least one branch label.");var d,f=h(l);try{for(f.s();!(d=f.n()).done;){var p=d.value;if("number"!=typeof p&&"string"!=typeof p)return c.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof p&&Math.floor(p)!==p)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,$t(p)))return null}else i=$t(p);if(void 0!==a[String(p)])return c.error("Branch labels must be unique.");a[String(p)]=o.length}}catch(v){f.e(v)}finally{f.f()}var m=n.parse(u,s,r);if(!m)return null;r=r||m.type,o.push(m)}var y=n.parse(t[1],1,Mt);if(!y)return null;var g=n.parse(t[t.length-1],t.length-1,r);return g?"value"!==y.type.kind&&n.concat(1).checkSubtype(i,y.type)?null:new e(i,r,y,a,o,g):null}}]),e}(),Si=Ei,Li=function(){function e(t,n,i){f(this,e),this.type=t,this.branches=n,this.otherwise=i}return p(e,[{key:"evaluate",value:function(e){var t,n=h(this.branches);try{for(n.s();!(t=n.n()).done;){var i=d(t.value,2),r=i[0],a=i[1];if(r.evaluate(e))return a.evaluate(e)}}catch(o){n.e(o)}finally{n.f()}return this.otherwise.evaluate(e)}},{key:"eachChild",value:function(e){var t,n=h(this.branches);try{for(n.s();!(t=n.n()).done;){var i=d(t.value,2),r=i[0],a=i[1];e(r),e(a)}}catch(o){n.e(o)}finally{n.f()}e(this.otherwise)}},{key:"outputDefined",value:function(){return this.branches.every((function(e){var t=d(e,2);return t[0],t[1].outputDefined()}))&&this.otherwise.outputDefined()}},{key:"serialize",value:function(){var e=["case"];return this.eachChild((function(t){e.push(t.serialize())})),e}}],[{key:"parse",value:function(t,n){if(t.length<4)return n.error("Expected at least 3 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=0)return n.error("Expected an odd number of arguments.");var i;n.expectedType&&"value"!==n.expectedType.kind&&(i=n.expectedType);for(var r=[],a=1;a<t.length-1;a+=2){var o=n.parse(t[a],a,Et);if(!o)return null;var s=n.parse(t[a+1],a+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}var l=n.parse(t[t.length-1],t.length-1,i);return l?new e(i,r,l):null}}]),e}(),Mi=Li,Ai=function(){function e(t,n,i,r){f(this,e),this.type=t,this.input=n,this.beginIndex=i,this.endIndex=r}return p(e,[{key:"evaluate",value:function(e){var t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!Ft(t,["string","array"]))throw new nn("Expected first argument to be of type array or string, but found ".concat(zt($t(t))," instead."));if(this.endIndex){var i=this.endIndex.evaluate(e);return t.slice(n,i)}return t.slice(n)}},{key:"eachChild",value:function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){if(null!=this.endIndex&&void 0!==this.endIndex){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}],[{key:"parse",value:function(t,n){if(t.length<=2||t.length>=5)return n.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));var i=n.parse(t[1],1,Mt),r=n.parse(t[2],2,kt);if(!i||!r)return null;if(!Bt(i.type,[Pt(Mt),Tt,Mt]))return n.error("Expected first argument to be of type array or string, but found ".concat(zt(i.type)," instead"));if(4===t.length){var a=n.parse(t[3],3,kt);return a?new e(i.type,i,r,a):null}return new e(i.type,i,r)}}]),e}(),Ci=Ai;function Ii(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Pi(e,t,n,i){return 0===i.compare(t,n)}function zi(e,t,n){var i="=="!==e&&"!="!==e;return function(){function r(e,t,n){f(this,r),this.type=Et,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}return p(r,[{key:"evaluate",value:function(r){var a=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){var s=$t(a),l=$t(o);if(s.kind!==l.kind||"string"!==s.kind&&"number"!==s.kind)throw new nn('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(s.kind,", ").concat(l.kind,") instead."))}if(this.collator&&!i&&this.hasUntypedArgument){var u=$t(a),c=$t(o);if("string"!==u.kind||"string"!==c.kind)return t(r,a,o)}return this.collator?n(r,a,o,this.collator.evaluate(r)):t(r,a,o)}},{key:"eachChild",value:function(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}},{key:"outputDefined",value:function(){return!0}},{key:"serialize",value:function(){var t=[e];return this.eachChild((function(e){t.push(e.serialize())})),t}}],[{key:"parse",value:function(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");var n=e[0],a=t.parse(e[1],1,Mt);if(!a)return null;if(!Ii(n,a.type))return t.concat(1).error('"'.concat(n,"\" comparisons are not supported for type '").concat(zt(a.type),"'."));var o=t.parse(e[2],2,Mt);if(!o)return null;if(!Ii(n,o.type))return t.concat(2).error('"'.concat(n,"\" comparisons are not supported for type '").concat(zt(o.type),"'."));if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot compare types '".concat(zt(a.type),"' and '").concat(zt(o.type),"'."));i&&("value"===a.type.kind&&"value"!==o.type.kind?a=new on(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new on(a.type,[o])));var s=null;if(4===e.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot use collator to compare non-string types.");if(!(s=t.parse(e[3],3,At)))return null}return new r(a,o,s)}}]),r}()}var Di=zi("==",(function(e,t,n){return t===n}),Pi),Ri=zi("!=",(function(e,t,n){return t!==n}),(function(e,t,n,i){return!Pi(0,t,n,i)})),Bi=zi("<",(function(e,t,n){return t<n}),(function(e,t,n,i){return i.compare(t,n)<0})),Fi=zi(">",(function(e,t,n){return t>n}),(function(e,t,n,i){return i.compare(t,n)>0})),Oi=zi("<=",(function(e,t,n){return t<=n}),(function(e,t,n,i){return i.compare(t,n)<=0})),Ni=zi(">=",(function(e,t,n){return t>=n}),(function(e,t,n,i){return i.compare(t,n)>=0})),Hi=function(){function e(t,n,i,r,a,o){f(this,e),this.type=Tt,this.number=t,this.locale=n,this.currency=i,this.unit=r,this.minFractionDigits=a,this.maxFractionDigits=o}return p(e,[{key:"evaluate",value:function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}},{key:"eachChild",value:function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}],[{key:"parse",value:function(t,n){if(3!==t.length)return n.error("Expected two arguments.");var i=n.parse(t[1],1,kt);if(!i)return null;var r=t[2];if("object"!=typeof r||Array.isArray(r))return n.error("NumberFormat options argument must be an object.");var a=null;if(r.locale&&!(a=n.parse(r.locale,1,Tt)))return null;var o=null;if(r.currency&&!(o=n.parse(r.currency,1,Tt)))return null;var s=null;if(r.unit&&!(s=n.parse(r.unit,1,Tt)))return null;var l=null;if(r["min-fraction-digits"]&&!(l=n.parse(r["min-fraction-digits"],1,kt)))return null;var u=null;return r["max-fraction-digits"]&&!(u=n.parse(r["max-fraction-digits"],1,kt))?null:new e(i,a,o,s,l,u)}}]),e}(),Ui=function(){function e(t){f(this,e),this.type=kt,this.input=t}return p(e,[{key:"evaluate",value:function(e){var t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new nn("Expected value to be of type string or array, but found ".concat(zt($t(t))," instead."))}},{key:"eachChild",value:function(e){e(this.input)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){var e=["length"];return this.eachChild((function(t){e.push(t.serialize())})),e}}],[{key:"parse",value:function(t,n){if(2!==t.length)return n.error("Expected 1 argument, but found ".concat(t.length-1," instead."));var i=n.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?n.error("Expected argument of type string or array, but found ".concat(zt(i.type)," instead.")):new e(i):null}}]),e}(),ji={"==":Di,"!=":Ri,">":Fi,"<":Bi,">=":Ni,"<=":Oi,array:on,at:xi,boolean:on,case:Mi,coalesce:yi,collator:yn,format:sn,image:ln,in:wi,"index-of":Ti,interpolate:pi,"interpolate-hcl":pi,"interpolate-lab":pi,length:Ui,let:vi,literal:tn,match:Si,number:on,"number-format":Hi,object:on,slice:Ci,step:Gn,string:on,"to-boolean":dn,"to-color":dn,"to-number":dn,"to-string":dn,var:Nn,within:Dn};function Vi(e,t){var n=d(t,4),i=n[0],r=n[1],a=n[2],o=n[3];i=i.evaluate(e),r=r.evaluate(e),a=a.evaluate(e);var s=o?o.evaluate(e):1,l=Yt(i,r,a,s);if(l)throw new nn(l);return new Gt(i/255*s,r/255*s,a/255*s,s)}function Wi(e,t){return e in t}function Gi(e,t){var n=t[e];return void 0===n?null:n}function qi(e){return{type:e}}mn.register(ji,{error:[{kind:"error"},[Tt],function(e,t){var n=d(t,1)[0];throw new nn(n.evaluate(e))}],typeof:[Tt,[Mt],function(e,t){return zt($t(d(t,1)[0].evaluate(e)))}],"to-rgba":[Pt(kt,4),[St],function(e,t){return d(t,1)[0].evaluate(e).toArray()}],rgb:[St,[kt,kt,kt],Vi],rgba:[St,[kt,kt,kt,kt],Vi],has:{type:Et,overloads:[[[Tt],function(e,t){return Wi(d(t,1)[0].evaluate(e),e.properties())}],[[Tt,Lt],function(e,t){var n=d(t,2),i=n[0],r=n[1];return Wi(i.evaluate(e),r.evaluate(e))}]]},get:{type:Mt,overloads:[[[Tt],function(e,t){return Gi(d(t,1)[0].evaluate(e),e.properties())}],[[Tt,Lt],function(e,t){var n=d(t,2),i=n[0],r=n[1];return Gi(i.evaluate(e),r.evaluate(e))}]]},"feature-state":[Mt,[Tt],function(e,t){return Gi(d(t,1)[0].evaluate(e),e.featureState||{})}],properties:[Lt,[],function(e){return e.properties()}],"geometry-type":[Tt,[],function(e){return e.geometryType()}],id:[Mt,[],function(e){return e.id()}],zoom:[kt,[],function(e){return e.globals.zoom}],pitch:[kt,[],function(e){return e.globals.pitch||0}],"distance-from-center":[kt,[],function(e){return e.distanceFromCenter()}],"heatmap-density":[kt,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[kt,[],function(e){return e.globals.lineProgress||0}],"sky-radial-progress":[kt,[],function(e){return e.globals.skyRadialProgress||0}],accumulated:[Mt,[],function(e){return void 0===e.globals.accumulated?null:e.globals.accumulated}],"+":[kt,qi(kt),function(e,t){var n,i=0,r=h(t);try{for(r.s();!(n=r.n()).done;)i+=n.value.evaluate(e)}catch(a){r.e(a)}finally{r.f()}return i}],"*":[kt,qi(kt),function(e,t){var n,i=1,r=h(t);try{for(r.s();!(n=r.n()).done;)i*=n.value.evaluate(e)}catch(a){r.e(a)}finally{r.f()}return i}],"-":{type:kt,overloads:[[[kt,kt],function(e,t){var n=d(t,2),i=n[0],r=n[1];return i.evaluate(e)-r.evaluate(e)}],[[kt],function(e,t){return-d(t,1)[0].evaluate(e)}]]},"/":[kt,[kt,kt],function(e,t){var n=d(t,2),i=n[0],r=n[1];return i.evaluate(e)/r.evaluate(e)}],"%":[kt,[kt,kt],function(e,t){var n=d(t,2),i=n[0],r=n[1];return i.evaluate(e)%r.evaluate(e)}],ln2:[kt,[],function(){return Math.LN2}],pi:[kt,[],function(){return Math.PI}],e:[kt,[],function(){return Math.E}],"^":[kt,[kt,kt],function(e,t){var n=d(t,2),i=n[0],r=n[1];return Math.pow(i.evaluate(e),r.evaluate(e))}],sqrt:[kt,[kt],function(e,t){var n=d(t,1)[0];return Math.sqrt(n.evaluate(e))}],log10:[kt,[kt],function(e,t){var n=d(t,1)[0];return Math.log(n.evaluate(e))/Math.LN10}],ln:[kt,[kt],function(e,t){var n=d(t,1)[0];return Math.log(n.evaluate(e))}],log2:[kt,[kt],function(e,t){var n=d(t,1)[0];return Math.log(n.evaluate(e))/Math.LN2}],sin:[kt,[kt],function(e,t){var n=d(t,1)[0];return Math.sin(n.evaluate(e))}],cos:[kt,[kt],function(e,t){var n=d(t,1)[0];return Math.cos(n.evaluate(e))}],tan:[kt,[kt],function(e,t){var n=d(t,1)[0];return Math.tan(n.evaluate(e))}],asin:[kt,[kt],function(e,t){var n=d(t,1)[0];return Math.asin(n.evaluate(e))}],acos:[kt,[kt],function(e,t){var n=d(t,1)[0];return Math.acos(n.evaluate(e))}],atan:[kt,[kt],function(e,t){var n=d(t,1)[0];return Math.atan(n.evaluate(e))}],min:[kt,qi(kt),function(e,t){return Math.min.apply(Math,c(t.map((function(t){return t.evaluate(e)}))))}],max:[kt,qi(kt),function(e,t){return Math.max.apply(Math,c(t.map((function(t){return t.evaluate(e)}))))}],abs:[kt,[kt],function(e,t){var n=d(t,1)[0];return Math.abs(n.evaluate(e))}],round:[kt,[kt],function(e,t){var n=d(t,1)[0].evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[kt,[kt],function(e,t){var n=d(t,1)[0];return Math.floor(n.evaluate(e))}],ceil:[kt,[kt],function(e,t){var n=d(t,1)[0];return Math.ceil(n.evaluate(e))}],"filter-==":[Et,[Tt,Mt],function(e,t){var n=d(t,2),i=n[0],r=n[1];return e.properties()[i.value]===r.value}],"filter-id-==":[Et,[Mt],function(e,t){var n=d(t,1)[0];return e.id()===n.value}],"filter-type-==":[Et,[Tt],function(e,t){var n=d(t,1)[0];return e.geometryType()===n.value}],"filter-<":[Et,[Tt,Mt],function(e,t){var n=d(t,2),i=n[0],r=n[1],a=e.properties()[i.value],o=r.value;return typeof a==typeof o&&a<o}],"filter-id-<":[Et,[Mt],function(e,t){var n=d(t,1)[0],i=e.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[Et,[Tt,Mt],function(e,t){var n=d(t,2),i=n[0],r=n[1],a=e.properties()[i.value],o=r.value;return typeof a==typeof o&&a>o}],"filter-id->":[Et,[Mt],function(e,t){var n=d(t,1)[0],i=e.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[Et,[Tt,Mt],function(e,t){var n=d(t,2),i=n[0],r=n[1],a=e.properties()[i.value],o=r.value;return typeof a==typeof o&&a<=o}],"filter-id-<=":[Et,[Mt],function(e,t){var n=d(t,1)[0],i=e.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[Et,[Tt,Mt],function(e,t){var n=d(t,2),i=n[0],r=n[1],a=e.properties()[i.value],o=r.value;return typeof a==typeof o&&a>=o}],"filter-id->=":[Et,[Mt],function(e,t){var n=d(t,1)[0],i=e.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[Et,[Mt],function(e,t){return d(t,1)[0].value in e.properties()}],"filter-has-id":[Et,[],function(e){return null!==e.id()&&void 0!==e.id()}],"filter-type-in":[Et,[Pt(Tt)],function(e,t){return d(t,1)[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[Et,[Pt(Mt)],function(e,t){return d(t,1)[0].value.indexOf(e.id())>=0}],"filter-in-small":[Et,[Tt,Pt(Mt)],function(e,t){var n=d(t,2),i=n[0];return n[1].value.indexOf(e.properties()[i.value])>=0}],"filter-in-large":[Et,[Tt,Pt(Mt)],function(e,t){var n=d(t,2),i=n[0],r=n[1];return function(e,t,n,i){for(;n<=i;){var r=n+i>>1;if(t[r]===e)return!0;t[r]>e?i=r-1:n=r+1}return!1}(e.properties()[i.value],r.value,0,r.value.length-1)}],all:{type:Et,overloads:[[[Et,Et],function(e,t){var n=d(t,2),i=n[0],r=n[1];return i.evaluate(e)&&r.evaluate(e)}],[qi(Et),function(e,t){var n,i=h(t);try{for(i.s();!(n=i.n()).done;)if(!n.value.evaluate(e))return!1}catch(r){i.e(r)}finally{i.f()}return!0}]]},any:{type:Et,overloads:[[[Et,Et],function(e,t){var n=d(t,2),i=n[0],r=n[1];return i.evaluate(e)||r.evaluate(e)}],[qi(Et),function(e,t){var n,i=h(t);try{for(i.s();!(n=i.n()).done;)if(n.value.evaluate(e))return!0}catch(r){i.e(r)}finally{i.f()}return!1}]]},"!":[Et,[Et],function(e,t){return!d(t,1)[0].evaluate(e)}],"is-supported-script":[Et,[Tt],function(e,t){var n=d(t,1)[0],i=e.globals&&e.globals.isSupportedScript;return!i||i(n.evaluate(e))}],upcase:[Tt,[Tt],function(e,t){return d(t,1)[0].evaluate(e).toUpperCase()}],downcase:[Tt,[Tt],function(e,t){return d(t,1)[0].evaluate(e).toLowerCase()}],concat:[Tt,qi(Mt),function(e,t){return t.map((function(t){return Qt(t.evaluate(e))})).join("")}],"resolved-locale":[Tt,[At],function(e,t){return d(t,1)[0].evaluate(e).resolvedLocale()}]});var Zi=ji;function Xi(e){return{result:"success",value:e}}function Ki(e){return{result:"error",value:e}}function Yi(e){return"data-driven"===e["property-type"]}function Ji(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function $i(e){return!!e.expression&&e.expression.interpolated}function Qi(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function er(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function tr(e){return e}function nr(e,t){var n,i,r,a="color"===t.type,o=e.stops&&"object"==typeof e.stops[0][0],s=o||!(o||void 0!==e.property),l=e.type||($i(t)?"exponential":"interval");if(a&&((e=mt({},e)).stops&&(e.stops=e.stops.map((function(e){return[e[0],Gt.parse(e[1])]}))),e.default=Gt.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!di[e.colorSpace])throw new Error("Unknown color space: ".concat(e.colorSpace));if("exponential"===l)n=or;else if("interval"===l)n=ar;else if("categorical"===l){n=rr,i=Object.create(null);var u,c=h(e.stops);try{for(c.s();!(u=c.n()).done;){var d=u.value;i[d[0]]=d[1]}}catch(T){c.e(T)}finally{c.f()}r=typeof e.stops[0][0]}else{if("identity"!==l)throw new Error('Unknown function type "'.concat(l,'"'));n=sr}if(o){for(var f={},p=[],m=0;m<e.stops.length;m++){var y=e.stops[m],g=y[0].zoom;void 0===f[g]&&(f[g]={zoom:g,type:e.type,property:e.property,default:e.default,stops:[]},p.push(g)),f[g].stops.push([y[0].value,y[1]])}for(var v=[],_=0,x=p;_<x.length;_++){var b=x[_];v.push([f[b].zoom,nr(f[b],t)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:pi.interpolationFactor.bind(void 0,w),zoomStops:v.map((function(e){return e[0]})),evaluate:function(n,i){var r=n.zoom;return or({stops:v,base:e.base},t,r).evaluate(r,i)}}}if(s){var k="exponential"===l?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:pi.interpolationFactor.bind(void 0,k),zoomStops:e.stops.map((function(e){return e[0]})),evaluate:function(a){var o=a.zoom;return n(e,t,o,i,r)}}}return{kind:"source",evaluate:function(a,o){var s=o&&o.properties?o.properties[e.property]:void 0;return void 0===s?ir(e.default,t.default):n(e,t,s,i,r)}}}function ir(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function rr(e,t,n,i,r){return ir(typeof n===r?i[n]:void 0,e.default,t.default)}function ar(e,t,n){if("number"!==Qi(n))return ir(e.default,t.default);var i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];var r=Vn(e.stops.map((function(e){return e[0]})),n);return e.stops[r][1]}function or(e,t,n){var i=void 0!==e.base?e.base:1;if("number"!==Qi(n))return ir(e.default,t.default);var r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];var a=Vn(e.stops.map((function(e){return e[0]})),n),o=function(e,t,n,i){var r=i-n,a=e-n;return 0===r?0:1===t?a/r:(Math.pow(t,a)-1)/(Math.pow(t,r)-1)}(n,i,e.stops[a][0],e.stops[a+1][0]),s=e.stops[a][1],l=e.stops[a+1][1],u=Zn[t.type]||tr;if(e.colorSpace&&"rgb"!==e.colorSpace){var c=di[e.colorSpace];u=function(e,t){return c.reverse(c.interpolate(c.forward(e),c.forward(t),o))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=s.evaluate.apply(void 0,t),r=l.evaluate.apply(void 0,t);if(void 0!==i&&void 0!==r)return u(i,r,o)}}:u(s,l,o)}function sr(e,t,n){return"color"===t.type?n=Gt.parse(n):"formatted"===t.type?n=Xt.fromString(n.toString()):"resolvedImage"===t.type?n=Kt.fromString(n.toString()):Qi(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),ir(n,e.default,t.default)}var lr=function(){function e(t,n){f(this,e),this.expression=t,this._warningHistory={},this._evaluator=new fn,this._defaultValue=n?function(e){return"color"===e.type&&(er(e.default)||Array.isArray(e.default))?new Gt(0,0,0,0):"color"===e.type?Gt.parse(e.default)||null:void 0===e.default?null:e.default}(n):null,this._enumValues=n&&"enum"===n.type?n.values:null}return p(e,[{key:"evaluateWithoutErrorHandling",value:function(e,t,n,i,r,a,o,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}},{key:"evaluate",value:function(e,t,n,i,r,a,o,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a||null,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=s||null;try{var l=this.expression.evaluate(this._evaluator);if(null==l||"number"==typeof l&&l!=l)return this._defaultValue;if(this._enumValues&&!(l in this._enumValues))throw new nn("Expected value to be one of ".concat(Object.keys(this._enumValues).map((function(e){return JSON.stringify(e)})).join(", "),", but found ").concat(JSON.stringify(l)," instead."));return l}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}]),e}();function ur(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Zi}function cr(e,t){var n=new Un(Zi,[],t?function(e){var t={color:St,string:Tt,number:kt,enum:Tt,boolean:Et,formatted:Ct,resolvedImage:It};return"array"===e.type?Pt(t[e.value]||Mt,e.length):t[e.type]}(t):void 0),i=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return i?Xi(new lr(i,t)):Ki(n.errors)}var dr=function(){function e(t,n){f(this,e),this.kind=t,this._styleExpression=n,this.isStateDependent="constant"!==t&&!Bn(n.expression)}return p(e,[{key:"evaluateWithoutErrorHandling",value:function(e,t,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,a)}},{key:"evaluate",value:function(e,t,n,i,r,a){return this._styleExpression.evaluate(e,t,n,i,r,a)}}]),e}(),hr=function(){function e(t,n,i,r){f(this,e),this.kind=t,this.zoomStops=i,this._styleExpression=n,this.isStateDependent="camera"!==t&&!Bn(n.expression),this.interpolationType=r}return p(e,[{key:"evaluateWithoutErrorHandling",value:function(e,t,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,a)}},{key:"evaluate",value:function(e,t,n,i,r,a){return this._styleExpression.evaluate(e,t,n,i,r,a)}},{key:"interpolationFactor",value:function(e,t,n){return this.interpolationType?pi.interpolationFactor(this.interpolationType,e,t,n):0}}]),e}();function fr(e,t){if("error"===(e=cr(e,t)).result)return e;var n=e.value.expression,i=Rn(n);if(!i&&!Yi(t))return Ki([new _t("","data expressions not supported")]);var r=Fn(n,["zoom","pitch","distance-from-center"]);if(!r&&!Ji(t))return Ki([new _t("","zoom expressions not supported")]);var a=mr(n);return a||r?a instanceof _t?Ki([a]):a instanceof pi&&!$i(t)?Ki([new _t("",'"interpolate" expressions cannot be used with this property')]):Xi(a?new hr(i?"camera":"composite",e.value,a.labels,a instanceof pi?a.interpolation:void 0):new dr(i?"constant":"source",e.value)):Ki([new _t("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}var pr=function(){function e(t,n){f(this,e),this._parameters=t,this._specification=n,mt(this,nr(this._parameters,this._specification))}return p(e,null,[{key:"deserialize",value:function(t){return new e(t._parameters,t._specification)}},{key:"serialize",value:function(e){return{_parameters:e._parameters,_specification:e._specification}}}]),e}();function mr(e){var t=null;if(e instanceof vi)t=mr(e.result);else if(e instanceof yi){var n,i=h(e.args);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(t=mr(r))break}}catch(a){i.e(a)}finally{i.f()}}else(e instanceof Gn||e instanceof pi)&&e.input instanceof mn&&"zoom"===e.input.name&&(t=e);return t instanceof _t||e.eachChild((function(e){var n=mr(e);n instanceof _t?t=n:!t&&n?t=new _t("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&n&&t!==n&&(t=new _t("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}var yr=p((function e(t,n,i,r){f(this,e),this.message=(t?"".concat(t,": "):"")+i,r&&(this.identifier=r),null!=n&&n.__line__&&(this.line=n.__line__)}));function gr(e){var t=e.key,n=e.value,i=e.valueSpec||{},r=e.objectElementValidators||{},a=e.style,o=e.styleSpec,s=[],l=Qi(n);if("object"!==l)return[new yr(t,n,"object expected, ".concat(l," found"))];for(var u in n){var c=u.split(".")[0],d=void 0;r[c]?d=r[c]:i[c]?d=Jr:r["*"]?d=r["*"]:i["*"]&&(d=Jr),d?s=s.concat(d({key:(t?"".concat(t,"."):t)+u,value:n[u],valueSpec:i[c]||i["*"],style:a,styleSpec:o,object:n,objectKey:u},n)):s.push(new yr(t,n[u],'unknown property "'.concat(u,'"')))}for(var h in i)r[h]||i[h].required&&void 0===i[h].default&&void 0===n[h]&&s.push(new yr(t,n,'missing required property "'.concat(h,'"')));return s}function vr(e){var t=e.value,n=e.valueSpec,i=e.style,r=e.styleSpec,a=e.key,o=e.arrayElementValidator||Jr;if("array"!==Qi(t))return[new yr(a,t,"array expected, ".concat(Qi(t)," found"))];if(n.length&&t.length!==n.length)return[new yr(a,t,"array length ".concat(n.length," expected, length ").concat(t.length," found"))];if(n["min-length"]&&t.length<n["min-length"])return[new yr(a,t,"array length at least ".concat(n["min-length"]," expected, length ").concat(t.length," found"))];var s={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};r.$version<7&&(s.function=n.function),"object"===Qi(n.value)&&(s=n.value);for(var l=[],u=0;u<t.length;u++)l=l.concat(o({array:t,arrayIndex:u,value:t[u],valueSpec:s,style:i,styleSpec:r,key:"".concat(a,"[").concat(u,"]")}));return l}function _r(e){var t=e.key,n=e.value,i=e.valueSpec,r=Qi(n);if("number"===r&&n!=n&&(r="NaN"),"number"!==r)return[new yr(t,n,"number expected, ".concat(r," found"))];if("minimum"in i){var a=i.minimum;if("array"===Qi(i.minimum)&&(a=i.minimum[e.arrayIndex]),n<a)return[new yr(t,n,"".concat(n," is less than the minimum value ").concat(a))]}if("maximum"in i){var o=i.maximum;if("array"===Qi(i.maximum)&&(o=i.maximum[e.arrayIndex]),n>o)return[new yr(t,n,"".concat(n," is greater than the maximum value ").concat(o))]}return[]}function xr(e){var t,n,i,r=e.valueSpec,a=yt(e.value.type),o={},s="categorical"!==a&&void 0===e.value.property,l=!s,u="array"===Qi(e.value.stops)&&"array"===Qi(e.value.stops[0])&&"object"===Qi(e.value.stops[0][0]),c=gr({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===a)return[new yr(e.key,e.value,'identity function may not have a "stops" property')];var t=[],n=e.value;return t=t.concat(vr({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:d})),"array"===Qi(n)&&0===n.length&&t.push(new yr(e.key,n,"array must have at least one stop")),t},default:function(e){return Jr({key:e.key,value:e.value,valueSpec:r,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===a&&s&&c.push(new yr(e.key,e.value,'missing required property "property"')),"identity"===a||e.value.stops||c.push(new yr(e.key,e.value,'missing required property "stops"')),"exponential"===a&&e.valueSpec.expression&&!$i(e.valueSpec)&&c.push(new yr(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!Yi(e.valueSpec)?c.push(new yr(e.key,e.value,"property functions not supported")):s&&!Ji(e.valueSpec)&&c.push(new yr(e.key,e.value,"zoom functions not supported"))),"categorical"!==a&&!u||void 0!==e.value.property||c.push(new yr(e.key,e.value,'"property" property is required')),c;function d(e){var t=[],a=e.value,s=e.key;if("array"!==Qi(a))return[new yr(s,a,"array expected, ".concat(Qi(a)," found"))];if(2!==a.length)return[new yr(s,a,"array length 2 expected, length ".concat(a.length," found"))];if(u){if("object"!==Qi(a[0]))return[new yr(s,a,"object expected, ".concat(Qi(a[0])," found"))];if(void 0===a[0].zoom)return[new yr(s,a,"object stop key must have zoom")];if(void 0===a[0].value)return[new yr(s,a,"object stop key must have value")];var l=yt(a[0].zoom);if("number"!=typeof l)return[new yr(s,a[0].zoom,"stop zoom values must be numbers")];if(i&&i>l)return[new yr(s,a[0].zoom,"stop zoom values must appear in ascending order")];l!==i&&(i=l,n=void 0,o={}),t=t.concat(gr({key:"".concat(s,"[0]"),value:a[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:_r,value:h}}))}else t=t.concat(h({key:"".concat(s,"[0]"),value:a[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},a));return ur(gt(a[1]))?t.concat([new yr("".concat(s,"[1]"),a[1],"expressions are not allowed in function stops.")]):t.concat(Jr({key:"".concat(s,"[1]"),value:a[1],valueSpec:r,style:e.style,styleSpec:e.styleSpec}))}function h(e,i){var s=Qi(e.value),l=yt(e.value),u=null!==e.value?e.value:i;if(t){if(s!==t)return[new yr(e.key,u,"".concat(s," stop domain type must match previous stop domain type ").concat(t))]}else t=s;if("number"!==s&&"string"!==s&&"boolean"!==s&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new yr(e.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==a){var c="number expected, ".concat(s," found");return Yi(r)&&void 0===a&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yr(e.key,u,c)]}return"categorical"!==a||"number"!==s||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==a&&"number"===s&&"number"==typeof l&&"number"==typeof n&&void 0!==n&&l<n?[new yr(e.key,u,"stop domain values must appear in ascending order")]:(n=l,"categorical"===a&&l in o?[new yr(e.key,u,"stop domain values must be unique")]:(o[l]=!0,[])):[new yr(e.key,u,"integer expected, found ".concat(String(l)))]}}function br(e){var t=("property"===e.expressionContext?fr:cr)(gt(e.value),e.valueSpec);if("error"===t.result)return t.value.map((function(t){return new yr("".concat(e.key).concat(t.key),e.value,t.message)}));var n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new yr(e.key,e.value,'Invalid data expression for "'.concat(e.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Bn(n))return[new yr(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return wr(n,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Fn(n,["zoom","feature-state"]))return[new yr(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Rn(n))return[new yr(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wr(e,t){var n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression){var i,r=h(t.valueSpec.expression.parameters);try{for(r.s();!(i=r.n()).done;){var a=i.value;n.delete(a)}}catch(s){r.e(s)}finally{r.f()}}if(0===n.size)return[];var o=[];return e instanceof mn&&n.has(e.name)?[new yr(t.key,t.value,'["'.concat(e.name,'"] expression is not supported in a filter for a ').concat(t.object.type," layer with id: ").concat(t.object.id))]:(e.eachChild((function(e){o.push.apply(o,c(wr(e,t)))})),o)}function kr(e){var t=e.key,n=e.value,i=e.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(yt(n))&&r.push(new yr(t,n,"expected one of [".concat(i.values.join(", "),"], ").concat(JSON.stringify(n)," found"))):-1===Object.keys(i.values).indexOf(yt(n))&&r.push(new yr(t,n,"expected one of [".concat(Object.keys(i.values).join(", "),"], ").concat(JSON.stringify(n)," found"))),r}function Tr(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":var t,n=h(e.slice(1));try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!Tr(i)&&"boolean"!=typeof i)return!1}}catch(r){n.e(r)}finally{n.f()}return!0;default:return!0}}function Er(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fill";if(null==e)return{filter:function(){return!0},needGeometry:!1,needFeature:!1};Tr(e)||(e=Pr(e));var n=e,i=!0;try{i=function(e){if(!Mr(e))return e;var t=gt(e);return Lr(t),t=Sr(t)}(n)}catch(e){console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n".concat(JSON.stringify(n,null,2),"\n        "))}var r=pt["filter_".concat(t)],a=cr(i,r),o=null;if("error"===a.result)throw new Error(a.value.map((function(e){return"".concat(e.key,": ").concat(e.message)})).join(", "));o=function(e,t,n){return a.value.evaluate(e,t,{},n)};var s=null,l=null;if(i!==n){var u=cr(n,r);if("error"===u.result)throw new Error(u.value.map((function(e){return"".concat(e.key,": ").concat(e.message)})).join(", "));s=function(e,t,n,i,r){return u.value.evaluate(e,t,{},n,void 0,void 0,i,r)},l=!Rn(u.value.expression)}return{filter:o,dynamicFilter:s||void 0,needGeometry:Ir(i),needFeature:!!l}}function Sr(e){if(!Array.isArray(e))return e;var t=function(e){if(Ar.has(e[0]))for(var t=1;t<e.length;t++)if(Mr(e[t]))return!0;return e}(e);return!0===t?t:t.map((function(e){return Sr(e)}))}function Lr(e){var t=!1,n=[];if("case"===e[0]){for(var i=1;i<e.length-1;i+=2)t=t||Mr(e[i]),n.push(e[i+1]);n.push(e[e.length-1])}else if("match"===e[0]){t=t||Mr(e[1]);for(var r=2;r<e.length-1;r+=2)n.push(e[r+1]);n.push(e[e.length-1])}else if("step"===e[0]){t=t||Mr(e[1]);for(var a=1;a<e.length-1;a+=2)n.push(e[a+1])}t&&(e.length=0,e.push.apply(e,["any"].concat(n)));for(var o=1;o<e.length;o++)Lr(e[o])}function Mr(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;for(var t,n=1;n<e.length;n++)if(Mr(e[n]))return!0;return!1}var Ar=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Cr(e,t){return e<t?-1:e>t?1:0}function Ir(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(var t=1;t<e.length;t++)if(Ir(e[t]))return!0;return!1}function Pr(e){if(!e)return!0;var t,n=e[0];return e.length<=1?"any"!==n:"=="===n?zr(e[1],e[2],"=="):"!="===n?Br(zr(e[1],e[2],"==")):"<"===n||">"===n||"<="===n||">="===n?zr(e[1],e[2],n):"any"===n?(t=e.slice(1),["any"].concat(t.map(Pr))):"all"===n?["all"].concat(e.slice(1).map(Pr)):"none"===n?["all"].concat(e.slice(1).map(Pr).map(Br)):"in"===n?Dr(e[1],e.slice(2)):"!in"===n?Br(Dr(e[1],e.slice(2))):"has"===n?Rr(e[1]):"!has"===n?Br(Rr(e[1])):"within"!==n||e}function zr(e,t,n){switch(e){case"$type":return["filter-type-".concat(n),t];case"$id":return["filter-id-".concat(n),t];default:return["filter-".concat(n),e,t]}}function Dr(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((function(e){return typeof e!=typeof t[0]}))?["filter-in-large",e,["literal",t.sort(Cr)]]:["filter-in-small",e,["literal",t]]}}function Rr(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Br(e){return["!",e]}function Fr(e){return Tr(gt(e.value))?br(mt({},e,{expressionContext:"filter",valueSpec:e.styleSpec["filter_".concat(e.layerType||"fill")]})):Or(e)}function Or(e){var t=e.value,n=e.key;if("array"!==Qi(t))return[new yr(n,t,"array expected, ".concat(Qi(t)," found"))];var i,r=e.styleSpec,a=[];if(t.length<1)return[new yr(n,t,"filter array must have at least 1 element")];switch(a=a.concat(kr({key:"".concat(n,"[0]"),value:t[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec})),yt(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===yt(t[1])&&a.push(new yr(n,t,'"$type" cannot be use with operator "'.concat(t[0],'"')));case"==":case"!=":3!==t.length&&a.push(new yr(n,t,'filter array for operator "'.concat(t[0],'" must have 3 elements')));case"in":case"!in":t.length>=2&&"string"!==(i=Qi(t[1]))&&a.push(new yr("".concat(n,"[1]"),t[1],"string expected, ".concat(i," found")));for(var o=2;o<t.length;o++)i=Qi(t[o]),"$type"===yt(t[1])?a=a.concat(kr({key:"".concat(n,"[").concat(o,"]"),value:t[o],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new yr("".concat(n,"[").concat(o,"]"),t[o],"string, number, or boolean expected, ".concat(i," found")));break;case"any":case"all":case"none":for(var s=1;s<t.length;s++)a=a.concat(Or({key:"".concat(n,"[").concat(s,"]"),value:t[s],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Qi(t[1]),2!==t.length?a.push(new yr(n,t,'filter array for "'.concat(t[0],'" operator must have 2 elements'))):"string"!==i&&a.push(new yr("".concat(n,"[1]"),t[1],"string expected, ".concat(i," found")));break;case"within":i=Qi(t[1]),2!==t.length?a.push(new yr(n,t,'filter array for "'.concat(t[0],'" operator must have 2 elements'))):"object"!==i&&a.push(new yr("".concat(n,"[1]"),t[1],"object expected, ".concat(i," found")))}return a}function Nr(e,t){var n=e.key,i=e.style,r=e.styleSpec,a=e.value,o=e.objectKey,s=r["".concat(t,"_").concat(e.layerType)];if(!s)return[];var l=o.match(/^(.*)-transition$/);if("paint"===t&&l&&s[l[1]]&&s[l[1]].transition)return Jr({key:n,value:a,valueSpec:r.transition,style:i,styleSpec:r});var u,c=e.valueSpec||s[o];if(!c)return[new yr(n,a,'unknown property "'.concat(o,'"'))];if("string"===Qi(a)&&Yi(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(a))){var d='`{ "type": "identity", "property": '.concat(u?JSON.stringify(u[1]):'"_"'," }`");return[new yr(n,a,'"'.concat(o,'" does not support interpolation syntax\nUse an identity property function instead: ').concat(d,"."))]}var h=[];return"symbol"===e.layerType&&("text-field"===o&&i&&!i.glyphs&&h.push(new yr(n,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&er(gt(a))&&"identity"===yt(a.type)&&h.push(new yr(n,a,'"text-font" does not support identity functions'))),h.concat(Jr({key:e.key,value:a,valueSpec:c,style:i,styleSpec:r,expressionContext:"property",propertyType:t,propertyKey:o}))}function Hr(e){return Nr(e,"paint")}function Ur(e){return Nr(e,"layout")}function jr(e){var t=[],n=e.value,i=e.key,r=e.style,a=e.styleSpec;n.type||n.ref||t.push(new yr(i,n,'either "type" or "ref" is required'));var o,s=yt(n.type),l=yt(n.ref);if(n.id)for(var u=yt(n.id),c=0;c<e.arrayIndex;c++){var d=r.layers[c];yt(d.id)===u&&t.push(new yr(i,n.id,'duplicate layer id "'.concat(n.id,'", previously used at line ').concat(d.id.__line__)))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach((function(e){e in n&&t.push(new yr(i,n[e],'"'.concat(e,'" is prohibited for ref layers')))})),r.layers.forEach((function(e){yt(e.id)===l&&(o=e)})),o?o.ref?t.push(new yr(i,n.ref,"ref cannot reference another ref layer")):s=yt(o.type):"string"==typeof l&&t.push(new yr(i,n.ref,'ref layer "'.concat(l,'" not found')));else if("background"!==s&&"sky"!==s)if(n.source){var h=r.sources&&r.sources[n.source],f=h&&yt(h.type);h?"vector"===f&&"raster"===s?t.push(new yr(i,n.source,'layer "'.concat(n.id,'" requires a raster source'))):"raster"===f&&"raster"!==s?t.push(new yr(i,n.source,'layer "'.concat(n.id,'" requires a vector source'))):"vector"!==f||n["source-layer"]?"raster-dem"===f&&"hillshade"!==s?t.push(new yr(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===f&&h.lineMetrics||t.push(new yr(i,n,'layer "'.concat(n.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):t.push(new yr(i,n,'layer "'.concat(n.id,'" must specify a "source-layer"'))):t.push(new yr(i,n.source,'source "'.concat(n.source,'" not found')))}else t.push(new yr(i,n,'missing required property "source"'));return t=t.concat(gr({key:i,value:n,valueSpec:a.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Jr({key:"".concat(i,".type"),value:n.type,valueSpec:a.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"})},filter:function(e){return Fr(mt({layerType:s},e))},layout:function(e){return gr({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return Ur(mt({layerType:s},e))}}})},paint:function(e){return gr({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return Hr(mt({layerType:s},e))}}})}}})),t}function Vr(e){var t=e.value,n=e.key,i=Qi(t);return"string"!==i?[new yr(n,t,"string expected, ".concat(i," found"))]:[]}var Wr={promoteId:function(e){var t=e.key,n=e.value;if("string"===Qi(n))return Vr({key:t,value:n});var i=[];for(var r in n)i.push.apply(i,c(Vr({key:"".concat(t,".").concat(r),value:n[r]})));return i}};function Gr(e){var t=e.value,n=e.key,i=e.styleSpec,r=e.style;if(!t.type)return[new yr(n,t,'"type" is required')];var a,o=yt(t.type);switch(o){case"vector":case"raster":case"raster-dem":return a=gr({key:n,value:t,valueSpec:i["source_".concat(o.replace("-","_"))],style:e.style,styleSpec:i,objectElementValidators:Wr});case"geojson":if(a=gr({key:n,value:t,valueSpec:i.source_geojson,style:r,styleSpec:i,objectElementValidators:Wr}),t.cluster)for(var s in t.clusterProperties){var l,u,h=d(t.clusterProperties[s],2),f=h[0],p=h[1],m="string"==typeof f?[f,["accumulated"],["get",s]]:f;(l=a).push.apply(l,c(br({key:"".concat(n,".").concat(s,".map"),value:p,expressionContext:"cluster-map"}))),(u=a).push.apply(u,c(br({key:"".concat(n,".").concat(s,".reduce"),value:m,expressionContext:"cluster-reduce"})))}return a;case"video":return gr({key:n,value:t,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return gr({key:n,value:t,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return[new yr(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return kr({key:"".concat(n,".type"),value:t.type,valueSpec:{values:qr(i)},style:r,styleSpec:i})}}function qr(e){return e.source.reduce((function(t,n){var i=e[n];return"enum"===i.type.type&&(t=t.concat(Object.keys(i.type.values))),t}),[])}function Zr(e){var t=e.value,n=e.styleSpec,i=n.light,r=e.style,a=[],o=Qi(t);if(void 0===t)return a;if("object"!==o)return a=a.concat([new yr("light",t,"object expected, ".concat(o," found"))]);for(var s in t){var l=s.match(/^(.*)-transition$/);a=a.concat(l&&i[l[1]]&&i[l[1]].transition?Jr({key:s,value:t[s],valueSpec:n.transition,style:r,styleSpec:n}):i[s]?Jr({key:s,value:t[s],valueSpec:i[s],style:r,styleSpec:n}):[new yr(s,t[s],'unknown property "'.concat(s,'"'))])}return a}function Xr(e){var t=e.value,n=e.key,i=e.style,r=e.styleSpec,a=r.terrain,o=[],s=Qi(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new yr("terrain",t,"object expected, ".concat(s," found"))]);for(var l in t){var u=l.match(/^(.*)-transition$/);o=o.concat(u&&a[u[1]]&&a[u[1]].transition?Jr({key:l,value:t[l],valueSpec:r.transition,style:i,styleSpec:r}):a[l]?Jr({key:l,value:t[l],valueSpec:a[l],style:i,styleSpec:r}):[new yr(l,t[l],'unknown property "'.concat(l,'"'))])}if(t.source){var c=i.sources&&i.sources[t.source],d=c&&yt(c.type);c?"raster-dem"!==d&&o.push(new yr(n,t.source,"terrain cannot be used with a source of type ".concat(String(d),', it only be used with a "raster-dem" source type'))):o.push(new yr(n,t.source,'source "'.concat(t.source,'" not found')))}else o.push(new yr(n,t,'terrain is missing required property "source"'));return o}function Kr(e){var t=e.value,n=e.style,i=e.styleSpec,r=i.fog,a=[],o=Qi(t);if(void 0===t)return a;if("object"!==o)return a=a.concat([new yr("fog",t,"object expected, ".concat(o," found"))]);for(var s in t){var l=s.match(/^(.*)-transition$/);a=a.concat(l&&r[l[1]]&&r[l[1]].transition?Jr({key:s,value:t[s],valueSpec:i.transition,style:n,styleSpec:i}):r[s]?Jr({key:s,value:t[s],valueSpec:r[s],style:n,styleSpec:i}):[new yr(s,t[s],'unknown property "'.concat(s,'"'))])}return a}var Yr={"*":function(){return[]},array:vr,boolean:function(e){var t=e.value,n=e.key,i=Qi(t);return"boolean"!==i?[new yr(n,t,"boolean expected, ".concat(i," found"))]:[]},number:_r,color:function(e){var t=e.key,n=e.value,i=Qi(n);return"string"!==i?[new yr(t,n,"color expected, ".concat(i," found"))]:null===Ot(n)?[new yr(t,n,'color expected, "'.concat(n,'" found'))]:[]},enum:kr,filter:Fr,function:xr,layer:jr,object:gr,source:Gr,light:Zr,terrain:Xr,fog:Kr,string:Vr,formatted:function(e){return 0===Vr(e).length?[]:br(e)},resolvedImage:function(e){return 0===Vr(e).length?[]:br(e)},projection:function(e){var t=e.value,n=e.styleSpec,i=n.projection,r=e.style,a=[],o=Qi(t);if("object"===o)for(var s in t)a=a.concat(Jr({key:s,value:t[s],valueSpec:i[s],style:r,styleSpec:n}));else"string"!==o&&(a=a.concat([new yr("projection",t,"object or string expected, ".concat(o," found"))]));return a}};function Jr(e){var t=e.value,n=e.valueSpec,i=e.styleSpec;return n.expression&&er(yt(t))?xr(e):n.expression&&ur(gt(t))?br(e):n.type&&Yr[n.type]?Yr[n.type](e):gr(mt({},e,{valueSpec:n.type?i[n.type]:n}))}function $r(e){var t=e.value,n=e.key,i=Vr(e);return i.length||(-1===t.indexOf("{fontstack}")&&i.push(new yr(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&i.push(new yr(n,t,'"glyphs" url must include a "{range}" token'))),i}function Qr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pt;return na(Jr({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:$r,"*":function(){return[]}}}))}var ea=function(e){return na(Hr(e))},ta=function(e){return na(Ur(e))};function na(e){return e.slice().sort((function(e,t){return e.line&&t.line?e.line-t.line:0}))}function ia(e,t){var n=!1;if(t&&t.length){var i,r=h(t);try{for(r.s();!(i=r.n()).done;){var a=i.value;e.fire(new ht(new Error(a.message))),n=!0}}catch(o){r.e(o)}finally{r.f()}}return n}var ra=oa,aa=3;function oa(e,t,n){var i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(n=r[2]);for(var a=0;a<this.d*this.d;a++){var o=r[aa+a],s=r[aa+a+1];i.push(o===s?null:r.subarray(o,s))}var l=r[aa+i.length+1];this.keys=r.subarray(r[aa+i.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var u=0;u<this.d*this.d;u++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var c=n/t*e;this.min=-c,this.max=e+c}oa.prototype.insert=function(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},oa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},oa.prototype._insertCell=function(e,t,n,i,r,a){this.cells[r].push(a)},oa.prototype.query=function(e,t,n,i,r){var a=this.min,o=this.max;if(e<=a&&t<=a&&o<=n&&o<=i&&!r)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,n,i,this._queryCell,s,{},r),s},oa.prototype._queryCell=function(e,t,n,i,r,a,o,s){var l=this.cells[r];if(null!==l)for(var u=this.keys,c=this.bboxes,d=0;d<l.length;d++){var h=l[d];if(void 0===o[h]){var f=4*h;(s?s(c[f+0],c[f+1],c[f+2],c[f+3]):e<=c[f+2]&&t<=c[f+3]&&n>=c[f+0]&&i>=c[f+1])?(o[h]=!0,a.push(u[h])):o[h]=!1}}},oa.prototype._forEachCell=function(e,t,n,i,r,a,o,s){for(var l=this._convertToCellCoord(e),u=this._convertToCellCoord(t),c=this._convertToCellCoord(n),d=this._convertToCellCoord(i),h=l;h<=c;h++)for(var f=u;f<=d;f++){var p=this.d*f+h;if((!s||s(this._convertFromCellCoord(h),this._convertFromCellCoord(f),this._convertFromCellCoord(h+1),this._convertFromCellCoord(f+1)))&&r.call(this,e,t,n,i,p,a,o,s))return}},oa.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},oa.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},oa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=aa+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var r=new Int32Array(t+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var a=t,o=0;o<e.length;o++){var s=e[o];r[aa+o]=a,r.set(s,a),a+=s.length}return r[aa+e.length]=a,r.set(this.keys,a),r[aa+e.length+1]=a+=this.keys.length,r.set(this.bboxes,a),a+=this.bboxes.length,r.buffer};var sa=S(ra),la={};function ua(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),la[t]={klass:e,omit:n.omit||[]}}for(var ca in ua(Object,"Object"),sa.serialize=function(e,t){var n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}},sa.deserialize=function(e){return new sa(e.buffer)},Object.defineProperty(sa,"name",{value:"Grid"}),ua(sa,"Grid"),ua(Gt,"Color"),ua(Error,"Error"),ua(ke,"AJAXError"),ua(Kt,"ResolvedImage"),ua(pr,"StylePropertyFunction"),ua(lr,"StyleExpression",{omit:["_evaluator"]}),ua(hr,"ZoomDependentExpression"),ua(dr,"ZoomConstantExpression"),ua(mn,"CompoundExpression",{omit:["_evaluate"]}),Zi)la[Zi[ca]._classRegistryKey]||ua(Zi[ca],"Expression".concat(ca));function da(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function ha(e){return v.ImageBitmap&&e instanceof v.ImageBitmap}function fa(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(da(e)||ha(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var n=e;return t&&t.push(n.buffer),n}if(e instanceof v.ImageData)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){var i,r=[],a=h(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;r.push(fa(o,t))}}catch(d){a.e(d)}finally{a.f()}return r}if("object"==typeof e){var s=e.constructor,l=s._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class ".concat(l));var u=s.serialize?s.serialize(e,t):{};if(!s.serialize){for(var c in e)e.hasOwnProperty(c)&&(la[l].omit.indexOf(c)>=0||(u[c]=fa(e[c],t)));e instanceof Error&&(u.message=e.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof e)}function pa(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||da(e)||ha(e)||ArrayBuffer.isView(e)||e instanceof v.ImageData)return e;if(Array.isArray(e))return e.map(pa);if("object"==typeof e){var t=e.$name||"Object",n=la[t].klass;if(!n)throw new Error("can't deserialize unregistered class ".concat(t));if(n.deserialize)return n.deserialize(e);for(var i=Object.create(n.prototype),r=0,a=Object.keys(e);r<a.length;r++){var o=a[r];"$name"!==o&&(i[o]=pa(e[o]))}return i}throw new Error("can't deserialize object of type "+typeof e)}var ma={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function ya(e){var t,n=h(e);try{for(n.s();!(t=n.n()).done;)if(_a(t.value.charCodeAt(0)))return!0}catch(i){n.e(i)}finally{n.f()}return!1}function ga(e){var t,n=h(e);try{for(n.s();!(t=n.n()).done;)if(!va(t.value.charCodeAt(0)))return!1}catch(i){n.e(i)}finally{n.f()}return!0}function va(e){return!(ma.Arabic(e)||ma["Arabic Supplement"](e)||ma["Arabic Extended-A"](e)||ma["Arabic Presentation Forms-A"](e)||ma["Arabic Presentation Forms-B"](e))}function _a(e){return!(746!==e&&747!==e&&(e<4352||!(ma["Bopomofo Extended"](e)||ma.Bopomofo(e)||ma["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||ma["CJK Compatibility Ideographs"](e)||ma["CJK Compatibility"](e)||ma["CJK Radicals Supplement"](e)||ma["CJK Strokes"](e)||!(!ma["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||ma["CJK Unified Ideographs Extension A"](e)||ma["CJK Unified Ideographs"](e)||ma["Enclosed CJK Letters and Months"](e)||ma["Hangul Compatibility Jamo"](e)||ma["Hangul Jamo Extended-A"](e)||ma["Hangul Jamo Extended-B"](e)||ma["Hangul Jamo"](e)||ma["Hangul Syllables"](e)||ma.Hiragana(e)||ma["Ideographic Description Characters"](e)||ma.Kanbun(e)||ma["Kangxi Radicals"](e)||ma["Katakana Phonetic Extensions"](e)||ma.Katakana(e)&&12540!==e||!(!ma["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!ma["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||ma["Unified Canadian Aboriginal Syllabics"](e)||ma["Unified Canadian Aboriginal Syllabics Extended"](e)||ma["Vertical Forms"](e)||ma["Yijing Hexagram Symbols"](e)||ma["Yi Syllables"](e)||ma["Yi Radicals"](e))))}function xa(e){return!(_a(e)||function(e){return!!(ma["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||ma["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||ma["Letterlike Symbols"](e)||ma["Number Forms"](e)||ma["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||ma["Control Pictures"](e)&&9251!==e||ma["Optical Character Recognition"](e)||ma["Enclosed Alphanumerics"](e)||ma["Geometric Shapes"](e)||ma["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ma["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ma["CJK Symbols and Punctuation"](e)||ma.Katakana(e)||ma["Private Use Area"](e)||ma["CJK Compatibility Forms"](e)||ma["Small Form Variants"](e)||ma["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function ba(e){return e>=1424&&e<=2303||ma["Arabic Presentation Forms-A"](e)||ma["Arabic Presentation Forms-B"](e)}function wa(e,t){return!(!t&&ba(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||ma.Khmer(e))}function ka(e){var t,n=h(e);try{for(n.s();!(t=n.n()).done;)if(ba(t.value.charCodeAt(0)))return!0}catch(i){n.e(i)}finally{n.f()}return!1}var Ta="deferred",Ea="loading",Sa="loaded",La=null,Ma="unavailable",Aa=null,Ca=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Ma="error"),La&&La(e)};function Ia(){Pa.fire(new dt("pluginStateChange",{pluginStatus:Ma,pluginURL:Aa}))}var Pa=new ft,za=function(){return Ma},Da=function(){if(Ma!==Ta||!Aa)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ma=Ea,Ia(),Aa&&Se({url:Aa},(function(e){e?Ca(e):(Ma=Sa,Ia())}))},Ra={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ma===Sa||null!=Ra.applyArabicShaping},isLoading:function(){return Ma===Ea},setState:function(e){Ma=e.pluginStatus,Aa=e.pluginURL},isParsed:function(){return null!=Ra.applyArabicShaping&&null!=Ra.processBidirectionalText&&null!=Ra.processStyledBidirectionalText},getPluginURL:function(){return Aa}},Ba=function(){function e(t,n){f(this,e),this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}return p(e,[{key:"isSupportedScript",value:function(e){return function(e,t){var n,i=h(e);try{for(i.s();!(n=i.n()).done;)if(!wa(n.value.charCodeAt(0),t))return!1}catch(r){i.e(r)}finally{i.f()}return!0}(e,Ra.isLoaded())}}]),e}(),Fa=function(){function e(t,n){f(this,e),this.property=t,this.value=n,this.expression=function(e,t){if(er(e))return new pr(e,t);if(ur(e)){var n=fr(e,t);if("error"===n.result)throw new Error(n.value.map((function(e){return"".concat(e.key,": ").concat(e.message)})).join(", "));return n.value}var i=e;return"string"==typeof e&&"color"===t.type&&(i=Gt.parse(e)),{kind:"constant",evaluate:function(){return i}}}(void 0===n?t.specification.default:n,t.specification)}return p(e,[{key:"isDataDriven",value:function(){return"source"===this.expression.kind||"composite"===this.expression.kind}},{key:"possiblyEvaluate",value:function(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}]),e}(),Oa=function(){function e(t){f(this,e),this.property=t,this.value=new Fa(t,void 0)}return p(e,[{key:"transitioned",value:function(e,t){return new Ha(this.property,this.value,t,q({},e.transition,this.transition),e.now)}},{key:"untransitioned",value:function(){return new Ha(this.property,this.value,null,{},0)}}]),e}(),Na=function(){function e(t){f(this,e),this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}return p(e,[{key:"getValue",value:function(e){return ne(this._values[e].value.value)}},{key:"setValue",value:function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Oa(this._values[e].property)),this._values[e].value=new Fa(this._values[e].property,null===t?void 0:ne(t))}},{key:"getTransition",value:function(e){return ne(this._values[e].transition)}},{key:"setTransition",value:function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Oa(this._values[e].property)),this._values[e].transition=ne(t)||void 0}},{key:"serialize",value:function(){for(var e={},t=0,n=Object.keys(this._values);t<n.length;t++){var i=n[t],r=this.getValue(i);void 0!==r&&(e[i]=r);var a=this.getTransition(i);void 0!==a&&(e["".concat(i,"-transition")]=a)}return e}},{key:"transitioned",value:function(e,t){for(var n=new Ua(this._properties),i=0,r=Object.keys(this._values);i<r.length;i++){var a=r[i];n._values[a]=this._values[a].transitioned(e,t._values[a])}return n}},{key:"untransitioned",value:function(){for(var e=new Ua(this._properties),t=0,n=Object.keys(this._values);t<n.length;t++){var i=n[t];e._values[i]=this._values[i].untransitioned()}return e}}]),e}(),Ha=function(){function e(t,n,i,r,a){f(this,e);var o=r.delay||0,s=r.duration||0;a=a||0,this.property=t,this.value=n,this.begin=a+o,this.end=this.begin+s,t.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}return p(e,[{key:"possiblyEvaluate",value:function(e,t,n){var i=e.now||0,r=this.value.possiblyEvaluate(e,t,n),a=this.prior;if(a){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return a.possiblyEvaluate(e,t,n);var o=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,n),r,O(o))}return r}}]),e}(),Ua=function(){function e(t){f(this,e),this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}return p(e,[{key:"possiblyEvaluate",value:function(e,t,n){for(var i=new Wa(this._properties),r=0,a=Object.keys(this._values);r<a.length;r++){var o=a[r];i._values[o]=this._values[o].possiblyEvaluate(e,t,n)}return i}},{key:"hasTransition",value:function(){for(var e=0,t=Object.keys(this._values);e<t.length;e++){var n=t[e];if(this._values[n].prior)return!0}return!1}}]),e}(),ja=function(){function e(t){f(this,e),this._properties=t,this._values=Object.create(t.defaultPropertyValues)}return p(e,[{key:"getValue",value:function(e){return ne(this._values[e].value)}},{key:"setValue",value:function(e,t){this._values[e]=new Fa(this._values[e].property,null===t?void 0:ne(t))}},{key:"serialize",value:function(){for(var e={},t=0,n=Object.keys(this._values);t<n.length;t++){var i=n[t],r=this.getValue(i);void 0!==r&&(e[i]=r)}return e}},{key:"possiblyEvaluate",value:function(e,t,n){for(var i=new Wa(this._properties),r=0,a=Object.keys(this._values);r<a.length;r++){var o=a[r];i._values[o]=this._values[o].possiblyEvaluate(e,t,n)}return i}}]),e}(),Va=function(){function e(t,n,i){f(this,e),this.property=t,this.value=n,this.parameters=i}return p(e,[{key:"isConstant",value:function(){return"constant"===this.value.kind}},{key:"constantOr",value:function(e){return"constant"===this.value.kind?this.value.value:e}},{key:"evaluate",value:function(e,t,n,i){return this.property.evaluate(this.value,this.parameters,e,t,n,i)}}]),e}(),Wa=function(){function e(t){f(this,e),this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}return p(e,[{key:"get",value:function(e){return this._values[e]}}]),e}(),Ga=function(){function e(t){f(this,e),this.specification=t}return p(e,[{key:"possiblyEvaluate",value:function(e,t){return e.expression.evaluate(t)}},{key:"interpolate",value:function(e,t,n){var i=Zn[this.specification.type];return i?i(e,t,n):e}}]),e}(),qa=function(){function e(t,n){f(this,e),this.specification=t,this.overrides=n}return p(e,[{key:"possiblyEvaluate",value:function(e,t,n,i){return new Va(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,i)}:e.expression,t)}},{key:"interpolate",value:function(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Va(this,{kind:"constant",value:void 0},e.parameters);var i=Zn[this.specification.type];return i?new Va(this,{kind:"constant",value:i(e.value.value,t.value.value,n)},e.parameters):e}},{key:"evaluate",value:function(e,t,n,i,r,a){return"constant"===e.kind?e.value:e.evaluate(t,n,i,r,a)}}]),e}(),Za=function(){function e(t){f(this,e),this.specification=t}return p(e,[{key:"possiblyEvaluate",value:function(e,t,n,i){return!!e.expression.evaluate(t,null,{},n,i)}},{key:"interpolate",value:function(){return!1}}]),e}(),Xa=p((function e(t){f(this,e),this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];var n=new Ba(0,{});for(var i in t){var r=t[i];r.specification.overridable&&this.overridableProperties.push(i);var a=this.defaultPropertyValues[i]=new Fa(r,void 0),o=this.defaultTransitionablePropertyValues[i]=new Oa(r);this.defaultTransitioningPropertyValues[i]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=a.possiblyEvaluate(n)}}));function Ka(e,t){return 256*(e=U(Math.floor(e),0,255))+U(Math.floor(t),0,255)}ua(qa,"DataDrivenProperty"),ua(Ga,"DataConstantProperty"),ua(Za,"ColorRampProperty");var Ya={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ja=p((function e(t,n){f(this,e),this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8})),$a=function(){function e(){f(this,e),this.isTransferred=!1,this.capacity=-1,this.resize(0)}return p(e,[{key:"_trim",value:function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}},{key:"clear",value:function(){this.length=0}},{key:"resize",value:function(e){this.reserve(e),this.length=e}},{key:"reserve",value:function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}},{key:"_refreshViews",value:function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}},{key:"destroy",value:function(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}],[{key:"serialize",value:function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}},{key:"deserialize",value:function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}}]),e}();function Qa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,i=0;return{members:e.map((function(e){var r=Ya[e.type].BYTES_PER_ELEMENT,a=n=eo(n,Math.max(t,r)),o=e.components||1;return i=Math.max(i,r),n+=r*o,{name:e.name,type:e.type,components:o,offset:a}})),size:eo(n,Math.max(i,t)),alignment:t}}function eo(e,t){return Math.ceil(e/t)*t}var to=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t){var n=this.length;return this.resize(n+1),this.emplace(n,e,t)}},{key:"emplace",value:function(e,t,n){var i=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,e}}]),n}($a);to.prototype.bytesPerElement=4,ua(to,"StructArrayLayout2i4");var no=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}},{key:"emplace",value:function(e,t,n,i){var r=3*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.int16[r+2]=i,e}}]),n}($a);no.prototype.bytesPerElement=6,ua(no,"StructArrayLayout3i6");var io=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}},{key:"emplace",value:function(e,t,n,i,r){var a=4*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,e}}]),n}($a);io.prototype.bytesPerElement=8,ua(io,"StructArrayLayout4i8");var ro=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i,r,a,o){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,a,o)}},{key:"emplace",value:function(e,t,n,i,r,a,o,s){var l=6*e,u=12*e,c=3*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.uint8[u+4]=i,this.uint8[u+5]=r,this.uint8[u+6]=a,this.uint8[u+7]=o,this.float32[c+2]=s,e}}]),n}($a);ro.prototype.bytesPerElement=12,ua(ro,"StructArrayLayout2i4ub1f12");var ao=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}},{key:"emplace",value:function(e,t,n,i,r){var a=4*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=i,this.float32[a+3]=r,e}}]),n}($a);ao.prototype.bytesPerElement=16,ua(ao,"StructArrayLayout4f16");var oo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i,r){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r)}},{key:"emplace",value:function(e,t,n,i,r,a){var o=6*e,s=3*e;return this.uint16[o+0]=t,this.uint16[o+1]=n,this.uint16[o+2]=i,this.uint16[o+3]=r,this.float32[s+2]=a,e}}]),n}($a);oo.prototype.bytesPerElement=12,ua(oo,"StructArrayLayout4ui1f12");var so=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}},{key:"emplace",value:function(e,t,n,i,r){var a=4*e;return this.uint16[a+0]=t,this.uint16[a+1]=n,this.uint16[a+2]=i,this.uint16[a+3]=r,e}}]),n}($a);so.prototype.bytesPerElement=8,ua(so,"StructArrayLayout4ui8");var lo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i,r,a){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r,a)}},{key:"emplace",value:function(e,t,n,i,r,a,o){var s=6*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=o,e}}]),n}($a);lo.prototype.bytesPerElement=12,ua(lo,"StructArrayLayout6i12");var uo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i,r,a,o,s,l,u,c,d){var h=this.length;return this.resize(h+1),this.emplace(h,e,t,n,i,r,a,o,s,l,u,c,d)}},{key:"emplace",value:function(e,t,n,i,r,a,o,s,l,u,c,d,h){var f=12*e;return this.int16[f+0]=t,this.int16[f+1]=n,this.int16[f+2]=i,this.int16[f+3]=r,this.uint16[f+4]=a,this.uint16[f+5]=o,this.uint16[f+6]=s,this.uint16[f+7]=l,this.int16[f+8]=u,this.int16[f+9]=c,this.int16[f+10]=d,this.int16[f+11]=h,e}}]),n}($a);uo.prototype.bytesPerElement=24,ua(uo,"StructArrayLayout4i4ui4i24");var co=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i,r,a){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r,a)}},{key:"emplace",value:function(e,t,n,i,r,a,o){var s=10*e,l=5*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=i,this.float32[l+2]=r,this.float32[l+3]=a,this.float32[l+4]=o,e}}]),n}($a);co.prototype.bytesPerElement=20,ua(co,"StructArrayLayout3i3f20");var ho=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}},{key:"emplace",value:function(e,t){return this.uint32[1*e+0]=t,e}}]),n}($a);ho.prototype.bytesPerElement=4,ua(ho,"StructArrayLayout1ul4");var fo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i,r,a,o,s,l,u,c,d,h){var f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,i,r,a,o,s,l,u,c,d,h)}},{key:"emplace",value:function(e,t,n,i,r,a,o,s,l,u,c,d,h,f){var p=20*e,m=10*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.int16[p+4]=a,this.float32[m+3]=o,this.float32[m+4]=s,this.float32[m+5]=l,this.float32[m+6]=u,this.int16[p+14]=c,this.uint32[m+8]=d,this.uint16[p+18]=h,this.uint16[p+19]=f,e}}]),n}($a);fo.prototype.bytesPerElement=40,ua(fo,"StructArrayLayout5i4f1i1ul2ui40");var po=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i,r,a,o){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,a,o)}},{key:"emplace",value:function(e,t,n,i,r,a,o,s){var l=8*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=i,this.int16[l+4]=r,this.int16[l+5]=a,this.int16[l+6]=o,this.int16[l+7]=s,e}}]),n}($a);po.prototype.bytesPerElement=16,ua(po,"StructArrayLayout3i2i2i16");var mo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i,r){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r)}},{key:"emplace",value:function(e,t,n,i,r,a){var o=4*e,s=8*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.int16[s+6]=r,this.int16[s+7]=a,e}}]),n}($a);mo.prototype.bytesPerElement=16,ua(mo,"StructArrayLayout2f1f2i16");var yo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}},{key:"emplace",value:function(e,t,n,i,r){var a=12*e,o=3*e;return this.uint8[a+0]=t,this.uint8[a+1]=n,this.float32[o+1]=i,this.float32[o+2]=r,e}}]),n}($a);yo.prototype.bytesPerElement=12,ua(yo,"StructArrayLayout2ub2f12");var go=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}},{key:"emplace",value:function(e,t,n,i){var r=3*e;return this.float32[r+0]=t,this.float32[r+1]=n,this.float32[r+2]=i,e}}]),n}($a);go.prototype.bytesPerElement=12,ua(go,"StructArrayLayout3f12");var vo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}},{key:"emplace",value:function(e,t,n,i){var r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,this.uint16[r+2]=i,e}}]),n}($a);vo.prototype.bytesPerElement=6,ua(vo,"StructArrayLayout3ui6");var _o=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,y,g,v,_,x){var b=this.length;return this.resize(b+1),this.emplace(b,e,t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,y,g,v,_,x)}},{key:"emplace",value:function(e,t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,y,g,v,_,x,b){var w=30*e,k=15*e,T=60*e;return this.int16[w+0]=t,this.int16[w+1]=n,this.int16[w+2]=i,this.float32[k+2]=r,this.float32[k+3]=a,this.uint16[w+8]=o,this.uint16[w+9]=s,this.uint32[k+5]=l,this.uint32[k+6]=u,this.uint32[k+7]=c,this.uint16[w+16]=d,this.uint16[w+17]=h,this.uint16[w+18]=f,this.float32[k+10]=p,this.float32[k+11]=m,this.uint8[T+48]=y,this.uint8[T+49]=g,this.uint8[T+50]=v,this.uint32[k+13]=_,this.int16[w+28]=x,this.uint8[T+58]=b,e}}]),n}($a);_o.prototype.bytesPerElement=60,ua(_o,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");var xo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,y,g,v,_,x,b,w,k,T,E,S,L,M,A){var C=this.length;return this.resize(C+1),this.emplace(C,e,t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,y,g,v,_,x,b,w,k,T,E,S,L,M,A)}},{key:"emplace",value:function(e,t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,y,g,v,_,x,b,w,k,T,E,S,L,M,A,C){var I=38*e,P=19*e;return this.int16[I+0]=t,this.int16[I+1]=n,this.int16[I+2]=i,this.float32[P+2]=r,this.float32[P+3]=a,this.int16[I+8]=o,this.int16[I+9]=s,this.int16[I+10]=l,this.int16[I+11]=u,this.int16[I+12]=c,this.int16[I+13]=d,this.uint16[I+14]=h,this.uint16[I+15]=f,this.uint16[I+16]=p,this.uint16[I+17]=m,this.uint16[I+18]=y,this.uint16[I+19]=g,this.uint16[I+20]=v,this.uint16[I+21]=_,this.uint16[I+22]=x,this.uint16[I+23]=b,this.uint16[I+24]=w,this.uint16[I+25]=k,this.uint16[I+26]=T,this.uint16[I+27]=E,this.uint16[I+28]=S,this.uint32[P+15]=L,this.float32[P+16]=M,this.float32[P+17]=A,this.float32[P+18]=C,e}}]),n}($a);xo.prototype.bytesPerElement=76,ua(xo,"StructArrayLayout3i2f6i15ui1ul3f76");var bo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}},{key:"emplace",value:function(e,t){return this.float32[1*e+0]=t,e}}]),n}($a);bo.prototype.bytesPerElement=4,ua(bo,"StructArrayLayout1f4");var wo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i,r){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r)}},{key:"emplace",value:function(e,t,n,i,r,a){var o=5*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=r,this.float32[o+4]=a,e}}]),n}($a);wo.prototype.bytesPerElement=20,ua(wo,"StructArrayLayout5f20");var ko=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}},{key:"emplace",value:function(e,t,n,i,r){var a=6*e;return this.uint32[3*e+0]=t,this.uint16[a+2]=n,this.uint16[a+3]=i,this.uint16[a+4]=r,e}}]),n}($a);ko.prototype.bytesPerElement=12,ua(ko,"StructArrayLayout1ul3ui12");var To=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t){var n=this.length;return this.resize(n+1),this.emplace(n,e,t)}},{key:"emplace",value:function(e,t,n){var i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,e}}]),n}($a);To.prototype.bytesPerElement=4,ua(To,"StructArrayLayout2ui4");var Eo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}},{key:"emplace",value:function(e,t){return this.uint16[1*e+0]=t,e}}]),n}($a);Eo.prototype.bytesPerElement=2,ua(Eo,"StructArrayLayout1ui2");var So=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t){var n=this.length;return this.resize(n+1),this.emplace(n,e,t)}},{key:"emplace",value:function(e,t,n){var i=2*e;return this.float32[i+0]=t,this.float32[i+1]=n,e}}]),n}($a);So.prototype.bytesPerElement=8,ua(So,"StructArrayLayout2f8");var Lo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"projectedAnchorX",get:function(){return this._structArray.int16[this._pos2+0]}},{key:"projectedAnchorY",get:function(){return this._structArray.int16[this._pos2+1]}},{key:"projectedAnchorZ",get:function(){return this._structArray.int16[this._pos2+2]}},{key:"tileAnchorX",get:function(){return this._structArray.int16[this._pos2+3]}},{key:"tileAnchorY",get:function(){return this._structArray.int16[this._pos2+4]}},{key:"x1",get:function(){return this._structArray.float32[this._pos4+3]}},{key:"y1",get:function(){return this._structArray.float32[this._pos4+4]}},{key:"x2",get:function(){return this._structArray.float32[this._pos4+5]}},{key:"y2",get:function(){return this._structArray.float32[this._pos4+6]}},{key:"padding",get:function(){return this._structArray.int16[this._pos2+14]}},{key:"featureIndex",get:function(){return this._structArray.uint32[this._pos4+8]}},{key:"sourceLayerIndex",get:function(){return this._structArray.uint16[this._pos2+18]}},{key:"bucketIndex",get:function(){return this._structArray.uint16[this._pos2+19]}}]),n}(Ja);Lo.prototype.size=40;var Mo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"get",value:function(e){return new Lo(this,e)}}]),n}(fo);ua(Mo,"CollisionBoxArray");var Ao=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"projectedAnchorX",get:function(){return this._structArray.int16[this._pos2+0]}},{key:"projectedAnchorY",get:function(){return this._structArray.int16[this._pos2+1]}},{key:"projectedAnchorZ",get:function(){return this._structArray.int16[this._pos2+2]}},{key:"tileAnchorX",get:function(){return this._structArray.float32[this._pos4+2]}},{key:"tileAnchorY",get:function(){return this._structArray.float32[this._pos4+3]}},{key:"glyphStartIndex",get:function(){return this._structArray.uint16[this._pos2+8]}},{key:"numGlyphs",get:function(){return this._structArray.uint16[this._pos2+9]}},{key:"vertexStartIndex",get:function(){return this._structArray.uint32[this._pos4+5]}},{key:"lineStartIndex",get:function(){return this._structArray.uint32[this._pos4+6]}},{key:"lineLength",get:function(){return this._structArray.uint32[this._pos4+7]}},{key:"segment",get:function(){return this._structArray.uint16[this._pos2+16]}},{key:"lowerSize",get:function(){return this._structArray.uint16[this._pos2+17]}},{key:"upperSize",get:function(){return this._structArray.uint16[this._pos2+18]}},{key:"lineOffsetX",get:function(){return this._structArray.float32[this._pos4+10]}},{key:"lineOffsetY",get:function(){return this._structArray.float32[this._pos4+11]}},{key:"writingMode",get:function(){return this._structArray.uint8[this._pos1+48]}},{key:"placedOrientation",get:function(){return this._structArray.uint8[this._pos1+49]},set:function(e){this._structArray.uint8[this._pos1+49]=e}},{key:"hidden",get:function(){return this._structArray.uint8[this._pos1+50]},set:function(e){this._structArray.uint8[this._pos1+50]=e}},{key:"crossTileID",get:function(){return this._structArray.uint32[this._pos4+13]},set:function(e){this._structArray.uint32[this._pos4+13]=e}},{key:"associatedIconIndex",get:function(){return this._structArray.int16[this._pos2+28]}},{key:"flipState",get:function(){return this._structArray.uint8[this._pos1+58]},set:function(e){this._structArray.uint8[this._pos1+58]=e}}]),n}(Ja);Ao.prototype.size=60;var Co=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"get",value:function(e){return new Ao(this,e)}}]),n}(_o);ua(Co,"PlacedSymbolArray");var Io=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"projectedAnchorX",get:function(){return this._structArray.int16[this._pos2+0]}},{key:"projectedAnchorY",get:function(){return this._structArray.int16[this._pos2+1]}},{key:"projectedAnchorZ",get:function(){return this._structArray.int16[this._pos2+2]}},{key:"tileAnchorX",get:function(){return this._structArray.float32[this._pos4+2]}},{key:"tileAnchorY",get:function(){return this._structArray.float32[this._pos4+3]}},{key:"rightJustifiedTextSymbolIndex",get:function(){return this._structArray.int16[this._pos2+8]}},{key:"centerJustifiedTextSymbolIndex",get:function(){return this._structArray.int16[this._pos2+9]}},{key:"leftJustifiedTextSymbolIndex",get:function(){return this._structArray.int16[this._pos2+10]}},{key:"verticalPlacedTextSymbolIndex",get:function(){return this._structArray.int16[this._pos2+11]}},{key:"placedIconSymbolIndex",get:function(){return this._structArray.int16[this._pos2+12]}},{key:"verticalPlacedIconSymbolIndex",get:function(){return this._structArray.int16[this._pos2+13]}},{key:"key",get:function(){return this._structArray.uint16[this._pos2+14]}},{key:"textBoxStartIndex",get:function(){return this._structArray.uint16[this._pos2+15]}},{key:"textBoxEndIndex",get:function(){return this._structArray.uint16[this._pos2+16]}},{key:"verticalTextBoxStartIndex",get:function(){return this._structArray.uint16[this._pos2+17]}},{key:"verticalTextBoxEndIndex",get:function(){return this._structArray.uint16[this._pos2+18]}},{key:"iconBoxStartIndex",get:function(){return this._structArray.uint16[this._pos2+19]}},{key:"iconBoxEndIndex",get:function(){return this._structArray.uint16[this._pos2+20]}},{key:"verticalIconBoxStartIndex",get:function(){return this._structArray.uint16[this._pos2+21]}},{key:"verticalIconBoxEndIndex",get:function(){return this._structArray.uint16[this._pos2+22]}},{key:"featureIndex",get:function(){return this._structArray.uint16[this._pos2+23]}},{key:"numHorizontalGlyphVertices",get:function(){return this._structArray.uint16[this._pos2+24]}},{key:"numVerticalGlyphVertices",get:function(){return this._structArray.uint16[this._pos2+25]}},{key:"numIconVertices",get:function(){return this._structArray.uint16[this._pos2+26]}},{key:"numVerticalIconVertices",get:function(){return this._structArray.uint16[this._pos2+27]}},{key:"useRuntimeCollisionCircles",get:function(){return this._structArray.uint16[this._pos2+28]}},{key:"crossTileID",get:function(){return this._structArray.uint32[this._pos4+15]},set:function(e){this._structArray.uint32[this._pos4+15]=e}},{key:"textOffset0",get:function(){return this._structArray.float32[this._pos4+16]}},{key:"textOffset1",get:function(){return this._structArray.float32[this._pos4+17]}},{key:"collisionCircleDiameter",get:function(){return this._structArray.float32[this._pos4+18]}}]),n}(Ja);Io.prototype.size=76;var Po=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"get",value:function(e){return new Io(this,e)}}]),n}(xo);ua(Po,"SymbolInstanceArray");var zo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getoffsetX",value:function(e){return this.float32[1*e+0]}}]),n}(bo);ua(zo,"GlyphOffsetArray");var Do=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getx",value:function(e){return this.int16[2*e+0]}},{key:"gety",value:function(e){return this.int16[2*e+1]}}]),n}(to);ua(Do,"SymbolLineVertexArray");var Ro=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"featureIndex",get:function(){return this._structArray.uint32[this._pos4+0]}},{key:"sourceLayerIndex",get:function(){return this._structArray.uint16[this._pos2+2]}},{key:"bucketIndex",get:function(){return this._structArray.uint16[this._pos2+3]}},{key:"layoutVertexArrayOffset",get:function(){return this._structArray.uint16[this._pos2+4]}}]),n}(Ja);Ro.prototype.size=12;var Bo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"get",value:function(e){return new Ro(this,e)}}]),n}(ko);ua(Bo,"FeatureIndexArray");var Fo=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"geta_centroid_pos0",value:function(e){return this.uint16[2*e+0]}},{key:"geta_centroid_pos1",value:function(e){return this.uint16[2*e+1]}}]),n}(To);ua(Fo,"FillExtrusionCentroidArray");var Oo=Qa([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),No=Qa([{name:"a_dash",components:4,type:"Uint16"}]),Ho={exports:{}},Uo={exports:{}};Uo.exports=function(e,t){var n,i,r,a,o,s,l,u;for(i=e.length-(n=3&e.length),r=t,o=3432918353,s=461845907,u=0;u<i;)l=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,r=27492+(65535&(a=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(u+2))<<16;case 2:l^=(255&e.charCodeAt(u+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(u)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0};var jo=Uo.exports,Vo={exports:{}};Vo.exports=function(e,t){for(var n,i=e.length,r=t^i,a=0;i>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++a;switch(i){case 3:r^=(255&e.charCodeAt(a+2))<<16;case 2:r^=(255&e.charCodeAt(a+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(a)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0};var Wo=jo,Go=Vo.exports;Ho.exports=Wo,Ho.exports.murmur3=Wo,Ho.exports.murmur2=Go;var qo=S(Ho.exports),Zo=function(){function e(){f(this,e),this.ids=[],this.positions=[],this.indexed=!1}return p(e,[{key:"add",value:function(e,t,n,i){this.ids.push(Xo(e)),this.positions.push(t,n,i)}},{key:"getPositions",value:function(e){for(var t=Xo(e),n=0,i=this.ids.length-1;n<i;){var r=n+i>>1;this.ids[r]>=t?i=r:n=r+1}for(var a=[];this.ids[n]===t;)a.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return a}}],[{key:"serialize",value:function(e,t){var n=new Float64Array(e.ids),i=new Uint32Array(e.positions);return Ko(n,i,0,n.length-1),t&&t.push(n.buffer,i.buffer),{ids:n,positions:i}}},{key:"deserialize",value:function(t){var n=new e;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}]),e}();function Xo(e){var t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:qo(String(e))}function Ko(e,t,n,i){for(;n<i;){for(var r=e[n+i>>1],a=n-1,o=i+1;;){do{a++}while(e[a]<r);do{o--}while(e[o]>r);if(a>=o)break;Yo(e,a,o),Yo(t,3*a,3*o),Yo(t,3*a+1,3*o+1),Yo(t,3*a+2,3*o+2)}o-n<i-o?(Ko(e,t,n,o),n=o+1):(Ko(e,t,o+1,i),i=o)}}function Yo(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}ua(Zo,"FeaturePositionMap");var Jo=function(){function e(t){f(this,e),this.gl=t.gl,this.initialized=!1}return p(e,[{key:"fetchUniformLocation",value:function(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}]),e}(),$o=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).current=0,i}return p(n,[{key:"set",value:function(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}]),n}(Jo),Qo=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).current=[0,0,0,0],i}return p(n,[{key:"set",value:function(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}]),n}(Jo),es=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).current=Gt.transparent,i}return p(n,[{key:"set",value:function(e,t,n){this.fetchUniformLocation(e,t)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}]),n}(Jo),ts=new Float32Array(16),ns=new Float32Array(9),is=new Float32Array(4);function rs(e){return[Ka(255*e.r,255*e.g),Ka(255*e.b,255*e.a)]}var as=function(){function e(t,n,i){f(this,e),this.value=t,this.uniformNames=n.map((function(e){return"u_".concat(e)})),this.type=i}return p(e,[{key:"setUniform",value:function(e,t,n,i,r){t.set(e,r,i.constantOr(this.value))}},{key:"getBinding",value:function(e,t){return"color"===this.type?new es(e):new $o(e)}}]),e}(),os=function(){function e(t,n){f(this,e),this.uniformNames=n.map((function(e){return"u_".concat(e)})),this.pattern=null,this.pixelRatio=1}return p(e,[{key:"setConstantPatternPositions",value:function(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}},{key:"setUniform",value:function(e,t,n,i,r){var a="u_pattern"===r||"u_dash"===r?this.pattern:"u_pixel_ratio"===r?this.pixelRatio:null;a&&t.set(e,r,a)}},{key:"getBinding",value:function(e,t){return"u_pattern"===t||"u_dash"===t?new Qo(e):new $o(e)}}]),e}(),ss=function(){function e(t,n,i,r){f(this,e),this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=n.map((function(e){return{name:"a_".concat(e),type:"Float32",components:"color"===i?2:1,offset:0}})),this.paintVertexArray=new r}return p(e,[{key:"populatePaintArray",value:function(e,t,n,i,r,a){var o=this.paintVertexArray.length,s=this.expression.evaluate(new Ba(0),t,{},r,i,a);this.paintVertexArray.resize(e),this._setPaintValue(o,e,s)}},{key:"updatePaintArray",value:function(e,t,n,i,r){var a=this.expression.evaluate({zoom:0},n,i,void 0,r);this._setPaintValue(e,t,a)}},{key:"_setPaintValue",value:function(e,t,n){if("color"===this.type)for(var i=rs(n),r=e;r<t;r++)this.paintVertexArray.emplace(r,i[0],i[1]);else{for(var a=e;a<t;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}},{key:"upload",value:function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}},{key:"destroy",value:function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}]),e}(),ls=function(){function e(t,n,i,r,a,o){f(this,e),this.expression=t,this.uniformNames=n.map((function(e){return"u_".concat(e,"_t")})),this.type=i,this.useIntegerZoom=r,this.zoom=a,this.maxValue=0,this.paintVertexAttributes=n.map((function(e){return{name:"a_".concat(e),type:"Float32",components:"color"===i?4:2,offset:0}})),this.paintVertexArray=new o}return p(e,[{key:"populatePaintArray",value:function(e,t,n,i,r,a){var o=this.expression.evaluate(new Ba(this.zoom),t,{},r,i,a),s=this.expression.evaluate(new Ba(this.zoom+1),t,{},r,i,a),l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(l,e,o,s)}},{key:"updatePaintArray",value:function(e,t,n,i,r){var a=this.expression.evaluate({zoom:this.zoom},n,i,void 0,r),o=this.expression.evaluate({zoom:this.zoom+1},n,i,void 0,r);this._setPaintValue(e,t,a,o)}},{key:"_setPaintValue",value:function(e,t,n,i){if("color"===this.type)for(var r=rs(n),a=rs(i),o=e;o<t;o++)this.paintVertexArray.emplace(o,r[0],r[1],a[0],a[1]);else{for(var s=e;s<t;s++)this.paintVertexArray.emplace(s,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}},{key:"upload",value:function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}},{key:"destroy",value:function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}},{key:"setUniform",value:function(e,t,n,i,r){var a=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,o=U(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(e,r,o)}},{key:"getBinding",value:function(e,t){return new $o(e)}}]),e}(),us=function(){function e(t,n,i,r,a){f(this,e),this.expression=t,this.layerId=a,this.paintVertexAttributes=("array"===i?No:Oo).members;for(var o=0;o<n.length;++o);this.paintVertexArray=new r}return p(e,[{key:"populatePaintArray",value:function(e,t,n){var i=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],n)}},{key:"updatePaintArray",value:function(e,t,n,i,r,a){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],a)}},{key:"_setPaintValues",value:function(e,t,n,i){if(i&&n){var r=i[n];if(r)for(var a=r.tl,o=r.br,s=r.pixelRatio,l=e;l<t;l++)this.paintVertexArray.emplace(l,a[0],a[1],o[0],o[1],s)}}},{key:"upload",value:function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}},{key:"destroy",value:function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}]),e}(),cs=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0};f(this,e),this.binders={},this._buffers=[];var r=[];for(var a in t.paint._values)if(i(a)){var o=t.paint.get(a);if(o instanceof Va&&Yi(o.property.specification)){var s=fs(a,t.type),l=o.value,u=o.property.specification.type,c=!!o.property.useIntegerZoom,d="line-dasharray"===a||a.endsWith("pattern"),h="line-dasharray"===a&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==l.kind||h)if("source"===l.kind||h||d){var p=ys(a,u,"source");this.binders[a]=d?new us(l,s,u,p,t.id):new ss(l,s,u,p),r.push("/a_".concat(a))}else{var m=ys(a,u,"composite");this.binders[a]=new ls(l,s,u,c,n,m),r.push("/z_".concat(a))}else this.binders[a]=d?new os(l.value,s):new as(l.value,s,u),r.push("/u_".concat(a))}}this.cacheKey=r.sort().join("")}return p(e,[{key:"getMaxValue",value:function(e){var t=this.binders[e];return t instanceof ss||t instanceof ls?t.maxValue:0}},{key:"populatePaintArrays",value:function(e,t,n,i,r,a){for(var o in this.binders){var s=this.binders[o];(s instanceof ss||s instanceof ls||s instanceof us)&&s.populatePaintArray(e,t,n,i,r,a)}}},{key:"setConstantPatternPositions",value:function(e){for(var t in this.binders){var n=this.binders[t];n instanceof os&&n.setConstantPatternPositions(e)}}},{key:"updatePaintArrays",value:function(e,t,n,i,r,a){var o=!1;for(var s in e){var l,u=t.getPositions(s),c=h(u);try{for(c.s();!(l=c.n()).done;){var d=l.value,f=n.feature(d.index);for(var p in this.binders){var m=this.binders[p];if((m instanceof ss||m instanceof ls||m instanceof us)&&!0===m.expression.isStateDependent){var y=i.paint.get(p);m.expression=y.value,m.updatePaintArray(d.start,d.end,f,e[s],r,a),o=!0}}}}catch(g){c.e(g)}finally{c.f()}}return o}},{key:"defines",value:function(){var e=[];for(var t in this.binders){var n=this.binders[t];(n instanceof as||n instanceof os)&&e.push.apply(e,c(n.uniformNames.map((function(e){return"#define HAS_UNIFORM_".concat(e)}))))}return e}},{key:"getBinderAttributes",value:function(){var e=[];for(var t in this.binders){var n=this.binders[t];if(n instanceof ss||n instanceof ls||n instanceof us)for(var i=0;i<n.paintVertexAttributes.length;i++)e.push(n.paintVertexAttributes[i].name)}return e}},{key:"getBinderUniforms",value:function(){var e=[];for(var t in this.binders){var n=this.binders[t];if(n instanceof as||n instanceof os||n instanceof ls){var i,r=h(n.uniformNames);try{for(r.s();!(i=r.n()).done;){var a=i.value;e.push(a)}}catch(o){r.e(o)}finally{r.f()}}}return e}},{key:"getPaintVertexBuffers",value:function(){return this._buffers}},{key:"getUniforms",value:function(e){var t=[];for(var n in this.binders){var i=this.binders[n];if(i instanceof as||i instanceof os||i instanceof ls){var r,a=h(i.uniformNames);try{for(a.s();!(r=a.n()).done;){var o=r.value;t.push({name:o,property:n,binding:i.getBinding(e,o)})}}catch(s){a.e(s)}finally{a.f()}}}return t}},{key:"setUniforms",value:function(e,t,n,i,r){var a,o=h(n);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=s.name,u=s.property,c=s.binding;this.binders[u].setUniform(e,c,r,i.get(u),l)}}catch(d){o.e(d)}finally{o.f()}}},{key:"updatePaintBuffers",value:function(){for(var e in this._buffers=[],this.binders){var t=this.binders[e];(t instanceof ss||t instanceof ls||t instanceof us)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}},{key:"upload",value:function(e){for(var t in this.binders){var n=this.binders[t];(n instanceof ss||n instanceof ls||n instanceof us)&&n.upload(e)}this.updatePaintBuffers()}},{key:"destroy",value:function(){for(var e in this.binders){var t=this.binders[e];(t instanceof ss||t instanceof ls||t instanceof us)&&t.destroy()}}}]),e}(),ds=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0};f(this,e),this.programConfigurations={};var r,a=h(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;this.programConfigurations[o.id]=new cs(o,n,i)}}catch(s){a.e(s)}finally{a.f()}this.needsUpload=!1,this._featureMap=new Zo,this._bufferOffset=0}return p(e,[{key:"populatePaintArrays",value:function(e,t,n,i,r,a,o){for(var s in this.programConfigurations)this.programConfigurations[s].populatePaintArrays(e,t,i,r,a,o);void 0!==t.id&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}},{key:"updatePaintArrays",value:function(e,t,n,i,r){var a,o=h(n);try{for(o.s();!(a=o.n()).done;){var s=a.value;this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(e,this._featureMap,t,s,i,r)||this.needsUpload}}catch(l){o.e(l)}finally{o.f()}}},{key:"get",value:function(e){return this.programConfigurations[e]}},{key:"upload",value:function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}},{key:"destroy",value:function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()}}]),e}(),hs={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function fs(e,t){return hs[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}var ps={"line-pattern":{source:oo,composite:oo},"fill-pattern":{source:oo,composite:oo},"fill-extrusion-pattern":{source:oo,composite:oo},"line-dasharray":{source:so,composite:so}},ms={color:{source:So,composite:ao},number:{source:bo,composite:So}};function ys(e,t,n){var i=ps[e];return i&&i[n]||ms[t][n]}ua(as,"ConstantBinder"),ua(os,"PatternConstantBinder"),ua(ss,"SourceExpressionBinder"),ua(us,"PatternCompositeBinder"),ua(ls,"CompositeExpressionBinder"),ua(cs,"ProgramConfiguration",{omit:["_buffers"]}),ua(ds,"ProgramConfigurationSet");var gs="-transition",vs=function(e){m(n,e);var t=y(n);function n(e,i){var r;if(f(this,n),(r=t.call(this)).id=e.id,r.type=e.type,r._featureFilter={filter:function(){return!0},needGeometry:!1,needFeature:!1},r._filterCompiled=!1,"custom"!==e.type&&(r.metadata=e.metadata,r.minzoom=e.minzoom,r.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(r.source=e.source,r.sourceLayer=e["source-layer"],r.filter=e.filter),i.layout&&(r._unevaluatedLayout=new ja(i.layout)),i.paint)){for(var a in r._transitionablePaint=new Na(i.paint),e.paint)r.setPaintProperty(a,e.paint[a],{validate:!1});for(var o in e.layout)r.setLayoutProperty(o,e.layout[o],{validate:!1});r._transitioningPaint=r._transitionablePaint.untransitioned(),r.paint=new Wa(i.paint)}return l(r)}return p(n,[{key:"getLayoutProperty",value:function(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}},{key:"setLayoutProperty",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null!=t&&this._validate(ta,"layers.".concat(this.id,".layout.").concat(e),e,t,n)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}},{key:"getPaintProperty",value:function(e){return Q(e,gs)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}},{key:"setPaintProperty",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=t&&this._validate(ea,"layers.".concat(this.id,".paint.").concat(e),e,t,n))return!1;if(Q(e,gs))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;var i=this._transitionablePaint._values[e],r=i.value.isDataDriven(),a=i.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);var o=this._transitionablePaint._values[e].value,s=o.isDataDriven(),l=Q(e,"pattern")||"line-dasharray"===e;return s||r||l||this._handleOverridablePaintPropertyUpdate(e,a,o)}},{key:"_handleSpecialPaintPropertyUpdate",value:function(e){}},{key:"getProgramIds",value:function(){return null}},{key:"getProgramConfiguration",value:function(e){return null}},{key:"_handleOverridablePaintPropertyUpdate",value:function(e,t,n){return!1}},{key:"isHidden",value:function(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}},{key:"updateTransitions",value:function(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}},{key:"hasTransition",value:function(){return this._transitioningPaint.hasTransition()}},{key:"recalculate",value:function(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}},{key:"serialize",value:function(){var e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),te(e,(function(e,t){return!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)}))}},{key:"_validate",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!r||!1!==r.validate)&&ia(this,e.call(Qr,{key:t,layerType:this.type,objectKey:n,value:i,styleSpec:pt,style:{glyphs:!0,sprite:!0}}))}},{key:"is3D",value:function(){return!1}},{key:"isSky",value:function(){return!1}},{key:"isTileClipped",value:function(){return!1}},{key:"hasOffscreenPass",value:function(){return!1}},{key:"resize",value:function(){}},{key:"isStateDependent",value:function(){for(var e in this.paint._values){var t=this.paint.get(e);if(t instanceof Va&&Yi(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}},{key:"compileFilter",value:function(){this._filterCompiled||(this._featureFilter=Er(this.filter),this._filterCompiled=!0)}},{key:"invalidateCompiledFilter",value:function(){this._filterCompiled=!1}},{key:"dynamicFilter",value:function(){return this._featureFilter.dynamicFilter}},{key:"dynamicFilterNeedsFeature",value:function(){return this._featureFilter.needFeature}}]),n}(ft),_s=Qa([{name:"a_pos",components:2,type:"Int16"}],4),xs=Qa([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),bs=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];f(this,e),this.segments=t}return p(e,[{key:"prepareSegment",value:function(t,n,i,r){var a=this.segments[this.segments.length-1];return t>e.MAX_VERTEX_ARRAY_LENGTH&&re("Max vertices per segment is ".concat(e.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(t)),(!a||a.vertexLength+t>e.MAX_VERTEX_ARRAY_LENGTH||a.sortKey!==r)&&(a={vertexOffset:n.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==r&&(a.sortKey=r),this.segments.push(a)),a}},{key:"get",value:function(){return this.segments}},{key:"destroy",value:function(){var e,t=h(this.segments);try{for(t.s();!(e=t.n()).done;){var n=e.value;for(var i in n.vaos)n.vaos[i].destroy()}}catch(r){t.e(r)}finally{t.f()}}}],[{key:"simpleSegment",value:function(t,n,i,r){return new e([{vertexOffset:t,primitiveOffset:n,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}]),e}();bs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ua(bs,"SegmentVector");var ws=8192,ks=function(){function e(t,n){f(this,e),t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}return p(e,[{key:"setNorthEast",value:function(e){return this._ne=e instanceof nu?new nu(e.lng,e.lat):nu.convert(e),this}},{key:"setSouthWest",value:function(e){return this._sw=e instanceof nu?new nu(e.lng,e.lat):nu.convert(e),this}},{key:"extend",value:function(t){var n,i,r=this._sw,a=this._ne;if(t instanceof nu)n=t,i=t;else{if(!(t instanceof e))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(e.convert(t)):this.extend(nu.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(nu.convert(t)):this;if(n=t._sw,i=t._ne,!n||!i)return this}return r||a?(r.lng=Math.min(n.lng,r.lng),r.lat=Math.min(n.lat,r.lat),a.lng=Math.max(i.lng,a.lng),a.lat=Math.max(i.lat,a.lat)):(this._sw=new nu(n.lng,n.lat),this._ne=new nu(i.lng,i.lat)),this}},{key:"getCenter",value:function(){return new nu((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}},{key:"getSouthWest",value:function(){return this._sw}},{key:"getNorthEast",value:function(){return this._ne}},{key:"getNorthWest",value:function(){return new nu(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new nu(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this._sw.lng}},{key:"getSouth",value:function(){return this._sw.lat}},{key:"getEast",value:function(){return this._ne.lng}},{key:"getNorth",value:function(){return this._ne.lat}},{key:"toArray",value:function(){return[this._sw.toArray(),this._ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this._sw&&this._ne)}},{key:"contains",value:function(e){var t=nu.convert(e),n=t.lng,i=t.lat,r=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}}],[{key:"convert",value:function(t){return!t||t instanceof e?t:new e(t)}}]),e}(),Ts=1e-6,Es="undefined"!=typeof Float32Array?Float32Array:Array;function Ss(){var e=new Es(9);return Es!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Ls(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=n[0],f=n[1],p=n[2],m=n[3],y=n[4],g=n[5],v=n[6],_=n[7],x=n[8];return e[0]=h*i+f*o+p*u,e[1]=h*r+f*s+p*c,e[2]=h*a+f*l+p*d,e[3]=m*i+y*o+g*u,e[4]=m*r+y*s+g*c,e[5]=m*a+y*l+g*d,e[6]=v*i+_*o+x*u,e[7]=v*r+_*s+x*c,e[8]=v*a+_*l+x*d,e}function Ms(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function As(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],f=t[11],p=t[12],m=t[13],y=t[14],g=t[15],v=n*s-i*o,_=n*l-r*o,x=n*u-a*o,b=i*l-r*s,w=i*u-a*s,k=r*u-a*l,T=c*m-d*p,E=c*y-h*p,S=c*g-f*p,L=d*y-h*m,M=d*g-f*m,A=h*g-f*y,C=v*A-_*M+x*L+b*S-w*E+k*T;return C?(e[0]=(s*A-l*M+u*L)*(C=1/C),e[1]=(r*M-i*A-a*L)*C,e[2]=(m*k-y*w+g*b)*C,e[3]=(h*w-d*k-f*b)*C,e[4]=(l*S-o*A-u*E)*C,e[5]=(n*A-r*S+a*E)*C,e[6]=(y*x-p*k-g*_)*C,e[7]=(c*k-h*x+f*_)*C,e[8]=(o*M-s*S+u*T)*C,e[9]=(i*S-n*M-a*T)*C,e[10]=(p*w-m*x+g*v)*C,e[11]=(d*x-c*w-f*v)*C,e[12]=(s*E-o*L-l*T)*C,e[13]=(n*L-i*E+r*T)*C,e[14]=(m*_-p*b-y*v)*C,e[15]=(c*b-d*_+h*v)*C,e):null}function Cs(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],f=t[10],p=t[11],m=t[12],y=t[13],g=t[14],v=t[15],_=n[0],x=n[1],b=n[2],w=n[3];return e[0]=_*i+x*s+b*d+w*m,e[1]=_*r+x*l+b*h+w*y,e[2]=_*a+x*u+b*f+w*g,e[3]=_*o+x*c+b*p+w*v,e[4]=(_=n[4])*i+(x=n[5])*s+(b=n[6])*d+(w=n[7])*m,e[5]=_*r+x*l+b*h+w*y,e[6]=_*a+x*u+b*f+w*g,e[7]=_*o+x*c+b*p+w*v,e[8]=(_=n[8])*i+(x=n[9])*s+(b=n[10])*d+(w=n[11])*m,e[9]=_*r+x*l+b*h+w*y,e[10]=_*a+x*u+b*f+w*g,e[11]=_*o+x*c+b*p+w*v,e[12]=(_=n[12])*i+(x=n[13])*s+(b=n[14])*d+(w=n[15])*m,e[13]=_*r+x*l+b*h+w*y,e[14]=_*a+x*u+b*f+w*g,e[15]=_*o+x*c+b*p+w*v,e}function Is(e,t,n){var i,r,a,o,s,l,u,c,d,h,f,p,m=n[0],y=n[1],g=n[2];return t===e?(e[12]=t[0]*m+t[4]*y+t[8]*g+t[12],e[13]=t[1]*m+t[5]*y+t[9]*g+t[13],e[14]=t[2]*m+t[6]*y+t[10]*g+t[14],e[15]=t[3]*m+t[7]*y+t[11]*g+t[15]):(r=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],f=t[10],p=t[11],e[0]=i=t[0],e[1]=r,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=d,e[9]=h,e[10]=f,e[11]=p,e[12]=i*m+s*y+d*g+t[12],e[13]=r*m+l*y+h*g+t[13],e[14]=a*m+u*y+f*g+t[14],e[15]=o*m+c*y+p*g+t[15]),e}function Ps(e,t,n){var i=n[0],r=n[1],a=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function zs(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[4],o=t[5],s=t[6],l=t[7],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*r+u*i,e[5]=o*r+c*i,e[6]=s*r+d*i,e[7]=l*r+h*i,e[8]=u*r-a*i,e[9]=c*r-o*i,e[10]=d*r-s*i,e[11]=h*r-l*i,e}function Ds(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[0],o=t[1],s=t[2],l=t[3],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r-u*i,e[1]=o*r-c*i,e[2]=s*r-d*i,e[3]=l*r-h*i,e[8]=a*i+u*r,e[9]=o*i+c*r,e[10]=s*i+d*r,e[11]=l*i+h*r,e}function Rs(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Bs(e,t,n){var i,r,a,o=n[0],s=n[1],l=n[2],u=Math.hypot(o,s,l);return u<Ts?null:(o*=u=1/u,s*=u,l*=u,i=Math.sin(t),r=Math.cos(t),e[0]=o*o*(a=1-r)+r,e[1]=s*o*a+l*i,e[2]=l*o*a-s*i,e[3]=0,e[4]=o*s*a-l*i,e[5]=s*s*a+r,e[6]=l*s*a+o*i,e[7]=0,e[8]=o*l*a+s*i,e[9]=s*l*a-o*i,e[10]=l*l*a+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Fs=Cs;function Os(){var e=new Es(3);return Es!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ns(e){var t=new Es(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Hs(e){return Math.hypot(e[0],e[1],e[2])}function Us(e,t,n){var i=new Es(3);return i[0]=e,i[1]=t,i[2]=n,i}function js(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Vs(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Ws(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Gs(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function qs(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function Zs(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Xs(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e}function Ks(e,t){var n=t[0],i=t[1],r=t[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function Ys(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Js(e,t,n){var i=t[0],r=t[1],a=t[2],o=n[0],s=n[1],l=n[2];return e[0]=r*l-a*s,e[1]=a*o-i*l,e[2]=i*s-r*o,e}function $s(e,t,n){var i=t[0],r=t[1],a=t[2],o=n[3]*i+n[7]*r+n[11]*a+n[15];return e[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/(o=o||1),e[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/o,e[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/o,e}function Qs(e,t,n){var i=n[0],r=n[1],a=n[2],o=t[0],s=t[1],l=t[2],u=r*l-a*s,c=a*o-i*l,d=i*s-r*o,h=r*d-a*c,f=a*u-i*d,p=i*c-r*u,m=2*n[3];return c*=m,d*=m,f*=2,p*=2,e[0]=o+(u*=m)+(h*=2),e[1]=s+c+f,e[2]=l+d+p,e}var el,tl=Vs,nl=Ws,il=Hs;function rl(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function al(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=n*n+i*i+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=i*o,e[2]=r*o,e[3]=a*o,e}function ol(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*a+n[12]*o,e[1]=n[1]*i+n[5]*r+n[9]*a+n[13]*o,e[2]=n[2]*i+n[6]*r+n[10]*a+n[14]*o,e[3]=n[3]*i+n[7]*r+n[11]*a+n[15]*o,e}function sl(){var e=new Es(4);return Es!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function ll(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ul(e,t,n){n*=.5;var i=t[0],r=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*s,e[1]=r*l+a*s,e[2]=a*l-r*s,e[3]=o*l-i*s,e}function cl(e,t,n){n*=.5;var i=t[0],r=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l-a*s,e[1]=r*l+o*s,e[2]=a*l+i*s,e[3]=o*l-r*s,e}Os(),el=new Es(4),Es!=Float32Array&&(el[0]=0,el[1]=0,el[2]=0,el[3]=0);var dl=al;Os(),Us(1,0,0),Us(0,1,0),sl(),sl(),Ss();var hl=Qa([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]).members,fl=Qa([{name:"a_pos_3",components:3,type:"Int16"}]),pl=Qa([{name:"a_pos",type:"Int16",components:2}]),ml=function(){function e(t,n){f(this,e),this.pos=t,this.dir=n}return p(e,[{key:"intersectsPlane",value:function(e,t,n){var i=Ys(t,this.dir);if(Math.abs(i)<1e-6)return!1;var r=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/i;return n[0]=this.pos[0]+this.dir[0]*r,n[1]=this.pos[1]+this.dir[1]*r,n[2]=this.pos[2]+this.dir[2]*r,!0}},{key:"closestPointOnSphere",value:function(e,t,n){if(function(e,t){var n=e[0],i=e[1],r=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(n-a)<=Ts*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-o)<=Ts*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-s)<=Ts*Math.max(1,Math.abs(r),Math.abs(s))}(this.pos,e)||0===t)return n[0]=n[1]=n[2]=0,!1;var i=d(this.dir,3),r=i[0],a=i[1],o=i[2],s=this.pos[0]-e[0],l=this.pos[1]-e[1],u=this.pos[2]-e[2],c=r*r+a*a+o*o,h=2*(s*r+l*a+u*o),f=h*h-4*c*(s*s+l*l+u*u-t*t);if(f<0){var p=Math.max(-h/2,0),m=s+r*p,y=l+a*p,g=u+o*p,v=Math.hypot(m,y,g);return n[0]=m*t/v,n[1]=y*t/v,n[2]=g*t/v,!1}var _=(-h-Math.sqrt(f))/(2*c);if(_<0){var x=Math.hypot(s,l,u);return n[0]=s*t/x,n[1]=l*t/x,n[2]=u*t/x,!1}return n[0]=s+r*_,n[1]=l+a*_,n[2]=u+o*_,!0}}]),e}(),yl=function(){function e(t,n,i,r,a){f(this,e),this.TL=t,this.TR=n,this.BR=i,this.BL=r,this.horizon=a}return p(e,null,[{key:"fromInvProjectionMatrix",value:function(t,n,i){var r=[-1,1,1],a=[1,1,1],o=[1,-1,1],s=[-1,-1,1];return new e($s(r,r,t),$s(a,a,t),$s(o,o,t),$s(s,s,t),n/i)}}]),e}(),gl=function(){function e(t,n){f(this,e),this.points=t,this.planes=n}return p(e,null,[{key:"fromInvProjectionMatrix",value:function(t,n,i,r){var a=Math.pow(2,i),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(e){var i=ol([],e,t),o=1/i[3]/n*a;return function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}(i,i,[o,o,r?1/i[3]:o,o])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var t=Ks([],Js([],tl([],o[e[0]],o[e[1]]),tl([],o[e[2]],o[e[1]]))),n=-Ys(t,o[e[1]]);return t.concat(n)}));return new e(o,s)}}]),e}(),vl=function(){function e(t,n){f(this,e),this.min=t,this.max=n,this.center=Zs([],js([],this.min,this.max),.5)}return p(e,[{key:"quadrant",value:function(t){for(var n=[t%2==0,t<2],i=Ns(this.min),r=Ns(this.max),a=0;a<n.length;a++)i[a]=n[a]?this.min[a]:this.center[a],r[a]=n[a]?this.center[a]:this.max[a];return r[2]=this.max[2],new e(i,r)}},{key:"distanceX",value:function(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}},{key:"distanceY",value:function(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}},{key:"distanceZ",value:function(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}},{key:"getCorners",value:function(){var e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}},{key:"intersects",value:function(e){for(var t=this.getCorners(),n=!0,i=0;i<e.planes.length;i++){for(var r=e.planes[i],a=0,o=0;o<t.length;o++)a+=Ys(r,t[o])+r[3]>=0;if(0===a)return 0;a!==t.length&&(n=!1)}if(n)return 2;for(var s=0;s<3;s++){for(var l=Number.MAX_VALUE,u=-Number.MAX_VALUE,c=0;c<e.points.length;c++){var d=e.points[c][s]-this.min[s];l=Math.min(l,d),u=Math.max(u,d)}if(u<0||l>this.max[s]-this.min[s])return 0}return 1}}],[{key:"fromPoints",value:function(t){var n,i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0],a=h(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;Gs(i,i,o),qs(r,r,o)}}catch(s){a.e(s)}finally{a.f()}return new e(i,r)}},{key:"applyTransform",value:function(t,n){for(var i=t.getCorners(),r=0;r<i.length;++r)$s(i[r],i[r],n);return e.fromPoints(i)}}]),e}(),_l=5,xl=6,bl=ws/Math.PI/2,wl=16383,kl=64,Tl=[kl,32,16],El=-bl,Sl=bl,Ll=[new vl([El,El,El],[Sl,Sl,Sl]),new vl([El,El,El],[0,0,Sl]),new vl([0,El,El],[Sl,0,Sl]),new vl([El,0,El],[0,Sl,Sl]),new vl([0,0,El],[Sl,Sl,Sl])];function Ml(e){return e*bl/Ql}function Al(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=Zs([],e._camera.position,e.worldSize),a=[t,n,1,1];ol(a,a,e.pixelMatrixInverse),rl(a,a,1/a[3]);var o=Ks([],tl([],a,r)),s=e.globeMatrix,l=[s[12],s[13],s[14]],u=tl([],l,r),c=Hs(u),d=Ks([],u),h=e.worldSize/(2*Math.PI),f=Ys(d,o),p=Math.asin(h/c);if(p<Math.acos(f)){if(!i)return null;var m=[],y=[];Zs(m,o,c/f),Ks(y,tl(y,m,u)),Ks(o,js(o,u,Zs(o,y,Math.tan(p)*c)))}var g=[];new ml(r,o).closestPointOnSphere(l,h,g);var v=Ks([],he(s,0)),_=Ks([],he(s,1)),x=Ks([],he(s,2)),b=Ys(v,g),w=Ys(_,g),k=Ys(x,g),T=B(Math.asin(-w/h)),E=B(Math.atan2(b,k));E=e.center.lng+function(e,t){var n=(t-e+180)%360-180;return n<-180?n+360:n}(e.center.lng,E);var S=ru(E),L=U(au(T),0,1);return new hu(S,L)}var Cl=p((function e(t,n,i){f(this,e),this.a=tl([],t,i),this.b=tl([],n,i),this.center=i;var r=Ks([],this.a),a=Ks([],this.b);this.angle=Math.acos(Ys(r,a))}));function Il(e,t){return 0===e.angle||(n=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)))<0||n>1?null:function(e,t,n,i){var r=Math.sin(n);return e*(Math.sin((1-i)*n)/r)+t*(Math.sin(i*n)/r)}(e.a[t],e.b[t],e.angle,U(n,0,1))+e.center[t];var n}function Pl(e){if(e.z<=1)return Ll[e.z+2*e.y+e.x];var t=Ol(Fl(e));return vl.fromPoints(t)}function zl(e,t,n){return Zs(e,e,1-n),Xs(e,e,t,n)}function Dl(e,t){var n=Zl(t.zoom);if(0===n)return Pl(e);var i=Fl(e),r=Ol(i),a=ru(i.getWest())*t.worldSize,o=ru(i.getEast())*t.worldSize,s=au(i.getNorth())*t.worldSize,l=au(i.getSouth())*t.worldSize,u=[a,s,0],c=[o,s,0],d=[a,l,0],h=[o,l,0],f=As([],t.globeMatrix);return $s(u,u,f),$s(c,c,f),$s(d,d,f),$s(h,h,f),r[0]=zl(r[0],d,n),r[1]=zl(r[1],h,n),r[2]=zl(r[2],c,n),r[3]=zl(r[3],u,n),vl.fromPoints(r)}function Rl(e,t,n){var i,r=h(e);try{for(r.s();!(i=r.n()).done;){var a=i.value;$s(a,a,t),Zs(a,a,n)}}catch(o){r.e(o)}finally{r.f()}}function Bl(e,t,n){var i=t/e.worldSize,r=e.globeMatrix;if(n.z<=1){var a=Pl(n).getCorners();return Rl(a,r,i),vl.fromPoints(a)}var o=Fl(n),s=Ol(o);Rl(s,r,i);var l=Number.MAX_VALUE,u=[-l,-l,-l],c=[l,l,l];if(o.contains(e.center)){var d,f=h(s);try{for(f.s();!(d=f.n()).done;){var p=d.value;Gs(c,c,p),qs(u,u,p)}}catch(O){f.e(O)}finally{f.f()}u[2]=0;var m=e.point,y=[m.x*i,m.y*i,0];return Gs(c,c,y),qs(u,u,y),new vl(c,u)}var g=[r[12]*i,r[13]*i,r[14]*i],v=o.getCenter(),_=U(e.center.lat,-cu,cu),x=U(v.lat,-cu,cu),b=ru(e.center.lng),w=au(_),k=b-ru(v.lng),T=w-au(x);k>.5?k-=1:k<-.5&&(k+=1);var E=0;Math.abs(k)>Math.abs(T)?E=k>=0?1:3:(E=T>=0?0:2,Xs(g,g,[r[4]*i,r[5]*i,r[6]*i],-Math.sin(R(T>=0?o.getSouth():o.getNorth()))*bl));var S=s[E],L=s[(E+1)%4],M=new Cl(S,L,g),A=[Il(M,0)||S[0],Il(M,1)||S[1],Il(M,2)||S[2]],C=Zl(e.zoom);if(C>0){for(var I=function(e,t,n,i,r){var a=e.x,o=e.y,s=1/(1<<e.z),l=a*s,u=l+s,c=o*s,d=c+s,h=0,f=(l+u)/2-i;return f>.5?h=-1:f<-.5&&(h=1),c=(c*t-(r*=t))*n+r,[[l=((l+h)*t-(i*=t))*n+i,d=(d*t-r)*n+r,0],[u=((u+h)*t-i)*n+i,d,0],[u,c,0],[l,c,0]]}(n,t,e._pixelsPerMercatorPixel,b,w),P=0;P<s.length;P++)zl(s[P],I[P],C);var z=js([],I[E],I[(E+1)%4]);Zs(z,z,.5),zl(A,z,C)}var D,B=h(s);try{for(B.s();!(D=B.n()).done;){var F=D.value;Gs(c,c,F),qs(u,u,F)}}catch(O){B.e(O)}finally{B.f()}return c[2]=Math.min(S[2],L[2]),Gs(c,c,A),qs(u,u,A),new vl(c,u)}function Fl(e){var t=e.x,n=e.y,i=1/(1<<e.z),r=new nu(su(t*i),lu((n+1)*i)),a=new nu(su((t+1)*i),lu(n*i));return new ks(r,a)}function Ol(e){var t=R(e.getNorth()),n=R(e.getSouth()),i=Math.cos(t),r=Math.cos(n),a=Math.sin(t),o=Math.sin(n),s=e.getWest(),l=e.getEast();return[Nl(r,o,s),Nl(r,o,l),Nl(i,a,l),Nl(i,a,s)]}function Nl(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bl;return n=R(n),[e*Math.sin(n)*i,-t*i,e*Math.cos(n)*i]}function Hl(e,t,n){return Nl(Math.cos(R(e)),Math.sin(R(e)),t,n)}function Ul(e,t,n,i){var r=1<<n.z,a=(e/ws+n.x)/r;return Hl(lu((t/ws+n.y)/r),su(a),i)}function jl(e){var t=e.min,n=e.max;return wl/Math.max(n[0]-t[0],n[1]-t[1],n[2]-t[2])}var Vl=new Float64Array(16);function Wl(e){var t,n,i=jl(e),r=Rs(Vl,[i,i,i]);return Is(r,r,((t=[])[0]=-(n=e.min)[0],t[1]=-n[1],t[2]=-n[2],t))}function Gl(e){var t,n,i=(n=e.min,(t=Vl)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t),r=1/jl(e);return Ps(i,i,[r,r,r])}function ql(e,t,n,i,r){var a=function(e){var t=ws/(2*Math.PI);return e/(2*Math.PI)/t}(n),o=[e,t,-n/(2*Math.PI)],s=Ms(new Float64Array(16));return Is(s,s,o),Ps(s,s,[a,a,a]),zs(s,s,R(-r)),Ds(s,s,R(-i)),s}function Zl(e){return j(_l,xl,e)}function Xl(e,t){var n,i,r,a,o,s,l,u,c,d,h=Hl(t.lat,t.lng),f=function(e){var t=Hl(e._center.lat,e._center.lng),n=Js([],Us(0,1,0),t),i=Bs([],-e.angle,t);n=$s(n,n,i),Bs(i,-e._pitch,n);var r=Ks([],t);return Zs(r,r,Ml(e.cameraToCenterDistance/e.pixelsPerMeter)),$s(r,r,i),js([],t,r)}(e);return r=(n=Vs([],f,h))[0],a=n[1],o=n[2],s=(i=h)[0],l=i[1],u=i[2],d=(c=Math.sqrt(r*r+a*a+o*o)*Math.sqrt(s*s+l*l+u*u))&&Ys(n,i)/c,Math.acos(Math.min(Math.max(d,-1),1))}function Kl(e,t){return Xl(e,t)>Math.PI/2*1.01}var Yl=R(85),Jl=Math.cos(Yl),$l=Math.sin(Yl),Ql=6371008.8,eu=2*Math.PI*Ql,tu=function(){function e(t,n){if(f(this,e),isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(n,")"));if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return p(e,[{key:"wrap",value:function(){return new e(V(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(e){var t=Math.PI/180,n=this.lat*t,i=e.lat*t,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return Ql*Math.acos(Math.min(r,1))}},{key:"toBounds",value:function(){var t=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,n=t/Math.cos(Math.PI/180*this.lat);return new ks(new e(this.lng-n,this.lat-t),new e(this.lng+n,this.lat+t))}},{key:"toEcef",value:function(e){var t=Ml(e);return Hl(this.lat,this.lng,bl+t)}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new e(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),nu=tu;function iu(e){return eu*Math.cos(e*Math.PI/180)}function ru(e){return(180+e)/360}function au(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ou(e,t){return e/iu(t)}function su(e){return 360*e-180}function lu(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function uu(e,t){return e*iu(lu(t))}var cu=85.051129;function du(e){return 1/Math.cos(e*Math.PI/180)}var hu=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;f(this,e),this.x=+t,this.y=+n,this.z=+i}return p(e,[{key:"toLngLat",value:function(){return new nu(su(this.x),lu(this.y))}},{key:"toAltitude",value:function(){return uu(this.z,this.y)}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/eu*du(lu(this.y))}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=nu.convert(t);return new e(ru(i.lng),au(i.lat),ou(n,i.lat))}}]),e}();function fu(e,t,n,i,r,a,o,s,l){var u=(t+i)/2,c=(n+r)/2,d=new P(u,c);s(d),function(e,t,n,i,r,a){var o=n-r,s=i-a;return Math.abs((i-t)*o-(n-e)*s)/Math.hypot(o,s)}(d.x,d.y,a.x,a.y,o.x,o.y)>=l?(fu(e,t,n,u,c,a,d,s,l),fu(e,u,c,i,r,d,o,s,l)):e.push(o)}function pu(e,t,n){var i=e[0],r=i.x,a=i.y;t(i);for(var o=[i],s=1;s<e.length;s++){var l=e[s],u=l.x,c=l.y;t(l),fu(o,r,a,u,c,i,l,t,n),r=u,a=c,i=l}return o}function mu(e,t,n,i){if(i(t,n)){var r=t.add(n)._mult(.5);mu(e,t,r,i),mu(e,r,n,i)}else e.push(n)}function yu(e,t){for(var n=e[0],i=[n],r=1;r<e.length;r++){var a=e[r];mu(i,n,a,t),n=a}return i}var gu=Math.pow(2,14)-1,vu=-gu-1;function _u(e,t){var n=Math.round(e.x*t),i=Math.round(e.y*t);return e.x=U(n,vu,gu),e.y=U(i,vu,gu),(n<e.x||n>e.x+1||i<e.y||i>e.y+1)&&re("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function xu(e,t,n){var i=e.loadGeometry(),r=e.extent,a=ws/r;if(t&&n&&n.projection.isReprojectedInTileSpace)for(var o=1<<t.z,s=n.scale,l=n.x,u=n.y,c=n.projection,d=function(e){var n=su((t.x+e.x/r)/o),i=lu((t.y+e.y/r)/o),a=c.project(n,i);e.x=(a.x*s-l)*r,e.y=(a.y*s-u)*r},f=0;f<i.length;f++)if(1!==e.type)i[f]=pu(i[f],d,1);else{var p,m=[],y=h(i[f]);try{for(y.s();!(p=y.n()).done;){var g=p.value;g.x<0||g.x>=r||g.y<0||g.y>=r||(d(g),m.push(g))}}catch(k){y.e(k)}finally{y.f()}i[f]=m}var v,_=h(i);try{for(_.s();!(v=_.n()).done;){var x,b=v.value,w=h(b);try{for(w.s();!(x=w.n()).done;)_u(x.value,a)}catch(k){w.e(k)}finally{w.f()}}}catch(k){_.e(k)}finally{_.f()}return i}function bu(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?xu(e):[]}}function wu(e,t,n,i,r){e.emplaceBack(2*t+(i+1)/2,2*n+(r+1)/2)}function ku(e,t,n){var i=16384;e.emplaceBack(t.x,t.y,t.z,n[0]*i,n[1]*i,n[2]*i)}var Tu=function(){function e(t){f(this,e),this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new to,this.indexArray=new vo,this.segments=new bs,this.programConfigurations=new ds(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))}return p(e,[{key:"populate",value:function(e,t,n,i){var r=this.layers[0],a=[],o=null;"circle"===r.type&&(o=r.layout.get("circle-sort-key"));var s,l=h(e);try{for(l.s();!(s=l.n()).done;){var u=s.value,c=u.feature,d=u.id,f=u.index,p=u.sourceLayerIndex,m=this.layers[0]._featureFilter.needGeometry,y=bu(c,m);if(this.layers[0]._featureFilter.filter(new Ba(this.zoom),y,n)){var g=o?o.evaluate(y,{},n):void 0,v={id:d,properties:c.properties,type:c.type,sourceLayerIndex:p,index:f,geometry:m?y.geometry:xu(c,n,i),patterns:{},sortKey:g};a.push(v)}}}catch(L){l.e(L)}finally{l.f()}o&&a.sort((function(e,t){return e.sortKey-t.sortKey}));var _=null;"globe"===i.projection.name&&(this.globeExtVertexArray=new lo,_=i.projection);for(var x=0,b=a;x<b.length;x++){var w=b[x],k=w.geometry,T=w.index,E=w.sourceLayerIndex,S=e[T].feature;this.addFeature(w,k,T,t.availableImages,n,_),t.featureIndex.insert(S,k,T,E,this.index)}}},{key:"update",value:function(e,t,n,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,i)}},{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length}},{key:"uploadPending",value:function(){return!this.uploaded||this.programConfigurations.needsUpload}},{key:"upload",value:function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_s.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,xs.members))),this.programConfigurations.upload(e),this.uploaded=!0}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}},{key:"addFeature",value:function(e,t,n,i,r,a){var o,s=h(t);try{for(s.s();!(o=s.n()).done;){var l,u=o.value,c=h(u);try{for(c.s();!(l=c.n()).done;){var d=l.value,f=d.x,p=d.y;if(!(f<0||f>=ws||p<0||p>=ws)){if(a){var m=a.projectTilePoint(f,p,r),y=a.upVector(r,f,p),g=this.globeExtVertexArray;ku(g,m,y),ku(g,m,y),ku(g,m,y),ku(g,m,y)}var v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),_=v.vertexLength;wu(this.layoutVertexArray,f,p,-1,-1),wu(this.layoutVertexArray,f,p,1,-1),wu(this.layoutVertexArray,f,p,1,1),wu(this.layoutVertexArray,f,p,-1,1),this.indexArray.emplaceBack(_,_+1,_+2),this.indexArray.emplaceBack(_,_+2,_+3),v.vertexLength+=4,v.primitiveLength+=2}}}catch(x){c.e(x)}finally{c.f()}}}catch(x){s.e(x)}finally{s.f()}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},i,r)}}]),e}();function Eu(e,t){for(var n=0;n<e.length;n++)if(Du(t,e[n]))return!0;for(var i=0;i<t.length;i++)if(Du(e,t[i]))return!0;return!!Au(e,t)}function Su(e,t,n){return!!Du(e,t)||!!Iu(t,e,n)}function Lu(e,t){if(1===e.length)return zu(t,e[0]);for(var n=0;n<t.length;n++)for(var i=t[n],r=0;r<i.length;r++)if(Du(e,i[r]))return!0;for(var a=0;a<e.length;a++)if(zu(t,e[a]))return!0;for(var o=0;o<t.length;o++)if(Au(e,t[o]))return!0;return!1}function Mu(e,t,n){if(e.length>1){if(Au(e,t))return!0;for(var i=0;i<t.length;i++)if(Iu(t[i],e,n))return!0}for(var r=0;r<e.length;r++)if(Iu(e[r],t,n))return!0;return!1}function Au(e,t){if(0===e.length||0===t.length)return!1;for(var n=0;n<e.length-1;n++)for(var i=e[n],r=e[n+1],a=0;a<t.length-1;a++)if(Cu(i,r,t[a],t[a+1]))return!0;return!1}function Cu(e,t,n,i){return ae(e,n,i)!==ae(t,n,i)&&ae(e,t,n)!==ae(e,t,i)}function Iu(e,t,n){var i=n*n;if(1===t.length)return e.distSqr(t[0])<i;for(var r=1;r<t.length;r++)if(Pu(e,t[r-1],t[r])<i)return!0;return!1}function Pu(e,t,n){var i=t.distSqr(n);if(0===i)return e.distSqr(t);var r=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;return e.distSqr(r<0?t:r>1?n:n.sub(t)._mult(r)._add(t))}function zu(e,t){for(var n,i,r,a=!1,o=0;o<e.length;o++)for(var s=0,l=(n=e[o]).length-1;s<n.length;l=s++)i=n[s],r=n[l],i.y>t.y!=r.y>t.y&&t.x<(r.x-i.x)*(t.y-i.y)/(r.y-i.y)+i.x&&(a=!a);return a}function Du(e,t){for(var n=!1,i=0,r=e.length-1;i<e.length;r=i++){var a=e[i],o=e[r];a.y>t.y!=o.y>t.y&&t.x<(o.x-a.x)*(t.y-a.y)/(o.y-a.y)+a.x&&(n=!n)}return n}function Ru(e,t,n,i,r){var a,o=h(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(t<=s.x&&n<=s.y&&i>=s.x&&r>=s.y)return!0}}catch(f){o.e(f)}finally{o.f()}var l=[new P(t,n),new P(t,r),new P(i,r),new P(i,n)];if(e.length>2){var u,c=h(l);try{for(c.s();!(u=c.n()).done;)if(Du(e,u.value))return!0}catch(f){c.e(f)}finally{c.f()}}for(var d=0;d<e.length-1;d++)if(Bu(e[d],e[d+1],l))return!0;return!1}function Bu(e,t,n){var i=n[0],r=n[2];if(e.x<i.x&&t.x<i.x||e.x>r.x&&t.x>r.x||e.y<i.y&&t.y<i.y||e.y>r.y&&t.y>r.y)return!1;var a=ae(e,t,n[0]);return a!==ae(e,t,n[1])||a!==ae(e,t,n[2])||a!==ae(e,t,n[3])}function Fu(e,t,n){var i=t.paint.get(e).value;return"constant"===i.kind?i.value:n.programConfigurations.get(t.id).getMaxValue(e)}function Ou(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Nu(e,t,n,i,r){if(!t[0]&&!t[1])return e;var a=P.convert(t)._mult(r);"viewport"===n&&a._rotate(-i);for(var o=[],s=0;s<e.length;s++)o.push(e[s].sub(a));return o}function Hu(e,t,n,i){var r=P.convert(e)._mult(i);return"viewport"===t&&r._rotate(-n),r}ua(Tu,"CircleBucket",{omit:["layers"]});var Uu=new Xa({"circle-sort-key":new qa(pt.layout_circle["circle-sort-key"])}),ju={paint:new Xa({"circle-radius":new qa(pt.paint_circle["circle-radius"]),"circle-color":new qa(pt.paint_circle["circle-color"]),"circle-blur":new qa(pt.paint_circle["circle-blur"]),"circle-opacity":new qa(pt.paint_circle["circle-opacity"]),"circle-translate":new Ga(pt.paint_circle["circle-translate"]),"circle-translate-anchor":new Ga(pt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ga(pt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ga(pt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qa(pt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qa(pt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qa(pt.paint_circle["circle-stroke-opacity"])}),layout:Uu};function Vu(e,t,n,i,r,a,o,s,l){if(a&&e.queryGeometry.isAboveHorizon)return!1;a&&(l*=e.pixelToTileUnitsFactor);var u,c=e.tileID.canonical,d=n.projection.upVectorScale(c,n.center.lat,n.worldSize).metersToTile,f=h(t);try{for(f.s();!(u=f.n()).done;){var p,m=u.value,y=h(m);try{var g=function(){var t=p.value,u=t.add(s),h=r&&n.elevation?n.elevation.exaggeration()*r.getElevationAt(u.x,u.y,!0):0,f=n.projection.projectTilePoint(u.x,u.y,c);if(h>0){var m=n.projection.upVector(c,u.x,u.y);f.x+=m[0]*d*h,f.y+=m[1]*d*h,f.z+=m[2]*d*h}var y=a?u:Wu(f.x,f.y,f.z,i),g=a?e.tilespaceRays.map((function(e){return Zu(e,h)})):e.queryGeometry.screenGeometry,v=ol([],[f.x,f.y,f.z,1],i);if(!o&&a?l*=v[3]/n.cameraToCenterDistance:o&&!a&&(l*=n.cameraToCenterDistance/v[3]),a){var _=lu((t.y/ws+c.y)/(1<<c.z));l/=n.projection.pixelsPerMeter(_,1)/ou(1,_)}if(Su(g,y,l))return{v:!0}};for(y.s();!(p=y.n()).done;){var v=g();if("object"===typeof v)return v.v}}catch(_){y.e(_)}finally{y.f()}}}catch(_){f.e(_)}finally{f.f()}return!1}function Wu(e,t,n,i){var r=ol([],[e,t,n,1],i);return new P(r[0]/r[3],r[1]/r[3])}var Gu=Us(0,0,0),qu=Us(0,0,1);function Zu(e,t){var n=Os();return Gu[2]=t,e.intersectsPlane(Gu,qu,n),new P(n[0],n[1])}var Xu=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n)}(Tu);function Ku(e,t,n,i){var r=t.width,a=t.height;if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==r*a*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(r*a*n);return e.width=r,e.height=a,e.data=i,e}function Yu(e,t,n){var i=t.width,r=t.height;i===e.width&&r===e.height||(Ju(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,i),height:Math.min(e.height,r)},n),e.width=i,e.height=r,e.data=t.data)}function Ju(e,t,n,i,r,a){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=e.data,s=t.data,l=0;l<r.height;l++)for(var u=((n.y+l)*e.width+n.x)*a,c=((i.y+l)*t.width+i.x)*a,d=0;d<r.width*a;d++)s[c+d]=o[u+d];return t}ua(Xu,"HeatmapBucket",{omit:["layers"]});var $u=function(){function e(t,n){f(this,e),Ku(this,t,1,n)}return p(e,[{key:"resize",value:function(t){Yu(this,new e(t),1)}},{key:"clone",value:function(){return new e({width:this.width,height:this.height},new Uint8Array(this.data))}}],[{key:"copy",value:function(e,t,n,i,r){Ju(e,t,n,i,r,1)}}]),e}(),Qu=function(){function e(t,n){f(this,e),Ku(this,t,4,n)}return p(e,[{key:"resize",value:function(t){Yu(this,new e(t),4)}},{key:"replace",value:function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}},{key:"clone",value:function(){return new e({width:this.width,height:this.height},new Uint8Array(this.data))}}],[{key:"copy",value:function(e,t,n,i,r){Ju(e,t,n,i,r,4)}}]),e}();ua($u,"AlphaImage"),ua(Qu,"RGBAImage");var ec={paint:new Xa({"heatmap-radius":new qa(pt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qa(pt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ga(pt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Za(pt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ga(pt.paint_heatmap["heatmap-opacity"])})};function tc(e){var t={},n=e.resolution||256,i=e.clips?e.clips.length:1,r=e.image||new Qu({width:n,height:i}),a=function(n,i,a){t[e.evaluationKey]=a;var o=e.expression.evaluate(t);r.data[n+i+0]=Math.floor(255*o.r/o.a),r.data[n+i+1]=Math.floor(255*o.g/o.a),r.data[n+i+2]=Math.floor(255*o.b/o.a),r.data[n+i+3]=Math.floor(255*o.a)};if(e.clips)for(var o=0,s=0;o<i;++o,s+=4*n)for(var l=0,u=0;l<n;l++,u+=4){var c=l/(n-1),d=e.clips[o];a(s,u,d.start*(1-c)+d.end*c)}else for(var h=0,f=0;h<n;h++,f+=4)a(0,f,h/(n-1));return r}var nc={paint:new Xa({"hillshade-illumination-direction":new Ga(pt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ga(pt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ga(pt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ga(pt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ga(pt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ga(pt.paint_hillshade["hillshade-accent-color"])})},ic=Qa([{name:"a_pos",components:2,type:"Int16"}],4).members,rc={exports:{}};function ac(e,t,n){n=n||2;var i,r,a,o,s,l,u,c=t&&t.length,d=c?t[0]*n:e.length,h=oc(e,0,d,n,!0),f=[];if(!h||h.next===h.prev)return f;if(c&&(h=function(e,t,n,i){var r,a,o,s=[];for(r=0,a=t.length;r<a;r++)(o=oc(e,t[r]*i,r<a-1?t[r+1]*i:e.length,i,!1))===o.next&&(o.steiner=!0),s.push(gc(o));for(s.sort(fc),r=0;r<s.length;r++)n=pc(s[r],n);return n}(e,t,h,n)),e.length>80*n){i=a=e[0],r=o=e[1];for(var p=n;p<d;p+=n)(s=e[p])<i&&(i=s),(l=e[p+1])<r&&(r=l),s>a&&(a=s),l>o&&(o=l);u=0!==(u=Math.max(a-i,o-r))?32767/u:0}return lc(h,f,n,i,r,u,0),f}function oc(e,t,n,i,r){var a,o;if(r===Cc(e,t,n,i)>0)for(a=t;a<n;a+=i)o=Lc(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=Lc(a,e[a],e[a+1],o);return o&&bc(o,o.next)&&(Mc(o),o=o.next),o}function sc(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!bc(i,i.next)&&0!==xc(i.prev,i,i.next))i=i.next;else{if(Mc(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function lc(e,t,n,i,r,a,o){if(e){!o&&a&&function(e,t,n,i){var r=e;do{0===r.z&&(r.z=yc(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,l,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<u&&(s++,i=i.nextZ);t++);for(l=u;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,u*=2}while(o>1)}(r)}(e,i,r,a);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?cc(e,i,r,a):uc(e))t.push(s.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Mc(e),e=l.next,u=l.next;else if((e=l)===u){o?1===o?lc(e=dc(sc(e),t,n),t,n,i,r,a,2):2===o&&hc(e,t,n,i,r,a):lc(sc(e),t,n,i,r,a,1);break}}}function uc(e){var t=e.prev,n=e,i=e.next;if(xc(t,n,i)>=0)return!1;for(var r=t.x,a=n.x,o=i.x,s=t.y,l=n.y,u=i.y,c=r<a?r<o?r:o:a<o?a:o,d=s<l?s<u?s:u:l<u?l:u,h=r>a?r>o?r:o:a>o?a:o,f=s>l?s>u?s:u:l>u?l:u,p=i.next;p!==t;){if(p.x>=c&&p.x<=h&&p.y>=d&&p.y<=f&&vc(r,s,a,l,o,u,p.x,p.y)&&xc(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function cc(e,t,n,i){var r=e.prev,a=e,o=e.next;if(xc(r,a,o)>=0)return!1;for(var s=r.x,l=a.x,u=o.x,c=r.y,d=a.y,h=o.y,f=s<l?s<u?s:u:l<u?l:u,p=c<d?c<h?c:h:d<h?d:h,m=s>l?s>u?s:u:l>u?l:u,y=c>d?c>h?c:h:d>h?d:h,g=yc(f,p,t,n,i),v=yc(m,y,t,n,i),_=e.prevZ,x=e.nextZ;_&&_.z>=g&&x&&x.z<=v;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=y&&_!==r&&_!==o&&vc(s,c,l,d,u,h,_.x,_.y)&&xc(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,x.x>=f&&x.x<=m&&x.y>=p&&x.y<=y&&x!==r&&x!==o&&vc(s,c,l,d,u,h,x.x,x.y)&&xc(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;_&&_.z>=g;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=y&&_!==r&&_!==o&&vc(s,c,l,d,u,h,_.x,_.y)&&xc(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=v;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=y&&x!==r&&x!==o&&vc(s,c,l,d,u,h,x.x,x.y)&&xc(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function dc(e,t,n){var i=e;do{var r=i.prev,a=i.next.next;!bc(r,a)&&wc(r,i,i.next,a)&&Ec(r,a)&&Ec(a,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(a.i/n|0),Mc(i),Mc(i.next),i=e=a),i=i.next}while(i!==e);return sc(i)}function hc(e,t,n,i,r,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&_c(o,s)){var l=Sc(o,s);return o=sc(o,o.next),l=sc(l,l.next),lc(o,t,n,i,r,a,0),void lc(l,t,n,i,r,a,0)}s=s.next}o=o.next}while(o!==e)}function fc(e,t){return e.x-t.x}function pc(e,t){var n=function(e,t){var n,i=t,r=e.x,a=e.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o&&(o=s,n=i.x<i.next.x?i:i.next,s===r))return n}i=i.next}while(i!==t);if(!n)return null;var l,u=n,c=n.x,d=n.y,h=1/0;i=n;do{r>=i.x&&i.x>=c&&r!==i.x&&vc(a<d?r:o,a,c,d,a<d?o:r,a,i.x,i.y)&&(l=Math.abs(a-i.y)/(r-i.x),Ec(i,e)&&(l<h||l===h&&(i.x>n.x||i.x===n.x&&mc(n,i)))&&(n=i,h=l)),i=i.next}while(i!==u);return n}(e,t);if(!n)return t;var i=Sc(n,e);return sc(i,i.next),sc(n,n.next)}function mc(e,t){return xc(e.prev,e,t.prev)<0&&xc(t.next,e,e.next)<0}function yc(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function gc(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function vc(e,t,n,i,r,a,o,s){return(r-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(i-s)>=(n-o)*(t-s)&&(n-o)*(a-s)>=(r-o)*(i-s)}function _c(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&wc(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Ec(e,t)&&Ec(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(xc(e.prev,e,t.prev)||xc(e,t.prev,t))||bc(e,t)&&xc(e.prev,e,e.next)>0&&xc(t.prev,t,t.next)>0)}function xc(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function bc(e,t){return e.x===t.x&&e.y===t.y}function wc(e,t,n,i){var r=Tc(xc(e,t,n)),a=Tc(xc(e,t,i)),o=Tc(xc(n,i,e)),s=Tc(xc(n,i,t));return r!==a&&o!==s||!(0!==r||!kc(e,n,t))||!(0!==a||!kc(e,i,t))||!(0!==o||!kc(n,e,i))||!(0!==s||!kc(n,t,i))}function kc(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Tc(e){return e>0?1:e<0?-1:0}function Ec(e,t){return xc(e.prev,e,e.next)<0?xc(e,t,e.next)>=0&&xc(e,e.prev,t)>=0:xc(e,t,e.prev)<0||xc(e,e.next,t)<0}function Sc(e,t){var n=new Ac(e.i,e.x,e.y),i=new Ac(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function Lc(e,t,n,i){var r=new Ac(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Mc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ac(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Cc(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}rc.exports=ac,rc.exports.default=ac,ac.deviation=function(e,t,n,i){var r=t&&t.length,a=Math.abs(Cc(e,0,r?t[0]*n:e.length,n));if(r)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(Cc(e,t[o]*n,o<s-1?t[o+1]*n:e.length,n));var l=0;for(o=0;o<i.length;o+=3){var u=i[o]*n,c=i[o+1]*n,d=i[o+2]*n;l+=Math.abs((e[u]-e[d])*(e[c+1]-e[u+1])-(e[u]-e[c])*(e[d+1]-e[u+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},ac.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var a=0;a<e[r].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[r][a][o]);r>0&&n.holes.push(i+=e[r-1].length)}return n};var Ic=S(rc.exports);function Pc(e,t,n,i,r){zc(e,t,n||0,i||e.length-1,r||Rc)}function zc(e,t,n,i,r){for(;i>n;){if(i-n>600){var a=i-n+1,o=t-n+1,s=Math.log(a),l=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);zc(e,t,Math.max(n,Math.floor(t-o*l/a+u)),Math.min(i,Math.floor(t+(a-o)*l/a+u)),r)}var c=e[t],d=n,h=i;for(Dc(e,n,t),r(e[i],c)>0&&Dc(e,n,i);d<h;){for(Dc(e,d,h),d++,h--;r(e[d],c)<0;)d++;for(;r(e[h],c)>0;)h--}0===r(e[n],c)?Dc(e,n,h):Dc(e,++h,i),h<=t&&(n=h+1),t<=h&&(i=h-1)}}function Dc(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function Rc(e,t){return e<t?-1:e>t?1:0}function Bc(e,t){var n=e.length;if(n<=1)return[e];for(var i,r,a=[],o=0;o<n;o++){var s=oe(e[o]);0!==s&&(e[o].area=Math.abs(s),void 0===r&&(r=s<0),r===s<0?(i&&a.push(i),i=[e[o]]):i.push(e[o]))}if(i&&a.push(i),t>1)for(var l=0;l<a.length;l++)a[l].length<=t||(Pc(a[l],t,1,a[l].length-1,Fc),a[l]=a[l].slice(0,t));return a}function Fc(e,t){return t.area-e.area}function Oc(e,t,n){var i,r=n.patternDependencies,a=!1,o=h(t);try{for(o.s();!(i=o.n()).done;){var s=i.value.paint.get("".concat(e,"-pattern"));s.isConstant()||(a=!0);var l=s.constantOr(null);l&&(a=!0,r[l]=!0)}}catch(u){o.e(u)}finally{o.f()}return a}function Nc(e,t,n,i,r){var a,o=r.patternDependencies,s=h(t);try{for(s.s();!(a=s.n()).done;){var l=a.value,u=l.paint.get("".concat(e,"-pattern")).value;if("constant"!==u.kind){var c=u.evaluate({zoom:i},n,{},r.availableImages);o[c=c&&c.name?c.name:c]=!0,n.patterns[l.id]=c}}}catch(d){s.e(d)}finally{s.f()}return n}var Hc=function(){function e(t){f(this,e),this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new to,this.indexArray=new vo,this.indexArray2=new To,this.programConfigurations=new ds(t.layers,t.zoom),this.segments=new bs,this.segments2=new bs,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id})),this.projection=t.projection}return p(e,[{key:"populate",value:function(e,t,n,i){this.hasPattern=Oc("fill",this.layers,t);var r,a=this.layers[0].layout.get("fill-sort-key"),o=[],s=h(e);try{for(s.s();!(r=s.n()).done;){var l=r.value,u=l.feature,c=l.id,d=l.index,f=l.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,m=bu(u,p);if(this.layers[0]._featureFilter.filter(new Ba(this.zoom),m,n)){var y=a?a.evaluate(m,{},n,t.availableImages):void 0,g={id:c,properties:u.properties,type:u.type,sourceLayerIndex:f,index:d,geometry:p?m.geometry:xu(u,n,i),patterns:{},sortKey:y};o.push(g)}}}catch(E){s.e(E)}finally{s.f()}a&&o.sort((function(e,t){return e.sortKey-t.sortKey}));for(var v=0,_=o;v<_.length;v++){var x=_[v],b=x.geometry,w=x.index,k=x.sourceLayerIndex;if(this.hasPattern){var T=Nc("fill",this.layers,x,this.zoom,t);this.patternFeatures.push(T)}else this.addFeature(x,b,w,n,{},t.availableImages);t.featureIndex.insert(e[w].feature,b,w,k,this.index)}}},{key:"update",value:function(e,t,n,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,i)}},{key:"addFeatures",value:function(e,t,n,i,r){var a,o=h(this.patternFeatures);try{for(o.s();!(a=o.n()).done;){var s=a.value;this.addFeature(s,s.geometry,s.index,t,n,i)}}catch(l){o.e(l)}finally{o.f()}}},{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length}},{key:"uploadPending",value:function(){return!this.uploaded||this.programConfigurations.needsUpload}},{key:"upload",value:function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ic),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}},{key:"addFeature",value:function(e,t,n,i,r){var a,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=h(Bc(t,500));try{for(s.s();!(a=s.n()).done;){var l,u=a.value,c=0,d=h(u);try{for(d.s();!(l=d.n()).done;)c+=l.value.length}catch(E){d.e(E)}finally{d.f()}var f,p=this.segments.prepareSegment(c,this.layoutVertexArray,this.indexArray),m=p.vertexLength,y=[],g=[],v=h(u);try{for(v.s();!(f=v.n()).done;){var _=f.value;if(0!==_.length){_!==u[0]&&g.push(y.length/2);var x=this.segments2.prepareSegment(_.length,this.layoutVertexArray,this.indexArray2),b=x.vertexLength;this.layoutVertexArray.emplaceBack(_[0].x,_[0].y),this.indexArray2.emplaceBack(b+_.length-1,b),y.push(_[0].x),y.push(_[0].y);for(var w=1;w<_.length;w++)this.layoutVertexArray.emplaceBack(_[w].x,_[w].y),this.indexArray2.emplaceBack(b+w-1,b+w),y.push(_[w].x),y.push(_[w].y);x.vertexLength+=_.length,x.primitiveLength+=_.length}}}catch(E){v.e(E)}finally{v.f()}for(var k=Ic(y,g),T=0;T<k.length;T+=3)this.indexArray.emplaceBack(m+k[T],m+k[T+1],m+k[T+2]);p.vertexLength+=c,p.primitiveLength+=k.length/3}}catch(E){s.e(E)}finally{s.f()}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,o,i)}}]),e}();ua(Hc,"FillBucket",{omit:["layers","patternFeatures"]});var Uc=new Xa({"fill-sort-key":new qa(pt.layout_fill["fill-sort-key"])}),jc={paint:new Xa({"fill-antialias":new Ga(pt.paint_fill["fill-antialias"]),"fill-opacity":new qa(pt.paint_fill["fill-opacity"]),"fill-color":new qa(pt.paint_fill["fill-color"]),"fill-outline-color":new qa(pt.paint_fill["fill-outline-color"]),"fill-translate":new Ga(pt.paint_fill["fill-translate"]),"fill-translate-anchor":new Ga(pt.paint_fill["fill-translate-anchor"]),"fill-pattern":new qa(pt.paint_fill["fill-pattern"])}),layout:Uc},Vc=Qa([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Wc=Qa([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Gc=Qa([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),qc=Vc.members,Zc={},Xc=C,Kc=Yc;function Yc(e,t,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=r,e.readFields(Jc,this,t)}function Jc(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var i=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[i]=r}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function $c(e){for(var t,n,i=0,r=0,a=e.length,o=a-1;r<a;o=r++)i+=((n=e[o]).x-(t=e[r]).x)*(t.y+n.y);return i}Yc.types=["Unknown","Point","LineString","Polygon"],Yc.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,r=0,a=0,o=0,s=[];e.pos<n;){if(r<=0){var l=e.readVarint();i=7&l,r=l>>3}if(r--,1===i||2===i)a+=e.readSVarint(),o+=e.readSVarint(),1===i&&(t&&s.push(t),t=[]),t.push(new Xc(a,o));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&s.push(t),s},Yc.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,i=0,r=0,a=0,o=1/0,s=-1/0,l=1/0,u=-1/0;e.pos<t;){if(i<=0){var c=e.readVarint();n=7&c,i=c>>3}if(i--,1===n||2===n)(r+=e.readSVarint())<o&&(o=r),r>s&&(s=r),(a+=e.readSVarint())<l&&(l=a),a>u&&(u=a);else if(7!==n)throw new Error("unknown command "+n)}return[o,l,s,u]},Yc.prototype.toGeoJSON=function(e,t,n){var i,r,a=this.extent*Math.pow(2,n),o=this.extent*e,s=this.extent*t,l=this.loadGeometry(),u=Yc.types[this.type];function c(e){for(var t=0;t<e.length;t++){var n=e[t];e[t]=[360*(n.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(i=0;i<l.length;i++)d[i]=l[i][0];c(l=d);break;case 2:for(i=0;i<l.length;i++)c(l[i]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var n,i,r=[],a=0;a<t;a++){var o=$c(e[a]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(n&&r.push(n),n=[e[a]]):n.push(e[a]))}return n&&r.push(n),r}(l),i=0;i<l.length;i++)for(r=0;r<l[i].length;r++)c(l[i][r])}1===l.length?l=l[0]:u="Multi"+u;var h={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(h.id=this.id),h};var Qc=Kc,ed=td;function td(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(nd,this,t),this.length=this._features.length}function nd(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null}return t}(n))}td.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Qc(this._pbf,t,this.extent,this._keys,this._values)};var id=ed;function rd(e,t,n){if(3===e){var i=new id(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}var ad=Zc.VectorTile=function(e,t){this.layers=e.readFields(rd,{},t)},od=Zc.VectorTileFeature=Kc;function sd(e,t,n,i){var r,a=[],o=0===i?function(e,t,n,i,r,a){e.push(new P(a,n+(a-t)/(i-t)*(r-n)))}:function(e,t,n,i,r,a){e.push(new P(t+(a-n)/(r-n)*(i-t),a))},s=h(e);try{for(s.s();!(r=s.n()).done;){var l,u=r.value,c=[],d=h(u);try{for(d.s();!(l=d.n()).done;){var f=l.value;if(!(f.length<=2)){for(var p=[],m=0;m<f.length-1;m++){var y=f[m].x,g=f[m].y,v=f[m+1].x,_=f[m+1].y,x=0===i?y:g,b=0===i?v:_;x<t?b>t&&o(p,y,g,v,_,t):x>n?b<n&&o(p,y,g,v,_,n):p.push(f[m]),b<t&&x>=t&&o(p,y,g,v,_,t),b>n&&x<=n&&o(p,y,g,v,_,n)}var w=f[f.length-1],k=0===i?w.x:w.y;k>=t&&k<=n&&p.push(w),p.length&&(w=p[p.length-1],p[0].x===w.x&&p[0].y===w.y||p.push(p[0]),c.push(p))}}}catch(T){d.e(T)}finally{d.f()}c.length&&a.push(c)}}catch(T){s.e(T)}finally{s.f()}return a}Zc.VectorTileLayer=ed;var ld=od.types,ud=Math.pow(2,13);function cd(e,t,n,i,r,a,o,s){e.emplaceBack((t<<1)+o,(n<<1)+a,(Math.floor(i*ud)<<1)+r,Math.round(s))}function dd(e,t,n){var i=16384;e.emplaceBack(t.x,t.y,t.z,n[0]*i,n[1]*i,n[2]*i)}var hd=function(){function e(){f(this,e),this.acc=new P(0,0),this.polyCount=[]}return p(e,[{key:"startRing",value:function(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new P(e.x,e.y),this.max=new P(e.x,e.y))}},{key:"append",value:function(e,t){this.currentPolyCount.edges++,this.acc._add(e);var n=this.min,i=this.max;e.x<n.x?n.x=e.x:e.x>i.x&&(i.x=e.x),e.y<n.y?n.y=e.y:e.y>i.y&&(i.y=e.y),((0===e.x||e.x===ws)&&e.x===t.x)!=((0===e.y||e.y===ws)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,qn(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>ws!=e.x>ws&&this.addBorderIntersection(1,qn(t.y,e.y,(ws-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,qn(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>ws!=e.y>ws&&this.addBorderIntersection(3,qn(t.x,e.x,(ws-t.y)/(e.y-t.y)))}},{key:"addBorderIntersection",value:function(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);var n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}},{key:"processBorderOverlap",value:function(e,t){if(e.x===t.x){if(e.y===t.y)return;var n=0===e.x?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{var i=0===e.y?2:3;this.addBorderIntersection(i,t.x),this.addBorderIntersection(i,e.x)}}},{key:"centroid",value:function(){var e=this.polyCount.reduce((function(e,t){return e+t.edges}),0);return 0!==e?this.acc.div(e)._round():new P(0,0)}},{key:"span",value:function(){return new P(this.max.x-this.min.x,this.max.y-this.min.y)}},{key:"intersectsCount",value:function(){return this.borders.reduce((function(e,t){return e+ +(t[0]!==Number.MAX_VALUE)}),0)}}]),e}(),fd=function(){function e(t){f(this,e),this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new io,this.centroidVertexArray=new Fo,this.indexArray=new vo,this.programConfigurations=new ds(t.layers,t.zoom),this.segments=new bs,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id})),this.enableTerrain=t.enableTerrain}return p(e,[{key:"populate",value:function(e,t,n,i){this.features=[],this.hasPattern=Oc("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(e){var t=Math.exp(Math.PI*(1-e.y/(1<<e.z)*2));return 80150034*t/(t*t+1)/ws/(1<<e.z)}(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;var r,a=h(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.feature,l=o.id,u=o.index,c=o.sourceLayerIndex,d=this.layers[0]._featureFilter.needGeometry,f=bu(s,d);if(this.layers[0]._featureFilter.filter(new Ba(this.zoom),f,n)){var p={id:l,sourceLayerIndex:c,index:u,geometry:d?f.geometry:xu(s,n,i),properties:s.properties,type:s.type,patterns:{}},m=this.layoutVertexArray.length;this.hasPattern?this.features.push(Nc("fill-extrusion",this.layers,p,this.zoom,t)):this.addFeature(p,p.geometry,u,n,{},t.availableImages,i),t.featureIndex.insert(s,p.geometry,u,c,this.index,m)}}}catch(y){a.e(y)}finally{a.f()}this.sortBorders()}},{key:"addFeatures",value:function(e,t,n,i,r){var a,o=h(this.features);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=s.geometry;this.addFeature(s,l,s.index,t,n,i,r)}}catch(u){o.e(u)}finally{o.f()}this.sortBorders()}},{key:"update",value:function(e,t,n,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,i)}},{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length}},{key:"uploadPending",value:function(){return!this.uploaded||this.programConfigurations.needsUpload}},{key:"upload",value:function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qc),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Gc.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}},{key:"uploadCentroid",value:function(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Wc.members,!0),this.needsCentroidUpdate=!1)}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}},{key:"addFeature",value:function(e,t,n,i,r,a,o){var s=[new P(0,0),new P(ws,ws)],l=o.projection,u="globe"===l.name,c=this.enableTerrain&&!u?new hd:null,d="Polygon"===ld[e.type];u&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new lo);for(var f,p,m=Bc(t,500),y=m.length-1;y>=0;y--){var g=m[y];(0===g.length||(f=g[0]).every((function(e){return e.x<=0}))||f.every((function(e){return e.x>=ws}))||f.every((function(e){return e.y<=0}))||f.every((function(e){return e.y>=ws})))&&m.splice(y,1)}if(u)p=bd(m,s,i);else{p=[];var v,_=h(m);try{for(_.s();!(v=_.n()).done;){var x=v.value;p.push({polygon:x,bounds:s})}}catch(Ce){_.e(Ce)}finally{_.f()}}var b,w=d?this.edgeRadius:0,k=h(p);try{for(k.s();!(b=k.n()).done;){var T,E=b.value,S=E.polygon,L=E.bounds,M=0,A=0,C=h(S);try{for(C.s();!(T=C.n()).done;){var I=T.value;d&&!I[0].equals(I[I.length-1])&&I.push(I[0]),A+=d?I.length-1:I.length}}catch(Ce){C.e(Ce)}finally{C.f()}var z=this.segments.prepareSegment((d?5:4)*A,this.layoutVertexArray,this.indexArray);if(d){var D=[],R=[];M=z.vertexLength;var B,F=h(S);try{for(F.s();!(B=F.n()).done;){var O=B.value,N=void 0,H=void 0;O.length&&O!==S[0]&&R.push(D.length/2),N=O[1].sub(O[0])._perp()._unit();for(var U=1;U<O.length;U++){var j=O[U],V=O[U===O.length-1?1:U+1],W=j.x,G=j.y;if(w){H=V.sub(j)._perp()._unit();var q=N.add(H)._unit(),Z=w*Math.min(4,1/(N.x*q.x+N.y*q.y));W+=Z*q.x,G+=Z*q.y,N=H}cd(this.layoutVertexArray,W,G,0,0,1,1,0),z.vertexLength++,D.push(j.x,j.y),u&&dd(this.layoutVertexExtArray,l.projectTilePoint(W,G,i),l.upVector(i,W,G))}}}catch(Ce){F.e(Ce)}finally{F.f()}for(var X=Ic(D,R),K=0;K<X.length;K+=3)this.indexArray.emplaceBack(M+X[K],M+X[K+2],M+X[K+1]),z.primitiveLength++}var Y,J=h(S);try{for(J.s();!(Y=J.n()).done;){var $=Y.value;c&&$.length&&c.startRing($[0]);var Q=void 0,ee=void 0,te=void 0,ne=$.length>4&&vd($[$.length-2],$[0],$[1]),ie=w?md($[$.length-2],$[0],$[1],w):0;ee=$[1].sub($[0])._perp()._unit();for(var re=!0,ae=1,oe=0;ae<$.length;ae++){var se=$[ae-1],le=$[ae],ue=$[ae===$.length-1?1:ae+1];if(c&&d&&c.currentPolyCount.top++,gd(le,se,L))w&&(ee=ue.sub(le)._perp()._unit(),re=!re);else{c&&c.append(le,se);var ce=le.sub(se)._perp(),de=ce.x/(Math.abs(ce.x)+Math.abs(ce.y)),he=ce.y>0?1:0,fe=se.dist(le);if(oe+fe>32768&&(oe=0),w){te=ue.sub(le)._perp()._unit();var pe=yd(se,le,ue,pd(ee,te),w);isNaN(pe)&&(pe=0);var me=le.sub(se)._unit();se=se.add(me.mult(ie))._round(),le=le.add(me.mult(-pe))._round(),ie=pe,ee=te}var ye=z.vertexLength,ge=$.length>4&&vd(se,le,ue),ve=_d(oe,ne,re);if(cd(this.layoutVertexArray,se.x,se.y,de,he,0,0,ve),cd(this.layoutVertexArray,se.x,se.y,de,he,0,1,ve),ve=_d(oe+=fe,ge,!re),ne=ge,cd(this.layoutVertexArray,le.x,le.y,de,he,0,0,ve),cd(this.layoutVertexArray,le.x,le.y,de,he,0,1,ve),z.vertexLength+=4,this.indexArray.emplaceBack(ye+0,ye+1,ye+2),this.indexArray.emplaceBack(ye+1,ye+3,ye+2),z.primitiveLength+=2,w){var _e=M+(1===ae?$.length-2:ae-2),xe=1===ae?M:_e+1;if(this.indexArray.emplaceBack(ye+1,_e,ye+3),this.indexArray.emplaceBack(_e,xe,ye+3),z.primitiveLength+=2,void 0===Q&&(Q=ye),!gd(ue,$[ae],L)){var be=ae===$.length-1?Q:z.vertexLength;this.indexArray.emplaceBack(ye+2,ye+3,be),this.indexArray.emplaceBack(ye+3,be+1,be),this.indexArray.emplaceBack(ye+3,xe,be+1),z.primitiveLength+=3}re=!re}if(u){var we=this.layoutVertexExtArray,ke=l.projectTilePoint(se.x,se.y,i),Te=l.projectTilePoint(le.x,le.y,i),Ee=l.upVector(i,se.x,se.y),Se=l.upVector(i,le.x,le.y);dd(we,ke,Ee),dd(we,ke,Ee),dd(we,Te,Se),dd(we,Te,Se)}}}d&&(M+=$.length-1)}}catch(Ce){J.e(Ce)}finally{J.f()}}}catch(Ce){k.e(Ce)}finally{k.f()}if(c&&c.polyCount.length>0){if(c.borders){c.vertexArrayOffset=this.centroidVertexArray.length;for(var Le=c.borders,Me=this.featuresOnBorder.push(c)-1,Ae=0;Ae<4;Ae++)Le[Ae][0]!==Number.MAX_VALUE&&this.borders[Ae].push(Me)}this.encodeCentroid(c.borders?void 0:c.centroid(),c)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,a,i)}},{key:"sortBorders",value:function(){for(var e=this,t=function(t){e.borders[t].sort((function(n,i){return e.featuresOnBorder[n].borders[t][0]-e.featuresOnBorder[i].borders[t][0]}))},n=0;n<4;n++)t(n)}},{key:"encodeCentroid",value:function(e,t){var n,i,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e)if(0!==e.y){var a=t.span()._mult(this.tileToMeter);n=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(a.x/10)),i=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(a.y/10))}else n=Math.ceil(7*(e.x+450)),i=0;else n=0,i=+r;var o,s=r?this.centroidVertexArray.length:t.vertexArrayOffset,l=h(t.polyCount);try{for(l.s();!(o=l.n()).done;){var u=o.value;r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*u.edges+u.top);for(var c=0;c<u.top;c++)this.centroidVertexArray.emplace(s++,n,i);for(var d=0;d<2*u.edges;d++)this.centroidVertexArray.emplace(s++,0,i),this.centroidVertexArray.emplace(s++,n,i)}}catch(f){l.e(f)}finally{l.f()}}}]),e}();function pd(e,t){var n=e.add(t)._unit();return e.x*n.x+e.y*n.y}function md(e,t,n,i){var r=t.sub(e)._perp()._unit(),a=n.sub(t)._perp()._unit();return yd(e,t,n,pd(r,a),i)}function yd(e,t,n,i,r){var a=Math.sqrt(1-i*i);return Math.min(e.dist(t)/3,t.dist(n)/3,r*a/i)}function gd(e,t,n){return e.x<n[0].x&&t.x<n[0].x||e.x>n[1].x&&t.x>n[1].x||e.y<n[0].y&&t.y<n[0].y||e.y>n[1].y&&t.y>n[1].y}function vd(e,t,n){if(e.x<0||e.x>=ws||t.x<0||t.x>=ws||n.x<0||n.x>=ws)return!1;var i=n.sub(t),r=i.perp(),a=e.sub(t);return(i.x*a.x+i.y*a.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(a.x*a.x+a.y*a.y))>-.866&&r.x*a.x+r.y*a.y<0}function _d(e,t,n){var i=t?2|e:-3&e;return n?1|i:-2&i}function xd(){var e=Math.PI/32,t=Math.tan(e),n=Ql;return n*Math.sqrt(1+2*t*t)-n}function bd(e,t,n){var i=1<<n.z,r=su(n.x/i),a=su((n.x+1)/i),o=lu(n.y/i),s=lu((n.y+1)/i);return function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0,o=[];if(!e.length||!n||!i)return o;for(var s=function(e,t){var n,i=h(e);try{for(i.s();!(n=i.n()).done;){var r=n.value;o.push({polygon:r,bounds:t})}}catch(a){i.e(a)}finally{i.f()}},l=Math.ceil(Math.log2(n)),u=Math.ceil(Math.log2(i)),c=l-u,d=[],f=0;f<Math.abs(c);f++)d.push(c>0?0:1);for(var p=0;p<Math.min(l,u);p++)d.push(0),d.push(1);var m=e;if(m=sd(m,t[0].y-r,t[1].y+r,1),!(m=sd(m,t[0].x-r,t[1].x+r,0)).length)return o;var y=[];for(d.length?y.push({polygons:m,bounds:t,depth:0}):s(m,t);y.length;){var g=y.pop(),v=g.depth,_=d[v],x=g.bounds[0],b=g.bounds[1],w=0===_?x.x:x.y,k=0===_?b.x:b.y,T=a?a(_,w,k):.5*(w+k),E=sd(g.polygons,w-r,T+r,_),S=sd(g.polygons,T-r,k+r,_);if(E.length){var L=[x,new P(0===_?T:b.x,1===_?T:b.y)];d.length>v+1?y.push({polygons:E,bounds:L,depth:v+1}):s(E,L)}if(S.length){var M=[new P(0===_?T:x.x,1===_?T:x.y),b];d.length>v+1?y.push({polygons:S,bounds:M,depth:v+1}):s(S,M)}}return o}(e,t,Math.ceil((a-r)/11.25),Math.ceil((o-s)/11.25),1,(function(e,t,r){if(0===e)return.5*(t+r);var a=lu((n.y+t/ws)/i);return(au(.5*(lu((n.y+r/ws)/i)+a))*i-n.y)*ws}))}ua(fd,"FillExtrusionBucket",{omit:["layers","features"]}),ua(hd,"PartMetadata");var wd=new Xa({"fill-extrusion-edge-radius":new Ga(pt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])}),kd={paint:new Xa({"fill-extrusion-opacity":new Ga(pt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qa(pt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ga(pt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ga(pt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new qa(pt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qa(pt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qa(pt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ga(pt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ga(pt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ga(pt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new Ga(pt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:wd};function Td(e,t,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[e*i-2*Math.PI*6378137/2,t*i-2*Math.PI*6378137/2]}var Ed=function(){function e(t,n,i){f(this,e),this.z=t,this.x=n,this.y=i,this.key=Md(0,t,t,n,i)}return p(e,[{key:"equals",value:function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}},{key:"url",value:function(e,t){var n=function(e,t,n){var i=Td(256*e,256*(t=Math.pow(2,n)-t-1),n),r=Td(256*(e+1),256*(t+1),n);return i[0]+","+i[1]+","+r[0]+","+r[1]}(this.x,this.y,this.z),i=function(e,t,n){for(var i,r="",a=e;a>0;a--)r+=(t&(i=1<<a-1)?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",i).replace("{bbox-epsg-3857}",n)}},{key:"toString",value:function(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}]),e}(),Sd=p((function e(t,n){f(this,e),this.wrap=t,this.canonical=n,this.key=Md(t,n.z,n.z,n.x,n.y)})),Ld=function(){function e(t,n,i,r,a){f(this,e),this.overscaledZ=t,this.wrap=n,this.canonical=new Ed(i,+r,+a),this.key=0===n&&t===i?this.canonical.key:Md(n,t,i,r,a)}return p(e,[{key:"equals",value:function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}},{key:"scaledTo",value:function(t){var n=this.canonical.z-t;return t>this.canonical.z?new e(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new e(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}},{key:"calculateScaledKey",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Md(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);var n=this.canonical.z-e;return Md(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}},{key:"isChildOf",value:function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}},{key:"children",value:function(t){if(this.overscaledZ>=t)return[new e(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var n=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new e(n,this.wrap,n,i,r),new e(n,this.wrap,n,i+1,r),new e(n,this.wrap,n,i,r+1),new e(n,this.wrap,n,i+1,r+1)]}},{key:"isLessThan",value:function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}},{key:"wrapped",value:function(){return new e(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}},{key:"unwrapTo",value:function(t){return new e(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}},{key:"overscaleFactor",value:function(){return Math.pow(2,this.overscaledZ-this.canonical.z)}},{key:"toUnwrapped",value:function(){return new Sd(this.wrap,this.canonical)}},{key:"toString",value:function(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}}]),e}();function Md(e,t,n,i,r){var a=1<<Math.min(n,22),o=a*(r%a)+i%a;return e&&n<22&&(o+=a*a*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*o+n)+(t-n)}ua(Ed,"CanonicalTileID"),ua(Ld,"OverscaledTileID",{omit:["projMatrix"]});var Ad=function(e){m(n,e);var t=y(n);function n(e,i,r){var a;return f(this,n),(a=t.call(this,e,i)).z=r,a}return p(n)}(P);function Cd(e,t){return e.x*t.x+e.y*t.y}function Id(e,t){if(1===e.length){for(var n,i=0,r=t[i++];!n||r.equals(n);)if(!(n=t[i++]))return 1/0;for(;i<t.length;i++){var a=t[i],o=e[0],s=n.sub(r),l=a.sub(r),u=o.sub(r),c=Cd(s,s),d=Cd(s,l),f=Cd(l,l),p=Cd(u,s),m=Cd(u,l),y=c*f-d*d,g=(f*p-d*m)/y,v=(c*m-d*p)/y,_=r.z*(1-g-v)+n.z*g+a.z*v;if(isFinite(_))return _}return 1/0}var x,b=1/0,w=h(t);try{for(w.s();!(x=w.n()).done;){var k=x.value;b=Math.min(b,k.z)}}catch(T){w.e(T)}finally{w.f()}return b}function Pd(e,t,n,i,r,a,o,s){var l=o*r.getElevationAt(e,t,!0,!0),u=0!==a[0],c=u?0===a[1]?o*(a[0]/7-450):o*function(e,t,n){var i=Math.floor(t[0]/8),r=Math.floor(t[1]/8),a=10*(t[0]-8*i),o=10*(t[1]-8*r),s=e.getElevationAt(i,r,!0,!0),l=e.getMeterToDEM(n),u=Math.floor(.5*(a*l-1)),c=Math.floor(.5*(o*l-1)),d=e.tileCoordToPixel(i,r),h=2*u+1,f=2*c+1,p=function(e,t,n,i,r){return[e.getElevationAtPixel(t,n,!0),e.getElevationAtPixel(t+r,n,!0),e.getElevationAtPixel(t,n+r,!0),e.getElevationAtPixel(t+i,n+r,!0)]}(e,d.x-u,d.y-c,h,f),m=Math.abs(p[0]-p[1]),y=Math.abs(p[2]-p[3]),g=Math.abs(p[0]-p[2])+Math.abs(p[1]-p[3]),v=Math.min(.25,.5*l*(m+y)/h),_=Math.min(.25,.5*l*g/f);return s+Math.max(v*a,_*o)}(r,a,s):l;return{base:l+(0===n)?-1:n,top:u?Math.max(c+i,l+n+2):l+i}}var zd=Qa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4).members,Dd=Qa([{name:"a_packed",components:4,type:"Float32"}]).members,Rd=od.types,Bd=Math.cos(Math.PI/180*37.5),Fd=function(){function e(t){var n=this;f(this,e),this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(e){n.gradients[e.id]={}})),this.layoutVertexArray=new ro,this.layoutVertexArray2=new ao,this.indexArray=new vo,this.programConfigurations=new ds(t.layers,t.zoom),this.segments=new bs,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))}return p(e,[{key:"populate",value:function(e,t,n,i){this.hasPattern=Oc("line",this.layers,t);var r,a=this.layers[0].layout.get("line-sort-key"),o=[],s=h(e);try{for(s.s();!(r=s.n()).done;){var l=r.value,u=l.feature,c=l.id,d=l.index,f=l.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,m=bu(u,p);if(this.layers[0]._featureFilter.filter(new Ba(this.zoom),m,n)){var y=a?a.evaluate(m,{},n):void 0,g={id:c,properties:u.properties,type:u.type,sourceLayerIndex:f,index:d,geometry:p?m.geometry:xu(u,n,i),patterns:{},sortKey:y};o.push(g)}}}catch(M){s.e(M)}finally{s.f()}a&&o.sort((function(e,t){return e.sortKey-t.sortKey}));for(var v=t.lineAtlas,_=t.featureIndex,x=this.addConstantDashes(v),b=0,w=o;b<w.length;b++){var k=w[b],T=k.geometry,E=k.index,S=k.sourceLayerIndex;if(x&&this.addFeatureDashes(k,v),this.hasPattern){var L=Nc("line",this.layers,k,this.zoom,t);this.patternFeatures.push(L)}else this.addFeature(k,T,E,n,v.positions,t.availableImages);_.insert(e[E].feature,T,E,S,this.index)}}},{key:"addConstantDashes",value:function(e){var t,n=!1,i=h(this.layers);try{for(i.s();!(t=i.n()).done;){var r=t.value,a=r.paint.get("line-dasharray").value,o=r.layout.get("line-cap").value;if("constant"!==a.kind||"constant"!==o.kind)n=!0;else{var s=o.value,l=a.value;if(!l)continue;e.addDash(l,s)}}}catch(u){i.e(u)}finally{i.f()}return n}},{key:"addFeatureDashes",value:function(e,t){var n,i=this.zoom,r=h(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=a.paint.get("line-dasharray").value,s=a.layout.get("line-cap").value;if("constant"!==o.kind||"constant"!==s.kind){var l=void 0,u=void 0;if("constant"===o.kind){if(!(l=o.value))continue}else l=o.evaluate({zoom:i},e);u="constant"===s.kind?s.value:s.evaluate({zoom:i},e),t.addDash(l,u),e.patterns[a.id]=t.getKey(l,u)}}}catch(c){r.e(c)}finally{r.f()}}},{key:"update",value:function(e,t,n,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,i)}},{key:"addFeatures",value:function(e,t,n,i,r){var a,o=h(this.patternFeatures);try{for(o.s();!(a=o.n()).done;){var s=a.value;this.addFeature(s,s.geometry,s.index,t,n,i)}}catch(l){o.e(l)}finally{o.f()}}},{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length}},{key:"uploadPending",value:function(){return!this.uploaded||this.programConfigurations.needsUpload}},{key:"upload",value:function(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Dd)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}},{key:"lineFeatureClips",value:function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}},{key:"addFeature",value:function(e,t,n,i,r,a){var o=this.layers[0].layout,s=o.get("line-join").evaluate(e,{}),l=o.get("line-cap").evaluate(e,{}),u=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);var d,f=h(t);try{for(f.s();!(d=f.n()).done;){var p=d.value;this.addLine(p,e,s,l,u,c)}}catch(m){f.e(m)}finally{f.f()}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,a,i)}},{key:"addLine",value:function(e,t,n,i,r,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var o=0;o<e.length-1;o++)this.totalDistance+=e[o].dist(e[o+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===Rd[t.type],l=e.length;l>=2&&e[l-1].equals(e[l-2]);)l--;for(var u=0;u<l-1&&e[u].equals(e[u+1]);)u++;if(!(l<(s?3:2))){"bevel"===n&&(r=1.05);var c,d,h,f,p,m=this.overscaling<=16?15*ws/(512*this.overscaling):0,y=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);this.e1=this.e2=-1,s&&(c=e[l-2],p=e[u].sub(c)._unit()._perp());for(var g=u;g<l;g++)if(!(h=g===l-1?s?e[u+1]:void 0:e[g+1])||!e[g].equals(h)){p&&(f=p),c&&(d=c),c=e[g],p=h?h.sub(c)._unit()._perp():f;var v=(f=f||p).add(p);0===v.x&&0===v.y||v._unit();var _=f.x*p.x+f.y*p.y,x=v.x*p.x+v.y*p.y,b=0!==x?1/x:1/0,w=2*Math.sqrt(2-2*x),k=x<Bd&&d&&h,T=f.x*p.y-f.y*p.x>0;if(k&&g>u){var E=c.dist(d);if(E>2*m){var S=c.sub(c.sub(d)._mult(m/E)._round());this.updateDistance(d,S),this.addCurrentVertex(S,f,0,0,y),d=S}}var L=d&&h,M=L?n:s?"butt":i;if(L&&"round"===M&&(b<a?M="miter":b<=2&&(M="fakeround")),"miter"===M&&b>r&&(M="bevel"),"bevel"===M&&(b>2&&(M="flipbevel"),b<r&&(M="miter")),d&&this.updateDistance(d,c),"miter"===M)v._mult(b),this.addCurrentVertex(c,v,0,0,y);else if("flipbevel"===M){if(b>100)v=p.mult(-1);else{var A=b*f.add(p).mag()/f.sub(p).mag();v._perp()._mult(A*(T?-1:1))}this.addCurrentVertex(c,v,0,0,y),this.addCurrentVertex(c,v.mult(-1),0,0,y)}else if("bevel"===M||"fakeround"===M){var C=-Math.sqrt(b*b-1),I=T?C:0,P=T?0:C;if(d&&this.addCurrentVertex(c,f,I,P,y),"fakeround"===M)for(var z=Math.round(180*w/Math.PI/20),D=1;D<z;D++){var R=D/z;if(.5!==R){var B=R-.5;R+=R*B*(R-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*B*B+(.848013+_*(.215638*_-1.06021)))}var F=p.sub(f)._mult(R)._add(f)._unit()._mult(T?-1:1);this.addHalfVertex(c,F.x,F.y,!1,T,0,y)}h&&this.addCurrentVertex(c,p,-I,-P,y)}else if("butt"===M)this.addCurrentVertex(c,v,0,0,y);else if("square"===M){var O=d?1:-1;d||this.addCurrentVertex(c,v,O,O,y),this.addCurrentVertex(c,v,0,0,y),d&&this.addCurrentVertex(c,v,O,O,y)}else"round"===M&&(d&&(this.addCurrentVertex(c,f,0,0,y),this.addCurrentVertex(c,f,1,1,y,!0)),h&&(this.addCurrentVertex(c,p,-1,-1,y,!0),this.addCurrentVertex(c,p,0,0,y)));if(k&&g<l-1){var N=c.dist(h);if(N>2*m){var H=c.add(h.sub(c)._mult(m/N)._round());this.updateDistance(c,H),this.addCurrentVertex(H,p,0,0,y),c=H}}}}}},{key:"addCurrentVertex",value:function(e,t,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=t.y*i-t.x,s=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,a,!1,n,r),this.addHalfVertex(e,o,s,a,!0,-i,r)}},{key:"addHalfVertex",value:function(e,t,n,i,r,a,o){var s=e.x,l=e.y;this.layoutVertexArray.emplaceBack((s<<1)+(i?1:0),(l<<1)+(r?1:0),Math.round(63*t)+128,Math.round(63*n)+128,1+(0===a?0:a<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);var u=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),o.primitiveLength++),r?this.e2=u:this.e1=u}},{key:"updateScaledDistance",value:function(){if(this.lineClips){var e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}},{key:"updateDistance",value:function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}]),e}();ua(Fd,"LineBucket",{omit:["layers","patternFeatures"]});var Od=new Xa({"line-cap":new qa(pt.layout_line["line-cap"]),"line-join":new qa(pt.layout_line["line-join"]),"line-miter-limit":new Ga(pt.layout_line["line-miter-limit"]),"line-round-limit":new Ga(pt.layout_line["line-round-limit"]),"line-sort-key":new qa(pt.layout_line["line-sort-key"])}),Nd={paint:new Xa({"line-opacity":new qa(pt.paint_line["line-opacity"]),"line-color":new qa(pt.paint_line["line-color"]),"line-translate":new Ga(pt.paint_line["line-translate"]),"line-translate-anchor":new Ga(pt.paint_line["line-translate-anchor"]),"line-width":new qa(pt.paint_line["line-width"]),"line-gap-width":new qa(pt.paint_line["line-gap-width"]),"line-offset":new qa(pt.paint_line["line-offset"]),"line-blur":new qa(pt.paint_line["line-blur"]),"line-dasharray":new qa(pt.paint_line["line-dasharray"]),"line-pattern":new qa(pt.paint_line["line-pattern"]),"line-gradient":new Za(pt.paint_line["line-gradient"]),"line-trim-offset":new Ga(pt.paint_line["line-trim-offset"])}),layout:Od},Hd=new(function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"possiblyEvaluate",value:function(e,t){return t=new Ba(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),o(s(n.prototype),"possiblyEvaluate",this).call(this,e,t)}},{key:"evaluate",value:function(e,t,i,r){return t=q({},t,{zoom:Math.floor(t.zoom)}),o(s(n.prototype),"evaluate",this).call(this,e,t,i,r)}}]),n}(qa))(Nd.paint.properties["line-width"].specification);function Ud(e,t){return t>0?t+2*e:e}Hd.useIntegerZoom=!0;var jd=Qa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vd=Qa([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Wd=Qa([{name:"a_projected_pos",components:4,type:"Float32"}],4);Qa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);var Gd=Qa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),qd=Qa([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Qa([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);var Zd=Qa([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xd=Qa([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Qa([{name:"triangle",components:3,type:"Uint16"}]),Qa([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Qa([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Qa([{type:"Float32",name:"offsetX"}]),Qa([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Kd=24,Yd=128;function Jd(e,t){var n=t.expression;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Ba(e+1))};if("source"===n.kind)return{kind:"source"};for(var i=n.zoomStops,r=n.interpolationType,a=0;a<i.length&&i[a]<=e;)a++;for(var o=a=Math.max(0,a-1);o<i.length&&i[o]<e+1;)o++;o=Math.min(i.length-1,o);var s=i[a],l=i[o];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:l,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:l,minSize:n.evaluate(new Ba(s)),maxSize:n.evaluate(new Ba(l)),interpolationType:r}}function $d(e,t,n){var i=t.uSize,r=t.uSizeT,a=n.lowerSize,o=n.upperSize;return"source"===e.kind?a/Yd:"composite"===e.kind?qn(a/Yd,o/Yd,r):i}function Qd(e,t){var n=0,i=0;if("constant"===e.kind)i=e.layoutSize;else if("source"!==e.kind){var r=e.interpolationType,a=e.minZoom,o=e.maxZoom,s=r?U(pi.interpolationFactor(r,t,a,o),0,1):0;"camera"===e.kind?i=qn(e.minSize,e.maxSize,s):n=s}return{uSizeT:n,uSize:i}}var eh=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Yd,evaluateSizeForFeature:$d,evaluateSizeForZoom:Qd,getSizeData:Jd});function th(e,t,n){return e.sections.forEach((function(e){e.text=function(e,t,n){var i=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?e=e.toLocaleUpperCase():"lowercase"===i&&(e=e.toLocaleLowerCase()),Ra.applyArabicShaping&&(e=Ra.applyArabicShaping(e)),e}(e.text,t,n)})),e}var nh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function ih(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function rh(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}var ah=lh,oh=function(e,t,n,i,r){var a,o,s=8*r-i-1,l=(1<<s)-1,u=l>>1,c=-7,d=n?r-1:0,h=n?-1:1,f=e[t+d];for(d+=h,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+d],d+=h,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=i;c>0;o=256*o+e[t+d],d+=h,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),a-=u}return(f?-1:1)*o*Math.pow(2,a-i)},sh=function(e,t,n,i,r,a){var o,s,l,u=8*a-r-1,c=(1<<u)-1,d=c>>1,h=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:a-1,p=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=c?(s=0,o=c):o+d>=1?(s=(t*l-1)*Math.pow(2,r),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,r),o=0));r>=8;e[n+f]=255&s,f+=p,s/=256,r-=8);for(o=o<<r|s,u+=r;u>0;e[n+f]=255&o,f+=p,o/=256,u-=8);e[n+f-p]|=128*m};function lh(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}lh.Varint=0,lh.Fixed64=1,lh.Bytes=2,lh.Fixed32=5;var uh=4294967296,ch=1/uh,dh="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function hh(e){return e.type===lh.Bytes?e.readVarint()+e.pos:e.pos+1}function fh(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function ph(e,t,n){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=e;r--)n.buf[r+i]=n.buf[r]}function mh(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function yh(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function gh(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function vh(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function _h(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function xh(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function bh(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function wh(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function kh(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function Th(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Eh(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function Sh(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}lh.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,a=this.pos;this.type=7&i,e(r,t,this),this.pos===a&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Th(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Sh(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Th(this.buf,this.pos)+Th(this.buf,this.pos+4)*uh;return this.pos+=8,e},readSFixed64:function(){var e=Th(this.buf,this.pos)+Sh(this.buf,this.pos+4)*uh;return this.pos+=8,e},readFloat:function(){var e=oh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=oh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,i=this.buf;return t=127&(n=i[this.pos++]),n<128?t:(t|=(127&(n=i[this.pos++]))<<7,n<128?t:(t|=(127&(n=i[this.pos++]))<<14,n<128?t:(t|=(127&(n=i[this.pos++]))<<21,n<128?t:function(e,t,n){var i,r,a=n.buf;if(i=(112&(r=a[n.pos++]))>>4,r<128)return fh(e,i,t);if(i|=(127&(r=a[n.pos++]))<<3,r<128)return fh(e,i,t);if(i|=(127&(r=a[n.pos++]))<<10,r<128)return fh(e,i,t);if(i|=(127&(r=a[n.pos++]))<<17,r<128)return fh(e,i,t);if(i|=(127&(r=a[n.pos++]))<<24,r<128)return fh(e,i,t);if(i|=(1&(r=a[n.pos++]))<<31,r<128)return fh(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&dh?function(e,t,n){return dh.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(var i="",r=t;r<n;){var a,o,s,l=e[r],u=null,c=l>239?4:l>223?3:l>191?2:1;if(r+c>n)break;1===c?l<128&&(u=l):2===c?128==(192&(a=e[r+1]))&&(u=(31&l)<<6|63&a)<=127&&(u=null):3===c?(o=e[r+2],128==(192&(a=e[r+1]))&&128==(192&o)&&((u=(15&l)<<12|(63&a)<<6|63&o)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(o=e[r+2],s=e[r+3],128==(192&(a=e[r+1]))&&128==(192&o)&&128==(192&s)&&((u=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,i+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),i+=String.fromCharCode(u),r+=c}return i}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==lh.Bytes)return e.push(this.readVarint(t));var n=hh(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==lh.Bytes)return e.push(this.readSVarint());var t=hh(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==lh.Bytes)return e.push(this.readBoolean());var t=hh(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==lh.Bytes)return e.push(this.readFloat());var t=hh(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==lh.Bytes)return e.push(this.readDouble());var t=hh(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==lh.Bytes)return e.push(this.readFixed32());var t=hh(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==lh.Bytes)return e.push(this.readSFixed32());var t=hh(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==lh.Bytes)return e.push(this.readFixed64());var t=hh(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==lh.Bytes)return e.push(this.readSFixed64());var t=hh(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===lh.Varint)for(;this.buf[this.pos++]>127;);else if(t===lh.Bytes)this.pos=this.readVarint()+this.pos;else if(t===lh.Fixed32)this.pos+=4;else{if(t!==lh.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Eh(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Eh(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Eh(this.buf,-1&e,this.pos),Eh(this.buf,Math.floor(e*ch),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Eh(this.buf,-1&e,this.pos),Eh(this.buf,Math.floor(e*ch),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,i;if(e>=0?(n=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var i,r,a=0;a<t.length;a++){if((i=t.charCodeAt(a))>55295&&i<57344){if(!r){i>56319||a+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):r=i;continue}if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(e[n++]=239,e[n++]=191,e[n++]=189,r=null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&ph(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),sh(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),sh(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var i=this.pos-n;i>=128&&ph(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,n){this.writeTag(e,lh.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,mh,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,yh,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,_h,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,gh,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,vh,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,xh,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,bh,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,wh,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,kh,t)},writeBytesField:function(e,t){this.writeTag(e,lh.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,lh.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,lh.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,lh.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,lh.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,lh.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,lh.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,lh.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,lh.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,lh.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Lh=S(ah),Mh=3;function Ah(e,t,n){t.glyphs=[],1===e&&n.readMessage(Ch,t)}function Ch(e,t,n){if(3===e){var i=n.readMessage(Ih,{}),r=i.id,a=i.bitmap,o=i.width,s=i.height,l=i.left,u=i.top,c=i.advance;t.glyphs.push({id:r,bitmap:new $u({width:o+2*Mh,height:s+2*Mh},a),metrics:{width:o,height:s,left:l,top:u,advance:c}})}else 4===e?t.ascender=n.readSVarint():5===e&&(t.descender=n.readSVarint())}function Ih(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}var Ph=Mh;function zh(e){var t,n=0,i=0,r=h(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n+=a.w*a.h,i=Math.max(i,a.w)}}catch(y){r.e(y)}finally{r.f()}e.sort((function(e,t){return t.h-e.h}));var o,s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),i),h:1/0}],l=0,u=0,c=h(e);try{for(c.s();!(o=c.n()).done;)for(var d=o.value,f=s.length-1;f>=0;f--){var p=s[f];if(!(d.w>p.w||d.h>p.h)){if(d.x=p.x,d.y=p.y,u=Math.max(u,d.y+d.h),l=Math.max(l,d.x+d.w),d.w===p.w&&d.h===p.h){var m=s.pop();f<s.length&&(s[f]=m)}else d.h===p.h?(p.x+=d.w,p.w-=d.w):d.w===p.w?(p.y+=d.h,p.h-=d.h):(s.push({x:p.x+d.w,y:p.y,w:p.w-d.w,h:d.h}),p.y+=d.h,p.h-=d.h);break}}}catch(y){c.e(y)}finally{c.f()}return{w:l,h:u,fill:n/(l*u)||0}}var Dh=1,Rh=function(){function e(t,n){var i=n.pixelRatio,r=n.version,a=n.stretchX,o=n.stretchY,s=n.content;f(this,e),this.paddedRect=t,this.pixelRatio=i,this.stretchX=a,this.stretchY=o,this.content=s,this.version=r}return p(e,[{key:"tl",get:function(){return[this.paddedRect.x+Dh,this.paddedRect.y+Dh]}},{key:"br",get:function(){return[this.paddedRect.x+this.paddedRect.w-Dh,this.paddedRect.y+this.paddedRect.h-Dh]}},{key:"displaySize",get:function(){return[(this.paddedRect.w-2*Dh)/this.pixelRatio,(this.paddedRect.h-2*Dh)/this.pixelRatio]}}]),e}(),Bh=function(){function e(t,n){f(this,e);var i={},r={};this.haveRenderCallbacks=[];var a=[];this.addImages(t,i,a),this.addImages(n,r,a);var o=zh(a),s=o.w,l=o.h,u=new Qu({width:s||1,height:l||1});for(var c in t){var d=t[c],h=i[c].paddedRect;Qu.copy(d.data,u,{x:0,y:0},{x:h.x+Dh,y:h.y+Dh},d.data)}for(var p in n){var m=n[p],y=r[p].paddedRect,g=y.x+Dh,v=y.y+Dh,_=m.data.width,x=m.data.height;Qu.copy(m.data,u,{x:0,y:0},{x:g,y:v},m.data),Qu.copy(m.data,u,{x:0,y:x-1},{x:g,y:v-1},{width:_,height:1}),Qu.copy(m.data,u,{x:0,y:0},{x:g,y:v+x},{width:_,height:1}),Qu.copy(m.data,u,{x:_-1,y:0},{x:g-1,y:v},{width:1,height:x}),Qu.copy(m.data,u,{x:0,y:0},{x:g+_,y:v},{width:1,height:x})}this.image=u,this.iconPositions=i,this.patternPositions=r}return p(e,[{key:"addImages",value:function(e,t,n){for(var i in e){var r=e[i],a={x:0,y:0,w:r.data.width+2*Dh,h:r.data.height+2*Dh};n.push(a),t[i]=new Rh(a,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}},{key:"patchUpdatedImages",value:function(e,t){for(var n in this.haveRenderCallbacks=this.haveRenderCallbacks.filter((function(t){return e.hasImage(t)})),e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}},{key:"patchUpdatedImage",value:function(e,t,n){if(e&&t&&e.version!==t.version){e.version=t.version;var i=d(e.tl,2),r=i[0],a=i[1];n.update(t.data,void 0,{x:r,y:a})}}}]),e}();ua(Rh,"ImagePosition"),ua(Bh,"ImageAtlas");var Fh={horizontal:1,vertical:2,horizontalOnly:3},Oh=-17,Nh=function(){function e(){f(this,e),this.scale=1,this.fontStack="",this.imageName=null}return p(e,null,[{key:"forText",value:function(t,n){var i=new e;return i.scale=t||1,i.fontStack=n,i}},{key:"forImage",value:function(t){var n=new e;return n.imageName=t,n}}]),e}(),Hh=function(){function e(){f(this,e),this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}return p(e,[{key:"length",value:function(){return this.text.length}},{key:"getSection",value:function(e){return this.sections[this.sectionIndex[e]]}},{key:"getSections",value:function(){return this.sections}},{key:"getSectionIndex",value:function(e){return this.sectionIndex[e]}},{key:"getCharCode",value:function(e){return this.text.charCodeAt(e)}},{key:"verticalizePunctuation",value:function(e){this.text=function(e,t){for(var n="",i=0;i<e.length;i++){var r=e.charCodeAt(i+1)||null,a=e.charCodeAt(i-1)||null;n+=!t&&(r&&xa(r)&&!nh[e[i+1]]||a&&xa(a)&&!nh[e[i-1]])||!nh[e[i]]?e[i]:nh[e[i]]}return n}(this.text,e)}},{key:"trim",value:function(){for(var e=0,t=0;t<this.text.length&&jh[this.text.charCodeAt(t)];t++)e++;for(var n=this.text.length,i=this.text.length-1;i>=0&&i>=e&&jh[this.text.charCodeAt(i)];i--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}},{key:"substring",value:function(t,n){var i=new e;return i.text=this.text.substring(t,n),i.sectionIndex=this.sectionIndex.slice(t,n),i.sections=this.sections,i}},{key:"toString",value:function(){return this.text}},{key:"getMaxScale",value:function(){var e=this;return this.sectionIndex.reduce((function(t,n){return Math.max(t,e.sections[n].scale)}),0)}},{key:"addTextSection",value:function(e,t){this.text+=e.text,this.sections.push(Nh.forText(e.scale,e.fontStack||t));for(var n=this.sections.length-1,i=0;i<e.text.length;++i)this.sectionIndex.push(n)}},{key:"addImageSection",value:function(e){var t=e.image?e.image.name:"";if(0!==t.length){var n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Nh.forImage(t)),this.sectionIndex.push(this.sections.length-1)):re("Reached maximum number of images 6401")}else re("Can't add FormattedSection with an empty image.")}},{key:"getNextImageSectionCharCode",value:function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}],[{key:"fromFeature",value:function(t,n){for(var i=new e,r=0;r<t.sections.length;r++){var a=t.sections[r];a.image?i.addImageSection(a):i.addTextSection(a,n)}return i}}]),e}();function Uh(e,t,n,i,r,a,o,s,l,u,c,d,f,p,m){var y=Hh.fromFeature(e,r);d===Fh.vertical&&y.verticalizePunctuation(f);var g=[],v=function(e,t,n,i,r,a){if(!e)return[];for(var o,s=[],l=function(e,t,n,i,r,a){for(var o=0,s=0;s<e.length();s++){var l=e.getSection(s);o+=Wh(e.getCharCode(s),l,i,r,t,a)}return o/Math.max(1,Math.ceil(o/n))}(e,t,n,i,r,a),u=e.text.indexOf("\u200b")>=0,c=0,d=0;d<e.length();d++){var h=e.getSection(d),f=e.getCharCode(d);if(jh[f]||(c+=Wh(f,h,i,r,t,a)),d<e.length()-1){var p=!((o=f)<11904||!(ma["Bopomofo Extended"](o)||ma.Bopomofo(o)||ma["CJK Compatibility Forms"](o)||ma["CJK Compatibility Ideographs"](o)||ma["CJK Compatibility"](o)||ma["CJK Radicals Supplement"](o)||ma["CJK Strokes"](o)||ma["CJK Symbols and Punctuation"](o)||ma["CJK Unified Ideographs Extension A"](o)||ma["CJK Unified Ideographs"](o)||ma["Enclosed CJK Letters and Months"](o)||ma["Halfwidth and Fullwidth Forms"](o)||ma.Hiragana(o)||ma["Ideographic Description Characters"](o)||ma["Kangxi Radicals"](o)||ma["Katakana Phonetic Extensions"](o)||ma.Katakana(o)||ma["Vertical Forms"](o)||ma["Yi Radicals"](o)||ma["Yi Syllables"](o)));(Vh[f]||p||h.imageName)&&s.push(Zh(d+1,c,l,s,qh(f,e.getCharCode(d+1),p&&u),!1))}}return Xh(Zh(e.length(),c,l,s,0,!0))}(y,u,a,t,i,p),_=Ra.processBidirectionalText,x=Ra.processStyledBidirectionalText;if(_&&1===y.sections.length){var b,w=_(y.toString(),v),k=h(w);try{for(k.s();!(b=k.n()).done;){var T=b.value,E=new Hh;E.text=T,E.sections=y.sections;for(var S=0;S<T.length;S++)E.sectionIndex.push(0);g.push(E)}}catch(D){k.e(D)}finally{k.f()}}else if(x){var L,M=x(y.text,y.sectionIndex,v),A=h(M);try{for(A.s();!(L=A.n()).done;){var C=L.value,I=new Hh;I.text=C[0],I.sectionIndex=C[1],I.sections=y.sections,g.push(I)}}catch(D){A.e(D)}finally{A.f()}}else g=function(e,t){var n,i=[],r=e.text,a=0,o=h(t);try{for(o.s();!(n=o.n()).done;){var s=n.value;i.push(e.substring(a,s)),a=s}}catch(D){o.e(D)}finally{o.f()}return a<r.length&&i.push(e.substring(a,r.length)),i}(y,v);var P=[],z={positionedLines:P,text:y.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:d,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,n,i,r,a,o,s,l,u,c,d){var f,p=0,m=0,y=0,g="right"===s?1:"left"===s?0:.5,v=!1,_=h(r);try{for(_.s();!(f=_.n()).done;){var x,b=f.value.getSections(),w=h(b);try{for(w.s();!(x=w.n()).done;){var k=x.value;if(!k.imageName){var T=t[k.fontStack];if(T&&!(v=void 0!==T.ascender&&void 0!==T.descender))break}}}catch(D){w.e(D)}finally{w.f()}if(!v)break}}catch(D){_.e(D)}finally{_.f()}var E,S,L=0,M=h(r);try{for(M.s();!(E=M.n()).done;){var A=E.value;A.trim();var C=A.getMaxScale(),I=(C-1)*Kd,P={positionedGlyphs:[],lineOffset:0};e.positionedLines[L]=P;var z=P.positionedGlyphs,R=0;if(A.length()){for(var B=0,F=0,O=0;O<A.length();O++){var N=A.getSection(O),H=A.getSectionIndex(O),U=A.getCharCode(O),j=N.scale,V=null,W=null,G=null,q=Kd,Z=0,X=!(l===Fh.horizontal||!c&&!_a(U)||c&&(jh[U]||(S=U,ma.Arabic(S)||ma["Arabic Supplement"](S)||ma["Arabic Extended-A"](S)||ma["Arabic Presentation Forms-A"](S)||ma["Arabic Presentation Forms-B"](S))));if(N.imageName){var K=i[N.imageName];if(!K)continue;G=N.imageName,e.iconsInText=e.iconsInText||!0,W=K.paddedRect;var Y=K.displaySize;j=j*Kd/d,V={width:Y[0],height:Y[1],left:Dh,top:-Ph,advance:X?Y[1]:Y[0],localGlyph:!1},Z=v?-V.height*j:Oh+C*Kd-Y[1]*j,q=V.advance;var J=(X?Y[0]:Y[1])*j-Kd*C;J>0&&J>R&&(R=J)}else{var $=n[N.fontStack];if(!$)continue;$[U]&&(W=$[U]);var Q=t[N.fontStack];if(!Q)continue;var ee=Q.glyphs[U];if(!ee)continue;if(V=ee.metrics,q=8203!==U?Kd:0,v){var te=void 0!==Q.ascender?Math.abs(Q.ascender):0,ne=void 0!==Q.descender?Math.abs(Q.descender):0,ie=(te+ne)*j;B<ie&&(B=ie,F=(te-ne)/2*j),Z=-te*j}else Z=Oh+(C-j)*Kd}X?(e.verticalizable=!0,z.push({glyph:U,imageName:G,x:p,y:m+Z,vertical:X,scale:j,localGlyph:V.localGlyph,fontStack:N.fontStack,sectionIndex:H,metrics:V,rect:W}),p+=q*j+u):(z.push({glyph:U,imageName:G,x:p,y:m+Z,vertical:X,scale:j,localGlyph:V.localGlyph,fontStack:N.fontStack,sectionIndex:H,metrics:V,rect:W}),p+=V.advance*j+u)}0!==z.length&&(y=Math.max(p-u,y),v?Yh(z,g,R,F,a*C/2):Yh(z,g,R,0,a/2)),p=0;var re=a*C+R;P.lineOffset=Math.max(R,I),m+=re,++L}else m+=a,++L}}catch(D){M.e(D)}finally{M.f()}var ae=m,oe=Kh(o),se=oe.horizontalAlign,le=oe.verticalAlign;(function(e,t,n,i,r,a){var o,s=(t-n)*r,l=-a*i,u=h(e);try{for(u.s();!(o=u.n()).done;){var c,d=o.value,f=h(d.positionedGlyphs);try{for(f.s();!(c=f.n()).done;){var p=c.value;p.x+=s,p.y+=l}}catch(D){f.e(D)}finally{f.f()}}}catch(D){u.e(D)}finally{u.f()}})(e.positionedLines,g,se,le,y,ae),e.top+=-le*ae,e.bottom=e.top+ae,e.left+=-se*y,e.right=e.left+y,e.hasBaseline=v}(z,t,n,i,g,o,s,l,d,u,f,m),!function(e){var t,n=h(e);try{for(n.s();!(t=n.n()).done;)if(0!==t.value.positionedGlyphs.length)return!1}catch(D){n.e(D)}finally{n.f()}return!0}(P)&&z}var jh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Vh={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Wh(e,t,n,i,r,a){if(t.imageName){var o=i[t.imageName];return o?o.displaySize[0]*t.scale*Kd/a+r:0}var s=n[t.fontStack],l=s&&s.glyphs[e];return l?l.metrics.advance*t.scale+r:0}function Gh(e,t,n,i){var r=Math.pow(e-t,2);return i?e<t?r/2:2*r:r+Math.abs(n)*n}function qh(e,t,n){var i=0;return 10===e&&(i-=1e4),n&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function Zh(e,t,n,i,r,a){var o,s=null,l=Gh(t,n,r,a),u=h(i);try{for(u.s();!(o=u.n()).done;){var c=o.value,d=Gh(t-c.x,n,r,a)+c.badness;d<=l&&(s=c,l=d)}}catch(f){u.e(f)}finally{u.f()}return{index:e,x:t,priorBreak:s,badness:l}}function Xh(e){return e?Xh(e.priorBreak).concat(e.index):[]}function Kh(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Yh(e,t,n,i,r){if(t||n||i||r)for(var a=e.length-1,o=e[a],s=(o.x+o.metrics.advance*o.scale)*t,l=0;l<=a;l++)e[l].x-=s,e[l].y+=n+i+r}function Jh(e,t,n){var i=Kh(n),r=i.horizontalAlign,a=i.verticalAlign,o=t[0]-e.displaySize[0]*r,s=t[1]-e.displaySize[1]*a;return{image:e,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function $h(e,t,n,i,r,a){var o,s=e.image;if(s.content){var l=s.content,u=s.pixelRatio||1;o=[l[0]/u,l[1]/u,s.displaySize[0]-l[2]/u,s.displaySize[1]-l[3]/u]}var c,d,h,f,p=t.left*a,m=t.right*a;"width"===n||"both"===n?(f=r[0]+p-i[3],d=r[0]+m+i[1]):d=(f=r[0]+(p+m-s.displaySize[0])/2)+s.displaySize[0];var y=t.top*a,g=t.bottom*a;return"height"===n||"both"===n?(c=r[1]+y-i[0],h=r[1]+g+i[2]):h=(c=r[1]+(y+g-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:c,right:d,bottom:h,left:f,collisionPadding:o}}var Qh=function(e){m(n,e);var t=y(n);function n(e,i,r,a,o){var s;return f(this,n),(s=t.call(this,e,i)).angle=a,s.z=r,void 0!==o&&(s.segment=o),s}return p(n,[{key:"clone",value:function(){return new n(this.x,this.y,this.z,this.angle,this.segment)}}]),n}(P);function ef(e,t,n,i,r){if(void 0===t.segment)return!0;for(var a=t,o=t.segment+1,s=0;s>-n/2;){if(--o<0)return!1;s-=e[o].dist(a),a=e[o]}s+=e[o].dist(e[o+1]),o++;for(var l=[],u=0;s<n/2;){var c=e[o],d=e[o+1];if(!d)return!1;var h=e[o-1].angleTo(c)-c.angleTo(d);for(h=Math.abs((h+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:h}),u+=h;s-l[0].distance>i;)u-=l.shift().angleDelta;if(u>r)return!1;o++,s+=c.dist(d)}return!0}function tf(e){for(var t=0,n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function nf(e,t,n){return e?.6*t*n:0}function rf(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function af(e,t,n,i,r,a){for(var o=nf(n,r,a),s=rf(n,i)*a,l=0,u=tf(e)/2,c=0;c<e.length-1;c++){var d=e[c],h=e[c+1],f=d.dist(h);if(l+f>u){var p=(u-l)/f,m=qn(d.x,h.x,p),y=qn(d.y,h.y,p),g=new Qh(m,y,0,h.angleTo(d),c);return!o||ef(e,g,s,o,t)?g:void 0}l+=f}}function of(e,t,n,i,r,a,o,s,l){var u=nf(i,a,o),c=rf(i,r),d=c*o,h=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-d<t/4&&(t=d+t/4),sf(e,h?t/2*s%t:(c/2+2*a)*o*s%t,t,u,n,d,h,!1,l)}function sf(e,t,n,i,r,a,o,s,l){for(var u=a/2,c=tf(e),d=0,h=t-n,f=[],p=0;p<e.length-1;p++){for(var m=e[p],y=e[p+1],g=m.dist(y),v=y.angleTo(m);h+n<d+g;){var _=((h+=n)-d)/g,x=qn(m.x,y.x,_),b=qn(m.y,y.y,_);if(x>=0&&x<l&&b>=0&&b<l&&h-u>=0&&h+u<=c){var w=new Qh(x,b,0,v,p);w._round(),i&&!ef(e,w,a,i,r)||f.push(w)}}d+=g}return s||f.length||o||(f=sf(e,d/2,n,i,r,a,o,!0,l)),f}function lf(e,t,n,i,r){for(var a=[],o=0;o<e.length;o++)for(var s=e[o],l=void 0,u=0;u<s.length-1;u++){var c=s[u],d=s[u+1];c.x<t&&d.x<t||(c.x<t?c=new P(t,c.y+(t-c.x)/(d.x-c.x)*(d.y-c.y))._round():d.x<t&&(d=new P(t,c.y+(t-c.x)/(d.x-c.x)*(d.y-c.y))._round()),c.y<n&&d.y<n||(c.y<n?c=new P(c.x+(n-c.y)/(d.y-c.y)*(d.x-c.x),n)._round():d.y<n&&(d=new P(c.x+(n-c.y)/(d.y-c.y)*(d.x-c.x),n)._round()),c.x>=i&&d.x>=i||(c.x>=i?c=new P(i,c.y+(i-c.x)/(d.x-c.x)*(d.y-c.y))._round():d.x>=i&&(d=new P(i,c.y+(i-c.x)/(d.x-c.x)*(d.y-c.y))._round()),c.y>=r&&d.y>=r||(c.y>=r?c=new P(c.x+(r-c.y)/(d.y-c.y)*(d.x-c.x),r)._round():d.y>=r&&(d=new P(c.x+(r-c.y)/(d.y-c.y)*(d.x-c.x),r)._round()),l&&c.equals(l[l.length-1])||(l=[c],a.push(l)),l.push(d)))))}return a}ua(Qh,"Anchor");var uf=1e20;function cf(e,t,n,i,r,a,o,s,l){for(var u=t;u<t+i;u++)df(e,n*a+u,a,r,o,s,l);for(var c=n;c<n+r;c++)df(e,c*a+t,1,i,o,s,l)}function df(e,t,n,i,r,a,o){a[0]=0,o[0]=-uf,o[1]=uf,r[0]=e[t];for(var s=1,l=0,u=0;s<i;s++){r[s]=e[t+s*n];var c=s*s;do{var d=a[l];u=(r[s]-r[d]+c-d*d)/(s-d)/2}while(u<=o[l]&&--l>-1);a[++l]=s,o[l]=u,o[l+1]=uf}for(var h=0,f=0;h<i;h++){for(;o[f+1]<h;)f++;var p=a[f],m=h-p;e[t+h*n]=r[p]+m*m}}var hf=2,ff={none:0,ideographs:1,all:2},pf=function(){function e(t,n,i){f(this,e),this.requestManager=t,this.localGlyphMode=n,this.localFontFamily=i,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}return p(e,[{key:"setURL",value:function(e){this.url=e}},{key:"getGlyphs",value:function(t,n){var i=this,r=[];for(var a in t){var o,s=h(t[a]);try{for(s.s();!(o=s.n()).done;){var l=o.value;r.push({stack:a,id:l})}}catch(u){s.e(u)}finally{s.f()}}W(r,(function(t,n){var r=t.stack,a=t.id,o=i.entries[r];o||(o=i.entries[r]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});var s=o.glyphs[a];if(void 0===s){if(s=i._tinySDF(o,r,a))return o.glyphs[a]=s,void n(null,{stack:r,id:a,glyph:s});var l=Math.floor(a/256);if(256*l>65535)n(new Error("glyphs > 65535 not supported"));else if(o.ranges[l])n(null,{stack:r,id:a,glyph:s});else{var c=o.requests[l];c||(c=o.requests[l]=[],e.loadGlyphRange(r,l,i.url,i.requestManager,(function(e,t){if(t){for(var n in o.ascender=t.ascender,o.descender=t.descender,t.glyphs)i._doesCharSupportLocalGlyph(+n)||(o.glyphs[+n]=t.glyphs[+n]);o.ranges[l]=!0}var r,a=h(c);try{for(a.s();!(r=a.n()).done;)(0,r.value)(e,t)}catch(u){a.e(u)}finally{a.f()}delete o.requests[l]}))),c.push((function(e,t){e?n(e):t&&n(null,{stack:r,id:a,glyph:t.glyphs[a]||null})}))}}else n(null,{stack:r,id:a,glyph:s})}),(function(e,t){if(e)n(e);else if(t){var r,a={},o=h(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,l=s.stack,c=s.id,d=s.glyph;void 0===a[l]&&(a[l]={}),void 0===a[l].glyphs&&(a[l].glyphs={}),a[l].glyphs[c]=d&&{id:d.id,bitmap:d.bitmap.clone(),metrics:d.metrics},a[l].ascender=i.entries[l].ascender,a[l].descender=i.entries[l].descender}}catch(u){o.e(u)}finally{o.f()}n(null,a)}}))}},{key:"_doesCharSupportLocalGlyph",value:function(e){return this.localGlyphMode!==ff.none&&(this.localGlyphMode===ff.all?!!this.localFontFamily:!!this.localFontFamily&&(ma["CJK Unified Ideographs"](e)||ma["Hangul Syllables"](e)||ma.Hiragana(e)||ma.Katakana(e)||ma["CJK Symbols and Punctuation"](e)))}},{key:"_tinySDF",value:function(t,n,i){var r=this.localFontFamily;if(r&&this._doesCharSupportLocalGlyph(i)){var a=t.tinySDF;if(!a){var o="400";/bold/i.test(n)?o="900":/medium/i.test(n)?o="500":/light/i.test(n)&&(o="200"),(a=t.tinySDF=new e.TinySDF({fontFamily:r,fontWeight:o,fontSize:24*hf,buffer:3*hf,radius:8*hf})).fontWeight=o}if(this.localGlyphs[a.fontWeight][i])return this.localGlyphs[a.fontWeight][i];var s=String.fromCharCode(i),l=a.draw(s),u=l.data,c=l.width,d=l.height,h=l.glyphWidth,f=l.glyphHeight,p=l.glyphLeft,m=l.glyphTop,y=l.glyphAdvance;return this.localGlyphs[a.fontWeight][i]={id:i,bitmap:new $u({width:c,height:d},u),metrics:{width:h/hf,height:f/hf,left:p/hf,top:m/hf-27,advance:y/hf,localGlyph:!0}}}}}]),e}();pf.loadGlyphRange=function(e,t,n,i,r){var a=256*t,o=a+255,s=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}","".concat(a,"-").concat(o)),we.Glyphs);Se(s,(function(e,t){if(e)r(e);else if(t){var n,i={},a=function(e){return new Lh(e).readFields(Ah,{})}(t),o=h(a.glyphs);try{for(o.s();!(n=o.n()).done;){var s=n.value;i[s.id]=s}}catch(l){o.e(l)}finally{o.f()}r(null,{glyphs:i,ascender:a.ascender,descender:a.descender})}}))},pf.TinySDF=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.fontSize,i=void 0===n?24:n,r=t.buffer,a=void 0===r?3:r,o=t.radius,s=void 0===o?8:o,l=t.cutoff,u=void 0===l?.25:l,c=t.fontFamily,d=void 0===c?"sans-serif":c,h=t.fontWeight,p=void 0===h?"normal":h,m=t.fontStyle,y=void 0===m?"normal":m;f(this,e),this.buffer=a,this.cutoff=u,this.radius=s;var g=this.size=i+4*a,v=this._createCanvas(g),_=this.ctx=v.getContext("2d",{willReadFrequently:!0});_.font="".concat(y," ").concat(p," ").concat(i,"px ").concat(d),_.textBaseline="alphabetic",_.textAlign="left",_.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}return p(e,[{key:"_createCanvas",value:function(e){var t=document.createElement("canvas");return t.width=t.height=e,t}},{key:"draw",value:function(e){var t=this.ctx.measureText(e),n=t.width,i=t.actualBoundingBoxAscent,r=t.actualBoundingBoxDescent,a=t.actualBoundingBoxLeft,o=t.actualBoundingBoxRight,s=Math.ceil(i),l=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-a))),u=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=l+2*this.buffer,d=u+2*this.buffer,h=Math.max(c*d,0),f=new Uint8ClampedArray(h),p={data:f,width:c,height:d,glyphWidth:l,glyphHeight:u,glyphTop:s,glyphLeft:0,glyphAdvance:n};if(0===l||0===u)return p;var m=this.ctx,y=this.buffer,g=this.gridInner,v=this.gridOuter;m.clearRect(y,y,l,u),m.fillText(e,y,y+s);var _=m.getImageData(y,y,l,u);v.fill(uf,0,h),g.fill(0,0,h);for(var x=0;x<u;x++)for(var b=0;b<l;b++){var w=_.data[4*(x*l+b)+3]/255;if(0!==w){var k=(x+y)*c+b+y;if(1===w)v[k]=0,g[k]=uf;else{var T=.5-w;v[k]=T>0?T*T:0,g[k]=T<0?T*T:0}}}cf(v,0,0,c,d,c,this.f,this.v,this.z),cf(g,y,y,l,u,c,this.f,this.v,this.z);for(var E=0;E<h;E++){var S=Math.sqrt(v[E])-Math.sqrt(g[E]);f[E]=Math.round(255-255*(S/this.radius+this.cutoff))}return p}}]),e}();var mf=Dh;function yf(e,t,n,i){var r=[],a=e.image,o=a.pixelRatio,s=a.paddedRect.w-2*mf,l=a.paddedRect.h-2*mf,u=e.right-e.left,c=e.bottom-e.top,d=a.stretchX||[[0,s]],h=a.stretchY||[[0,l]],f=function(e,t){return e+t[1]-t[0]},p=d.reduce(f,0),m=h.reduce(f,0),y=s-p,g=l-m,v=0,_=p,x=0,b=m,w=0,k=y,T=0,E=g;if(a.content&&i){var S=a.content;v=gf(d,0,S[0]),x=gf(h,0,S[1]),_=gf(d,S[0],S[2]),b=gf(h,S[1],S[3]),w=S[0]-v,T=S[1]-x,k=S[2]-S[0]-_,E=S[3]-S[1]-b}var L=function(i,r,s,l){var d=_f(i.stretch-v,_,u,e.left),h=xf(i.fixed-w,k,i.stretch,p),f=_f(r.stretch-x,b,c,e.top),y=xf(r.fixed-T,E,r.stretch,m),g=_f(s.stretch-v,_,u,e.left),S=xf(s.fixed-w,k,s.stretch,p),L=_f(l.stretch-x,b,c,e.top),M=xf(l.fixed-T,E,l.stretch,m),A=new P(d,f),C=new P(g,f),I=new P(g,L),z=new P(d,L),D=new P(h/o,y/o),R=new P(S/o,M/o),B=t*Math.PI/180;if(B){var F=Math.sin(B),O=Math.cos(B),N=[O,-F,F,O];A._matMult(N),C._matMult(N),z._matMult(N),I._matMult(N)}var H=i.stretch+i.fixed,U=r.stretch+r.fixed;return{tl:A,tr:C,bl:z,br:I,tex:{x:a.paddedRect.x+mf+H,y:a.paddedRect.y+mf+U,w:s.stretch+s.fixed-H,h:l.stretch+l.fixed-U},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:R,minFontScaleX:k/o/u,minFontScaleY:E/o/c,isSDF:n}};if(i&&(a.stretchX||a.stretchY))for(var M=vf(d,y,p),A=vf(h,g,m),C=0;C<M.length-1;C++)for(var I=M[C],z=M[C+1],D=0;D<A.length-1;D++)r.push(L(I,A[D],z,A[D+1]));else r.push(L({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:s+1},{fixed:0,stretch:l+1}));return r}function gf(e,t,n){var i,r=0,a=h(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;r+=Math.max(t,Math.min(n,o[1]))-Math.max(t,Math.min(n,o[0]))}}catch(s){a.e(s)}finally{a.f()}return r}function vf(e,t,n){var i,r=[{fixed:-mf,stretch:0}],a=h(e);try{for(a.s();!(i=a.n()).done;){var o=d(i.value,2),s=o[0],l=o[1],u=r[r.length-1];r.push({fixed:s-u.stretch,stretch:u.stretch}),r.push({fixed:s-u.stretch,stretch:u.stretch+(l-s)})}}catch(c){a.e(c)}finally{a.f()}return r.push({fixed:t+mf,stretch:n}),r}function _f(e,t,n,i){return e/t*n+i}function xf(e,t,n,i){return e-t*n/i}function bf(e,t,n,i){var r=t+e.positionedLines[i].lineOffset;return 0===i?n+r/2:n+(r+(t+e.positionedLines[i-1].lineOffset))/2}var wf=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kf;if(f(this,e),this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}return p(e,[{key:"push",value:function(e){this.data.push(e),this.length++,this._up(this.length-1)}},{key:"pop",value:function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}}},{key:"peek",value:function(){return this.data[0]}},{key:"_up",value:function(e){for(var t=this.data,n=this.compare,i=t[e];e>0;){var r=e-1>>1,a=t[r];if(n(i,a)>=0)break;t[e]=a,e=r}t[e]=i}},{key:"_down",value:function(e){for(var t=this.data,n=this.compare,i=this.length>>1,r=t[e];e<i;){var a=1+(e<<1),o=t[a],s=a+1;if(s<this.length&&n(t[s],o)<0&&(a=s,o=t[s]),n(o,r)>=0)break;t[e]=o,e=a}t[e]=r}}]),e}();function kf(e,t){return e<t?-1:e>t?1:0}function Tf(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=1/0,r=1/0,a=-1/0,o=-1/0,s=e[0],l=0;l<s.length;l++){var u=s[l];(!l||u.x<i)&&(i=u.x),(!l||u.y<r)&&(r=u.y),(!l||u.x>a)&&(a=u.x),(!l||u.y>o)&&(o=u.y)}var c=Math.min(a-i,o-r),d=c/2,h=new wf([],Ef);if(0===c)return new P(i,r);for(var f=i;f<a;f+=c)for(var p=r;p<o;p+=c)h.push(new Sf(f+d,p+d,d,e));for(var m=function(e){for(var t=0,n=0,i=0,r=e[0],a=0,o=r.length,s=o-1;a<o;s=a++){var l=r[a],u=r[s],c=l.x*u.y-u.x*l.y;n+=(l.x+u.x)*c,i+=(l.y+u.y)*c,t+=3*c}return new Sf(n/t,i/t,0,e)}(e),y=h.length;h.length;){var g=h.pop();(g.d>m.d||!m.d)&&(m=g,n&&console.log("found best %d after %d probes",Math.round(1e4*g.d)/1e4,y)),g.max-m.d<=t||(d=g.h/2,h.push(new Sf(g.p.x-d,g.p.y-d,d,e)),h.push(new Sf(g.p.x+d,g.p.y-d,d,e)),h.push(new Sf(g.p.x-d,g.p.y+d,d,e)),h.push(new Sf(g.p.x+d,g.p.y+d,d,e)),y+=4)}return n&&(console.log("num probes: ".concat(y)),console.log("best distance: ".concat(m.d))),m.p}function Ef(e,t){return t.max-e.max}var Sf=p((function e(t,n,i,r){f(this,e),this.p=new P(t,n),this.h=i,this.d=function(e,t){for(var n=!1,i=1/0,r=0;r<t.length;r++)for(var a=t[r],o=0,s=a.length,l=s-1;o<s;l=o++){var u=a[o],c=a[l];u.y>e.y!=c.y>e.y&&e.x<(c.x-u.x)*(e.y-u.y)/(c.y-u.y)+u.x&&(n=!n),i=Math.min(i,Pu(e,u,c))}return(n?1:-1)*Math.sqrt(i)}(this.p,r),this.max=this.d+this.h*Math.SQRT2})),Lf=7,Mf=Number.POSITIVE_INFINITY,Af=Math.sqrt(2);function Cf(e,t){var n=d(t,2),i=n[0],r=n[1],a=0,o=0;if(r===Mf){i<0&&(i=0);var s=i/Af;switch(e){case"top-right":case"top-left":o=s-Lf;break;case"bottom-right":case"bottom-left":o=-s+Lf;break;case"bottom":o=-i+Lf;break;case"top":o=i-Lf}switch(e){case"top-right":case"bottom-right":a=-s;break;case"top-left":case"bottom-left":a=s;break;case"left":a=i;break;case"right":a=-i}}else{switch(i=Math.abs(i),r=Math.abs(r),e){case"top-right":case"top-left":case"top":o=r-Lf;break;case"bottom-right":case"bottom-left":case"bottom":o=-r+Lf}switch(e){case"top-right":case"bottom-right":case"right":a=-i;break;case"top-left":case"bottom-left":case"left":a=i}}return[a,o]}function If(e,t,n,i,r,a,o,s,l,u){e.createArrays(),e.tilePixelRatio=ws/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var c=e.layers[0].layout,d=e.layers[0]._unevaluatedLayout._values,f={};if("composite"===e.textSizeData.kind){var p=e.textSizeData,m=p.minZoom,y=p.maxZoom;f.compositeTextSizes=[d["text-size"].possiblyEvaluate(new Ba(m),s),d["text-size"].possiblyEvaluate(new Ba(y),s)]}if("composite"===e.iconSizeData.kind){var g=e.iconSizeData,v=g.minZoom,_=g.maxZoom;f.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new Ba(v),s),d["icon-size"].possiblyEvaluate(new Ba(_),s)]}f.layoutTextSize=d["text-size"].possiblyEvaluate(new Ba(l+1),s),f.layoutIconSize=d["icon-size"].possiblyEvaluate(new Ba(l+1),s),f.textMaxSize=d["text-size"].possiblyEvaluate(new Ba(18),s);var x,b="map"===c.get("text-rotation-alignment")&&"point"!==c.get("symbol-placement"),w=c.get("text-size"),k=h(e.features);try{var T=function(){var a,l=x.value,d=c.get("text-font").evaluate(l,{},s).join(","),h=w.evaluate(l,{},s),p=f.layoutTextSize.evaluate(l,{},s),m=(f.layoutIconSize.evaluate(l,{},s),{horizontal:{},vertical:void 0}),y=l.text,g=[0,0];if(y){var v=y.toString(),_=c.get("text-letter-spacing").evaluate(l,{},s)*Kd,k=c.get("text-line-height").evaluate(l,{},s)*Kd,T=ga(v)?_:0,E=c.get("text-anchor").evaluate(l,{},s),S=c.get("text-variable-anchor");if(!S){var L=c.get("text-radial-offset").evaluate(l,{},s);g=L?Cf(E,[L*Kd,Mf]):c.get("text-offset").evaluate(l,{},s).map((function(e){return e*Kd}))}var M=b?"center":c.get("text-justify").evaluate(l,{},s),A="point"===c.get("symbol-placement"),C=A?c.get("text-max-width").evaluate(l,{},s)*Kd:1/0,I=function(i){e.allowVerticalPlacement&&ya(v)&&(m.vertical=Uh(y,t,n,r,d,C,k,E,i,T,g,Fh.vertical,!0,p,h))};if(!b&&S){for(var P="auto"===M?S.map((function(e){return Pf(e)})):[M],z=!1,D=0;D<P.length;D++){var R=P[D];if(!m.horizontal[R])if(z)m.horizontal[R]=m.horizontal[0];else{var B=Uh(y,t,n,r,d,C,k,"center",R,T,g,Fh.horizontal,!1,p,h);B&&(m.horizontal[R]=B,z=1===B.positionedLines.length)}}I("left")}else{if("auto"===M&&(M=Pf(E)),A||c.get("text-writing-mode").indexOf("horizontal")>=0||!ya(v)){var F=Uh(y,t,n,r,d,C,k,E,M,T,g,Fh.horizontal,!1,p,h);F&&(m.horizontal[M]=F)}I(A?"left":M)}}var O=!1;if(l.icon&&l.icon.name){var N=i[l.icon.name];N&&(a=Jh(r[l.icon.name],c.get("icon-offset").evaluate(l,{},s),c.get("icon-anchor").evaluate(l,{},s)),O=N.sdf,void 0===e.sdfIcons?e.sdfIcons=N.sdf:e.sdfIcons!==N.sdf&&re("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(N.pixelRatio!==e.pixelRatio||0!==c.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}var H=Ff(m.horizontal)||m.vertical;e.iconsInText||(e.iconsInText=!!H&&H.iconsInText),(H||a)&&zf(e,l,m,a,i,f,p,0,g,O,o,s,u)};for(k.s();!(x=k.n()).done;)T()}catch(E){k.e(E)}finally{k.f()}a&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function Pf(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function zf(e,t,n,i,r,a,o,s,l,u,c,f,p){var m=a.textMaxSize.evaluate(t,{},f);void 0===m&&(m=o);var y,g,v=e.layers[0].layout,_=v.get("icon-offset").evaluate(t,{},f),x=Ff(n.horizontal)||n.vertical,b="globe"===p.name,w=Kd,k=o/w,T=e.tilePixelRatio*m/w,E=(y=e.overscaling,e.zoom>18&&y>2&&(y>>=1),Math.max(ws/(512*y),1)*v.get("symbol-spacing")),S=v.get("text-padding")*e.tilePixelRatio,L=v.get("icon-padding")*e.tilePixelRatio,M=R(v.get("text-max-angle")),A="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement"),C="map"===v.get("icon-rotation-alignment")&&"point"!==v.get("symbol-placement"),I=v.get("symbol-placement"),P=E/2,z=v.get("icon-text-fit");i&&"none"!==z&&(e.allowVerticalPlacement&&n.vertical&&(g=$h(i,n.vertical,z,v.get("icon-text-fit-padding"),_,k)),x&&(i=$h(i,x,z,v.get("icon-text-fit-padding"),_,k)));var D=function(o,s,h){if(!(s.x<0||s.x>=ws||s.y<0||s.y>=ws)){var m=null;if(b){var y=p.projectTilePoint(s.x,s.y,h),v=y.x,x=y.y,w=y.z;m={anchor:new Qh(v,x,w,0,void 0),up:p.upVector(h,s.x,s.y)}}!function(e,t,n,i,r,a,o,s,l,u,c,h,f,p,m,y,g,v,_,x,b,w,k,T,E,S,L){var M,A,C,I,P,z,D,R=e.addToLineVertexArray(t,i),B=0,F=0,O=0,N=0,H=-1,U=-1,j={},V=qo(""),W=n?n.anchor:t,G=0,q=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?(S=l.layout.get("text-offset").evaluate(b,{},E).map((function(e){return e*Kd})),G=(L=d(S,2))[0],q=L[1]):(G=l.layout.get("text-radial-offset").evaluate(b,{},E)*Kd,q=Mf),e.allowVerticalPlacement&&r.vertical){var Z=r.vertical;if(m)z=Nf(Z),s&&(D=Nf(s));else{var X=l.layout.get("text-rotate").evaluate(b,{},E)+90;C=Of(u,W,t,c,h,f,Z,p,X,y),s&&(I=Of(u,W,t,c,h,f,s,v,X))}}if(a){var K=l.layout.get("icon-rotate").evaluate(b,{},E),Y="none"!==l.layout.get("icon-text-fit"),J=yf(a,K,k,Y),$=s?yf(s,K,k,Y):void 0;A=Of(u,W,t,c,h,f,a,v,K),B=4*J.length;var Q=e.iconSizeData,ee=null;"source"===Q.kind?(ee=[Yd*l.layout.get("icon-size").evaluate(b,{},E)])[0]>Rf&&re("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(Df,'. Reduce your "icon-size".')):"composite"===Q.kind&&((ee=[Yd*w.compositeIconSizes[0].evaluate(b,{},E),Yd*w.compositeIconSizes[1].evaluate(b,{},E)])[0]>Rf||ee[1]>Rf)&&re("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(Df,'. Reduce your "icon-size".')),e.addSymbols(e.icon,J,ee,x,_,b,!1,n,t,R.lineStartIndex,R.lineLength,-1,T,E),H=e.icon.placedSymbolArray.length-1,$&&(F=4*$.length,e.addSymbols(e.icon,$,ee,x,_,b,Fh.vertical,n,t,R.lineStartIndex,R.lineLength,-1,T,E),U=e.icon.placedSymbolArray.length-1)}for(var te in r.horizontal){var ne=r.horizontal[te];M||(V=qo(ne.text),m?P=Nf(ne):M=Of(u,W,t,c,h,f,ne,p,l.layout.get("text-rotate").evaluate(b,{},E),y));var ie=1===ne.positionedLines.length;if(O+=Bf(e,n,t,ne,o,l,m,b,y,R,r.vertical?Fh.horizontal:Fh.horizontalOnly,ie?Object.keys(r.horizontal):[te],j,H,w,T,E),ie)break}r.vertical&&(N+=Bf(e,n,t,r.vertical,o,l,m,b,y,R,Fh.vertical,["vertical"],j,U,w,T,E));var ae=-1,oe=function(e,t){return e?Math.max(e,t):t};ae=oe(P,ae),ae=oe(z,ae);var se=(ae=oe(D,ae))>-1?1:0;e.glyphOffsetArray.length>=vp.MAX_GLYPHS&&re("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,b.sortKey),e.symbolInstances.emplaceBack(W.x,W.y,W.z,t.x,t.y,j.right>=0?j.right:-1,j.center>=0?j.center:-1,j.left>=0?j.left:-1,j.vertical>=0?j.vertical:-1,H,U,V,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,void 0!==C?C:e.collisionBoxArray.length,void 0!==C?C+1:e.collisionBoxArray.length,void 0!==A?A:e.collisionBoxArray.length,void 0!==A?A+1:e.collisionBoxArray.length,I||e.collisionBoxArray.length,I?I+1:e.collisionBoxArray.length,c,O,N,B,F,se,0,G,q,ae)}(e,s,m,o,n,i,r,g,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,S,A,l,0,L,C,_,t,a,u,c,f)}};if("line"===I){var B,F=h(lf(t.geometry,0,0,ws,ws));try{for(F.s();!(B=F.n()).done;){var O,N=B.value,H=of(N,E,M,n.vertical||x,i,w,T,e.overscaling,ws),U=h(H);try{for(U.s();!(O=U.n()).done;){var j=O.value;x&&Hf(e,x.text,P,j)||D(N,j,f)}}catch(se){U.e(se)}finally{U.f()}}}catch(se){F.e(se)}finally{F.f()}}else if("line-center"===I){var V,W=h(t.geometry);try{for(W.s();!(V=W.n()).done;){var G=V.value;if(G.length>1){var q=af(G,M,n.vertical||x,i,w,T);q&&D(G,q,f)}}}catch(se){W.e(se)}finally{W.f()}}else if("Polygon"===t.type){var Z,X=h(Bc(t.geometry,0));try{for(X.s();!(Z=X.n()).done;){var K=Z.value,Y=Tf(K,16);D(K[0],new Qh(Y.x,Y.y,0,0,void 0),f)}}catch(se){X.e(se)}finally{X.f()}}else if("LineString"===t.type){var J,$=h(t.geometry);try{for($.s();!(J=$.n()).done;){var Q=J.value;D(Q,new Qh(Q[0].x,Q[0].y,0,0,void 0),f)}}catch(se){$.e(se)}finally{$.f()}}else if("Point"===t.type){var ee,te=h(t.geometry);try{for(te.s();!(ee=te.n()).done;){var ne,ie=ee.value,ae=h(ie);try{for(ae.s();!(ne=ae.n()).done;){var oe=ne.value;D([oe],new Qh(oe.x,oe.y,0,0,void 0),f)}}catch(se){ae.e(se)}finally{ae.f()}}}catch(se){te.e(se)}finally{te.f()}}}var Df=255,Rf=Df*Yd;function Bf(e,t,n,i,r,o,s,l,u,d,f,p,m,y,g,v,_){var x=function(e,t,n,i,r,o,s,l){var u=[];if(0===t.positionedLines.length)return u;var d,f=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,p=function(e){var t=e[0],n=e[1],i=t*n;return i>0?[t,-n]:i<0?[-t,n]:0===t?[n,t]:[n,-t]}(n),m=Math.abs(t.top-t.bottom),y=h(t.positionedLines);try{for(y.s();!(d=y.n()).done;)m-=d.value.lineOffset}catch(oe){y.e(oe)}finally{y.f()}for(var g=t.positionedLines.length,v=m/g,_=t.top-n[1],x=0;x<g;++x){var b=t.positionedLines[x];_=bf(t,v,_,x);var w,k=h(b.positionedGlyphs);try{for(k.s();!(w=k.n()).done;){var T=w.value;if(T.rect){var E=T.rect||{},S=Ph+1,L=!0,M=1,A=0;if(T.imageName){var C=s[T.imageName];if(!C)continue;if(C.sdf){re("SDF images are not supported in formatted text and will be ignored.");continue}L=!1,M=C.pixelRatio,S=Dh/M}var I=(r||l)&&T.vertical,z=T.metrics.advance*T.scale/2,D=T.metrics,R=T.rect;if(null!==R){l&&t.verticalizable&&(A=T.imageName?z-T.metrics.width*T.scale/2:0);var B=r?[T.x+z,T.y]:[0,0],F=[0,0],O=[0,0],N=!1;r||(I?(O=[T.x+z+p[0],T.y+p[1]-A],N=!0):F=[T.x+z+n[0],T.y+n[1]-A]);var H=R.w*T.scale/(M*(T.localGlyph?hf:1)),U=R.h*T.scale/(M*(T.localGlyph?hf:1)),j=void 0,V=void 0,W=void 0,G=void 0;if(I){var q=T.y-_,Z=new P(-z,z-q),X=-Math.PI/2,K=a(P,c(O));(j=new P(-z+F[0],F[1]))._rotateAround(X,Z)._add(K),j.x+=-q+z,j.y-=(D.left-S)*T.scale;var Y=T.imageName?D.advance*T.scale:Kd*T.scale,J=String.fromCharCode(T.glyph);ih(J)?j.x+=(1-S)*T.scale:rh(J)?j.x+=Y-D.height*T.scale+(-S-1)*T.scale:j.x+=T.imageName||D.width+2*S===R.w&&D.height+2*S===R.h?(Y-U)/2:(Y-(D.height+2*S)*T.scale)/2,V=new P(j.x,j.y-H),W=new P(j.x+U,j.y),G=new P(j.x+U,j.y-H)}else{var $=(D.left-S)*T.scale-z+F[0],Q=(-D.top-S)*T.scale+F[1],ee=$+H,te=Q+U;j=new P($,Q),V=new P(ee,Q),W=new P($,te),G=new P(ee,te)}if(f){var ne=void 0;ne=r?new P(0,0):N?new P(p[0],p[1]):new P(n[0],n[1]),j._rotateAround(f,ne),V._rotateAround(f,ne),W._rotateAround(f,ne),G._rotateAround(f,ne)}var ie=new P(0,0),ae=new P(0,0);u.push({tl:j,tr:V,bl:W,br:G,tex:E,writingMode:t.writingMode,glyphOffset:B,sectionIndex:T.sectionIndex,isSDF:L,pixelOffsetTL:ie,pixelOffsetBR:ae,minFontScaleX:0,minFontScaleY:0})}}}}catch(oe){k.e(oe)}finally{k.f()}}return u}(0,i,u,o,s,l,r,e.allowVerticalPlacement),b=e.textSizeData,w=null;"source"===b.kind?(w=[Yd*o.layout.get("text-size").evaluate(l,{},_)])[0]>Rf&&re("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(Df,'. Reduce your "text-size".')):"composite"===b.kind&&((w=[Yd*g.compositeTextSizes[0].evaluate(l,{},_),Yd*g.compositeTextSizes[1].evaluate(l,{},_)])[0]>Rf||w[1]>Rf)&&re("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(Df,'. Reduce your "text-size".')),e.addSymbols(e.text,x,w,u,s,l,f,t,n,d.lineStartIndex,d.lineLength,y,v,_);var k,T=h(p);try{for(T.s();!(k=T.n()).done;)m[k.value]=e.text.placedSymbolArray.length-1}catch(E){T.e(E)}finally{T.f()}return 4*x.length}function Ff(e){for(var t in e)return e[t];return null}function Of(e,t,n,i,r,a,o,s,l,u){var c=o.top,d=o.bottom,h=o.left,f=o.right,p=o.collisionPadding;if(p&&(h-=p[0],c-=p[1],f+=p[2],d+=p[3]),l){var m=new P(h,c),y=new P(f,c),g=new P(h,d),v=new P(f,d),_=R(l),x=new P(0,0);u&&(x=new P(u[0],u[1])),m._rotateAround(_,x),y._rotateAround(_,x),g._rotateAround(_,x),v._rotateAround(_,x),h=Math.min(m.x,y.x,g.x,v.x),f=Math.max(m.x,y.x,g.x,v.x),c=Math.min(m.y,y.y,g.y,v.y),d=Math.max(m.y,y.y,g.y,v.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,h,c,f,d,s,i,r,a),e.length-1}function Nf(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);var t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Hf(e,t,n,i){var r=e.compareText;if(t in r){for(var a=r[t],o=a.length-1;o>=0;o--)if(i.dist(a[o])<n)return!0}else r[t]=[];return r[t].push(i),!1}function Uf(e,t){var n=e.fovAboveCenter,i=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,r=(e._camera.position[2]*e.worldSize-i)/Math.cos(e._pitch),a=Math.sin(n)*r/Math.sin(Math.max(Math.PI/2-e._pitch-n,.01)),o=Math.sin(e._pitch)*a+r;return Math.min(1.01*o,r*(1/e._horizonShift))}function jf(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};var n=Math.pow(2,-e.z),i=e.x*n,r=(e.x+1)*n,a=e.y*n,o=(e.y+1)*n,s=su(i),l=su(r),u=lu(a),c=lu(o),d=t.project(s,u),h=t.project(l,u),f=t.project(l,c),p=t.project(s,c),m=Math.min(d.x,h.x,f.x,p.x),y=Math.min(d.y,h.y,f.y,p.y),g=Math.max(d.x,h.x,f.x,p.x),v=Math.max(d.y,h.y,f.y,p.y),_=n/16;function x(e,n,i,r,a,o){var s=(i+a)/2,l=(r+o)/2,u=t.project(su(s),lu(l)),c=Math.max(0,m-u.x,y-u.y,u.x-g,u.y-v);m=Math.min(m,u.x),g=Math.max(g,u.x),y=Math.min(y,u.y),v=Math.max(v,u.y),c>_&&(x(e,u,i,r,s,l),x(u,n,s,l,a,o))}x(d,h,i,a,r,a),x(h,f,r,a,r,o),x(f,p,r,o,i,o),x(p,d,i,o,i,a),m-=_,y-=_,g+=_,v+=_;var b=1/Math.max(g-m,v-y);return{scale:b,x:m*b,y:y*b,x2:g*b,y2:v*b,projection:t}}var Vf=Ms(new Float32Array(16)),Wf=function(){function e(t){f(this,e),this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}return p(e,[{key:"project",value:function(e,t){return{x:0,y:0,z:0}}},{key:"unproject",value:function(e,t){return new nu(0,0)}},{key:"projectTilePoint",value:function(e,t,n){return{x:e,y:t,z:0}}},{key:"locationPoint",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._coordinatePoint(e.locationCoordinate(t),n)}},{key:"pixelsPerMeter",value:function(e,t){return ou(1,e)*t}},{key:"pixelSpaceConversion",value:function(e,t,n){return 1}},{key:"farthestPixelDistance",value:function(e){return Uf(e,e.pixelsPerMeter)}},{key:"pointCoordinate",value:function(e,t,n,i){var r=e.horizonLineFromTop(!1),a=new P(t,Math.max(r,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(a,i))}},{key:"pointCoordinate3D",value:function(e,t,n){var i=new P(t,n);if(e.elevation)return e.elevation.pointCoordinate(i);var r=this.pointCoordinate(e,i.x,i.y,0);return[r.x,r.y,r.z]}},{key:"isPointAboveHorizon",value:function(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);var n=e.horizonLineFromTop();return t.y<n}},{key:"createInversionMatrix",value:function(e,t){return Vf}},{key:"createTileMatrix",value:function(e,t,n){var i,r,a,o=n.canonical,s=Ms(new Float64Array(16));if(this.isReprojectedInTileSpace){var l=jf(o,this);i=1,r=l.x+n.wrap*l.scale,a=l.y,Ps(s,s,[i/l.scale,i/l.scale,e.pixelsPerMeter/t])}else i=t/e.zoomScale(o.z),r=(o.x+Math.pow(2,o.z)*n.wrap)*i,a=o.y*i;return Is(s,s,[r,a,0]),Ps(s,s,[i/ws,i/ws,1]),s}},{key:"upVector",value:function(e,t,n){return[0,0,1]}},{key:"upVectorScale",value:function(e,t,n){return{metersToTile:1}}}]),e}(),Gf=function(e){m(n,e);var t=y(n);function n(e){var i;f(this,n),(i=t.call(this,e)).range=[4,7],i.center=e.center||[-96,37.5];var r=i.parallels=e.parallels||[29.5,45.5],a=d(r,2),o=a[0],s=a[1],l=Math.sin(R(o));return i.n=(l+Math.sin(R(s)))/2,i.c=1+l*(2*i.n-l),i.r0=Math.sqrt(i.c)/i.n,i}return p(n,[{key:"project",value:function(e,t){var n=this.n,i=this.c,r=this.r0,a=R(e-this.center[0]),o=R(t),s=Math.sqrt(i-2*n*Math.sin(o))/n;return{x:s*Math.sin(a*n),y:s*Math.cos(a*n)-r,z:0}}},{key:"unproject",value:function(e,t){var n=this.n,i=this.c,r=this.r0+t,a=Math.atan2(e,Math.abs(r))*Math.sign(r);r*n<0&&(a-=Math.PI*Math.sign(e)*Math.sign(r));var o=R(this.center[0])*n,s=U(B((a=V(a,-Math.PI-o,Math.PI-o))/n)+this.center[0],-180,180),l=Math.asin(U((i-(e*e+r*r)*n*n)/(2*n),-1,1)),u=U(B(l),-cu,cu);return new nu(s,u)}}]),n}(Wf),qf=1.340264,Zf=-.081106,Xf=893e-6,Kf=.003796,Yf=Math.sqrt(3)/2,Jf=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"project",value:function(e,t){t=t/180*Math.PI,e=e/180*Math.PI;var n=Math.asin(Yf*Math.sin(t)),i=n*n,r=i*i*i;return{x:.5*(e*Math.cos(n)/(Yf*(qf+3*Zf*i+r*(7*Xf+9*Kf*i)))/Math.PI+.5),y:1-.5*(n*(qf+Zf*i+r*(Xf+Kf*i))/Math.PI+1),z:0}}},{key:"unproject",value:function(e,t){e=(2*e-.5)*Math.PI;for(var n,i=t=(2*(1-t)-1)*Math.PI,r=i*i,a=r*r*r,o=0;o<12&&(a=(r=(i=U(i-(n=(i*(qf+Zf*r+a*(Xf+Kf*r))-t)/(qf+3*Zf*r+a*(7*Xf+9*Kf*r))),-Math.PI/3,Math.PI/3))*i)*r*r,!(Math.abs(n)<1e-12));++o);var s=Yf*e*(qf+3*Zf*r+a*(7*Xf+9*Kf*r))/Math.cos(i),l=Math.asin(Math.sin(i)/Yf),u=U(180*s/Math.PI,-180,180),c=U(180*l/Math.PI,-cu,cu);return new nu(u,c)}}]),n}(Wf),$f=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).wrap=!0,i.supportsWorldCopies=!0,i}return p(n,[{key:"project",value:function(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}},{key:"unproject",value:function(e,t){var n=360*(e-.5),i=U(360*(.5-t),-cu,cu);return new nu(n,i)}}]),n}(Wf),Qf=Math.PI/2;function ep(e){return Math.tan((Qf+e)/2)}var tp=function(e){m(n,e);var t=y(n);function n(e){var i;f(this,n),(i=t.call(this,e)).center=e.center||[0,30];var r=i.parallels=e.parallels||[30,30],a=d(r,2),o=a[0],s=a[1],l=R(o),u=R(s);i.southernCenter=l+u<0,i.southernCenter&&(l=-l,u=-u);var c=Math.cos(l),h=ep(l);return i.n=l===u?Math.sin(l):Math.log(c/Math.cos(u))/Math.log(ep(u)/h),i.f=c*Math.pow(ep(l),i.n)/i.n,i}return p(n,[{key:"project",value:function(e,t){t=R(t),this.southernCenter&&(t=-t),e=R(e-this.center[0]);var n=1e-6,i=this.n,r=this.f;r>0?t<-Qf+n&&(t=-Qf+n):t>Qf-n&&(t=Qf-n);var a=r/Math.pow(ep(t),i),o=a*Math.sin(i*e),s=r-a*Math.cos(i*e);return o=.5*(o/Math.PI+.5),s=.5*(s/Math.PI+.5),{x:o,y:this.southernCenter?s:1-s,z:0}}},{key:"unproject",value:function(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;var n=this.n,i=this.f,r=i-t,a=Math.sign(r),o=Math.sign(n)*Math.sqrt(e*e+r*r),s=Math.atan2(e,Math.abs(r))*a;r*n<0&&(s-=Math.PI*Math.sign(e)*a);var l=U(B(s/n)+this.center[0],-180,180),u=U(B(2*Math.atan(Math.pow(i/o,1/n))-Qf),-cu,cu);return new nu(l,this.southernCenter?-u:u)}}]),n}(Wf),np=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).wrap=!0,i.supportsWorldCopies=!0,i.supportsTerrain=!0,i.supportsFog=!0,i.supportsFreeCamera=!0,i.isReprojectedInTileSpace=!1,i.unsupportedLayers=[],i.range=null,i}return p(n,[{key:"project",value:function(e,t){return{x:ru(e),y:au(t),z:0}}},{key:"unproject",value:function(e,t){var n=su(e),i=lu(t);return new nu(n,i)}}]),n}(Wf),ip=R(cu),rp=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"project",value:function(e,t){var n=(t=R(t))*t,i=n*n;return{x:.5*((e=R(e))*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))/Math.PI+1),z:0}}},{key:"unproject",value:function(e,t){e=(2*e-.5)*Math.PI;var n=t=(2*(1-t)-1)*Math.PI,i=25,r=0,a=n*n;do{var o=(a=n*n)*a;n=U(n-(r=(n*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-t)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o)))),-ip,ip)}while(Math.abs(r)>1e-6&&--i>0);var s=U(B(e/(.8707+(a=n*n)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979))),-180,180),l=B(n);return new nu(s,l)}}]),n}(Wf),ap=R(cu),op=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"project",value:function(e,t){t=R(t),e=R(e);var n=Math.cos(t),i=2/Math.PI,r=Math.acos(n*Math.cos(e/2)),a=Math.sin(r)/r,o=.5*(e*i+2*n*Math.sin(e/2)/a)||0,s=.5*(t+Math.sin(t)/a)||0;return{x:.5*(o/Math.PI+.5),y:1-.5*(s/Math.PI+1),z:0}}},{key:"unproject",value:function(e,t){var n=e=(2*e-.5)*Math.PI,i=t=(2*(1-t)-1)*Math.PI,r=25,a=1e-6,o=0,s=0;do{var l=Math.cos(i),u=Math.sin(i),c=2*u*l,d=u*u,h=l*l,f=Math.cos(n/2),p=Math.sin(n/2),m=2*f*p,y=p*p,g=1-h*f*f,v=g?1/g:0,_=g?Math.acos(l*f)*Math.sqrt(1/g):0,x=.5*(2*_*l*p+2*n/Math.PI)-e,b=.5*(_*u+i)-t,w=.5*v*(h*y+_*l*f*d)+1/Math.PI,k=v*(m*c/4-_*u*p),T=.125*v*(c*p-_*u*h*m),E=.5*v*(d*f+_*y*l)+.5,S=k*T-E*w;s=(x*T-b*w)/S,n=U(n-(o=(b*k-x*E)/S),-Math.PI,Math.PI),i=U(i-s,-ap,ap)}while((Math.abs(o)>a||Math.abs(s)>a)&&--r>0);return new nu(B(n),B(i))}}]),n}(Wf),sp=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).center=e.center||[0,0],i.parallels=e.parallels||[0,0],i.cosPhi=Math.max(.01,Math.cos(R(i.parallels[0]))),i.scale=1/(2*Math.max(Math.PI*i.cosPhi,1/i.cosPhi)),i.wrap=!0,i.supportsWorldCopies=!0,i}return p(n,[{key:"project",value:function(e,t){var n=this.scale,i=this.cosPhi;return{x:R(e)*i*n+.5,y:-Math.sin(R(t))/i*n+.5,z:0}}},{key:"unproject",value:function(e,t){var n=this.scale,i=this.cosPhi,r=-(t-.5)/n,a=U(B((e-.5)/n)/i,-180,180),o=Math.asin(U(r*i,-1,1)),s=U(B(o),-cu,cu);return new nu(a,s)}}]),n}(Wf),lp=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).requiresDraping=!0,i.supportsWorldCopies=!1,i.supportsFog=!0,i.zAxisUnit="pixels",i.unsupportedLayers=["debug"],i.range=[3,5],i}return p(n,[{key:"projectTilePoint",value:function(e,t,n){var i=Ul(e,t,n);return $s(i,i,Wl(Pl(n))),{x:i[0],y:i[1],z:i[2]}}},{key:"locationPoint",value:function(e,t){var n=Hl(t.lat,t.lng),i=Ks([],n),r=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;Xs(n,n,i,ou(1,0)*ws*r);var a=Ms(new Float64Array(16));return Cs(a,e.pixelMatrix,e.globeMatrix),$s(n,n,a),new P(n[0],n[1])}},{key:"pixelsPerMeter",value:function(e,t){return ou(1,0)*t}},{key:"pixelSpaceConversion",value:function(e,t,n){var i=ou(1,e)*t,r=qn(ou(1,45)*t,i,n);return this.pixelsPerMeter(e,t)/r}},{key:"createTileMatrix",value:function(e,t,n){var i=Gl(Pl(n.canonical));return Cs(new Float64Array(16),e.globeMatrix,i)}},{key:"createInversionMatrix",value:function(e,t){var n=e.center,i=Wl(Pl(t));return Ds(i,i,R(n.lng)),zs(i,i,R(n.lat)),Ps(i,i,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(i)}},{key:"pointCoordinate",value:function(e,t,n,i){return Al(e,t,n,!0)||new hu(0,0)}},{key:"pointCoordinate3D",value:function(e,t,n){var i=this.pointCoordinate(e,t,n,0);return[i.x,i.y,i.z]}},{key:"isPointAboveHorizon",value:function(e,t){return!Al(e,t.x,t.y,!1)}},{key:"farthestPixelDistance",value:function(e){var t=function(e,t){var n,i=e.cameraToCenterDistance,r=e._centerAltitude*t,a=e._camera,o=e._camera.forward(),s=js([],Zs([],o,-i),[0,0,r]),l=e.worldSize/(2*Math.PI),u=[0,0,-l],c=e.width/e.height,d=Math.tan(e.fovAboveCenter),h=Zs([],a.up(),d),f=Zs([],a.right(),d*c),p=Ks([],js([],js([],o,h),f)),m=[];if(new ml(s,p).closestPointOnSphere(u,l,m)){var y=js([],m,u),g=tl([],y,s);n=Math.cos(e.fovAboveCenter)*Hs(g)}else{var v=tl([],s,u),_=tl([],u,s);Ks(_,_);var x=Hs(v)-l;n=Math.sqrt(x*(x+2*l));var b=Math.acos(n/(l+x))-Math.acos(Ys(o,_));n*=Math.cos(b)}return 1.01*n}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=Zl(e.zoom);if(n>0){var i=Uf(e,ou(1,e.center.lat)*e.worldSize),r=e.worldSize/(2*Math.PI),a=Math.max(e.width,e.height)/e.worldSize*Math.PI;return qn(t,i+r*(1-Math.cos(a)),Math.pow(n,10))}return t}},{key:"upVector",value:function(e,t,n){return Ul(t,n,e,1)}},{key:"upVectorScale",value:function(e){return{metersToTile:Ml(jl(Pl(e)))}}}]),n}(np);function up(e){var t=e.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new np(e);case"equirectangular":return new $f(e);case"naturalEarth":return new rp(e);case"equalEarth":return new Jf(e);case"winkelTripel":return new op(e);case"albers":return n?new sp(e):new Gf(e);case"lambertConformalConic":return n?new sp(e):new tp(e);case"globe":return new lp(e)}throw new Error("Invalid projection name: ".concat(e.name))}var cp=od.types,dp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hp(e,t,n,i,r,a,o,s,l,u,c,d,h){var f=s?Math.min(Rf,Math.round(s[0])):0,p=s?Math.min(Rf,Math.round(s[1])):0;e.emplaceBack(t,n,Math.round(32*i),Math.round(32*r),a,o,(f<<1)+(l?1:0),p,16*u,16*c,256*d,256*h)}function fp(e,t,n,i,r,a,o){e.emplaceBack(t,n,i,r,a,o)}function pp(e,t,n,i,r){e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r)}function mp(e){var t,n=h(e.sections);try{for(n.s();!(t=n.n()).done;)if(ka(t.value.text))return!0}catch(i){n.e(i)}finally{n.f()}return!1}var yp=function(){function e(t){f(this,e),this.layoutVertexArray=new uo,this.indexArray=new vo,this.programConfigurations=t,this.segments=new bs,this.dynamicLayoutVertexArray=new ao,this.opacityVertexArray=new ho,this.placedSymbolArray=new Co,this.globeExtVertexArray=new co}return p(e,[{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}},{key:"upload",value:function(e,t,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jd.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Wd.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,dp,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Vd.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(e))}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}]),e}();ua(yp,"SymbolBuffers");var gp=function(){function e(t,n,i){f(this,e),this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new i,this.segments=new bs,this.collisionVertexArray=new yo,this.collisionVertexArrayExt=new go}return p(e,[{key:"upload",value:function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Gd.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,qd.members,!0)}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}]),e}();ua(gp,"CollisionBuffers");var vp=function(){function e(t){f(this,e),this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ms([]),this.placementViewportMatrix=Ms([]);var n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jd(this.zoom,n["text-size"]),this.iconSizeData=Jd(this.zoom,n["icon-size"]);var i=this.layers[0].layout,r=i.get("symbol-sort-key"),a=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==a&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===a||"auto"===a&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map((function(e){return Fh[e]})),this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id})),this.sourceID=t.sourceID,this.projection=t.projection}return p(e,[{key:"createArrays",value:function(){this.text=new yp(new ds(this.layers,this.zoom,(function(e){return/^text/.test(e)}))),this.icon=new yp(new ds(this.layers,this.zoom,(function(e){return/^icon/.test(e)}))),this.glyphOffsetArray=new zo,this.lineVertexArray=new Do,this.symbolInstances=new Po}},{key:"calculateGlyphDependencies",value:function(e,t,n,i,r){for(var a=0;a<e.length;a++)if(t[e.charCodeAt(a)]=!0,i&&r){var o=nh[e.charAt(a)];o&&(t[o.charCodeAt(0)]=!0)}}},{key:"populate",value:function(e,t,n,i){var r=this,a=this.layers[0],o=a.layout,s="globe"===this.projection.name,l=o.get("text-font"),u=o.get("text-field"),c=o.get("icon-image"),d=("constant"!==u.value.kind||u.value.value instanceof Xt&&!u.value.value.isEmpty()||u.value.value.toString().length>0)&&("constant"!==l.value.kind||l.value.value.length>0),f="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,p=o.get("symbol-sort-key");if(this.features=[],d||f){var m,y=t.iconDependencies,g=t.glyphDependencies,v=t.availableImages,_=new Ba(this.zoom),x=h(e);try{var b=function(){var e,t,u=m.value,c=u.feature,x=u.id,b=u.index,w=u.sourceLayerIndex,k=a._featureFilter.needGeometry,T=bu(c,k);if(!a._featureFilter.filter(_,T,n))return"continue";if(k||(T.geometry=xu(c,n,i)),s&&1!==c.type&&n.z<=5)for(var E=T.geometry,S=.98078528056,L=function(e,t){return Ys(Ul(e.x,e.y,n,1),Ul(t.x,t.y,n,1))<S},M=0;M<E.length;M++)E[M]=yu(E[M],L);if(d){var A=a.getValueAndResolveTokens("text-field",T,n,v),C=Xt.factory(A);mp(C)&&(r.hasRTLText=!0),(!r.hasRTLText||"unavailable"===za()||r.hasRTLText&&Ra.isParsed())&&(e=th(C,a,T))}if(f){var I=a.getValueAndResolveTokens("icon-image",T,n,v);t=I instanceof Kt?I:Kt.fromString(I)}if(!e&&!t)return"continue";var P=r.sortFeaturesByKey?p.evaluate(T,{},n):void 0;if(r.features.push({id:x,text:e,icon:t,index:b,sourceLayerIndex:w,geometry:T.geometry,properties:c.properties,type:cp[c.type],sortKey:P}),t&&(y[t.name]=!0),e){var z=l.evaluate(T,{},n).join(","),D="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");r.allowVerticalPlacement=r.writingModes&&r.writingModes.indexOf(Fh.vertical)>=0;var R,B=h(e.sections);try{for(B.s();!(R=B.n()).done;){var F=R.value;if(F.image)y[F.image.name]=!0;else{var O=ya(e.toString()),N=F.fontStack||z,H=g[N]=g[N]||{};r.calculateGlyphDependencies(F.text,H,D,r.allowVerticalPlacement,O)}}}catch(U){B.e(U)}finally{B.f()}}};for(x.s();!(m=x.n()).done;)b()}catch(w){x.e(w)}finally{x.f()}"line"===o.get("symbol-placement")&&(this.features=function(e){var t={},n={},i=[],r=0;function a(t){i.push(e[t]),r++}function o(e,t,r){var a=n[e];return delete n[e],n[t]=a,i[a].geometry[0].pop(),i[a].geometry[0]=i[a].geometry[0].concat(r[0]),a}function s(e,n,r){var a=t[n];return delete t[n],t[e]=a,i[a].geometry[0].shift(),i[a].geometry[0]=r[0].concat(i[a].geometry[0]),a}function l(e,t,n){var i=n?t[0][t[0].length-1]:t[0][0];return"".concat(e,":").concat(i.x,":").concat(i.y)}for(var u=0;u<e.length;u++){var c=e[u],d=c.geometry,h=c.text?c.text.toString():null;if(h){var f=l(h,d),p=l(h,d,!0);if(f in n&&p in t&&n[f]!==t[p]){var m=s(f,p,d),y=o(f,p,i[m].geometry);delete t[f],delete n[p],n[l(h,i[y].geometry,!0)]=y,i[m].geometry=null}else f in n?o(f,p,d):p in t?s(f,p,d):(a(u),t[f]=r-1,n[p]=r-1)}else a(u)}return i.filter((function(e){return e.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(e,t){return e.sortKey-t.sortKey}))}}},{key:"update",value:function(e,t,n,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n,i),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n,i))}},{key:"isEmpty",value:function(){return 0===this.symbolInstances.length&&!this.hasRTLText}},{key:"uploadPending",value:function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}},{key:"upload",value:function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}},{key:"destroyDebugData",value:function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}},{key:"getProjection",value:function(){return this.projectionInstance||(this.projectionInstance=up(this.projection)),this.projectionInstance}},{key:"destroy",value:function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}},{key:"addToLineVertexArray",value:function(e,t){var n=this.lineVertexArray.length;if(void 0!==e.segment){var i,r=h(t);try{for(r.s();!(i=r.n()).done;){var a=i.value,o=a.x,s=a.y;this.lineVertexArray.emplaceBack(o,s)}}catch(l){r.e(l)}finally{r.f()}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}},{key:"addSymbols",value:function(e,t,n,i,r,a,o,s,l,u,c,h,f,p){for(var m=e.indexArray,y=e.layoutVertexArray,g=e.globeExtVertexArray,v=e.segments.prepareSegment(4*t.length,y,m,this.canOverlap?a.sortKey:void 0),_=this.glyphOffsetArray.length,x=v.vertexLength,b=this.allowVerticalPlacement&&o===Fh.vertical?Math.PI/2:0,w=a.text&&a.text.sections,k=0;k<t.length;k++){var T=t[k],E=T.tl,S=T.tr,L=T.bl,M=T.br,A=T.tex,C=T.pixelOffsetTL,I=T.pixelOffsetBR,P=T.minFontScaleX,z=T.minFontScaleY,D=T.glyphOffset,R=T.isSDF,B=T.sectionIndex,F=v.vertexLength,O=D[1];if(hp(y,l.x,l.y,E.x,O+E.y,A.x,A.y,n,R,C.x,C.y,P,z),hp(y,l.x,l.y,S.x,O+S.y,A.x+A.w,A.y,n,R,I.x,C.y,P,z),hp(y,l.x,l.y,L.x,O+L.y,A.x,A.y+A.h,n,R,C.x,I.y,P,z),hp(y,l.x,l.y,M.x,O+M.y,A.x+A.w,A.y+A.h,n,R,I.x,I.y,P,z),s){var N=s.anchor,H=N.x,U=N.y,j=N.z,V=d(s.up,3),W=V[0],G=V[1],q=V[2];fp(g,H,U,j,W,G,q),fp(g,H,U,j,W,G,q),fp(g,H,U,j,W,G,q),fp(g,H,U,j,W,G,q),pp(e.dynamicLayoutVertexArray,H,U,j,b)}else pp(e.dynamicLayoutVertexArray,l.x,l.y,l.z,b);m.emplaceBack(F,F+1,F+2),m.emplaceBack(F+1,F+2,F+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(D[0]),k!==t.length-1&&B===t[k+1].sectionIndex||e.programConfigurations.populatePaintArrays(y.length,a,a.index,{},f,p,w&&w[B])}var Z=s?s.anchor:l;e.placedSymbolArray.emplaceBack(Z.x,Z.y,Z.z,l.x,l.y,_,this.glyphOffsetArray.length-_,x,u,c,l.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],o,0,!1,0,h,0)}},{key:"_commitLayoutVertex",value:function(e,t,n,i,r,a,o){e.emplaceBack(t,n,i,r,a,Math.round(o.x),Math.round(o.y))}},{key:"_addCollisionDebugVertices",value:function(e,t,n,i,r,a,o){for(var s=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),l=s.vertexLength,u=o.tileAnchorX,c=o.tileAnchorY,d=0;d<4;d++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,i,r,a,u,c,new P(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,r,a,u,c,new P(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,r,a,u,c,new P(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,r,a,u,c,new P(e.x1,e.y2)),s.vertexLength+=4;var h=n.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),s.primitiveLength+=4}},{key:"_addTextDebugCollisionBoxes",value:function(e,t,n,i,r,a){for(var o=i;o<r;o++){var s=n.get(o),l=this.getSymbolInstanceTextSize(e,a,t,o);this._addCollisionDebugVertices(s,l,this.textCollisionBox,s.projectedAnchorX,s.projectedAnchorY,s.projectedAnchorZ,a)}}},{key:"_addIconDebugCollisionBoxes",value:function(e,t,n,i,r,a){for(var o=i;o<r;o++){var s=n.get(o),l=this.getSymbolInstanceIconSize(e,t,a.placedIconSymbolIndex);this._addCollisionDebugVertices(s,l,this.iconCollisionBox,s.projectedAnchorX,s.projectedAnchorY,s.projectedAnchorZ,a)}}},{key:"generateCollisionDebugBuffers",value:function(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gp(po,Zd.members,To),this.iconCollisionBox=new gp(po,Zd.members,To);for(var n=Qd(this.iconSizeData,e),i=Qd(this.textSizeData,e),r=0;r<this.symbolInstances.length;r++){var a=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(i,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(i,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}},{key:"getSymbolInstanceTextSize",value:function(e,t,n,i){var r=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:i),a=$d(this.textSizeData,e,r)/Kd;return this.tilePixelRatio*a}},{key:"getSymbolInstanceIconSize",value:function(e,t,n){var i=this.icon.placedSymbolArray.get(n),r=$d(this.iconSizeData,e,i);return this.tilePixelRatio*r}},{key:"_commitDebugCollisionVertexUpdate",value:function(e,t,n){e.emplaceBack(t,-n,-n),e.emplaceBack(t,n,-n),e.emplaceBack(t,n,n),e.emplaceBack(t,-n,n)}},{key:"_updateTextDebugCollisionBoxes",value:function(e,t,n,i,r,a){for(var o=i;o<r;o++){var s=n.get(o),l=this.getSymbolInstanceTextSize(e,a,t,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,l,s.padding)}}},{key:"_updateIconDebugCollisionBoxes",value:function(e,t,n,i,r,a){for(var o=i;o<r;o++){var s=n.get(o),l=this.getSymbolInstanceIconSize(e,t,a);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,l,s.padding)}}},{key:"updateCollisionDebugBuffers",value:function(e,t){if(this.hasDebugData()){this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();for(var n=Qd(this.iconSizeData,e),i=Qd(this.textSizeData,e),r=0;r<this.symbolInstances.length;r++){var a=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(i,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(i,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(n,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(n,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}}},{key:"_deserializeCollisionBoxesForSymbol",value:function(e,t,n,i,r,a,o,s,l){var u={};if(t<n){var c=e.get(t),d=c.x1,h=c.y1,f=c.x2,p=c.y2,m=c.padding,y=c.projectedAnchorX,g=c.projectedAnchorY,v=c.projectedAnchorZ,_=c.tileAnchorX,x=c.tileAnchorY,b=c.featureIndex;u.textBox={x1:d,y1:h,x2:f,y2:p,padding:m,projectedAnchorX:y,projectedAnchorY:g,projectedAnchorZ:v,tileAnchorX:_,tileAnchorY:x},u.textFeatureIndex=b}if(i<r){var w=e.get(i),k=w.x1,T=w.y1,E=w.x2,S=w.y2,L=w.padding,M=w.projectedAnchorX,A=w.projectedAnchorY,C=w.projectedAnchorZ,I=w.tileAnchorX,P=w.tileAnchorY,z=w.featureIndex;u.verticalTextBox={x1:k,y1:T,x2:E,y2:S,padding:L,projectedAnchorX:M,projectedAnchorY:A,projectedAnchorZ:C,tileAnchorX:I,tileAnchorY:P},u.verticalTextFeatureIndex=z}if(a<o){var D=e.get(a),R=D.x1,B=D.y1,F=D.x2,O=D.y2,N=D.padding,H=D.projectedAnchorX,U=D.projectedAnchorY,j=D.projectedAnchorZ,V=D.tileAnchorX,W=D.tileAnchorY,G=D.featureIndex;u.iconBox={x1:R,y1:B,x2:F,y2:O,padding:N,projectedAnchorX:H,projectedAnchorY:U,projectedAnchorZ:j,tileAnchorX:V,tileAnchorY:W},u.iconFeatureIndex=G}if(s<l){var q=e.get(s),Z=q.x1,X=q.y1,K=q.x2,Y=q.y2,J=q.padding,$=q.projectedAnchorX,Q=q.projectedAnchorY,ee=q.projectedAnchorZ,te=q.tileAnchorX,ne=q.tileAnchorY,ie=q.featureIndex;u.verticalIconBox={x1:Z,y1:X,x2:K,y2:Y,padding:J,projectedAnchorX:$,projectedAnchorY:Q,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ne},u.verticalIconFeatureIndex=ie}return u}},{key:"deserializeCollisionBoxes",value:function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}},{key:"hasTextData",value:function(){return this.text.segments.get().length>0}},{key:"hasIconData",value:function(){return this.icon.segments.get().length>0}},{key:"hasDebugData",value:function(){return this.textCollisionBox&&this.iconCollisionBox}},{key:"hasTextCollisionBoxData",value:function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}},{key:"hasIconCollisionBoxData",value:function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}},{key:"addIndicesForPlacedSymbol",value:function(e,t){for(var n=e.placedSymbolArray.get(t),i=n.vertexStartIndex+4*n.numGlyphs,r=n.vertexStartIndex;r<i;r+=4)e.indexArray.emplaceBack(r,r+1,r+2),e.indexArray.emplaceBack(r+1,r+2,r+3)}},{key:"getSortedSymbolIndexes",value:function(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var t=Math.sin(e),n=Math.cos(e),i=[],r=[],a=[],o=0;o<this.symbolInstances.length;++o){a.push(o);var s=this.symbolInstances.get(o);i.push(0|Math.round(t*s.tileAnchorX+n*s.tileAnchorY)),r.push(s.featureIndex)}return a.sort((function(e,t){return i[e]-i[t]||r[t]-r[e]})),a}},{key:"addToSortKeyRanges",value:function(e,t){var n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}},{key:"sortFeatures",value:function(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];var t,n=h(this.symbolInstanceIndexes);try{for(n.s();!(t=n.n()).done;){var i=t.value,r=this.symbolInstances.get(i);this.featureSortOrder.push(r.featureIndex);var a=r.rightJustifiedTextSymbolIndex,o=r.centerJustifiedTextSymbolIndex,s=r.leftJustifiedTextSymbolIndex,l=r.verticalPlacedTextSymbolIndex,u=r.placedIconSymbolIndex,c=r.verticalPlacedIconSymbolIndex;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),o>=0&&o!==a&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&s!==o&&s!==a&&this.addIndicesForPlacedSymbol(this.text,s),l>=0&&this.addIndicesForPlacedSymbol(this.text,l),u>=0&&this.addIndicesForPlacedSymbol(this.icon,u),c>=0&&this.addIndicesForPlacedSymbol(this.icon,c)}}catch(d){n.e(d)}finally{n.f()}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}]),e}();ua(vp,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),vp.MAX_GLYPHS=65535,vp.addDynamicAttributes=pp;var _p=new Xa({"symbol-placement":new Ga(pt.layout_symbol["symbol-placement"]),"symbol-spacing":new Ga(pt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ga(pt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qa(pt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ga(pt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ga(pt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ga(pt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ga(pt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ga(pt.layout_symbol["icon-rotation-alignment"]),"icon-size":new qa(pt.layout_symbol["icon-size"]),"icon-text-fit":new Ga(pt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ga(pt.layout_symbol["icon-text-fit-padding"]),"icon-image":new qa(pt.layout_symbol["icon-image"]),"icon-rotate":new qa(pt.layout_symbol["icon-rotate"]),"icon-padding":new Ga(pt.layout_symbol["icon-padding"]),"icon-keep-upright":new Ga(pt.layout_symbol["icon-keep-upright"]),"icon-offset":new qa(pt.layout_symbol["icon-offset"]),"icon-anchor":new qa(pt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ga(pt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ga(pt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ga(pt.layout_symbol["text-rotation-alignment"]),"text-field":new qa(pt.layout_symbol["text-field"]),"text-font":new qa(pt.layout_symbol["text-font"]),"text-size":new qa(pt.layout_symbol["text-size"]),"text-max-width":new qa(pt.layout_symbol["text-max-width"]),"text-line-height":new qa(pt.layout_symbol["text-line-height"]),"text-letter-spacing":new qa(pt.layout_symbol["text-letter-spacing"]),"text-justify":new qa(pt.layout_symbol["text-justify"]),"text-radial-offset":new qa(pt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ga(pt.layout_symbol["text-variable-anchor"]),"text-anchor":new qa(pt.layout_symbol["text-anchor"]),"text-max-angle":new Ga(pt.layout_symbol["text-max-angle"]),"text-writing-mode":new Ga(pt.layout_symbol["text-writing-mode"]),"text-rotate":new qa(pt.layout_symbol["text-rotate"]),"text-padding":new Ga(pt.layout_symbol["text-padding"]),"text-keep-upright":new Ga(pt.layout_symbol["text-keep-upright"]),"text-transform":new qa(pt.layout_symbol["text-transform"]),"text-offset":new qa(pt.layout_symbol["text-offset"]),"text-allow-overlap":new Ga(pt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ga(pt.layout_symbol["text-ignore-placement"]),"text-optional":new Ga(pt.layout_symbol["text-optional"])}),xp={paint:new Xa({"icon-opacity":new qa(pt.paint_symbol["icon-opacity"]),"icon-color":new qa(pt.paint_symbol["icon-color"]),"icon-halo-color":new qa(pt.paint_symbol["icon-halo-color"]),"icon-halo-width":new qa(pt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qa(pt.paint_symbol["icon-halo-blur"]),"icon-translate":new Ga(pt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ga(pt.paint_symbol["icon-translate-anchor"]),"text-opacity":new qa(pt.paint_symbol["text-opacity"]),"text-color":new qa(pt.paint_symbol["text-color"],{runtimeType:St,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new qa(pt.paint_symbol["text-halo-color"]),"text-halo-width":new qa(pt.paint_symbol["text-halo-width"]),"text-halo-blur":new qa(pt.paint_symbol["text-halo-blur"]),"text-translate":new Ga(pt.paint_symbol["text-translate"]),"text-translate-anchor":new Ga(pt.paint_symbol["text-translate-anchor"])}),layout:_p},bp=function(){function e(t){f(this,e),this.type=t.property.overrides?t.property.overrides.runtimeType:wt,this.defaultValue=t}return p(e,[{key:"evaluate",value:function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}},{key:"eachChild",value:function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return null}}]),e}();ua(bp,"FormatSectionOverride",{omit:["defaultValue"]});var wp=function(e){m(n,e);var t=y(n);function n(e){return f(this,n),t.call(this,e,xp)}return p(n,[{key:"recalculate",value:function(e,t){o(s(n.prototype),"recalculate",this).call(this,e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));var i=this.layout.get("text-writing-mode");if(i){var r,a=[],l=h(i);try{for(l.s();!(r=l.n()).done;){var u=r.value;a.indexOf(u)<0&&a.push(u)}}catch(c){l.e(c)}finally{l.f()}this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}},{key:"getValueAndResolveTokens",value:function(e,t,n,i){var r=this.layout.get(e).evaluate(t,{},n,i),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||ur(a.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,(function(t,n){return n in e?String(e[n]):""}))}(t.properties,r)}},{key:"createBucket",value:function(e){return new vp(e)}},{key:"queryRadius",value:function(){return 0}},{key:"queryIntersectsFeature",value:function(){return!1}},{key:"_setPaintOverrides",value:function(){var e,t=h(xp.paint.overridableProperties);try{for(t.s();!(e=t.n()).done;){var i=e.value;if(n.hasPaintOverride(this.layout,i)){var r=this.paint.get(i),a=new bp(r),o=new lr(a,r.property.specification),s=null;s="constant"===r.value.kind||"source"===r.value.kind?new dr("source",o):new hr("composite",o,r.value.zoomStops,r.value._interpolationType),this.paint._values[i]=new Va(r.property,s,r.parameters)}}}catch(l){t.e(l)}finally{t.f()}}},{key:"_handleOverridablePaintPropertyUpdate",value:function(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven())&&n.hasPaintOverride(this.layout,e)}},{key:"getProgramConfiguration",value:function(e){return new cs(this,e)}}],[{key:"hasPaintOverride",value:function(e,t){var n=e.get("text-field"),i=xp.paint.properties[t],r=!1,a=function(e){var t,n=h(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(i.overrides&&i.overrides.hasOverride(a))return void(r=!0)}}catch(o){n.e(o)}finally{n.f()}};if("constant"===n.value.kind&&n.value.value instanceof Xt)a(n.value.value.sections);else if("source"===n.value.kind){var o=function e(t){r||(t instanceof tn&&$t(t.value)===Ct?a(t.value.sections):t instanceof sn?a(t.sections):t.eachChild(e))},s=n.value;s._styleExpression&&o(s._styleExpression.expression)}return r}}]),n}(vs),kp={paint:new Xa({"background-color":new Ga(pt.paint_background["background-color"]),"background-pattern":new Ga(pt.paint_background["background-pattern"]),"background-opacity":new Ga(pt.paint_background["background-opacity"])})},Tp={paint:new Xa({"raster-opacity":new Ga(pt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ga(pt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ga(pt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ga(pt.paint_raster["raster-brightness-max"]),"raster-saturation":new Ga(pt.paint_raster["raster-saturation"]),"raster-contrast":new Ga(pt.paint_raster["raster-contrast"]),"raster-resampling":new Ga(pt.paint_raster["raster-resampling"]),"raster-fade-duration":new Ga(pt.paint_raster["raster-fade-duration"])})},Ep=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e,{})).implementation=e,i}return p(n,[{key:"is3D",value:function(){return"3d"===this.implementation.renderingMode}},{key:"hasOffscreenPass",value:function(){return void 0!==this.implementation.prerender}},{key:"isLayerDraped",value:function(){return void 0!==this.implementation.renderToTile}},{key:"shouldRedrape",value:function(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}},{key:"recalculate",value:function(){}},{key:"updateTransitions",value:function(){}},{key:"hasTransition",value:function(){return!1}},{key:"serialize",value:function(){}},{key:"onAdd",value:function(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}},{key:"onRemove",value:function(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}]),n}(vs),Sp={paint:new Xa({"sky-type":new Ga(pt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ga(pt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ga(pt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ga(pt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ga(pt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Za(pt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ga(pt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ga(pt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ga(pt.paint_sky["sky-opacity"])})};function Lp(e,t,n){var i=[0,0,1],r=ll([]);return cl(r,r,n?-R(e)+Math.PI:R(e)),ul(r,r,-R(t)),Qs(i,i,r),Ks(i,i)}for(var Mp={circle:function(e){m(n,e);var t=y(n);function n(e){return f(this,n),t.call(this,e,ju)}return p(n,[{key:"createBucket",value:function(e){return new Tu(e)}},{key:"queryRadius",value:function(e){var t=e;return Fu("circle-radius",this,t)+Fu("circle-stroke-width",this,t)+Ou(this.paint.get("circle-translate"))}},{key:"queryIntersectsFeature",value:function(e,t,n,i,r,a,o,s){var l=Hu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),u=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Vu(e,i,a,o,s,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,u)}},{key:"getProgramIds",value:function(){return["circle"]}},{key:"getProgramConfiguration",value:function(e){return new cs(this,e)}}]),n}(vs),heatmap:function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e,ec))._updateColorRamp(),i}return p(n,[{key:"createBucket",value:function(e){return new Xu(e)}},{key:"_handleSpecialPaintPropertyUpdate",value:function(e){"heatmap-color"===e&&this._updateColorRamp()}},{key:"_updateColorRamp",value:function(){this.colorRamp=tc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}},{key:"resize",value:function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}},{key:"queryRadius",value:function(e){return Fu("heatmap-radius",this,e)}},{key:"queryIntersectsFeature",value:function(e,t,n,i,r,a,o,s){var l=this.paint.get("heatmap-radius").evaluate(t,n);return Vu(e,i,a,o,s,!0,!0,new P(0,0),l)}},{key:"hasOffscreenPass",value:function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},{key:"getProgramIds",value:function(){return["heatmap","heatmapTexture"]}},{key:"getProgramConfiguration",value:function(e){return new cs(this,e)}}]),n}(vs),hillshade:function(e){m(n,e);var t=y(n);function n(e){return f(this,n),t.call(this,e,nc)}return p(n,[{key:"hasOffscreenPass",value:function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},{key:"getProgramIds",value:function(){return["hillshade","hillshadePrepare"]}}]),n}(vs),fill:function(e){m(n,e);var t=y(n);function n(e){return f(this,n),t.call(this,e,jc)}return p(n,[{key:"getProgramIds",value:function(){var e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}},{key:"getProgramConfiguration",value:function(e){return new cs(this,e)}},{key:"recalculate",value:function(e,t){o(s(n.prototype),"recalculate",this).call(this,e,t);var i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}},{key:"createBucket",value:function(e){return new Hc(e)}},{key:"queryRadius",value:function(){return Ou(this.paint.get("fill-translate"))}},{key:"queryIntersectsFeature",value:function(e,t,n,i,r,a){return!e.queryGeometry.isAboveHorizon&&Lu(Nu(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),i)}},{key:"isTileClipped",value:function(){return!0}}]),n}(vs),"fill-extrusion":function(e){m(n,e);var t=y(n);function n(e){return f(this,n),t.call(this,e,kd)}return p(n,[{key:"createBucket",value:function(e){return new fd(e)}},{key:"queryRadius",value:function(){return Ou(this.paint.get("fill-extrusion-translate"))}},{key:"is3D",value:function(){return!0}},{key:"getProgramIds",value:function(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}},{key:"getProgramConfiguration",value:function(e){return new cs(this,e)}},{key:"queryIntersectsFeature",value:function(e,t,n,i,r,a,o,s,l){var u=Hu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),c=this.paint.get("fill-extrusion-height").evaluate(t,n),f=this.paint.get("fill-extrusion-base").evaluate(t,n),p=[0,0],m=s&&a.elevation,y=a.elevation?a.elevation.exaggeration():1,g=e.tile.getBucket(this);if(m&&g instanceof fd){var v=g.centroidVertexArray,_=l+1;_<v.length&&(p[0]=v.geta_centroid_pos0(_),p[1]=v.geta_centroid_pos1(_))}if(0===p[0]&&1===p[1])return!1;"globe"===a.projection.name&&(i=bd([i],[new P(0,0),new P(ws,ws)],e.tileID.canonical).map((function(e){return e.polygon})).flat());var x=function(e,t,n,i,r,a,o,s,l,u,c){return"globe"===e.projection.name?function(e,t,n,i,r,a,o,s,l,u,c){var d=[],f=[],p=e.projection.upVectorScale(c,e.center.lat,e.worldSize).metersToTile,m=[0,0,0,1],y=[0,0,0,1],g=function(e,t,n,i){e[0]=t,e[1]=n,e[2]=i,e[3]=1},v=xd();n>0&&(n+=v),i+=v;var _,x=h(t);try{for(x.s();!(_=x.n()).done;){var b,w=_.value,k=[],T=[],E=h(w);try{for(E.s();!(b=E.n()).done;){var S=b.value,L=S.x+r.x,M=S.y+r.y,A=e.projection.projectTilePoint(L,M,c),C=e.projection.upVector(c,S.x,S.y),I=n,P=i;if(o){var z=Pd(L,M,n,i,o,s,l,u);I+=z.base,P+=z.top}0!==n?g(m,A.x+C[0]*p*I,A.y+C[1]*p*I,A.z+C[2]*p*I):g(m,A.x,A.y,A.z),g(y,A.x+C[0]*p*P,A.y+C[1]*p*P,A.z+C[2]*p*P),$s(m,m,a),$s(y,y,a),k.push(new Ad(m[0],m[1],m[2])),T.push(new Ad(y[0],y[1],y[2]))}}catch(D){E.e(D)}finally{E.f()}d.push(k),f.push(T)}}catch(D){x.e(D)}finally{x.f()}return[d,f]}(e,t,n,i,r,a,o,s,l,u,c):o?function(e,t,n,i,r,a,o,s,l){var u,c=[],d=[],f=[0,0,0,1],p=h(e);try{for(p.s();!(u=p.n()).done;){var m,y=u.value,g=[],v=[],_=h(y);try{for(_.s();!(m=_.n()).done;){var x=m.value,b=x.x+i.x,w=x.y+i.y,k=Pd(b,w,t,n,a,o,s,l);f[0]=b,f[1]=w,f[2]=k.base,f[3]=1,ol(f,f,r),f[3]=Math.max(f[3],1e-5);var T=new Ad(f[0]/f[3],f[1]/f[3],f[2]/f[3]);f[0]=b,f[1]=w,f[2]=k.top,f[3]=1,ol(f,f,r),f[3]=Math.max(f[3],1e-5);var E=new Ad(f[0]/f[3],f[1]/f[3],f[2]/f[3]);g.push(T),v.push(E)}}catch(S){_.e(S)}finally{_.f()}c.push(g),d.push(v)}}catch(S){p.e(S)}finally{p.f()}return[c,d]}(t,n,i,r,a,o,s,l,u):function(e,t,n,i,r){var a,o=[],s=[],l=r[8]*t,u=r[9]*t,c=r[10]*t,d=r[11]*t,f=r[8]*n,p=r[9]*n,m=r[10]*n,y=r[11]*n,g=h(e);try{for(g.s();!(a=g.n()).done;){var v,_=a.value,x=[],b=[],w=h(_);try{for(w.s();!(v=w.n()).done;){var k=v.value,T=k.x+i.x,E=k.y+i.y,S=r[0]*T+r[4]*E+r[12],L=r[1]*T+r[5]*E+r[13],M=r[2]*T+r[6]*E+r[14],A=r[3]*T+r[7]*E+r[15],C=S+l,I=L+u,P=M+c,z=Math.max(A+d,1e-5),D=S+f,R=L+p,B=M+m,F=Math.max(A+y,1e-5);x.push(new Ad(C/z,I/z,P/z)),b.push(new Ad(D/F,R/F,B/F))}}catch(O){w.e(O)}finally{w.f()}o.push(x),s.push(b)}}catch(O){g.e(O)}finally{g.f()}return[o,s]}(t,n,i,r,a)}(a,i,f,c,u,o,m?s:null,p,y,a.center.lat,e.tileID.canonical),b=d(x,2),w=b[0],k=b[1],T=e.queryGeometry;return function(e,t,n){var i=1/0;Lu(n,t)&&(i=Id(n,t[0]));for(var r=0;r<t.length;r++)for(var a=t[r],o=e[r],s=0;s<a.length-1;s++){var l=a[s],u=[l,a[s+1],o[s+1],o[s],l];Eu(n,u)&&(i=Math.min(i,Id(n,u)))}return i!==1/0&&i}(w,k,T.isPointQuery()?T.screenBounds:T.screenGeometry)}}]),n}(vs),line:function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e,Nd)).gradientVersion=0,i}return p(n,[{key:"_handleSpecialPaintPropertyUpdate",value:function(e){if("line-gradient"===e){var t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Gn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}},{key:"gradientExpression",value:function(){return this._transitionablePaint._values["line-gradient"].value.expression}},{key:"widthExpression",value:function(){return this._transitionablePaint._values["line-width"].value.expression}},{key:"recalculate",value:function(e,t){o(s(n.prototype),"recalculate",this).call(this,e,t),this.paint._values["line-floorwidth"]=Hd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}},{key:"createBucket",value:function(e){return new Fd(e)}},{key:"getProgramIds",value:function(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}},{key:"getProgramConfiguration",value:function(e){return new cs(this,e)}},{key:"queryRadius",value:function(e){var t=e,n=Ud(Fu("line-width",this,t),Fu("line-gap-width",this,t)),i=Fu("line-offset",this,t);return n/2+Math.abs(i)+Ou(this.paint.get("line-translate"))}},{key:"queryIntersectsFeature",value:function(e,t,n,i,r,a){if(e.queryGeometry.isAboveHorizon)return!1;var o=Nu(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),s=e.pixelToTileUnitsFactor/2*Ud(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),l=this.paint.get("line-offset").evaluate(t,n);return l&&(i=function(e,t){for(var n=[],i=new P(0,0),r=0;r<e.length;r++){for(var a=e[r],o=[],s=0;s<a.length;s++){var l=a[s],u=a[s+1],c=0===s?i:l.sub(a[s-1])._unit()._perp(),d=s===a.length-1?i:u.sub(l)._unit()._perp(),h=c._add(d)._unit();h._mult(1/(h.x*d.x+h.y*d.y)),o.push(h._mult(t)._add(l))}n.push(o)}return n}(i,l*e.pixelToTileUnitsFactor)),function(e,t,n){for(var i=0;i<t.length;i++){var r=t[i];if(e.length>=3)for(var a=0;a<r.length;a++)if(Du(e,r[a]))return!0;if(Mu(e,r,n))return!0}return!1}(o,i,s)}},{key:"isTileClipped",value:function(){return!0}}]),n}(vs),symbol:wp,background:function(e){m(n,e);var t=y(n);function n(e){return f(this,n),t.call(this,e,kp)}return p(n,[{key:"getProgramIds",value:function(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}}]),n}(vs),raster:function(e){m(n,e);var t=y(n);function n(e){return f(this,n),t.call(this,e,Tp)}return p(n,[{key:"getProgramIds",value:function(){return["raster"]}}]),n}(vs),sky:function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e,Sp))._updateColorRamp(),i}return p(n,[{key:"_handleSpecialPaintPropertyUpdate",value:function(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}},{key:"_updateColorRamp",value:function(){this.colorRamp=tc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}},{key:"needsSkyboxCapture",value:function(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){var t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}},{key:"getCenter",value:function(e,t){if("atmosphere"===this.paint.get("sky-type")){var n=this.paint.get("sky-atmosphere-sun"),i=!n,r=e.style.light,a=r.properties.get("position");return i&&"viewport"===r.properties.get("anchor")&&re("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?Lp(a.azimuthal,90-a.polar,t):Lp(n[0],90-n[1],t)}var o=this.paint.get("sky-gradient-center");return Lp(o[0],90-o[1],t)}},{key:"is3D",value:function(){return!1}},{key:"isSky",value:function(){return!0}},{key:"markSkyboxValid",value:function(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}},{key:"hasOffscreenPass",value:function(){return!0}},{key:"getProgramIds",value:function(){var e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}]),n}(vs)},Ap=function(){function e(t,n,i,r){f(this,e),this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(n,r)}return p(e,[{key:"update",value:function(e,t,n){var i=e.width,r=e.height,a=this.context,o=a.gl,s=v.HTMLImageElement,l=v.HTMLCanvasElement,u=v.HTMLVideoElement,c=v.ImageData,d=v.ImageBitmap;if(o.bindTexture(o.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA&&(!t||!1!==t.premultiply)),n||this.size&&this.size[0]===i&&this.size[1]===r){var h=n||{x:0,y:0},f=h.x,p=h.y;e instanceof s||e instanceof l||e instanceof u||e instanceof c||d&&e instanceof d?o.texSubImage2D(o.TEXTURE_2D,0,f,p,o.RGBA,o.UNSIGNED_BYTE,e):o.texSubImage2D(o.TEXTURE_2D,0,f,p,i,r,o.RGBA,o.UNSIGNED_BYTE,e.data)}else this.size=[i,r],e instanceof s||e instanceof l||e instanceof u||e instanceof c||d&&e instanceof d?o.texImage2D(o.TEXTURE_2D,0,this.format,this.format,o.UNSIGNED_BYTE,e):o.texImage2D(o.TEXTURE_2D,0,this.format,i,r,0,this.format,o.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&o.generateMipmap(o.TEXTURE_2D)}},{key:"bind",value:function(e,t){var n=this.context.gl;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrap=t)}},{key:"isSizePowerOfTwo",value:function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}},{key:"destroy",value:function(){this.context.gl.deleteTexture(this.texture),this.texture=null}}]),e}(),Cp=function(){function e(t){var n=this;f(this,e),this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){n._triggered=!1,n._callback()})}return p(e,[{key:"trigger",value:function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){e._triggered=!1,e._callback()}),0))}},{key:"remove",value:function(){this._channel=void 0,this._callback=function(){}}}]),e}(),Ip=function(){function e(){f(this,e),this.tasks={},this.taskQueue=[],$(["process"],this),this.invoker=new Cp(this.process),this.nextId=0}return p(e,[{key:"add",value:function(e,t){var n=this,i=this.nextId++,r=function(e){var t=e.type,n=e.isSymbolTile,i=e.zoom;return i=i||0,"message"===t?0:"maybePrepare"!==t||n?"parseTile"!==t||n?"parseTile"===t&&n?300-i:"maybePrepare"===t&&n?400-i:500:200-i:100-i}(t);if(0===r){se();try{e()}finally{}return{cancel:function(){}}}return this.tasks[i]={fn:e,metadata:t,priority:r,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:function(){delete n.tasks[i]}}}},{key:"process",value:function(){var e=this;se();try{if(this.taskQueue=this.taskQueue.filter((function(t){return!!e.tasks[t]})),!this.taskQueue.length)return;var t=this.pick();if(null===t)return;var n=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}},{key:"pick",value:function(){for(var e=null,t=1/0,n=0;n<this.taskQueue.length;n++){var i=this.tasks[this.taskQueue[n]];i.priority<t&&(t=i.priority,e=n)}if(null===e)return null;var r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}},{key:"remove",value:function(){this.invoker.remove()}}]),e}(),Pp=function(){function e(t){f(this,e),this._stringToNumber={},this._numberToString=[];for(var n=0;n<t.length;n++){var i=t[n];this._stringToNumber[i]=n,this._numberToString[n]=i}}return p(e,[{key:"encode",value:function(e){return this._stringToNumber[e]}},{key:"decode",value:function(e){return this._numberToString[e]}}]),e}(),zp=["tile","layer","source","sourceLayer","state"],Dp=function(){function e(t,n,i,r,a){f(this,e),this.type="Feature",this._vectorTileFeature=t,this._z=n,this._x=i,this._y=r,this.properties=t.properties,this.id=a}return p(e,[{key:"geometry",get:function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry},set:function(e){this._geometry=e}},{key:"toJSON",value:function(){var e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(var t=0,n=zp;t<n.length;t++){var i=n[t];void 0!==this[i]&&(e[i]=this[i])}return e}}]),e}(),Rp=32,Bp=33,Fp=new Uint16Array(8184),Op=0;Op<2046;Op++){var Np=Op+2,Hp=0,Up=0,jp=0,Vp=0,Wp=0,Gp=0;for(1&Np?jp=Vp=Wp=Rp:Hp=Up=Gp=Rp;(Np>>=1)>1;){var qp=Hp+jp>>1,Zp=Up+Vp>>1;1&Np?(jp=Hp,Vp=Up,Hp=Wp,Up=Gp):(Hp=jp,Up=Vp,jp=Wp,Vp=Gp),Wp=qp,Gp=Zp}var Xp=4*Op;Fp[Xp+0]=Hp,Fp[Xp+1]=Up,Fp[Xp+2]=jp,Fp[Xp+3]=Vp}var Kp=new Uint16Array(2178),Yp=new Uint8Array(1089),Jp=new Uint16Array(1089);function $p(e){return 0===e?-.03125:32===e?.03125:0}var Qp=Qa([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),em={type:2,extent:ws,loadGeometry:function(){return[[new P(0,0),new P(ws+1,0),new P(ws+1,ws+1),new P(0,ws+1),new P(0,0)]]}},tm=function(){function e(t,n,i,r,a){f(this,e),this.tileID=t,this.uid=X(),this.uses=0,this.tileSize=n,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=a,this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection)}return p(e,[{key:"registerFadeDuration",value:function(e){var t=e+this.timeAdded;t<lt.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}},{key:"wasRequested",value:function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}},{key:"tileTransform",get:function(){return this._tileTransform||(this._tileTransform=jf(this.tileID.canonical,this.projection)),this._tileTransform}},{key:"loadVectorData",value:function(e,t,n){if(this.unloadVectorData(),this.state="loaded",e){for(var i in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){var n={};if(!t)return n;var i,r=h(e);try{var a=function(){var e=i.value,r=e.layerIds.map((function(e){return t.getLayer(e)})).filter(Boolean);if(0!==r.length){e.layers=r,e.stateDependentLayerIds&&(e.stateDependentLayers=e.stateDependentLayerIds.map((function(e){return r.filter((function(t){return t.id===e}))[0]})));var a,o=h(r);try{for(o.s();!(a=o.n()).done;){var s=a.value;n[s.id]=e}}catch(l){o.e(l)}finally{o.f()}}};for(r.s();!(i=r.n()).done;)a()}catch(o){r.e(o)}finally{r.f()}return n}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var r=this.buckets[i];if(r instanceof vp){if(this.hasSymbolBuckets=!0,!n)break;r.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var a in this.buckets){var o=this.buckets[a];if(o instanceof vp&&o.hasRTLText){this.hasRTLText=!0,Ra.isLoading()||Ra.isLoaded()||"deferred"!==za()||Da();break}}for(var s in this.queryPadding=0,this.buckets){var l=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(s).queryRadius(l))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Mo}},{key:"unloadVectorData",value:function(){if(this.hasData()){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}},{key:"getBucket",value:function(e){return this.buckets[e.id]}},{key:"upload",value:function(e){for(var t in this.buckets){var n=this.buckets[t];n.uploadPending()&&n.upload(e)}var i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ap(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ap(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ap(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}},{key:"prepare",value:function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}},{key:"queryRenderedFeatures",value:function(e,t,n,i,r,a,o,s){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:i,pixelPosMatrix:o,transform:a,params:r,tileTransform:this.tileTransform},e,t,n):{}}},{key:"querySourceFeatures",value:function(e,t){var n=this.latestFeatureIndex;if(n&&n.rawTileData){var i=n.loadVTLayers(),r=t?t.sourceLayer:"",a=i._geojsonTileLayer||i[r];if(a)for(var o=Er(t&&t.filter),s=this.tileID.canonical,l=s.z,u=s.x,c=s.y,d={z:l,x:u,y:c},h=0;h<a.length;h++){var f=a.feature(h);if(o.needGeometry){var p=bu(f,!0);if(!o.filter(new Ba(this.tileID.overscaledZ),p,this.tileID.canonical))continue}else if(!o.filter(new Ba(this.tileID.overscaledZ),f))continue;var m=n.getId(f,r),y=new Dp(f,l,u,c,m);y.tile=d,e.push(y)}}}},{key:"hasData",value:function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}},{key:"patternsLoaded",value:function(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}},{key:"setExpiryData",value:function(e){var t=this.expirationTime;if(e.cacheControl){var n=le(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var i=Date.now(),r=!1;if(this.expirationTime>i)r=!1;else if(t)if(this.expirationTime<t)r=!0;else{var a=this.expirationTime-t;a?this.expirationTime=i+Math.max(a,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}},{key:"getExpiryTimeout",value:function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}},{key:"setFeatureState",value:function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t){var n=this.latestFeatureIndex.loadVTLayers(),i=t.style.listImages();for(var r in this.buckets)if(t.style.hasLayer(r)){var a=this.buckets[r],o=a.layers[0].sourceLayer||"_geojsonTileLayer",s=n[o],l=e[o];if(s&&l&&0!==Object.keys(l).length){if(a.update(l,s,i,this.imageAtlas&&this.imageAtlas.patternPositions||{}),a instanceof Fd||a instanceof Hc){var u=t.style._getSourceCache(a.layers[0].source);t._terrain&&t._terrain.enabled&&u&&a.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(u.id,this.tileID)}var c=t&&t.style&&t.style.getLayer(r);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(a)))}}}}},{key:"holdingForFade",value:function(){return void 0!==this.symbolFadeHoldUntil}},{key:"symbolFadeFinished",value:function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<lt.now()}},{key:"clearFadeHold",value:function(){this.symbolFadeHoldUntil=void 0}},{key:"setHoldDuration",value:function(e){this.symbolFadeHoldUntil=lt.now()+e}},{key:"setTexture",value:function(e,t){var n=t.context,i=n.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Ap(n,e,i.RGBA,{useMipmap:!0}),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE))}},{key:"setDependencies",value:function(e,t){var n,i={},r=h(t);try{for(r.s();!(n=r.n()).done;)i[n.value]=!0}catch(a){r.e(a)}finally{r.f()}this.dependencies[e]=i}},{key:"hasDependency",value:function(e,t){var n,i=h(e);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=this.dependencies[r];if(a){var o,s=h(t);try{for(s.s();!(o=s.n()).done;)if(a[o.value])return!0}catch(l){s.e(l)}finally{s.f()}}}}catch(l){i.e(l)}finally{i.f()}return!1}},{key:"clearQueryDebugViz",value:function(){}},{key:"_makeDebugTileBoundsBuffers",value:function(e,t){if(t&&"mercator"!==t.name&&!this._tileDebugBuffer){for(var n=xu(em,this.tileID.canonical,this.tileTransform)[0],i=new to,r=new Eo,a=0;a<n.length;a++){var o=n[a],s=o.x,l=o.y;i.emplaceBack(s,l),r.emplaceBack(a)}r.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(r),this._tileDebugBuffer=e.createVertexBuffer(i,pl.members),this._tileDebugSegments=bs.simpleSegment(0,0,i.length,r.length)}}},{key:"_makeTileBoundsBuffers",value:function(e,t){if(!this._tileBoundsBuffer&&t&&"mercator"!==t.name){var n,i,r=xu(em,this.tileID.canonical,this.tileTransform)[0];if(this.isRaster){var a=function(e,t){for(var n=jf(e,t),i=Math.pow(2,e.z),r=0;r<Bp;r++)for(var a=0;a<Bp;a++){var o=su((e.x+(a+$p(a))/Rp)/i),s=lu((e.y+(r+$p(r))/Rp)/i),l=t.project(o,s),u=r*Bp+a;Kp[2*u+0]=Math.round((l.x*n.scale-n.x)*ws),Kp[2*u+1]=Math.round((l.y*n.scale-n.y)*ws)}Yp.fill(0),Jp.fill(0);for(var c=2045;c>=0;c--){var d=4*c,h=Fp[d+0],f=Fp[d+1],p=Fp[d+2],m=Fp[d+3],y=h+p>>1,g=f+m>>1,v=y+g-f,_=g+h-y,x=f*Bp+h,b=m*Bp+p,w=g*Bp+y,k=Math.hypot((Kp[2*x+0]+Kp[2*b+0])/2-Kp[2*w+0],(Kp[2*x+1]+Kp[2*b+1])/2-Kp[2*w+1])>=16;Yp[w]=Yp[w]||(k?1:0),c<1022&&(Yp[w]=Yp[w]||Yp[(f+_>>1)*Bp+(h+v>>1)]||Yp[(m+_>>1)*Bp+(p+v>>1)])}var T=new io,E=new vo,S=0;function L(e,t){var n=t*Bp+e;return 0===Jp[n]&&(T.emplaceBack(Kp[2*n+0],Kp[2*n+1],e*ws/Rp,t*ws/Rp),Jp[n]=++S),Jp[n]-1}function M(e,t,n,i,r,a){var o=e+n>>1,s=t+i>>1;if(Math.abs(e-r)+Math.abs(t-a)>1&&Yp[s*Bp+o])M(r,a,e,t,o,s),M(n,i,r,a,o,s);else{var l=L(e,t),u=L(n,i),c=L(r,a);E.emplaceBack(l,u,c)}}return M(0,0,Rp,Rp,Rp,0),M(Rp,Rp,0,0,0,Rp),{vertices:T,indices:E}}(this.tileID.canonical,t);n=a.vertices,i=a.indices}else{n=new io,i=new vo;var o,s=h(r);try{for(s.s();!(o=s.n()).done;){var l=o.value,u=l.x,c=l.y;n.emplaceBack(u,c,0,0)}}catch(p){s.e(p)}finally{s.f()}for(var d=Ic(n.int16,void 0,4),f=0;f<d.length;f+=3)i.emplaceBack(d[f],d[f+1],d[f+2])}this._tileBoundsBuffer=e.createVertexBuffer(n,Qp.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(i),this._tileBoundsSegments=bs.simpleSegment(0,0,n.length,i.length)}}},{key:"_makeGlobeTileDebugBuffers",value:function(e,t){var n=t.projection;if(n&&"globe"===n.name&&!t.freezeTileCoverage){var i,r=this.tileID.canonical,a=Wl(Dl(r,t)),o=Zl(t.zoom);o>0&&(i=As(new Float64Array(16),t.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,r,t,a,i,o),this._makeGlobeTileDebugTextBuffer(e,r,t,a,i,o)}}},{key:"_globePoint",value:function(e,t,n,i,r,a,o){var s=Ul(e,t,n);if(a){var l=1<<n.z,u=ru(i.center.lng),c=au(i.center.lat),d=(n.x+.5)/l-u,h=0;d>.5?h=-1:d<-.5&&(h=1);var f=(e/ws+n.x)/l+h,p=(t/ws+n.y)/l;f=(f-u)*i._pixelsPerMercatorPixel+u,p=(p-c)*i._pixelsPerMercatorPixel+c;var m=[f*i.worldSize,p*i.worldSize,0];$s(m,m,a),s=zl(s,m,o)}return $s(s,s,r)}},{key:"_makeGlobeTileDebugBorderBuffer",value:function(e,t,n,i,r,a){var o=this,s=new to,l=new Eo,u=new no,c=function(e,c,d,h,f){for(var p=(d-e)/(f-1),m=(h-c)/(f-1),y=s.length,g=0;g<f;g++){var v=e+g*p,_=c+g*m;s.emplaceBack(v,_);var x=o._globePoint(v,_,t,n,i,r,a);u.emplaceBack(x[0],x[1],x[2]),l.emplaceBack(y+g)}},d=ws;c(0,0,d,0,16),c(d,0,d,d,16),c(d,d,0,d,16),c(0,d,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(l),this._tileDebugBuffer=e.createVertexBuffer(s,pl.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(u,fl.members),this._tileDebugSegments=bs.simpleSegment(0,0,s.length,l.length)}},{key:"_makeGlobeTileDebugTextBuffer",value:function(e,t,n,i,r,a){var o=ws/4,s=new to,l=new vo,u=new no,c=25;l.reserve(32),s.reserve(c),u.reserve(c);for(var d=function(e,t){return c*e+t},h=0;h<c;h++)for(var f=h*o,p=0;p<c;p++){var m=p*o;s.emplaceBack(m,f);var y=this._globePoint(m,f,t,n,i,r,a);u.emplaceBack(y[0],y[1],y[2])}for(var g=0;g<4;g++)for(var v=0;v<4;v++){var _=d(g,v),x=d(g,v+1),b=d(g+1,v),w=d(g+1,v+1);l.emplaceBack(_,x,b),l.emplaceBack(b,x,w)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(l),this._tileDebugTextBuffer=e.createVertexBuffer(s,pl.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(u,fl.members),this._tileDebugTextSegments=bs.simpleSegment(0,0,c,32)}}]),e}(),nm=function(){function e(){f(this,e),this.state={},this.stateChanges={},this.deletedStates={}}return p(e,[{key:"updateState",value:function(e,t,n){var i=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][i]=this.stateChanges[e][i]||{},q(this.stateChanges[e][i],n),null===this.deletedStates[e])for(var r in this.deletedStates[e]={},this.state[e])r!==i&&(this.deletedStates[e][r]=null);else if(this.deletedStates[e]&&null===this.deletedStates[e][i])for(var a in this.deletedStates[e][i]={},this.state[e][i])n[a]||(this.deletedStates[e][i][a]=null);else for(var o in n)this.deletedStates[e]&&this.deletedStates[e][i]&&null===this.deletedStates[e][i][o]&&delete this.deletedStates[e][i][o]}},{key:"removeFeatureState",value:function(e,t,n){if(null!==this.deletedStates[e]){var i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][i])for(n in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][n]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}}},{key:"getState",value:function(e,t){var n=String(t),i=q({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){var r=this.deletedStates[e][t];if(null===r)return{};for(var a in r)delete i[a]}return i}},{key:"initializeTileState",value:function(e,t){e.setFeatureState(this.state,t)}},{key:"coalesceChanges",value:function(e,t){var n={};for(var i in this.stateChanges){this.state[i]=this.state[i]||{};var r={};for(var a in this.stateChanges[i])this.state[i][a]||(this.state[i][a]={}),q(this.state[i][a],this.stateChanges[i][a]),r[a]=this.state[i][a];n[i]=r}for(var o in this.deletedStates){this.state[o]=this.state[o]||{};var s={};if(null===this.deletedStates[o])for(var l in this.state[o])s[l]={},this.state[o][l]={};else for(var u in this.deletedStates[o]){if(null===this.deletedStates[o][u])this.state[o][u]={};else if(this.state[o][u])for(var c=0,d=Object.keys(this.deletedStates[o][u]);c<d.length;c++){var h=d[c];delete this.state[o][u][h]}s[u]=this.state[o][u]}n[o]=n[o]||{},q(n[o],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(var f in e)e[f].setFeatureState(n,t)}}]),e}(),im=function(){function e(t){f(this,e),this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}return p(e,[{key:"getElevation",value:function(e,t){var n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}},{key:"isLeaf",value:function(e,t){return this.leaves[this.toIdx(e,t)]}},{key:"toIdx",value:function(e,t){return t*this.size+e}}]),e}();function rm(e,t,n,i){for(var r=0,a=Number.MAX_VALUE,o=0;o<3;o++)if(Math.abs(i[o])<1e-15){if(n[o]<e[o]||n[o]>t[o])return null}else{var s=1/i[o],l=(e[o]-n[o])*s,u=(t[o]-n[o])*s;if(l>u){var c=l;l=u,u=c}if(l>r&&(r=l),u<a&&(a=u),r>a)return null}return r}function am(e,t,n,i,r,a,o,s,l,u,c){var d=i-e,h=r-t,f=a-n,p=o-e,m=s-t,y=l-n,g=c[1]*y-c[2]*m,v=c[2]*p-c[0]*y,_=c[0]*m-c[1]*p,x=d*g+h*v+f*_;if(Math.abs(x)<1e-15)return null;var b=1/x,w=u[0]-e,k=u[1]-t,T=u[2]-n,E=(w*g+k*v+T*_)*b;if(E<0||E>1)return null;var S=k*f-T*h,L=T*d-w*f,M=w*h-k*d,A=(c[0]*S+c[1]*L+c[2]*M)*b;return A<0||E+A>1?null:(p*S+m*L+y*M)*b}function om(e,t,n){return(e-t)/(n-t)}function sm(e,t,n,i,r,a,o,s,l){var u=1<<n,c=a-i,d=o-r,h=(e+1)/u*c+i,f=(t+0)/u*d+r,p=(t+1)/u*d+r;s[0]=(e+0)/u*c+i,s[1]=f,l[0]=h,l[1]=p}var lm=function(){function e(t){if(f(this,e),this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],this.dem){var n=function(e){for(var t=Math.ceil(Math.log2(e.dim/8)),n=[],i=Math.ceil(Math.pow(2,t)),r=1/i,a=function(e,t,n,i,r){var a=i?1:0,o=(e+1)*n-a,s=t*n,l=(t+1)*n-a;r[0]=e*n,r[1]=s,r[2]=o,r[3]=l},o=new im(i),s=[],l=0;l<i*i;l++){a(l%i,Math.floor(l/i),r,!1,s);var u=cm(s[0],s[1],e),c=cm(s[2],s[1],e),d=cm(s[2],s[3],e),h=cm(s[0],s[3],e);o.minimums.push(Math.min(u,c,d,h)),o.maximums.push(Math.max(u,c,d,h)),o.leaves.push(1)}for(n.push(o),i/=2;i>=1;i/=2){var f=n[n.length-1];o=new im(i);for(var p=0;p<i*i;p++){a(p%i,Math.floor(p/i),2,!0,s);var m=f.getElevation(s[0],s[1]),y=f.getElevation(s[2],s[1]),g=f.getElevation(s[2],s[3]),v=f.getElevation(s[0],s[3]),_=f.isLeaf(s[0],s[1]),x=f.isLeaf(s[2],s[1]),b=f.isLeaf(s[2],s[3]),w=f.isLeaf(s[0],s[3]),k=Math.min(m.min,y.min,g.min,v.min),T=Math.max(m.max,y.max,g.max,v.max),E=_&&x&&b&&w;o.maximums.push(T),o.minimums.push(k),o.leaves.push(T-k<=5&&E?1:0)}n.push(o)}return n}(this.dem),i=n.length-1,r=n[i];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(n,0,0,i,0)}}return p(e,[{key:"raycastRoot",value:function(e,t,n,i,r,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return rm([e,t,-100],[n,i,this.maximums[0]*o],r,a)}},{key:"raycast",value:function(e,t,n,i,r,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;var s=this.raycastRoot(e,t,n,i,r,a,o);if(null==s)return null;for(var l=[],u=[],c=[],d=[],h=[{idx:0,t:s,nodex:0,nodey:0,depth:0}];h.length>0;){var f=h.pop(),p=f.idx,m=f.t,y=f.nodex,g=f.nodey,v=f.depth;if(this.leaves[p]){sm(y,g,v,e,t,n,i,c,d);var _=1<<v,x=(y+0)/_,b=(y+1)/_,w=(g+0)/_,k=(g+1)/_,T=cm(x,w,this.dem)*o,E=cm(b,w,this.dem)*o,S=cm(b,k,this.dem)*o,L=cm(x,k,this.dem)*o,M=am(c[0],c[1],T,d[0],c[1],E,d[0],d[1],S,r,a),A=am(d[0],d[1],S,c[0],d[1],L,c[0],c[1],T,r,a),C=Math.min(null!==M?M:Number.MAX_VALUE,null!==A?A:Number.MAX_VALUE);if(C!==Number.MAX_VALUE)return C;var I=Xs([],r,a,m);if(um(T,E,L,S,om(I[0],c[0],d[0]),om(I[1],c[1],d[1]))>=I[2])return m}else{for(var P=0,z=0;z<this._siblingOffset.length;z++){sm((y<<1)+this._siblingOffset[z][0],(g<<1)+this._siblingOffset[z][1],v+1,e,t,n,i,c,d),c[2]=-100,d[2]=this.maximums[this.childOffsets[p]+z]*o;var D=rm(c,d,r,a);if(null!=D){var R=D;l[z]=R;for(var B=!1,F=0;F<P&&!B;F++)R>=l[u[F]]&&(u.splice(F,0,z),B=!0);B||(u[P]=z),P++}}for(var O=0;O<P;O++){var N=u[O];h.push({idx:this.childOffsets[p]+N,t:l[N],nodex:(y<<1)+this._siblingOffset[N][0],nodey:(g<<1)+this._siblingOffset[N][1],depth:v+1})}}}return null}},{key:"_addNode",value:function(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}},{key:"_construct",value:function(e,t,n,i,r){if(1!==e[i].isLeaf(t,n)){this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);for(var a=i-1,o=e[a],s=0,l=0,u=0;u<this._siblingOffset.length;u++){var c=2*t+this._siblingOffset[u][0],d=2*n+this._siblingOffset[u][1],h=o.getElevation(c,d),f=o.isLeaf(c,d),p=this._addNode(h.min,h.max,f);f&&(s|=1<<u),l||(l=p)}for(var m=0;m<this._siblingOffset.length;m++)s&1<<m||this._construct(e,2*t+this._siblingOffset[m][0],2*n+this._siblingOffset[m][1],a,l+m)}}}]),e}();function um(e,t,n,i,r,a){return qn(qn(e,n,a),qn(t,i,a),r)}function cm(e,t,n){var i=n.dim,r=U(e*i-.5,0,i-1),a=U(t*i-.5,0,i-1),o=Math.floor(r),s=Math.floor(a),l=Math.min(o+1,i-1),u=Math.min(s+1,i-1);return um(n.get(o,s),n.get(l,s),n.get(o,u),n.get(l,u),r-o,a-s)}var dm={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function hm(e,t,n){return(256*e*256+256*t+n)/10-1e4}function fm(e,t,n){return 256*e+t+n/256-32768}var pm=function(){function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(f(this,e),this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return re('"'.concat(i,'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".'));this.stride=n.height;var o=this.dim=n.height-2,s=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=i||"mapbox",this.borderReady=r,!r){for(var l=0;l<o;l++)s[this._idx(-1,l)]=s[this._idx(0,l)],s[this._idx(o,l)]=s[this._idx(o-1,l)],s[this._idx(l,-1)]=s[this._idx(l,0)],s[this._idx(l,o)]=s[this._idx(l,o-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(o,-1)]=s[this._idx(o-1,0)],s[this._idx(-1,o)]=s[this._idx(0,o-1)],s[this._idx(o,o)]=s[this._idx(o-1,o-1)],a&&this._buildQuadTree()}}return p(e,[{key:"tree",get:function(){return this._tree||this._buildQuadTree(),this._tree}},{key:"_buildQuadTree",value:function(){this._tree=new lm(this)}},{key:"get",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e=U(e,-1,this.dim),t=U(t,-1,this.dim));var n=4*this._idx(e,t);return("terrarium"===this.encoding?fm:hm)(this.pixels[n],this.pixels[n+1],this.pixels[n+2])}},{key:"unpackVector",get:function(){return dm[this.encoding]}},{key:"_idx",value:function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}},{key:"getPixels",value:function(){return new Qu({width:this.stride,height:this.stride},this.pixels)}},{key:"backfillBorder",value:function(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var i=t*this.dim,r=t*this.dim+this.dim,a=n*this.dim,o=n*this.dim+this.dim;switch(t){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:a=o-1;break;case 1:o=a+1}for(var s=-t*this.dim,l=-n*this.dim,u=a;u<o;u++)for(var c=i;c<r;c++){var d=4*this._idx(c,u),h=4*this._idx(c+s,u+l);this.pixels[d+0]=e.pixels[h+0],this.pixels[d+1]=e.pixels[h+1],this.pixels[d+2]=e.pixels[h+2],this.pixels[d+3]=e.pixels[h+3]}}},{key:"onDeserialize",value:function(){this._tree&&(this._tree.dem=this)}}],[{key:"getUnpackVector",value:function(e){return dm[e]}},{key:"pack",value:function(t,n){var i=[0,0,0,0],r=e.getUnpackVector(n),a=Math.floor((t+r[3])/r[2]);return i[2]=a%256,a=Math.floor(a/256),i[1]=a%256,a=Math.floor(a/256),i[0]=a,i}}]),e}();ua(pm,"DEMData"),ua(lm,"DemMinMaxQuadTree",{omit:["dem"]});var mm=function(){function e(t,n){f(this,e),this.max=t,this.onRemove=n,this.reset()}return p(e,[{key:"reset",value:function(){for(var e in this.data){var t,n=h(this.data[e]);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value)}}catch(r){n.e(r)}finally{n.f()}}return this.data={},this.order=[],this}},{key:"add",value:function(e,t,n){var i=this,r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);var a={value:t,timeout:void 0};if(void 0!==n&&(a.timeout=setTimeout((function(){i.remove(e,a)}),n)),this.data[r].push(a),this.order.push(r),this.order.length>this.max){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}},{key:"has",value:function(e){return e.wrapped().key in this.data}},{key:"getAndRemove",value:function(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}},{key:"_getAndRemoveByKey",value:function(e){var t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}},{key:"getByKey",value:function(e){var t=this.data[e];return t?t[0].value:null}},{key:"get",value:function(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}},{key:"remove",value:function(e,t){if(!this.has(e))return this;var n=e.wrapped().key,i=void 0===t?0:this.data[n].indexOf(t),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}},{key:"setMaxSize",value:function(e){for(this.max=e;this.order.length>this.max;){var t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}},{key:"filter",value:function(e){var t=[];for(var n in this.data){var i,r=h(this.data[n]);try{for(r.s();!(i=r.n()).done;){var a=i.value;e(a.value)||t.push(a)}}catch(u){r.e(u)}finally{r.f()}}for(var o=0,s=t;o<s.length;o++){var l=s[o];this.remove(l.value.tileID,l)}}}]),e}(),ym=p((function e(t,n,i){f(this,e),this.func=t,this.mask=n,this.range=i}));ym.ReadOnly=!1,ym.ReadWrite=!0,ym.disabled=new ym(519,ym.ReadOnly,[0,1]);var gm=7680,vm=p((function e(t,n,i,r,a,o){f(this,e),this.test=t,this.ref=n,this.mask=i,this.fail=r,this.depthFail=a,this.pass=o}));vm.disabled=new vm({func:519,mask:0},0,0,gm,gm,gm);var _m=p((function e(t,n,i){f(this,e),this.blendFunction=t,this.blendColor=n,this.mask=i}));_m.Replace=[1,0],_m.disabled=new _m(_m.Replace,Gt.transparent,[!1,!1,!1,!1]),_m.unblended=new _m(_m.Replace,Gt.transparent,[!0,!0,!0,!0]),_m.alphaBlended=new _m([1,771],Gt.transparent,[!0,!0,!0,!0]);var xm=1029,bm=2305,wm=p((function e(t,n,i){f(this,e),this.enable=t,this.mode=n,this.frontFace=i}));wm.disabled=new wm(!1,xm,bm),wm.backCCW=new wm(!0,xm,bm),wm.backCW=new wm(!0,xm,2304),wm.frontCW=new wm(!0,1028,2304),wm.frontCCW=new wm(!0,1028,bm);var km=function(e){m(n,e);var t=y(n);function n(e,i,a){var o;return f(this,n),(o=t.call(this)).id=e,o._onlySymbols=a,i.on("data",(function(e){"source"===e.dataType&&"metadata"===e.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),i.on("error",(function(){o._sourceErrored=!0})),o._source=i,o._tiles={},o._cache=new mm(0,o._unloadTile.bind(r(o))),o._timers={},o._cacheTimers={},o._minTileCacheSize=i.minTileCacheSize,o._maxTileCacheSize=i.maxTileCacheSize,o._loadedParentTiles={},o._coveredTiles={},o._state=new nm,o._isRaster="raster"===o._source.type||"raster-dem"===o._source.type||"custom"===o._source.type&&"raster"===o._source._dataType,o}return p(n,[{key:"onAdd",value:function(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}},{key:"loaded",value:function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var e in this._tiles){var t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}},{key:"getSource",value:function(){return this._source}},{key:"pause",value:function(){this._paused=!0}},{key:"resume",value:function(){if(this._paused){var e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}}},{key:"_loadTile",value:function(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}},{key:"_unloadTile",value:function(e){if(this._source.unloadTile)return this._source.unloadTile(e,(function(){}))}},{key:"_abortTile",value:function(e){if(this._source.abortTile)return this._source.abortTile(e,(function(){}))}},{key:"serialize",value:function(){return this._source.serialize()}},{key:"prepare",value:function(e){for(var t in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}}},{key:"getIds",value:function(){return G(this._tiles).map((function(e){return e.tileID})).sort(Tm).map((function(e){return e.key}))}},{key:"getRenderableIds",value:function(e){var t=this,n=[];for(var i in this._tiles)this._isIdRenderable(+i,e)&&n.push(this._tiles[i]);return e?n.sort((function(e,n){var i=e.tileID,r=n.tileID,a=new P(i.canonical.x,i.canonical.y)._rotate(t.transform.angle),o=new P(r.canonical.x,r.canonical.y)._rotate(t.transform.angle);return i.overscaledZ-r.overscaledZ||o.y-a.y||o.x-a.x})).map((function(e){return e.tileID.key})):n.map((function(e){return e.tileID})).sort(Tm).map((function(e){return e.key}))}},{key:"hasRenderableParent",value:function(e){var t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}},{key:"_isIdRenderable",value:function(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}},{key:"reload",value:function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var e in this._cache.reset(),this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}},{key:"_reloadTile",value:function(e,t){var n=this._tiles[e];n&&("loading"!==n.state&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}},{key:"_tileLoaded",value:function(e,t,n,i){if(i)if(e.state="errored",404!==i.status)this._source.fire(new ht(i,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){var r=this.map.painter.terrain;this.update(this.transform,r.getScaledDemTileSize(),!0),r.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=lt.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new dt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}},{key:"_backfillDEM",value:function(e){for(var t=this.getRenderableIds(),n=0;n<t.length;n++){var i=t[n];if(e.neighboringTiles&&e.neighboringTiles[i]){var r=this.getTileByID(i);a(e,r),a(r,e)}}function a(e,t){if(e.dem&&!e.dem.borderReady){e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;var n=t.tileID.canonical.x-e.tileID.canonical.x,i=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),a=t.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,i),e.neighboringTiles&&e.neighboringTiles[a]&&(e.neighboringTiles[a].backfilled=!0)))}}}},{key:"getTile",value:function(e){return this.getTileByID(e.key)}},{key:"getTileByID",value:function(e){return this._tiles[e]}},{key:"_retainLoadedChildren",value:function(e,t,n,i){for(var r in this._tiles){var a=this._tiles[r];if(!(i[r]||!a.hasData()||a.tileID.overscaledZ<=t||a.tileID.overscaledZ>n)){for(var o=a.tileID;a&&a.tileID.overscaledZ>t+1;){var s=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[s.key])&&a.hasData()&&(o=s)}for(var l=o;l.overscaledZ>t;)if(e[(l=l.scaledTo(l.overscaledZ-1)).key]){i[o.key]=o;break}}}}},{key:"findLoadedParent",value:function(e,t){if(e.key in this._loadedParentTiles){var n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(var i=e.overscaledZ-1;i>=t;i--){var r=e.scaledTo(i),a=this._getLoadedTile(r);if(a)return a}}},{key:"_getLoadedTile",value:function(e){var t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}},{key:"updateCacheSize",value:function(e,t){t=t||this._source.tileSize;var n=Math.ceil(e.width/t)+1,i=Math.ceil(e.height/t)+1,r=Math.floor(n*i*5),a="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,a):a;this._cache.setMaxSize(o)}},{key:"handleWrapJump",value:function(e){var t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){var n={};for(var i in this._tiles){var r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),n[r.tileID.key]=r}for(var a in this._tiles=n,this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(var o in this._tiles)this._setTileReloadTimer(+o,this._tiles[o])}}},{key:"update",value:function(e,t,i){var r=this;if(this.transform=e,this._sourceLoaded&&!this._paused&&!this.transform.freezeTileCoverage&&(!this.usedForTerrain||i)){var a;this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new Ld(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(a=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(a=a.filter((function(e){return r._source.hasTile(e)})))):a=[];var o=this._updateRetainedTiles(a);if(Em(this._source.type)&&0!==a.length){for(var s={},l={},u=0,c=Object.keys(o);u<c.length;u++){var d=c[u],f=o[d],p=this._tiles[d];if(p&&!(p.fadeEndTime&&p.fadeEndTime<=lt.now())){var m=this.findLoadedParent(f,Math.max(f.overscaledZ-n.maxOverzooming,this._source.minzoom));m&&(this._addTile(m.tileID),s[m.tileID.key]=m.tileID),l[d]=f}}var y=a[a.length-1].overscaledZ;for(var g in this._tiles){var v=this._tiles[g];if(!o[g]&&v.hasData())for(var _=v.tileID;_.overscaledZ>y;){_=_.scaledTo(_.overscaledZ-1);var x=this._tiles[_.key];if(x&&x.hasData()&&l[_.key]){o[g]=v.tileID;break}}}for(var b in s)o[b]||(this._coveredTiles[b]=!0,o[b]=s[b])}for(var w in o)this._tiles[w].clearFadeHold();var k,T=function(e,t){var n=[];for(var i in e)i in t||n.push(i);return n}(this._tiles,o),E=h(T);try{for(E.s();!(k=E.n()).done;){var S=k.value,L=this._tiles[S];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(+S)}}catch(M){E.e(M)}finally{E.f()}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}}},{key:"releaseSymbolFadeTiles",value:function(){for(var e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}},{key:"_updateRetainedTiles",value:function(e){var t={};if(0===e.length)return t;var i,r={},a=e.reduce((function(e,t){return Math.min(e,t.overscaledZ)}),1/0),o=e[0].overscaledZ,s=Math.max(o-n.maxOverzooming,this._source.minzoom),l=Math.max(o+n.maxUnderzooming,this._source.minzoom),u={},c=h(e);try{for(c.s();!(i=c.n()).done;){var d=i.value,f=this._addTile(d);t[d.key]=d,f.hasData()||a<this._source.maxzoom&&(u[d.key]=d)}}catch(T){c.e(T)}finally{c.f()}this._retainLoadedChildren(u,a,l,t);var p,m=h(e);try{for(m.s();!(p=m.n()).done;){var y=p.value,g=this._tiles[y.key];if(!g.hasData()){if(y.canonical.z>=this._source.maxzoom){var v=y.children(this._source.maxzoom)[0],_=this.getTile(v);if(_&&_.hasData()){t[v.key]=v;continue}}else{var x=y.children(this._source.maxzoom);if(t[x[0].key]&&t[x[1].key]&&t[x[2].key]&&t[x[3].key])continue}for(var b=g.wasRequested(),w=y.overscaledZ-1;w>=s;--w){var k=y.scaledTo(w);if(r[k.key])break;if(r[k.key]=!0,!(g=this.getTile(k))&&b&&(g=this._addTile(k)),g&&(t[k.key]=k,b=g.wasRequested(),g.hasData()))break}}}}catch(T){m.e(T)}finally{m.f()}return t}},{key:"_updateLoadedParentTileCache",value:function(){for(var e in this._loadedParentTiles={},this._tiles){for(var t=[],n=void 0,i=this._tiles[e].tileID;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}t.push(i.key);var r=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(r))break;i=r}for(var a=0,o=t;a<o.length;a++){var s=o[a];this._loadedParentTiles[s]=n}}}},{key:"_addTile",value:function(e){var t=this._tiles[e.key];if(t)return t;(t=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));var n=Boolean(t);if(!n){var i=this.map?this.map.painter:null;t=new tm(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,i,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,n||this._source.fire(new dt("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}},{key:"_setTileReloadTimer",value:function(e,t){var n=this;e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);var i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((function(){n._reloadTile(e,"expired"),delete n._timers[e]}),i))}},{key:"_removeTile",value:function(e){var t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}},{key:"clearTiles",value:function(){for(var e in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}},{key:"tilesIn",value:function(e,t,n){var i=[],r=this.transform;if(!r)return i;var a="globe"===r.projection.name,o=ru(r.center.lng);for(var s in this._tiles){var l=this._tiles[s];if(n&&l.clearQueryDebugViz(),!l.holdingForFade()){var u=void 0;if(a){var d=l.tileID.canonical;if(0===d.z){var f=[Math.abs(U.apply(void 0,[o].concat(c(Sm(d,-1))))-o),Math.abs(U.apply(void 0,[o].concat(c(Sm(d,1))))-o)];u=[0,2*f.indexOf(Math.min.apply(Math,f))-1]}else{var p=[Math.abs(U.apply(void 0,[o].concat(c(Sm(d,-1))))-o),Math.abs(U.apply(void 0,[o].concat(c(Sm(d,0))))-o),Math.abs(U.apply(void 0,[o].concat(c(Sm(d,1))))-o)];u=[p.indexOf(Math.min.apply(Math,p))-1]}}else u=[0];var m,y=h(u);try{for(y.s();!(m=y.n()).done;){var g=m.value,v=e.containsTile(l,r,t,g);v&&i.push(v)}}catch(_){y.e(_)}finally{y.f()}}}return i}},{key:"getVisibleCoordinates",value:function(e){var t,n=this,i=this.getRenderableIds(e).map((function(e){return n._tiles[e].tileID})),r=h(i);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped())}}catch(o){r.e(o)}finally{r.f()}return i}},{key:"hasTransition",value:function(){if(this._source.hasTransition())return!0;if(Em(this._source.type))for(var e in this._tiles){var t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=lt.now())return!0}return!1}},{key:"setFeatureState",value:function(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}},{key:"removeFeatureState",value:function(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}},{key:"getFeatureState",value:function(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}},{key:"setDependencies",value:function(e,t,n){var i=this._tiles[e];i&&i.setDependencies(t,n)}},{key:"reloadTilesForDependencies",value:function(e,t){for(var n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter((function(n){return!n.hasDependency(e,t)}))}},{key:"_preloadTiles",value:function(e,t){var n=this;if(this._sourceLoaded){var i,r=new Map,a=Array.isArray(e)?e:[e],o=this.map.painter.terrain,s=this.usedForTerrain&&o?o.getScaledDemTileSize():this._source.tileSize,l=h(a);try{for(l.s();!(i=l.n()).done;){var u,c=i.value,d=c.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),f=h(d);try{for(f.s();!(u=f.n()).done;){var p=u.value;r.set(p.key,p)}}catch(y){f.e(y)}finally{f.f()}this.usedForTerrain&&c.updateElevation(!1)}}catch(y){l.e(y)}finally{l.f()}W(Array.from(r.values()),(function(e,t){var i=new tm(e,n._source.tileSize*e.overscaleFactor(),n.transform.tileZoom,n.map.painter,n._isRaster);n._loadTile(i,(function(e){"raster-dem"===n._source.type&&i.dem&&n._backfillDEM(i),t(e,i)}))}),t)}else{var m=function i(){n._sourceLoaded&&(n._source.off("data",i),n._preloadTiles(e,t))};this._source.on("data",m)}}}]),n}(ft);function Tm(e,t){var n=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Em(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Sm(e,t){var n=1<<e.z;return[e.x/n+t,(e.x+1)/n+t]}km.maxOverzooming=10,km.maxUnderzooming=3;var Lm=function(){function e(t,n,i){f(this,e),this._demTile=t,this._dem=this._demTile.dem,this._scale=n,this._offset=i}return p(e,[{key:"tileCoordToPixel",value:function(e,t){var n=t*this._scale+this._offset[1],i=Math.floor(e*this._scale+this._offset[0]),r=Math.floor(n);return new P(i,r)}},{key:"getElevationAt",value:function(e,t,n,i){var r=e*this._scale+this._offset[0],a=t*this._scale+this._offset[1],o=Math.floor(r),s=Math.floor(a),l=this._dem;return i=!!i,n?qn(qn(l.get(o,s,i),l.get(o,s+1,i),a-s),qn(l.get(o+1,s,i),l.get(o+1,s+1,i),a-s),r-o):l.get(o,s,i)}},{key:"getElevationAtPixel",value:function(e,t,n){return this._dem.get(e,t,!!n)}},{key:"getMeterToDEM",value:function(e){return(1<<this._demTile.tileID.canonical.z)*ou(1,e)*this._dem.stride}}],[{key:"create",value:function(t,n,i){var r=i||t.findDEMTileFor(n);if(r&&r.dem){var a=r.dem,o=r.tileID,s=1<<n.canonical.z-o.canonical.z;return new e(r,r.tileSize/ws/s,[(n.canonical.x/s-o.canonical.x)*a.dim,(n.canonical.y/s-o.canonical.y)*a.dim])}}}]),e}(),Mm=function(){function e(t,n){f(this,e),this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new sa(ws,16,0),this.featureIndexArray=new Bo,this.promoteId=n}return p(e,[{key:"insert",value:function(e,t,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r,a);for(var s=this.grid,l=0;l<t.length;l++){for(var u=t[l],c=[1/0,1/0,-1/0,-1/0],d=0;d<u.length;d++){var h=u[d];c[0]=Math.min(c[0],h.x),c[1]=Math.min(c[1],h.y),c[2]=Math.max(c[2],h.x),c[3]=Math.max(c[3],h.y)}c[0]<ws&&c[1]<ws&&c[2]>=0&&c[3]>=0&&s.insert(o,c[0],c[1],c[2],c[3])}}},{key:"loadVTLayers",value:function(){if(!this.vtLayers)for(var e in this.vtLayers=new ad(new Lh(this.rawTileData)).layers,this.sourceLayerCoder=new Pp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={},this.vtLayers)this.vtFeatures[e]=[];return this.vtLayers}},{key:"query",value:function(e,t,n,i){var r=this;this.loadVTLayers();var a=e.params||{},o=Er(a.filter),s=e.tileResult,l=e.transform,u=s.bufferedTilespaceBounds,c=this.grid.query(u.min.x,u.min.y,u.max.x,u.max.y,(function(e,t,n,i){return Ru(s.bufferedTilespaceGeometry,e,t,n,i)}));c.sort(Cm);var d=null;l.elevation&&c.length>0&&(d=Lm.create(l.elevation,this.tileID));for(var h,f={},p=function(){var l=c[m];if(l===h)return"continue";h=l;var u=r.featureIndexArray.get(l),p=null;r.loadMatchingFeature(f,u,o,a.layers,a.availableImages,t,n,i,(function(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return p||(p=xu(t,r.tileID.canonical,e.tileTransform)),n.queryIntersectsFeature(s,t,i,p,r.z,e.transform,e.pixelPosMatrix,d,a)}))},m=0;m<c.length;m++)p();return f}},{key:"loadMatchingFeature",value:function(e,t,n,i,r,a,o,s,l){var u=t.featureIndex,c=t.bucketIndex,d=t.sourceLayerIndex,h=t.layoutVertexArrayOffset,f=this.bucketLayerIDs[c];if(!i||function(e,t){for(var n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}(i,f)){var p=this.sourceLayerCoder.decode(d),m=this.vtLayers[p].feature(u);if(n.needGeometry){var y=bu(m,!0);if(!n.filter(new Ba(this.tileID.overscaledZ),y,this.tileID.canonical))return}else if(!n.filter(new Ba(this.tileID.overscaledZ),m))return;for(var g=this.getId(m,p),v=0;v<f.length;v++){var _=f[v];if(!(i&&i.indexOf(_)<0)){var x=a[_];if(x){var b={};void 0!==g&&s&&(b=s.getState(x.sourceLayer||"_geojsonTileLayer",g));var w=q({},o[_]);w.paint=Am(w.paint,x.paint,m,b,r),w.layout=Am(w.layout,x.layout,m,b,r);var k=!l||l(m,x,b,h);if(k){var T=new Dp(m,this.z,this.x,this.y,g);T.layer=w;var E=e[_];void 0===E&&(E=e[_]=[]),E.push({featureIndex:u,feature:T,intersectionZ:k})}}}}}}},{key:"lookupSymbolFeatures",value:function(e,t,n,i,r,a,o,s){var l={};this.loadVTLayers();var u,c=Er(r),d=h(e);try{for(d.s();!(u=d.n()).done;){var f=u.value;this.loadMatchingFeature(l,{bucketIndex:n,sourceLayerIndex:i,featureIndex:f,layoutVertexArrayOffset:0},c,a,o,s,t)}}catch(p){d.e(p)}finally{d.f()}return l}},{key:"loadFeature",value:function(e){var t=e.featureIndex,n=e.sourceLayerIndex;this.loadVTLayers();var i=this.sourceLayerCoder.decode(n),r=this.vtFeatures[i];if(r[t])return r[t];var a=this.vtLayers[i].feature(t);return r[t]=a,a}},{key:"hasLayer",value:function(e){var t,n=h(this.bucketLayerIDs);try{for(n.s();!(t=n.n()).done;){var i,r=t.value,a=h(r);try{for(a.s();!(i=a.n()).done;)if(e===i.value)return!0}catch(o){a.e(o)}finally{a.f()}}}catch(o){n.e(o)}finally{n.f()}return!1}},{key:"getId",value:function(e,t){var n=e.id;if(this.promoteId){var i="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=i&&(n=e.properties[i]),"boolean"==typeof n&&(n=Number(n))}return n}}]),e}();function Am(e,t,n,i,r){return ee(e,(function(e,a){var o=t instanceof Wa?t.get(a):null;return o&&o.evaluate?o.evaluate(n,i,r):o}))}function Cm(e,t){return t-e}ua(Mm,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Im=function(){function e(t,n){f(this,e),this.width=t,this.height=n,this.nextRow=0,this.image=new $u({width:t,height:n}),this.positions={},this.uploaded=!1}return p(e,[{key:"getDash",value:function(e,t){var n=this.getKey(e,t);return this.positions[n]}},{key:"trim",value:function(){var e=this.width,t=this.height=Y(this.nextRow);this.image.resize({width:e,height:t})}},{key:"getKey",value:function(e,t){return e.join(",")+t}},{key:"getDashRanges",value:function(e,t,n){var i=[],r=e.length%2==1?-e[e.length-1]*n:0,a=e[0]*n,o=!0;i.push({left:r,right:a,isDash:o,zeroLength:0===e[0]});for(var s=e[0],l=1;l<e.length;l++){o=!o;var u=e[l];r=s*n,a=(s+=u)*n,i.push({left:r,right:a,isDash:o,zeroLength:0===u})}return i}},{key:"addRoundDash",value:function(e,t,n){for(var i=t/2,r=-n;r<=n;r++)for(var a=this.width*(this.nextRow+n+r),o=0,s=e[o],l=0;l<this.width;l++){l/s.right>1&&(s=e[++o]);var u=Math.abs(l-s.left),c=Math.abs(l-s.right),d=Math.min(u,c),h=void 0,f=r/n*(i+1);if(s.isDash){var p=i-Math.abs(f);h=Math.sqrt(d*d+p*p)}else h=i-Math.sqrt(d*d+f*f);this.image.data[a+l]=Math.max(0,Math.min(255,h+128))}}},{key:"addRegularDash",value:function(e,t){for(var n=e.length-1;n>=0;--n){var i=e[n],r=e[n+1];i.zeroLength?e.splice(n,1):r&&r.isDash===i.isDash&&(r.left=i.left,e.splice(n,1))}var a=e[0],o=e[e.length-1];a.isDash===o.isDash&&(a.left=o.left-this.width,o.right=a.right+this.width);for(var s=this.width*this.nextRow,l=0,u=e[l],c=0;c<this.width;c++){c/u.right>1&&(u=e[++l]);var d=Math.abs(c-u.left),h=Math.abs(c-u.right),f=Math.min(d,h);this.image.data[s+c]=Math.max(0,Math.min(255,(u.isDash?f:-f)+t+128))}}},{key:"addDash",value:function(e,t){var n=this.getKey(e,t);if(this.positions[n])return this.positions[n];var i="round"===t,r=i?7:0,a=2*r+1;if(this.nextRow+a>this.height)return re("LineAtlas out of space"),null;0===e.length&&e.push(1);for(var o=0,s=0;s<e.length;s++)e[s]<0&&(re("Negative value is found in line dasharray, replacing values with 0"),e[s]=0),o+=e[s];if(0!==o){var l=this.width/o,u=this.getDashRanges(e,this.width,l);i?this.addRoundDash(u,l,r):this.addRegularDash(u,"square"===t?.5*l:0)}var c=this.nextRow+r;this.nextRow+=a;var d={tl:[c,r],br:[o,0]};return this.positions[n]=d,d}}]),e}();ua(Im,"LineAtlas");var Pm=1*hf,zm=p((function e(t){f(this,e);var n={},i=[];for(var r in t){var a=t[r],o=n[r]={};for(var s in a.glyphs){var l=a.glyphs[+s];if(l&&0!==l.bitmap.width&&0!==l.bitmap.height){var u=l.metrics.localGlyph?Pm:1,c={x:0,y:0,w:l.bitmap.width+2*u,h:l.bitmap.height+2*u};i.push(c),o[s]=c}}}var d=zh(i),h=d.w,p=d.h,m=new $u({width:h||1,height:p||1});for(var y in t){var g=t[y];for(var v in g.glyphs){var _=g.glyphs[+v];if(_&&0!==_.bitmap.width&&0!==_.bitmap.height){var x=n[y][v],b=_.metrics.localGlyph?Pm:1;$u.copy(_.bitmap,m,{x:0,y:0},{x:x.x+b,y:x.y+b},_.bitmap)}}}this.image=m,this.positions=n}));ua(zm,"GlyphAtlas");var Dm=function(){function e(t){f(this,e),this.tileID=new Ld(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=jf(t.tileID.canonical,t.projection),this.projection=t.projection}return p(e,[{key:"parse",value:function(e,t,n,i,r){var a=this;this.status="parsing",this.data=e,this.collisionBoxArray=new Mo;var o=new Pp(Object.keys(e.layers).sort()),s=new Mm(this.tileID,this.promoteId);s.bucketLayerIDs=[];var l,u,c,d,f={},p=new Im(256,256),m={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:p,availableImages:n},y=t.familiesBySource[this.source];for(var g in y){var v=e.layers[g];if(v){var _,x=!1,b=!1,w=h(y[g]);try{for(w.s();!(_=w.n()).done;)"symbol"===_.value[0].type?x=!0:b=!0}catch(F){w.e(F)}finally{w.f()}if((!0!==this.isSymbolTile||x)&&(!1!==this.isSymbolTile||b)){1===v.version&&re('Vector tile source "'.concat(this.source,'" layer "').concat(g,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));for(var k=o.encode(g),T=[],E=0;E<v.length;E++){var S=v.feature(E),L=s.getId(S,g);T.push({feature:S,id:L,index:E,sourceLayerIndex:k})}var M,A=h(y[g]);try{for(A.s();!(M=A.n()).done;){var C=M.value,I=C[0];void 0!==this.isSymbolTile&&"symbol"===I.type!==this.isSymbolTile||I.minzoom&&this.zoom<Math.floor(I.minzoom)||I.maxzoom&&this.zoom>=I.maxzoom||"none"!==I.visibility&&(Rm(C,this.zoom,n),(f[I.id]=I.createBucket({index:s.bucketLayerIDs.length,layers:C,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:k,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:n})).populate(T,m,this.tileID.canonical,this.tileTransform),s.bucketLayerIDs.push(C.map((function(e){return e.id}))))}}catch(F){A.e(F)}finally{A.f()}}}}p.trim();var P={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},z=function(){if(l)return r(l);if(u&&c&&d){var e=new zm(u),t=new Bh(c,d);for(var i in f){var o=f[i];o instanceof vp?(Rm(o.layers,a.zoom,n),If(o,u,e.positions,c,t.iconPositions,a.showCollisionBoxes,n,a.tileID.canonical,a.tileZoom,a.projection)):o.hasPattern&&(o instanceof Fd||o instanceof Hc||o instanceof fd)&&(Rm(o.layers,a.zoom,n),o.addFeatures(m,a.tileID.canonical,t.patternPositions,n,a.tileTransform))}a.status="done",r(null,{buckets:G(f).filter((function(e){return!e.isEmpty()})),featureIndex:s,collisionBoxArray:a.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:p,imageAtlas:t,glyphMap:a.returnDependencies?u:null,iconMap:a.returnDependencies?c:null,glyphPositions:a.returnDependencies?e.positions:null})}},D=ee(m.glyphDependencies,(function(e){return Object.keys(e).map(Number)}));Object.keys(D).length?i.send("getGlyphs",{uid:this.uid,stacks:D},(function(e,t){l||(l=e,u=t,z())}),void 0,!1,P):u={};var R=Object.keys(m.iconDependencies);R.length?i.send("getImages",{icons:R,source:this.source,tileID:this.tileID,type:"icons"},(function(e,t){l||(l=e,c=t,z())}),void 0,!1,P):c={};var B=Object.keys(m.patternDependencies);B.length?i.send("getImages",{icons:B,source:this.source,tileID:this.tileID,type:"patterns"},(function(e,t){l||(l=e,d=t,z())}),void 0,!1,P):d={},z()}}]),e}();function Rm(e,t,n){var i,r=new Ba(t),a=h(e);try{for(a.s();!(i=a.n()).done;)i.value.recalculate(r,n)}catch(o){a.e(o)}finally{a.f()}}var Bm=function(){function e(t){f(this,e),this.entries={},this.scheduler=t}return p(e,[{key:"request",value:function(e,t,n,i){var r=this,a=this.entries[e]=this.entries[e]||{callbacks:[]};if(a.result){var o=d(a.result,2),s=o[0],l=o[1];return this.scheduler?this.scheduler.add((function(){i(s,l)}),t):i(s,l),function(){}}return a.callbacks.push(i),a.cancel||(a.cancel=n((function(n,i){a.result=[n,i];var o,s=h(a.callbacks);try{var l=function(){var e=o.value;r.scheduler?r.scheduler.add((function(){e(n,i)}),t):e(n,i)};for(s.s();!(o=s.n()).done;)l()}catch(u){s.e(u)}finally{s.f()}setTimeout((function(){return delete r.entries[e]}),3e3)}))),function(){a.result||(a.callbacks=a.callbacks.filter((function(e){return e!==i})),a.callbacks.length||(a.cancel(),delete r.entries[e]))}}}]),e}();function Fm(e,t,n){var i=JSON.stringify(e.request);return e.data&&(this.deduped.entries[i]={result:[null,e.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(function(t){var i=Se(e.request,(function(e,i,r,a){e?t(e):i&&t(null,{vectorTile:n?void 0:new ad(new Lh(i)),rawData:i,cacheControl:r,expires:a})}));return function(){i.cancel(),t()}}),t)}var Om=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Nm=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,r=arguments.length>3?arguments[3]:void 0;if(f(this,e),isNaN(t)||t<0)throw new Error("Unpexpected numItems value: ".concat(t,"."));this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;var a=Om.indexOf(this.ArrayType),o=2*t*this.ArrayType.BYTES_PER_ELEMENT,s=t*this.IndexArrayType.BYTES_PER_ELEMENT,l=(8-s%8)%8;if(a<0)throw new Error("Unexpected typed array class: ".concat(i,"."));r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+l,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+l),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+l,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+a]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}return p(e,[{key:"add",value:function(e,t){var n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}},{key:"finish",value:function(){var e=this._pos>>1;if(e!==this.numItems)throw new Error("Added ".concat(e," items when expected ").concat(this.numItems,"."));return Hm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}},{key:"range",value:function(e,t,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var r=this.ids,a=this.coords,o=this.nodeSize,s=[0,r.length-1,0],l=[];s.length;){var u=s.pop()||0,c=s.pop()||0,d=s.pop()||0;if(c-d<=o)for(var h=d;h<=c;h++){var f=a[2*h],p=a[2*h+1];f>=e&&f<=n&&p>=t&&p<=i&&l.push(r[h])}else{var m=d+c>>1,y=a[2*m],g=a[2*m+1];y>=e&&y<=n&&g>=t&&g<=i&&l.push(r[m]),(0===u?e<=y:t<=g)&&(s.push(d),s.push(m-1),s.push(1-u)),(0===u?n>=y:i>=g)&&(s.push(m+1),s.push(c),s.push(1-u))}}return l}},{key:"within",value:function(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var i=this.ids,r=this.coords,a=this.nodeSize,o=[0,i.length-1,0],s=[],l=n*n;o.length;){var u=o.pop()||0,c=o.pop()||0,d=o.pop()||0;if(c-d<=a)for(var h=d;h<=c;h++)Wm(r[2*h],r[2*h+1],e,t)<=l&&s.push(i[h]);else{var f=d+c>>1,p=r[2*f],m=r[2*f+1];Wm(p,m,e,t)<=l&&s.push(i[f]),(0===u?e-n<=p:t-n<=m)&&(o.push(d),o.push(f-1),o.push(1-u)),(0===u?e+n>=p:t+n>=m)&&(o.push(f+1),o.push(c),o.push(1-u))}}return s}}],[{key:"from",value:function(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");var n=new Uint8Array(t,0,2),i=d(n,2),r=i[0],a=i[1];if(219!==r)throw new Error("Data does not appear to be in a KDBush format.");var o=a>>4;if(1!==o)throw new Error("Got v".concat(o," data when expected v1."));var s=Om[15&a];if(!s)throw new Error("Unrecognized array type.");var l=new Uint16Array(t,2,1),u=d(l,1)[0],c=new Uint32Array(t,4,1);return new e(d(c,1)[0],u,s,t)}}]),e}();function Hm(e,t,n,i,r,a){if(!(r-i<=n)){var o=i+r>>1;Um(e,t,o,i,r,a),Hm(e,t,n,i,o-1,1-a),Hm(e,t,n,o+1,r,1-a)}}function Um(e,t,n,i,r,a){for(;r>i;){if(r-i>600){var o=r-i+1,s=n-i+1,l=Math.log(o),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(o-u)/o)*(s-o/2<0?-1:1);Um(e,t,n,Math.max(i,Math.floor(n-s*u/o+c)),Math.min(r,Math.floor(n+(o-s)*u/o+c)),a)}var d=t[2*n+a],h=i,f=r;for(jm(e,t,i,n),t[2*r+a]>d&&jm(e,t,i,r);h<f;){for(jm(e,t,h,f),h++,f--;t[2*h+a]<d;)h++;for(;t[2*f+a]>d;)f--}t[2*i+a]===d?jm(e,t,i,f):jm(e,t,++f,r),f<=n&&(i=f+1),n<=f&&(r=f-1)}}function jm(e,t,n,i){Vm(e,n,i),Vm(t,2*n,2*i),Vm(t,2*n+1,2*i+1)}function Vm(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function Wm(e,t,n,i){var r=e-n,a=t-i;return r*r+a*a}e.ARRAY_TYPE=Es,e.AUTH_ERR_MSG=Pe,e.Aabb=vl,e.Actor=function(){function e(t,n,i){f(this,e),this.target=t,this.parent=n,this.mapId=i,this.callbacks={},this.cancelCallbacks={},$(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=se()?t:v,this.scheduler=new Ip}return p(e,[{key:"send",value:function(e,t,n,i){var r=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=o,this.callbacks[s]=n);var l=ce(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:e,hasCallback:!!n,targetMapId:i,mustQueue:a,sourceMapId:this.mapId,data:fa(t,l)},l),{cancel:function(){n&&delete r.callbacks[s],r.target.postMessage({id:s,type:"<cancel>",targetMapId:i,sourceMapId:r.mapId})}}}},{key:"receive",value:function(e){var t=this,n=e.data,i=n.id;if(i&&(!n.targetMapId||this.mapId===n.targetMapId))if("<cancel>"===n.type){var r=this.cancelCallbacks[i];delete this.cancelCallbacks[i],r&&r.cancel()}else if(n.mustQueue||se()){var a=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add((function(){return t.processTask(i,n)}),a&&a.metadata||{type:"message"})}else this.processTask(i,n)}},{key:"processTask",value:function(e,t){var n=this;if("<response>"===t.type){var i=this.callbacks[e];delete this.callbacks[e],i&&(t.error?i(pa(t.error)):i(null,pa(t.data)))}else{var r=ce(this.globalScope)?void 0:[],a=t.hasCallback?function(t,i){delete n.cancelCallbacks[e],n.target.postMessage({id:e,type:"<response>",sourceMapId:n.mapId,error:t?fa(t):null,data:fa(i,r)},r)}:function(e){},o=pa(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,o,a);else if(this.parent.getWorkerSource){var s=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,s[0],o.source)[s[1]](o,a)}else a(new Error("Could not find function ".concat(t.type)))}}},{key:"remove",value:function(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}]),e}(),e.CanonicalTileID=Ed,e.Color=Gt,e.ColorMode=_m,e.CullFaceMode=wm,e.DEMData=pm,e.DataConstantProperty=Ga,e.DedupedRequest=Bm,e.DepthMode=ym,e.EXTENT=ws,e.Elevation=function(){function e(){f(this,e)}return p(e,[{key:"isDataAvailableAtPoint",value:function(e){var t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;var n=t.getSource().maxzoom,i=1<<n,r=Math.floor(e.x),a=Math.floor((e.x-r)*i),o=Math.floor(e.y*i),s=this.findDEMTileFor(new Ld(n,r,n,a,o));return!(!s||!s.dem)}},{key:"getAtPointOrZero",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getAtPoint(e,t)||0}},{key:"getAtPoint",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.isUsingMockSource())return null;null==t&&(t=null);var i=this._source();if(!i)return t;if(e.y<0||e.y>1)return t;var r=i.getSource().maxzoom,a=1<<r,o=Math.floor(e.x),s=e.x-o,l=new Ld(r,o,r,Math.floor(s*a),Math.floor(e.y*a)),u=this.findDEMTileFor(l);if(!u||!u.dem)return t;var c=u.dem,d=1<<u.tileID.canonical.z,h=(s*d-u.tileID.canonical.x)*c.dim,f=(e.y*d-u.tileID.canonical.y)*c.dim,p=Math.floor(h),m=Math.floor(f);return(n?this.exaggeration():1)*qn(qn(c.get(p,m),c.get(p,m+1),f-m),qn(c.get(p+1,m),c.get(p+1,m+1),f-m),h-p)}},{key:"getAtTileOffset",value:function(e,t,n){var i=1<<e.canonical.z;return this.getAtPointOrZero(new hu(e.wrap+(e.canonical.x+t/ws)/i,(e.canonical.y+n/ws)/i))}},{key:"getAtTileOffsetFunc",value:function(e,t,n,i){var r=this;return function(a){var o=r.getAtTileOffset(e,a.x,a.y),s=i.upVector(e.canonical,a.x,a.y);return Zs(s,s,o*i.upVectorScale(e.canonical,t,n).metersToTile),s}}},{key:"getForTilePoints",value:function(e,t,n,i){var r=this;if(this.isUsingMockSource())return!1;var a=Lm.create(this,e,i);return!!a&&(t.forEach((function(e){e[2]=r.exaggeration()*a.getElevationAt(e[0],e[1],n)})),!0)}},{key:"getMinMaxForTile",value:function(e){if(this.isUsingMockSource())return null;var t=this.findDEMTileFor(e);if(!t||!t.dem)return null;for(var n=t.dem.tree,i=t.tileID,r=1<<e.canonical.z-i.canonical.z,a=e.canonical.x/r-i.canonical.x,o=e.canonical.y/r-i.canonical.y,s=0,l=0;l<e.canonical.z-i.canonical.z&&!n.leaves[s];l++){a*=2,o*=2;var u=2*Math.floor(o)+Math.floor(a);s=n.childOffsets[s]+u,a%=1,o%=1}return{min:this.exaggeration()*n.minimums[s],max:this.exaggeration()*n.maximums[s]}}},{key:"getMinElevationBelowMSL",value:function(){throw new Error("Pure virtual method called.")}},{key:"raycast",value:function(e,t,n){throw new Error("Pure virtual method called.")}},{key:"pointCoordinate",value:function(e){throw new Error("Pure virtual method called.")}},{key:"_source",value:function(){throw new Error("Pure virtual method called.")}},{key:"isUsingMockSource",value:function(){throw new Error("Pure virtual method called.")}},{key:"exaggeration",value:function(){throw new Error("Pure virtual method called.")}},{key:"findDEMTileFor",value:function(e){throw new Error("Pure virtual method called.")}},{key:"visibleDemTiles",get:function(){throw new Error("Getter must be implemented in subclass.")}}]),e}(),e.ErrorEvent=ht,e.EvaluationParameters=Ba,e.Event=dt,e.Evented=ft,e.FillExtrusionBucket=fd,e.Frustum=gl,e.FrustumCorners=yl,e.GLOBE_RADIUS=bl,e.GLOBE_SCALE_MATCH_LATITUDE=45,e.GLOBE_ZOOM_THRESHOLD_MAX=xl,e.GLOBE_ZOOM_THRESHOLD_MIN=_l,e.GlobeSharedBuffers=function(){function e(t){f(this,e),this._createGrid(t),this._createPoles(t)}return p(e,[{key:"destroy",value:function(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();var e,t=h(this._poleSegments);try{for(t.s();!(e=t.n()).done;)e.value.destroy()}catch(s){t.e(s)}finally{t.f()}var n,i=h(this._gridSegments);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.withSkirts.destroy(),r.withoutSkirts.destroy()}}catch(s){i.e(s)}finally{i.f()}if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();var a,o=h(this._wireframeSegments);try{for(o.s();!(a=o.n()).done;)a.value.destroy()}catch(s){o.e(s)}finally{o.f()}}}},{key:"_fillGridMeshWithLods",value:function(e,t){for(var n=new to,i=new vo,r=[],a=e+1+2,o=t[0]+1,s=t[0]+1+(1+t.length),l=function(e,t,n){var i=e===a-1?e-2:0===e?e:e-1;return[i+=n?24575:0,t]},u=0;u<a;++u)n.emplaceBack.apply(n,c(l(u,0,!0)));for(var d=0;d<o;++d)for(var h=0;h<a;++h)n.emplaceBack.apply(n,c(l(h,d,(0===h||h===a-1)&&!0)));for(var f=0;f<t.length;++f)for(var p=t[f],m=0;m<a;++m)n.emplaceBack.apply(n,c(l(m,p,!0)));for(var y=0;y<t.length;++y){for(var g=i.length,v=t[y]+1+2,_=new vo,x=0;x<v-1;x++)for(var b=x===v-2,w=b?a*(s-t.length+y-x):a,k=0;k<a-1;k++){var T=x*a+k;0===x||b||0===k||k===a-2?(_.emplaceBack(T+1,T,T+w),_.emplaceBack(T+w,T+w+1,T+1)):(i.emplaceBack(T+1,T,T+w),i.emplaceBack(T+w,T+w+1,T+1))}for(var E=bs.simpleSegment(0,g,n.length,i.length-g),S=0;S<_.uint16.length;S+=3)i.emplaceBack(_.uint16[S],_.uint16[S+1],_.uint16[S+2]);var L=bs.simpleSegment(0,g,n.length,i.length-g);r.push({withoutSkirts:E,withSkirts:L})}return{vertices:n,indices:i,segments:r}}},{key:"_createGrid",value:function(e){var t=this._fillGridMeshWithLods(kl,Tl);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,pl.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}},{key:"_createPoles",value:function(e){for(var t=new vo,n=0;n<=kl;n++)t.emplaceBack(0,n+1,n+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);var i=new wo,r=new wo;this._poleSegments=[];for(var a=0,o=0;a<_l;a++){var s=360/(1<<a);i.emplaceBack(0,-bl,0,.5,0),r.emplaceBack(0,-bl,0,.5,1);for(var l=0;l<=kl;l++){var u=l/kl,c=qn(0,s,u),h=Nl(Jl,$l,c,bl),f=d(h,3),p=f[0],m=f[1],y=f[2];i.emplaceBack(p,m,y,u,0),r.emplaceBack(p,m,y,u,1)}this._poleSegments.push(bs.simpleSegment(o,0,66,64)),o+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,hl,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(r,hl,!1)}},{key:"getGridBuffers",value:function(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}},{key:"getPoleBuffers",value:function(e){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},{key:"getWirefameBuffers",value:function(e,t){if(!this._wireframeSegments){var n=new To,i=kl,r=i+1+2,a=1;this._wireframeSegments=[];for(var o=0,s=0;o<Tl.length;o++){for(var l=Tl[o],u=a;u<l+a;u++)for(var c=a;c<i+a;c++){var d=u*r+c;n.emplaceBack(d,d+1),n.emplaceBack(d,d+r),n.emplaceBack(d,d+r+1)}var h=l*i*3;this._wireframeSegments.push(bs.simpleSegment(0,s,(l+1)*r,h)),s+=h}this._wireframeIndexBuffer=e.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}}]),e}(),e.GlyphManager=pf,e.ImagePosition=Rh,e.KDBush=Nm,e.LivePerformanceUtils=et,e.LngLat=nu,e.LngLatBounds=ks,e.LocalGlyphMode=ff,e.MAX_MERCATOR_LATITUDE=cu,e.MercatorCoordinate=hu,e.ONE_EM=Kd,e.OverscaledTileID=Ld,e.PerformanceMarkers=Qe,e.Point=P,e.Properties=Xa,e.RGBAImage=Qu,e.Ray=ml,e.RequestManager=function(){function e(t,n,i){f(this,e),this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!i,this._createSkuToken()}return p(e,[{key:"_createSkuToken",value:function(){var e=function(){for(var e="",t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",E,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}},{key:"_isSkuTokenExpired",value:function(){return Date.now()>this._skuTokenExpiresAt}},{key:"transformRequest",value:function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}},{key:"normalizeStyleURL",value:function(e,t){if(!ze(e))return e;var n=Ne(e);return n.path="/styles/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||t)}},{key:"normalizeGlyphsURL",value:function(e,t){if(!ze(e))return e;var n=Ne(e);return n.path="/fonts/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||t)}},{key:"normalizeSourceURL",value:function(e,t,n,i){if(!ze(e))return e;var r=Ne(e);return r.path="/v4/".concat(r.authority,".json"),r.params.push("secure"),n&&r.params.push("language=".concat(n)),i&&r.params.push("worldview=".concat(i)),this._makeAPIURL(r,this._customAccessToken||t)}},{key:"normalizeSpriteURL",value:function(e,t,n,i){var r=Ne(e);return ze(e)?(r.path="/styles/v1".concat(r.path,"/sprite").concat(t).concat(n),this._makeAPIURL(r,this._customAccessToken||i)):(r.path+="".concat(t).concat(n),He(r))}},{key:"normalizeTileURL",value:function(e,t,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!ze(e))return e;var i=Ne(e);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,"".concat(t||n&&"raster"!==i.authority&&512===n?"@2x":"").concat(b.supported?".webp":"$1")),"raster"===i.authority?i.path="/".concat(x.RASTER_URL_PREFIX).concat(i.path):(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path="/".concat(x.TILE_URL_VERSION).concat(i.path));var r=this._customAccessToken||function(e){var t,n=h(e);try{for(n.s();!(t=n.n()).done;){var i=t.value.match(/^access_token=(.*)$/);if(i)return i[1]}}catch(r){n.e(r)}finally{n.f()}return null}(i.params)||x.ACCESS_TOKEN;return x.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&i.params.push("sku=".concat(this._skuToken)),this._makeAPIURL(i,r)}},{key:"canonicalizeTileURL",value:function(e,t){var n=Ne(e);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return e;var i="mapbox://";n.path.match(/^\/raster\/v1\//)?i+="raster/".concat(n.path.replace("/".concat(x.RASTER_URL_PREFIX,"/"),"")):i+="tiles/".concat(n.path.replace("/".concat(x.TILE_URL_VERSION,"/"),""));var r=n.params;return t&&(r=r.filter((function(e){return!e.match(/^access_token=/)}))),r.length&&(i+="?".concat(r.join("&"))),i}},{key:"canonicalizeTileset",value:function(e,t){var n,i=!!t&&ze(t),r=[],a=h(e.tiles||[]);try{for(a.s();!(n=a.n()).done;){var o=n.value;De(o)?r.push(this.canonicalizeTileURL(o,i)):r.push(o)}}catch(s){a.e(s)}finally{a.f()}return r}},{key:"_makeAPIURL",value:function(e,t){var n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",i=Ne(x.API_URL);if(e.protocol=i.protocol,e.authority=i.authority,"http"===e.protocol){var r=e.params.indexOf("secure");r>=0&&e.params.splice(r,1)}if("/"!==i.path&&(e.path="".concat(i.path).concat(e.path)),!x.REQUIRE_ACCESS_TOKEN)return He(e);if(t=t||x.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error("An API access token is required to use Mapbox GL. ".concat(n));if("s"===t[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(n))}return e.params=e.params.filter((function(e){return-1===e.indexOf("access_token")})),e.params.push("access_token=".concat(t||"")),He(e)}}]),e}(),e.ResourceType=we,e.SegmentVector=bs,e.SourceCache=km,e.StencilMode=vm,e.StructArrayLayout1ui2=Eo,e.StructArrayLayout2f1f2i16=mo,e.StructArrayLayout2i4=to,e.StructArrayLayout2ui4=To,e.StructArrayLayout3f12=go,e.StructArrayLayout3ui6=vo,e.StructArrayLayout4i8=io,e.StructArrayLayout5f20=wo,e.Texture=Ap,e.Tile=tm,e.Transitionable=Na,e.Uniform1f=$o,e.Uniform1i=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).current=0,i}return p(n,[{key:"set",value:function(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}]),n}(Jo),e.Uniform2f=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).current=[0,0],i}return p(n,[{key:"set",value:function(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}]),n}(Jo),e.Uniform3f=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).current=[0,0,0],i}return p(n,[{key:"set",value:function(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}]),n}(Jo),e.Uniform4f=Qo,e.UniformColor=es,e.UniformMatrix2f=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).current=is,i}return p(n,[{key:"set",value:function(e,t,n){if(this.fetchUniformLocation(e,t))for(var i=0;i<4;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}]),n}(Jo),e.UniformMatrix3f=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).current=ns,i}return p(n,[{key:"set",value:function(e,t,n){if(this.fetchUniformLocation(e,t))for(var i=0;i<9;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}]),n}(Jo),e.UniformMatrix4f=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).current=ts,i}return p(n,[{key:"set",value:function(e,t,n){if(this.fetchUniformLocation(e,t)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(var i=1;i<16;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}]),n}(Jo),e.UnwrappedTileID=Sd,e.ValidationError=yr,e.VectorTileFeature=od,e.VectorTileWorkerSource=function(e){m(n,e);var t=y(n);function n(e,i,r,a,o){var s;return f(this,n),(s=t.call(this)).actor=e,s.layerIndex=i,s.availableImages=r,s.loadVectorData=o||Fm,s.loading={},s.loaded={},s.deduped=new Bm(e.scheduler),s.isSpriteLoaded=a,s.scheduler=e.scheduler,s}return p(n,[{key:"loadTile",value:function(e,t){var n=this,i=e.uid,r=e&&e.request,a=r&&r.collectResourceTiming,o=this.loading[i]=new Dm(e);o.abort=this.loadVectorData(e,(function(s,l){var u=!n.loading[i];if(delete n.loading[i],u||s||!l)return o.status="done",u||(n.loaded[i]=o),t(s);var c=l.rawData,d={};l.expires&&(d.expires=l.expires),l.cacheControl&&(d.cacheControl=l.cacheControl),o.vectorTile=l.vectorTile||new ad(new Lh(c));var h=function(){o.parse(o.vectorTile,n.layerIndex,n.availableImages,n.actor,(function(e,n){if(e||!n)return t(e);var i={};if(a){var o=st(r);o.length>0&&(i.resourceTiming=JSON.parse(JSON.stringify(o)))}t(null,q({rawTileData:c.slice(0)},n,d,i))}))};n.isSpriteLoaded?h():n.once("isSpriteLoaded",(function(){n.scheduler?n.scheduler.add(h,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):h()})),n.loaded=n.loaded||{},n.loaded[i]=o}))}},{key:"reloadTile",value:function(e,t){var n=this,i=this.loaded,r=e.uid,a=this;if(i&&i[r]){var o=i[r];o.showCollisionBoxes=e.showCollisionBoxes,o.enableTerrain=!!e.enableTerrain,o.projection=e.projection,o.tileTransform=jf(e.tileID.canonical,e.projection);var s=function(e,i){var r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,a.layerIndex,n.availableImages,a.actor,r)),t(e,i)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}},{key:"abortTile",value:function(e,t){var n=e.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),t()}},{key:"removeTile",value:function(e,t){var n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}}]),n}(ft),e.WritingMode=Fh,e.ZoomDependentExpression=hr,e.add=js,e.addDynamicAttributes=pp,e.adjoint=function(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8];return e[0]=o*c-s*u,e[1]=r*u-i*c,e[2]=i*s-r*o,e[3]=s*l-a*c,e[4]=n*c-r*l,e[5]=r*a-n*s,e[6]=a*u-o*l,e[7]=i*l-n*u,e[8]=n*o-i*a,e},e.asyncAll=W,e.bezier=N,e.bindAll=$,e.boundsAttributes=Qp,e.bufferConvexPolygon=function(e,t){for(var n=[],i=0;i<e.length;i++){var r=V(i-1,-1,e.length-1),a=V(i+1,-1,e.length-1),o=e[i],s=e[a],l=e[r].sub(o).unit(),u=s.sub(o).unit(),c=u.angleWithSep(l.x,l.y),d=l.add(u).unit().mult(-1*t/Math.sin(c/2));n.push(o.add(d))}return n},e.cacheEntryPossiblyAdded=function(e){++be>ge&&(e.getActor().send("enforceCacheSizeLimit",ye),be=0)},e.calculateGlobeLabelMatrix=function(e,t){var n=e.point,i=ql(n.x,n.y,e.worldSize/e._pixelsPerMercatorPixel,0,0);return Cs(i,i,Gl(Pl(t)))},e.calculateGlobeMatrix=function(e){var t=e.point,n=t.x,i=t.y,r=e._center,a=r.lng,o=r.lat;return ql(n,i,e.worldSize,a,o)},e.calculateGlobeMercatorMatrix=function(e){var t=e.pixelsPerMeter,n=t/ou(1,e.center.lat),i=Ms(new Float64Array(16));return Is(i,i,[e.point.x,e.point.y,0]),Ps(i,i,[n,n,t]),Float32Array.from(i)},e.circumferenceAtLatitude=iu,e.clamp=U,e.clearTileCache=function(e){if(ve()){var t=v.caches.delete(me);e&&t.catch(e).then((function(){return e()}))}},e.clipLine=lf,e.clone=function(e){var t=new Es(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.clone$1=ne,e.collisionCircleLayout=Xd,e.config=x,e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.create=function(){var e=new Es(16);return Es!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.create$1=Ss,e.createExpression=cr,e.createLayout=Qa,e.createStyleLayer=function(e){return"custom"===e.type?new Ep(e):new Mp[e.type](e)},e.cross=Js,e.degToRad=R,e.distance=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},e.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},e.dot=Ys,e.earthRadius=Ql,e.ease=H,e.easeCubicInOut=O,e.ecefToLatLng=function(e){var t=d(e,3),n=t[0],i=t[1],r=t[2],a=Math.hypot(n,i,r),o=Math.atan2(n,r),s=.5*Math.PI-Math.acos(-i/a);return new nu(B(o),B(s))},e.emitValidationErrors=ia,e.endsWith=Q,e.enforceCacheSizeLimit=function(e){_e(),fe&&fe.then((function(t){t.keys().then((function(n){for(var i=0;i<n.length-e;i++)t.delete(n[i])}))}))},e.evaluateSizeForFeature=$d,e.evaluateSizeForZoom=Qd,e.evaluateVariableOffset=Cf,e.evented=Pa,e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.exported=lt,e.exported$1=b,e.extend=q,e.extend$1=mt,e.fillExtrusionHeightLift=xd,e.filterObject=te,e.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.fromQuat=function(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=n+n,s=i+i,l=r+r,u=n*o,c=i*o,d=i*s,h=r*o,f=r*s,p=r*l,m=a*o,y=a*s,g=a*l;return e[0]=1-d-p,e[1]=c+g,e[2]=h-y,e[3]=0,e[4]=c-g,e[5]=1-u-p,e[6]=f+m,e[7]=0,e[8]=h+y,e[9]=f-m,e[10]=1-u-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.fromScaling=Rs,e.furthestTileCorner=function(e){var t=Math.round((e+45+360)%360/90)%4;return F[t]},e.getAABBPointSquareDist=function(e,t,n){for(var i=0,r=0;r<2;++r){var a=n?n[r]:0;e[r]>a&&(i+=(e[r]-a)*(e[r]-a)),t[r]<a&&(i+=(a-t[r])*(a-t[r]))}return i},e.getAnchorAlignment=Kh,e.getAnchorJustification=Pf,e.getBounds=function(e){var t,n=1/0,i=1/0,r=-1/0,a=-1/0,o=h(e);try{for(o.s();!(t=o.n()).done;){var s=t.value;n=Math.min(n,s.x),i=Math.min(i,s.y),r=Math.max(r,s.x),a=Math.max(a,s.y)}}catch(l){o.e(l)}finally{o.f()}return{min:new P(n,i),max:new P(r,a)}},e.getColumn=he,e.getDefaultExportFromCjs=S,e.getGridMatrix=function(e,t,n,i){var r=t.getNorth(),a=t.getSouth(),o=t.getWest(),s=t.getEast(),l=1<<e.z,u=s-o,c=r-a,d=u/kl,h=-c/Tl[n],f=[0,d,0,h,0,0,r,o,0];if(e.z>0){var p=180/i;Ls(f,f,[p/u+1,0,0,0,p/c+1,0,-.5*p/d,.5*p/h,1])}return f[2]=l,f[5]=e.x,f[8]=e.y,f},e.getImage=Ie,e.getJSON=function(e,t){return Ee(q(e,{type:"json"}),t)},e.getLatitudinalLod=function(e){var t=cu-5;e=U(e,-t,t)/t*90;var n=Math.pow(Math.abs(Math.sin(R(e))),3);return Math.round(n*(Tl.length-1))},e.getMapSessionAPI=Je,e.getPerformanceMeasurement=st,e.getProjection=up,e.getRTLTextPluginStatus=za,e.getReferrer=Te,e.getTilePoint=function(e,t){var n=t.x,i=t.y;return new P(((n-(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))*e.scale-e.x)*ws,(i*e.scale-e.y)*ws)},e.getTileVec3=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Us(((t.x-n)*e.scale-e.x)*ws,(t.y*e.scale-e.y)*ws,uu(t.z,t.y))},e.getVideo=function(e,t){var n=v.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(var i=0;i<e.length;i++){var r=v.document.createElement("source");Le(e[i])||(n.crossOrigin="Anonymous"),r.src=e[i],n.appendChild(r)}return{cancel:function(){}}},e.globeCenterToScreenPoint=function(e){var t=[0,0,0],n=Ms(new Float64Array(16));return Cs(n,e.pixelMatrix,e.globeMatrix),$s(t,t,n),new P(t[0],t[1])},e.globeDenormalizeECEF=Gl,e.globeECEFOrigin=function(e,t){var n=[0,0,0];return $s(n,n,Wl(Pl(t.canonical))),$s(n,n,e),n},e.globeMetersToEcef=Ml,e.globeNormalizeECEF=Wl,e.globePixelsToTileUnits=function(e,t){return ws/(512*Math.pow(2,e))*jl(Pl(t))},e.globePoleMatrixForTile=function(e,t,n){var i=Ms(new Float64Array(16)),r=(t/(1<<e)-.5)*Math.PI*2;return Ds(i,n.globeMatrix,r),Float32Array.from(i)},e.globeTileBounds=Pl,e.globeTiltAtLngLat=Xl,e.globeToMercatorTransition=Zl,e.globeUseCustomAntiAliasing=function(e,t,n){var i=Zl(n.zoom),r=e.style.map._antialias,a=!!t.extStandardDerivatives,o=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===i&&!r&&!o&&a},e.identity=Ms,e.identity$1=ll,e.invert=As,e.isFullscreen=function(){return!!v.document.fullscreenElement||!!v.document.webkitFullscreenElement},e.isLngLatBehindGlobe=Kl,e.isMapAuthenticated=function(e){return $e.has(e)},e.isMapboxURL=ze,e.isSafariWithAntialiasingBug=function(e){var t=e.navigator?e.navigator.userAgent:null;return!!ce(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},e.latFromMercatorY=lu,e.latLngToECEF=Hl,e.len=il,e.length=Hs,e.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.lngFromMercatorX=su,e.loadVectorTile=Fm,e.makeRequest=Ee,e.mapValue=function(e,t,n,i,r){return U((e-t)/(n-t)*(r-i)+i,i,r)},e.mercatorScale=du,e.mercatorXfromLng=ru,e.mercatorYfromLat=au,e.mercatorZfromAltitude=ou,e.mul=Fs,e.mul$1=nl,e.multiply=Cs,e.multiply$1=Ls,e.multiply$2=Ws,e.nextPowerOfTwo=Y,e.normalize=Ks,e.normalize$1=dl,e.normalize$2=al,e.number=qn,e.ortho=function(e,t,n,i,r,a,o){var s=1/(t-n),l=1/(i-r),u=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*s,e[13]=(r+i)*l,e[14]=(o+a)*u,e[15]=1,e},e.pbf=ah,e.perspective=function(e,t,n,i,r){var a,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+i)*(a=1/(i-r)),e[14]=2*r*i*a):(e[10]=-1,e[14]=-2*i),e},e.pick=function(e,t){for(var n={},i=0;i<t.length;i++){var r=t[i];r in e&&(n[r]=e[r])}return n},e.plugin=Ra,e.pointGeometry=C,e.polesInViewport=function(e){var t=Ms(new Float64Array(16));Cs(t,e.pixelMatrix,e.globeMatrix);var n=[0,El,0],i=[0,Sl,0];return $s(n,n,t),$s(i,i,t),[n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!Kl(e,new nu(e.center.lat,90)),i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!Kl(e,new nu(e.center.lat,-90))]},e.polygonContainsPoint=Du,e.polygonIntersectsBox=Ru,e.polygonIntersectsPolygon=Eu,e.polygonizeBounds=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=new P(n,n),a=e.sub(r),o=t.add(r),s=[a,new P(o.x,a.y),o,new P(a.x,o.y)];return i&&s.push(a.clone()),s},e.posAttributes=pl,e.postMapLoadEvent=Ze,e.postPerformanceEvent=Ke,e.postTurnstileEvent=Ge,e.potpack=zh,e.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.radToDeg=B,e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.registerForPluginStateChange=function(e){return e({pluginStatus:Ma,pluginURL:Aa}),Pa.on("pluginStateChange",e),e},e.removeAuthState=function(e){$e.delete(e)},e.renderColorRamp=tc,e.resample=pu,e.rotateX=zs,e.rotateX$1=ul,e.rotateY=Ds,e.rotateY$1=cl,e.rotateZ=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[0],o=t[1],s=t[2],l=t[3],u=t[4],c=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r+u*i,e[1]=o*r+c*i,e[2]=s*r+d*i,e[3]=l*r+h*i,e[4]=u*r-a*i,e[5]=c*r-o*i,e[6]=d*r-s*i,e[7]=h*r-l*i,e},e.rotateZ$1=function(e,t,n){n*=.5;var i=t[0],r=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*s,e[1]=r*l-i*s,e[2]=a*l+o*s,e[3]=o*l-a*s,e},e.scale=Ps,e.scale$1=rl,e.scale$2=Zs,e.scaleAndAdd=Xs,e.set=function(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e},e.setCacheLimits=function(e,t){ye=e,ge=t},e.setColumn=function(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},e.setRTLTextPlugin=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Ma===Ta||Ma===Ea||Ma===Sa)throw new Error("setRTLTextPlugin cannot be called multiple times.");Aa=lt.resolveURL(e),Ma=Ta,La=t,Ia(),n||Da()},e.smoothstep=j,e.spec=pt,e.squaredLength=function(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i},e.storeAuthState=function(e,t){t?$e.add(e):$e.delete(e)},e.sub=tl,e.subtract=Vs,e.symbolSize=eh,e.tileAABB=function(e,t,n,i,r,a,o,s,l){if("globe"===l.name)return Bl(e,t,new Ed(n,i,r));var u=jf({z:n,x:i,y:r},l);return new vl([(a+u.x/u.scale)*t,t*(u.y/u.scale),o],[(a+u.x2/u.scale)*t,t*(u.y2/u.scale),s])},e.tileCornersToBounds=Fl,e.tileTransform=jf,e.transformMat3=function(e,t,n){var i=t[0],r=t[1],a=t[2];return e[0]=i*n[0]+r*n[3]+a*n[6],e[1]=i*n[1]+r*n[4]+a*n[7],e[2]=i*n[2]+r*n[5]+a*n[8],e},e.transformMat4=$s,e.transformMat4$1=ol,e.transformQuat=Qs,e.transitionTileAABBinECEF=Dl,e.translate=Is,e.transpose=function(e,t){if(e===t){var n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},e.triggerPluginCompletionEvent=Ca,e.uniqueId=X,e.updateGlobeVertexNormal=function(e,t,n,i,r){var a=5*t+2;e.float32[a+0]=n,e.float32[a+1]=i,e.float32[a+2]=r},e.validateCustomStyleLayer=function(e){var t=[],n=e.id;return void 0===n&&t.push({message:"layers.".concat(n,': missing required property "id"')}),void 0===e.render&&t.push({message:"layers.".concat(n,': missing required method "render"')}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:"layers.".concat(n,': property "renderingMode" must be either "2d" or "3d"')}),t},e.validateFilter=function(e){return na(Fr(e))},e.validateFog=function(e){return na(Kr(e))},e.validateLayer=function(e){return na(jr(e))},e.validateLight=function(e){return na(Zr(e))},e.validateSource=function(e){return na(Gr(e))},e.validateStyle=Qr,e.validateTerrain=function(e){return na(Xr(e))},e.values=G,e.vectorTile=Zc,e.version=_,e.warnOnce=re,e.window=v,e.wrap=V})),v(["./shared"],(function(e){function t(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){var n,i="[",r=h(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;i+="".concat(t(a),",")}}catch(c){r.e(c)}finally{r.f()}return"".concat(i,"]")}var o,s="{",l=h(Object.keys(e).sort());try{for(l.s();!(o=l.n()).done;){var u=o.value;s+="".concat(u,":").concat(t(e[u]),",")}}catch(c){l.e(c)}finally{l.f()}return"".concat(s,"}")}function n(n){var i,r="",a=h(e.refProperties);try{for(a.s();!(i=a.n()).done;){var o=i.value;r+="/".concat(t(n[o]))}}catch(s){a.e(s)}finally{a.f()}return r}var i=function(){function t(e){f(this,t),this.keyCache={},e&&this.replace(e)}return p(t,[{key:"replace",value:function(e){this._layerConfigs={},this._layers={},this.update(e,[])}},{key:"update",value:function(t,i){var r,a=this,o=h(t);try{for(o.s();!(r=o.n()).done;){var s=r.value;this._layerConfigs[s.id]=s,(this._layers[s.id]=e.createStyleLayer(s)).compileFilter(),this.keyCache[s.id]&&delete this.keyCache[s.id]}}catch(b){o.e(b)}finally{o.f()}var l,u=h(i);try{for(u.s();!(l=u.n()).done;){var c=l.value;delete this.keyCache[c],delete this._layerConfigs[c],delete this._layers[c]}}catch(b){u.e(b)}finally{u.f()}this.familiesBySource={};var d,f=function(e,t){for(var i={},r=0;r<e.length;r++){var a=t&&t[e[r].id]||n(e[r]);t&&(t[e[r].id]=a);var o=i[a];o||(o=i[a]=[]),o.push(e[r])}var s=[];for(var l in i)s.push(i[l]);return s}(e.values(this._layerConfigs),this.keyCache),p=h(f);try{for(p.s();!(d=p.n()).done;){var m=d.value.map((function(e){return a._layers[e.id]})),y=m[0];if("none"!==y.visibility){var g=y.source||"",v=this.familiesBySource[g];v||(v=this.familiesBySource[g]={});var _=y.sourceLayer||"_geojsonTileLayer",x=v[_];x||(x=v[_]=[]),x.push(m)}}}catch(b){p.e(b)}finally{p.f()}}}]),t}(),r=function(){function t(){f(this,t)}return p(t,[{key:"loadTile",value:function(t,n){var i=t.uid,r=t.encoding,a=t.rawImageData,o=t.padding,s=t.buildQuadTree,l=e.window.ImageBitmap&&a instanceof e.window.ImageBitmap?this.getImageData(a,o):a;n(null,new e.DEMData(i,l,r,o<1,s))}},{key:"getImageData",value:function(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);var n=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),n}}]),t}();function a(e,t){if(0!==e.length){l(e[0],t);for(var n=1;n<e.length;n++)l(e[n],!t)}}function l(e,t){for(var n=0,i=0,r=0,a=e.length,o=a-1;r<a;o=r++){var s=(e[r][0]-e[o][0])*(e[o][1]+e[r][1]),l=n+s;i+=Math.abs(n)>=Math.abs(s)?n-l+s:s-l+n,n=l}n+i>=0!=!!t&&e.reverse()}var u=e.getDefaultExportFromCjs((function e(t,n){var i,r=t&&t.type;if("FeatureCollection"===r)for(i=0;i<t.features.length;i++)e(t.features[i],n);else if("GeometryCollection"===r)for(i=0;i<t.geometries.length;i++)e(t.geometries[i],n);else if("Feature"===r)e(t.geometry,n);else if("Polygon"===r)a(t.coordinates,n);else if("MultiPolygon"===r)for(i=0;i<t.coordinates.length;i++)a(t.coordinates[i],n);return t})),c=e.VectorTileFeature.prototype.toGeoJSON,g={exports:{}},v=e.pointGeometry,_=e.vectorTile.VectorTileFeature,x=b;function b(e,t){this.options=t||{},this.features=e,this.length=e.length}function w(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}b.prototype.feature=function(e){return new w(this.features[e],this.options.extent)},w.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var n=e[t],i=[],r=0;r<n.length;r++)i.push(new v(n[r][0],n[r][1]));this.geometry.push(i)}return this.geometry},w.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,n=-1/0,i=1/0,r=-1/0,a=0;a<e.length;a++)for(var o=e[a],s=0;s<o.length;s++){var l=o[s];t=Math.min(t,l.x),n=Math.max(n,l.x),i=Math.min(i,l.y),r=Math.max(r,l.y)}return[t,i,n,r]},w.prototype.toGeoJSON=_.prototype.toGeoJSON;var k=e.pbf,T=x;function E(e){var t=new k;return function(e,t){for(var n in e.layers)t.writeMessage(3,S,e.layers[n])}(e,t),t.finish()}function S(e,t){var n;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<e.length;n++)i.feature=e.feature(n),t.writeMessage(2,L,i);var r=i.keys;for(n=0;n<r.length;n++)t.writeStringField(3,r[n]);var a=i.values;for(n=0;n<a.length;n++)t.writeMessage(4,P,a[n])}function L(e,t){var n=e.feature;void 0!==n.id&&t.writeVarintField(1,n.id),t.writeMessage(2,M,e),t.writeVarintField(3,n.type),t.writeMessage(4,I,n)}function M(e,t){var n=e.feature,i=e.keys,r=e.values,a=e.keycache,o=e.valuecache;for(var s in n.properties){var l=n.properties[s],u=a[s];if(null!==l){void 0===u&&(i.push(s),a[s]=u=i.length-1),t.writeVarint(u);var c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var d=c+":"+l,h=o[d];void 0===h&&(r.push(l),o[d]=h=r.length-1),t.writeVarint(h)}}}function A(e,t){return(t<<3)+(7&e)}function C(e){return e<<1^e>>31}function I(e,t){for(var n=e.loadGeometry(),i=e.type,r=0,a=0,o=n.length,s=0;s<o;s++){var l=n[s],u=1;1===i&&(u=l.length),t.writeVarint(A(1,u));for(var c=3===i?l.length-1:l.length,d=0;d<c;d++){1===d&&1!==i&&t.writeVarint(A(2,c-1));var h=l[d].x-r,f=l[d].y-a;t.writeVarint(C(h)),t.writeVarint(C(f)),r+=h,a+=f}3===i&&t.writeVarint(A(7,1))}}function P(e,t){var n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}g.exports=E,g.exports.fromVectorTileJs=E,g.exports.fromGeojsonVt=function(e,t){t=t||{};var n={};for(var i in e)n[i]=new T(e[i].features,t),n[i].name=i,n[i].version=t.version,n[i].extent=t.extent;return E({layers:n})},g.exports.GeoJSONWrapper=T;var z,D=e.getDefaultExportFromCjs(g.exports),R={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},B=Math.fround||(z=new Float32Array(1),function(e){return z[0]=+e,z[0]}),F=3,O=5,N=6,H=function(){function t(e){f(this,t),this.options=Object.assign(Object.create(R),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}return p(t,[{key:"load",value:function(e){var t=this.options,n=t.log,i=t.minZoom,r=t.maxZoom;n&&console.time("total time");var a="prepare ".concat(e.length," points");n&&console.time(a),this.points=e;for(var o=[],s=0;s<e.length;s++){var l=e[s];if(l.geometry){var u=d(l.geometry.coordinates,2),c=u[0],h=u[1],f=B(V(c)),p=B(W(h));o.push(f,p,1/0,s,-1,1),this.options.reduce&&o.push(0)}}var m=this.trees[r+1]=this._createTree(o);n&&console.timeEnd(a);for(var y=r;y>=i;y--){var g=+Date.now();m=this.trees[y]=this._createTree(this._cluster(m,y)),n&&console.log("z%d: %d clusters in %dms",y,m.numItems,+Date.now()-g)}return n&&console.timeEnd("total time"),this}},{key:"getClusters",value:function(e,t){var n=((e[0]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,e[1])),r=180===e[2]?180:((e[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,r=180;else if(n>r){var o=this.getClusters([n,i,180,a],t),s=this.getClusters([-180,i,r,a],t);return o.concat(s)}var l,u=this.trees[this._limitZoom(t)],c=u.range(V(n),W(a),V(r),W(i)),d=u.data,f=[],p=h(c);try{for(p.s();!(l=p.n()).done;){var m=l.value,y=this.stride*m;f.push(d[y+O]>1?U(d,y,this.clusterProps):this.points[d[y+F]])}}catch(g){p.e(g)}finally{p.f()}return f}},{key:"getChildren",value:function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);var a=r.data;if(t*this.stride>=a.length)throw new Error(i);var o,s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),l=r.within(a[t*this.stride],a[t*this.stride+1],s),u=[],c=h(l);try{for(c.s();!(o=c.n()).done;){var d=o.value*this.stride;a[d+4]===e&&u.push(a[d+O]>1?U(a,d,this.clusterProps):this.points[a[d+F]])}}catch(f){c.e(f)}finally{c.f()}if(0===u.length)throw new Error(i);return u}},{key:"getLeaves",value:function(e,t,n){var i=[];return this._appendLeaves(i,e,t=t||10,n=n||0,0),i}},{key:"getTile",value:function(e,t,n){var i=this.trees[this._limitZoom(e)],r=Math.pow(2,e),a=this.options,o=a.extent,s=a.radius/o,l=(n-s)/r,u=(n+1+s)/r,c={features:[]};return this._addTileFeatures(i.range((t-s)/r,l,(t+1+s)/r,u),i.data,t,n,r,c),0===t&&this._addTileFeatures(i.range(1-s/r,l,1,u),i.data,r,n,r,c),t===r-1&&this._addTileFeatures(i.range(0,l,s/r,u),i.data,-1,n,r,c),c.features.length?c:null}},{key:"getClusterExpansionZoom",value:function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}},{key:"_appendLeaves",value:function(e,t,n,i,r){var a,o=this.getChildren(t),s=h(o);try{for(s.s();!(a=s.n()).done;){var l=a.value,u=l.properties;if(u&&u.cluster?r+u.point_count<=i?r+=u.point_count:r=this._appendLeaves(e,u.cluster_id,n,i,r):r<i?r++:e.push(l),e.length===n)break}}catch(c){s.e(c)}finally{s.f()}return r}},{key:"_createTree",value:function(t){for(var n=new e.KDBush(t.length/this.stride|0,this.options.nodeSize,Float32Array),i=0;i<t.length;i+=this.stride)n.add(t[i],t[i+1]);return n.finish(),n.data=t,n}},{key:"_addTileFeatures",value:function(e,t,n,i,r,a){var o,s=h(e);try{for(s.s();!(o=s.n()).done;){var l=o.value*this.stride,u=t[l+O]>1,c=void 0,f=void 0,p=void 0;if(u)c=j(t,l,this.clusterProps),f=t[l],p=t[l+1];else{var m=this.points[t[l+F]];c=m.properties;var y=d(m.geometry.coordinates,2),g=y[0],v=y[1];f=V(g),p=W(v)}var _={type:1,geometry:[[Math.round(this.options.extent*(f*r-n)),Math.round(this.options.extent*(p*r-i))]],tags:c},x=void 0;void 0!==(x=u||this.options.generateId?t[l+F]:this.points[t[l+F]].id)&&(_.id=x),a.features.push(_)}}catch(b){s.e(b)}finally{s.f()}}},{key:"_limitZoom",value:function(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}},{key:"_cluster",value:function(e,t){for(var n=this.options,i=n.radius,r=n.extent,a=n.reduce,o=n.minPoints,s=i/(r*Math.pow(2,t)),l=e.data,u=[],c=this.stride,d=0;d<l.length;d+=c)if(!(l[d+2]<=t)){l[d+2]=t;var f,p=l[d],m=l[d+1],y=e.within(l[d],l[d+1],s),g=l[d+O],v=g,_=h(y);try{for(_.s();!(f=_.n()).done;){var x=f.value*c;l[x+2]>t&&(v+=l[x+O])}}catch(R){_.e(R)}finally{_.f()}if(v>g&&v>=o){var b,w=void 0,k=p*g,T=m*g,E=-1,S=((d/c|0)<<5)+(t+1)+this.points.length,L=h(y);try{for(L.s();!(b=L.n()).done;){var M=b.value*c;if(!(l[M+2]<=t)){l[M+2]=t;var A=l[M+O];k+=l[M]*A,T+=l[M+1]*A,l[M+4]=S,a&&(w||(w=this._map(l,d,!0),E=this.clusterProps.length,this.clusterProps.push(w)),a(w,this._map(l,M)))}}}catch(R){L.e(R)}finally{L.f()}l[d+4]=S,u.push(k/v,T/v,1/0,S,-1,v),a&&u.push(E)}else{for(var C=0;C<c;C++)u.push(l[d+C]);if(v>1){var I,P=h(y);try{for(P.s();!(I=P.n()).done;){var z=I.value*c;if(!(l[z+2]<=t)){l[z+2]=t;for(var D=0;D<c;D++)u.push(l[z+D])}}}catch(R){P.e(R)}finally{P.f()}}}}return u}},{key:"_getOriginId",value:function(e){return e-this.points.length>>5}},{key:"_getOriginZoom",value:function(e){return(e-this.points.length)%32}},{key:"_map",value:function(e,t,n){if(e[t+O]>1){var i=this.clusterProps[e[t+N]];return n?Object.assign({},i):i}var r=this.points[e[t+F]].properties,a=this.options.map(r);return n&&a===r?Object.assign({},a):a}}]),t}();function U(e,t,n){return{type:"Feature",id:e[t+F],properties:j(e,t,n),geometry:{type:"Point",coordinates:[(i=e[t],360*(i-.5)),G(e[t+1])]}};var i}function j(e,t,n){var i=e[t+O],r=i>=1e4?"".concat(Math.round(i/1e3),"k"):i>=1e3?Math.round(i/100)/10+"k":i,a=e[t+N],o=-1===a?{}:Object.assign({},n[a]);return Object.assign(o,{cluster:!0,cluster_id:e[t+F],point_count:i,point_count_abbreviated:r})}function V(e){return e/360+.5}function W(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function G(e){var t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function q(e,t,n,i){for(var r,a=i,o=n-t>>1,s=n-t,l=e[t],u=e[t+1],c=e[n],d=e[n+1],h=t+3;h<n;h+=3){var f=Z(e[h],e[h+1],l,u,c,d);if(f>a)r=h,a=f;else if(f===a){var p=Math.abs(h-o);p<s&&(r=h,s=p)}}a>i&&(r-t>3&&q(e,t,r,i),e[r+2]=a,n-r>3&&q(e,r,n,i))}function Z(e,t,n,i,r,a){var o=r-n,s=a-i;if(0!==o||0!==s){var l=((e-n)*o+(t-i)*s)/(o*o+s*s);l>1?(n=r,i=a):l>0&&(n+=o*l,i+=s*l)}return(o=e-n)*o+(s=t-i)*s}function X(e,t,n,i){var r={id:void 0===e?null:e,type:t,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)K(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<t.length;i++)K(e,t[i]);else if("MultiPolygon"===n)for(i=0;i<t.length;i++)for(var r=0;r<t[i].length;r++)K(e,t[i][r])}(r),r}function K(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function Y(e,t,n,i){if(t.geometry){var r=t.geometry.coordinates,a=t.geometry.type,o=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],l=t.id;if(n.promoteId?l=t.properties[n.promoteId]:n.generateId&&(l=i||0),"Point"===a)J(r,s);else if("MultiPoint"===a)for(var u=0;u<r.length;u++)J(r[u],s);else if("LineString"===a)$(r,s,o,!1);else if("MultiLineString"===a){if(n.lineMetrics){for(u=0;u<r.length;u++)$(r[u],s=[],o,!1),e.push(X(l,"LineString",s,t.properties));return}Q(r,s,o,!1)}else if("Polygon"===a)Q(r,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(u=0;u<t.geometry.geometries.length;u++)Y(e,{id:l,geometry:t.geometry.geometries[u],properties:t.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<r.length;u++){var c=[];Q(r[u],c,o,!0),s.push(c)}}e.push(X(l,a,s,t.properties))}}function J(e,t){t.push(ee(e[0])),t.push(te(e[1])),t.push(0)}function $(e,t,n,i){for(var r,a,o=0,s=0;s<e.length;s++){var l=ee(e[s][0]),u=te(e[s][1]);t.push(l),t.push(u),t.push(0),s>0&&(o+=i?(r*u-l*a)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(u-a,2))),r=l,a=u}var c=t.length-3;t[2]=1,q(t,0,c,n),t[c+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function Q(e,t,n,i){for(var r=0;r<e.length;r++){var a=[];$(e[r],a,n,i),t.push(a)}}function ee(e){return e/360+.5}function te(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function ne(e,t,n,i,r,a,o,s){if(i/=t,a>=(n/=t)&&o<i)return e;if(o<n||a>=i)return null;for(var l=[],u=0;u<e.length;u++){var c=e[u],d=c.geometry,h=c.type,f=0===r?c.minX:c.minY,p=0===r?c.maxX:c.maxY;if(f>=n&&p<i)l.push(c);else if(!(p<n||f>=i)){var m=[];if("Point"===h||"MultiPoint"===h)ie(d,m,n,i,r);else if("LineString"===h)re(d,m,n,i,r,!1,s.lineMetrics);else if("MultiLineString"===h)oe(d,m,n,i,r,!1);else if("Polygon"===h)oe(d,m,n,i,r,!0);else if("MultiPolygon"===h)for(var y=0;y<d.length;y++){var g=[];oe(d[y],g,n,i,r,!0),g.length&&m.push(g)}if(m.length){if(s.lineMetrics&&"LineString"===h){for(y=0;y<m.length;y++)l.push(X(c.id,h,m[y],c.tags));continue}"LineString"!==h&&"MultiLineString"!==h||(1===m.length?(h="LineString",m=m[0]):h="MultiLineString"),"Point"!==h&&"MultiPoint"!==h||(h=3===m.length?"Point":"MultiPoint"),l.push(X(c.id,h,m,c.tags))}}}return l.length?l:null}function ie(e,t,n,i,r){for(var a=0;a<e.length;a+=3){var o=e[a+r];o>=n&&o<=i&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function re(e,t,n,i,r,a,o){for(var s,l,u=ae(e),c=0===r?le:ue,d=e.start,h=0;h<e.length-3;h+=3){var f=e[h],p=e[h+1],m=e[h+2],y=e[h+3],g=e[h+4],v=0===r?f:p,_=0===r?y:g,x=!1;o&&(s=Math.sqrt(Math.pow(f-y,2)+Math.pow(p-g,2))),v<n?_>n&&(l=c(u,f,p,y,g,n),o&&(u.start=d+s*l)):v>i?_<i&&(l=c(u,f,p,y,g,i),o&&(u.start=d+s*l)):se(u,f,p,m),_<n&&v>=n&&(l=c(u,f,p,y,g,n),x=!0),_>i&&v<=i&&(l=c(u,f,p,y,g,i),x=!0),!a&&x&&(o&&(u.end=d+s*l),t.push(u),u=ae(e)),o&&(d+=s)}var b=e.length-3;f=e[b],p=e[b+1],m=e[b+2],(v=0===r?f:p)>=n&&v<=i&&se(u,f,p,m),b=u.length-3,a&&b>=3&&(u[b]!==u[0]||u[b+1]!==u[1])&&se(u,u[0],u[1],u[2]),u.length&&t.push(u)}function ae(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function oe(e,t,n,i,r,a){for(var o=0;o<e.length;o++)re(e[o],t,n,i,r,a,!1)}function se(e,t,n,i){e.push(t),e.push(n),e.push(i)}function le(e,t,n,i,r,a){var o=(a-t)/(i-t);return e.push(a),e.push(n+(r-n)*o),e.push(1),o}function ue(e,t,n,i,r,a){var o=(a-n)/(r-n);return e.push(t+(i-t)*o),e.push(a),e.push(1),o}function ce(e,t){for(var n=[],i=0;i<e.length;i++){var r,a=e[i],o=a.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)r=de(a.geometry,t);else if("MultiLineString"===o||"Polygon"===o){r=[];for(var s=0;s<a.geometry.length;s++)r.push(de(a.geometry[s],t))}else if("MultiPolygon"===o)for(r=[],s=0;s<a.geometry.length;s++){for(var l=[],u=0;u<a.geometry[s].length;u++)l.push(de(a.geometry[s][u],t));r.push(l)}n.push(X(a.id,o,r,a.tags))}return n}function de(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var i=0;i<e.length;i+=3)n.push(e[i]+t,e[i+1],e[i+2]);return n}function he(e,t){if(e.transformed)return e;var n,i,r,a=1<<e.z,o=e.x,s=e.y;for(n=0;n<e.features.length;n++){var l=e.features[n],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(i=0;i<u.length;i+=2)l.geometry.push(fe(u[i],u[i+1],t,a,o,s));else for(i=0;i<u.length;i++){var d=[];for(r=0;r<u[i].length;r+=2)d.push(fe(u[i][r],u[i][r+1],t,a,o,s));l.geometry.push(d)}}return e.transformed=!0,e}function fe(e,t,n,i,r,a){return[Math.round(n*(e*i-r)),Math.round(n*(t*i-a))]}function pe(e,t,n,i,r){for(var a=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){o.numFeatures++,me(o,e[s],a,r);var l=e[s].minX,u=e[s].minY,c=e[s].maxX,d=e[s].maxY;l<o.minX&&(o.minX=l),u<o.minY&&(o.minY=u),c>o.maxX&&(o.maxX=c),d>o.maxY&&(o.maxY=d)}return o}function me(e,t,n,i){var r=t.geometry,a=t.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<r.length;s+=3)o.push(r[s]),o.push(r[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===a)ye(o,r,e,n,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<r.length;s++)ye(o,r[s],e,n,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var l=0;l<r.length;l++){var u=r[l];for(s=0;s<u.length;s++)ye(o,u[s],e,n,!0,0===s)}if(o.length){var c=t.tags||null;if("LineString"===a&&i.lineMetrics){for(var d in c={},t.tags)c[d]=t.tags[d];c.mapbox_clip_start=r.start/r.size,c.mapbox_clip_end=r.end/r.size}var h={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:c};null!==t.id&&(h.id=t.id),e.features.push(h)}}function ye(e,t,n,i,r,a){var o=i*i;if(i>0&&t.size<(r?o:i))n.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===i||t[l+2]>o)&&(n.numSimplified++,s.push(t[l]),s.push(t[l+1])),n.numPoints++;r&&function(e,t){for(var n=0,i=0,r=e.length,a=r-2;i<r;a=i,i+=2)n+=(e[i]-e[a])*(e[i+1]+e[a+1]);if(n>0===t)for(i=0,r=e.length;i<r/2;i+=2){var o=e[i],s=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=o,e[r-1-i]=s}}(s,a),e.push(s)}}function ge(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)Y(n,e.features[i],t,i);else Y(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(e,t){var n=t.buffer/t.extent,i=e,r=ne(e,1,-1-n,n,0,-1,2,t),a=ne(e,1,1-n,2+n,0,-1,2,t);return(r||a)&&(i=ne(e,1,-n,1+n,0,-1,2,t)||[],r&&(i=ce(r,1).concat(i)),a&&(i=i.concat(ce(a,-1)))),i}(i,t),i.length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ve(e,t,n){return 32*((1<<e)*n+t)+e}function _e(t,n){var i=t.tileID.canonical;if(!this._geoJSONIndex)return n(null,null);var r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return n(null,null);var a=new(function(){function t(n){f(this,t),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.EXTENT,this.length=n.length,this._features=n}return p(t,[{key:"feature",value:function(t){return new(function(){function t(n){f(this,t),this._feature=n,this.extent=e.EXTENT,this.type=n.type,this.properties=n.tags,"id"in n&&!isNaN(n.id)&&(this.id=parseInt(n.id,10))}return p(t,[{key:"loadGeometry",value:function(){if(1===this._feature.type){var t,n=[],i=h(this._feature.geometry);try{for(i.s();!(t=i.n()).done;){var r=t.value;n.push([new e.Point(r[0],r[1])])}}catch(p){i.e(p)}finally{i.f()}return n}var a,o=[],s=h(this._feature.geometry);try{for(s.s();!(a=s.n()).done;){var l,u=a.value,c=[],d=h(u);try{for(d.s();!(l=d.n()).done;){var f=l.value;c.push(new e.Point(f[0],f[1]))}}catch(p){d.e(p)}finally{d.f()}o.push(c)}}catch(p){s.e(p)}finally{s.f()}return o}},{key:"toGeoJSON",value:function(e,t,n){return c.call(this,e,t,n)}}]),t}())(this._features[t])}}]),t}())(r.features),o=D(a);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),n(null,{vectorTile:a,rawData:o.buffer})}ge.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ge.prototype.splitTile=function(e,t,n,i,r,a,o){for(var s=[e,t,n,i],l=this.options,u=l.debug;s.length;){i=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,d=ve(t,n,i),h=this.tiles[d];if(!h&&(u>1&&console.time("creation"),h=this.tiles[d]=pe(e,t,n,i,l),this.tileCoords.push({z:t,x:n,y:i}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,i,h.numFeatures,h.numPoints,h.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(h.source=e,r){if(t===l.maxZoom||t===r)continue;var p=1<<r-t;if(n!==Math.floor(a/p)||i!==Math.floor(o/p))continue}else if(t===l.indexMaxZoom||h.numPoints<=l.indexMaxPoints)continue;if(h.source=null,0!==e.length){u>1&&console.time("clipping");var m,y,g,v,_,x,b=.5*l.buffer/l.extent,w=.5-b,k=.5+b,T=1+b;m=y=g=v=null,_=ne(e,c,n-b,n+k,0,h.minX,h.maxX,l),x=ne(e,c,n+w,n+T,0,h.minX,h.maxX,l),e=null,_&&(m=ne(_,c,i-b,i+k,1,h.minY,h.maxY,l),y=ne(_,c,i+w,i+T,1,h.minY,h.maxY,l),_=null),x&&(g=ne(x,c,i-b,i+k,1,h.minY,h.maxY,l),v=ne(x,c,i+w,i+T,1,h.minY,h.maxY,l),x=null),u>1&&console.timeEnd("clipping"),s.push(m||[],t+1,2*n,2*i),s.push(y||[],t+1,2*n,2*i+1),s.push(g||[],t+1,2*n+1,2*i),s.push(v||[],t+1,2*n+1,2*i+1)}}},ge.prototype.getTile=function(e,t,n){var i=this.options,r=i.extent,a=i.debug;if(e<0||e>24)return null;var o=1<<e,s=ve(e,t=(t%o+o)%o,n);if(this.tiles[s])return he(this.tiles[s],r);a>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var l,u=e,c=t,d=n;!l&&u>0;)u--,c=Math.floor(c/2),d=Math.floor(d/2),l=this.tiles[ve(u,c,d)];return l&&l.source?(a>1&&console.log("found parent tile z%d-%d-%d",u,c,d),a>1&&console.time("drilling down"),this.splitTile(l.source,u,c,d,e,t,n),a>1&&console.timeEnd("drilling down"),this.tiles[s]?he(this.tiles[s],r):null):null};var xe=function(t){m(i,t);var n=y(i);function i(e,t,r,a,o){var s;return f(this,i),s=n.call(this,e,t,r,a,_e),o&&(s.loadGeoJSON=o),s}return p(i,[{key:"loadData",value:function(t,n){var i=this,r=t&&t.request,a=r&&r.collectResourceTiming;this.loadGeoJSON(t,(function(o,s){if(o||!s)return n(o);if("object"!=typeof s)return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));u(s,!0);try{if(t.filter){var l=e.createExpression(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===l.result)throw new Error(l.value.map((function(e){return"".concat(e.key,": ").concat(e.message)})).join(", "));var c=s.features.filter((function(e){return l.value.evaluate({zoom:0},e)}));s={type:"FeatureCollection",features:c}}i._geoJSONIndex=t.cluster?new H(function(t){var n=t.superclusterOptions,i=t.clusterProperties;if(!i||!n)return n;for(var r={},a={},o={accumulated:null,zoom:0},s={properties:null},l=Object.keys(i),u=0,c=l;u<c.length;u++){var h=c[u],f=d(i[h],2),p=f[0],m=f[1],y=e.createExpression(m),g=e.createExpression("string"==typeof p?[p,["accumulated"],["get",h]]:p);r[h]=y.value,a[h]=g.value}return n.map=function(e){s.properties=e;for(var t={},n=0,i=l;n<i.length;n++){var a=i[n];t[a]=r[a].evaluate(o,s)}return t},n.reduce=function(e,t){s.properties=t;for(var n=0,i=l;n<i.length;n++){var r=i[n];o.accumulated=e[r],e[r]=a[r].evaluate(o,s)}},n}(t)).load(s.features):function(e,t){return new ge(e,t)}(s,t.geojsonVtOptions)}catch(o){return n(o)}i.loaded={};var h={};if(a){var f=e.getPerformanceMeasurement(r);f&&(h.resourceTiming={},h.resourceTiming[t.source]=JSON.parse(JSON.stringify(f)))}n(null,h)}))}},{key:"reloadTile",value:function(e,t){var n=this.loaded;return n&&n[e.uid]?o(s(i.prototype),"reloadTile",this).call(this,e,t):this.loadTile(e,t)}},{key:"loadGeoJSON",value:function(t,n){if(t.request)e.getJSON(t.request,n);else{if("string"!=typeof t.data)return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));try{return n(null,JSON.parse(t.data))}catch(e){return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")))}}}},{key:"getClusterExpansionZoom",value:function(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}},{key:"getClusterChildren",value:function(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}},{key:"getClusterLeaves",value:function(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}]),i}(e.VectorTileWorkerSource),be=function(){function t(n){var i=this;f(this,t),this.self=n,this.actor=new e.Actor(n,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.getProjection({name:"mercator"}),this.workerSourceTypes={vector:e.VectorTileWorkerSource,geojson:xe},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(e,t){if(i.workerSourceTypes[e])throw new Error('Worker source with name "'.concat(e,'" already registered.'));i.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=function(t){if(e.plugin.isParsed())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}}return p(t,[{key:"clearCaches",value:function(e,t,n){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],n()}},{key:"checkIfReady",value:function(e,t,n){n()}},{key:"setReferrer",value:function(e,t){this.referrer=t}},{key:"spriteLoaded",value:function(t,n){for(var i in this.isSpriteLoaded[t]=n,this.workerSources[t]){var r=this.workerSources[t][i];for(var a in r)r[a]instanceof e.VectorTileWorkerSource&&(r[a].isSpriteLoaded=n,r[a].fire(new e.Event("isSpriteLoaded")))}}},{key:"setImages",value:function(e,t,n){for(var i in this.availableImages[e]=t,this.workerSources[e]){var r=this.workerSources[e][i];for(var a in r)r[a].availableImages=t}n()}},{key:"enableTerrain",value:function(e,t,n){this.terrain=t,n()}},{key:"setProjection",value:function(t,n){this.projections[t]=e.getProjection(n)}},{key:"setLayers",value:function(e,t,n){this.getLayerIndex(e).replace(t),n()}},{key:"updateLayers",value:function(e,t,n){this.getLayerIndex(e).update(t.layers,t.removedIds),n()}},{key:"loadTile",value:function(t,n,i){var r=this.enableTerrain?e.extend({enableTerrain:this.terrain},n):n;r.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,n.type,n.source).loadTile(r,i)}},{key:"loadDEMTile",value:function(t,n,i){var r=this.enableTerrain?e.extend({buildQuadTree:this.terrain},n):n;this.getDEMWorkerSource(t,n.source).loadTile(r,i)}},{key:"reloadTile",value:function(t,n,i){var r=this.enableTerrain?e.extend({enableTerrain:this.terrain},n):n;r.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,n.type,n.source).reloadTile(r,i)}},{key:"abortTile",value:function(e,t,n){this.getWorkerSource(e,t.type,t.source).abortTile(t,n)}},{key:"removeTile",value:function(e,t,n){this.getWorkerSource(e,t.type,t.source).removeTile(t,n)}},{key:"removeSource",value:function(e,t,n){if(this.workerSources[e]&&this.workerSources[e][t.type]&&this.workerSources[e][t.type][t.source]){var i=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,n):n()}}},{key:"loadWorkerSource",value:function(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}}},{key:"syncRTLPluginState",value:function(t,n,i){try{e.plugin.setState(n);var r=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&null!=r){this.self.importScripts(r);var a=e.plugin.isParsed();i(a?void 0:new Error("RTL Text Plugin failed to import scripts from ".concat(r)),a)}}catch(e){i(e.toString())}}},{key:"getAvailableImages",value:function(e){var t=this.availableImages[e];return t||(t=[]),t}},{key:"getLayerIndex",value:function(e){var t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new i),t}},{key:"getWorkerSource",value:function(e,t,n){var i=this;if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][n]){var r={send:function(t,n,r,a,o,s){i.actor.send(t,n,r,e,o,s)},scheduler:this.actor.scheduler};this.workerSources[e][t][n]=new this.workerSourceTypes[t](r,this.getLayerIndex(e),this.getAvailableImages(e),this.isSpriteLoaded[e])}return this.workerSources[e][t][n]}},{key:"getDEMWorkerSource",value:function(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new r),this.demWorkerSources[e][t]}},{key:"enforceCacheSizeLimit",value:function(t,n){e.enforceCacheSizeLimit(n)}},{key:"getWorkerPerformanceMetrics",value:function(e,t,n){n(void 0,void 0)}}]),t}();return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new be(self)),be})),v(["./shared"],(function(e){function t(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(var i=0;i<e.length;i++)if(!t(e[i],n[i]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(e).length!==Object.keys(n).length)return!1;for(var r in e)if(!t(e[r],n[r]))return!1;return!0}return e===n}var n=u;function u(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{t=new Worker(i),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(i),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var n=t.getImageData(0,0,1,1);return n&&n.width===e.width}()?(void 0===g[t=e&&e.failIfMajorPerformanceCaveat]&&(g[t]=function(e){var t,n=function(e){var t=document.createElement("canvas"),n=Object.create(u.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=e,t.getContext("webgl",n)||t.getContext("experimental-webgl",n)}(e);if(!n)return!1;try{t=n.createShader(n.VERTEX_SHADER)}catch(e){return!1}return!(!t||n.isContextLost())&&(n.shaderSource(t,"void main() {}"),n.compileShader(t),!0===n.getShaderParameter(t,n.COMPILE_STATUS))}(t)),g[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var g={};function v(t,n,i){var r=e.window.document.createElement(t);return void 0!==n&&(r.className=n),i&&i.appendChild(r),r}function _(t,n,i){for(var r=e.window.document.createElementNS("http://www.w3.org/2000/svg",t),a=0,o=Object.keys(n);a<o.length;a++){var s=o[a];r.setAttributeNS(null,s,n[s])}return i&&i.appendChild(r),r}u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};var x,b=e.window.document&&e.window.document.documentElement.style,w=b&&void 0!==b.userSelect?"userSelect":"WebkitUserSelect";function k(){b&&w&&(x=b[w],b[w]="none")}function T(){b&&w&&(b[w]=x)}function E(t){t.preventDefault(),t.stopPropagation(),e.window.removeEventListener("click",E,!0)}function S(){e.window.addEventListener("click",E,!0),e.window.setTimeout((function(){e.window.removeEventListener("click",E,!0)}),0)}function L(e,t){var n=e.getBoundingClientRect();return C(e,n,t)}function M(e,t){for(var n=e.getBoundingClientRect(),i=[],r=0;r<t.length;r++)i.push(C(e,n,t[r]));return i}function A(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function C(t,n,i){var r=t.offsetWidth===n.width?1:t.offsetWidth/n.width;return new e.Point((i.clientX-n.left)*r,(i.clientY-n.top)*r)}function I(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=n*a-r*i;return o?(e[0]=a*(o=1/o),e[1]=-i*o,e[2]=-r*o,e[3]=n*o,e):null}function P(e){var t=e.userImage;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}var z=function(t){m(i,t);var n=y(i);function i(){var t;return f(this,i),(t=n.call(this)).images={},t.updatedImages={},t.callbackDispatchedThisFrame={},t.loaded=!1,t.requestors=[],t.patterns={},t.atlasImage=new e.RGBAImage({width:1,height:1}),t.dirty=!0,t}return p(i,[{key:"isLoaded",value:function(){return this.loaded}},{key:"setLoaded",value:function(e){if(this.loaded!==e&&(this.loaded=e,e)){var t,n=h(this.requestors);try{for(n.s();!(t=n.n()).done;){var i=t.value,r=i.ids,a=i.callback;this._notify(r,a)}}catch(o){n.e(o)}finally{n.f()}this.requestors=[]}}},{key:"hasImage",value:function(e){return!!this.getImage(e)}},{key:"getImage",value:function(e){return this.images[e]}},{key:"addImage",value:function(e,t){this._validate(e,t)&&(this.images[e]=t)}},{key:"_validate",value:function(t,n){var i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new e.ErrorEvent(new Error('Image "'.concat(t,'" has invalid "stretchX" value')))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new e.ErrorEvent(new Error('Image "'.concat(t,'" has invalid "stretchY" value')))),i=!1),this._validateContent(n.content,n)||(this.fire(new e.ErrorEvent(new Error('Image "'.concat(t,'" has invalid "content" value')))),i=!1),i}},{key:"_validateStretch",value:function(e,t){if(!e)return!0;var n,i=0,r=h(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a[0]<i||a[1]<a[0]||t<a[1])return!1;i=a[1]}}catch(o){r.e(o)}finally{r.f()}return!0}},{key:"_validateContent",value:function(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}},{key:"updateImage",value:function(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0}},{key:"removeImage",value:function(e){var t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}},{key:"listImages",value:function(){return Object.keys(this.images)}},{key:"getImages",value:function(e,t){var n=!0;if(!this.isLoaded()){var i,r=h(e);try{for(r.s();!(i=r.n()).done;){var a=i.value;this.images[a]||(n=!1)}}catch(o){r.e(o)}finally{r.f()}}this.isLoaded()||n?this._notify(e,t):this.requestors.push({ids:e,callback:t})}},{key:"_notify",value:function(t,n){var i,r={},a=h(t);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.images[o]||this.fire(new e.Event("styleimagemissing",{id:o}));var s=this.images[o];s?r[o]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:e.warnOnce('Image "'.concat(o,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'))}}catch(l){a.e(l)}finally{a.f()}n(null,r)}},{key:"getPixelSize",value:function(){var e=this.atlasImage;return{width:e.width,height:e.height}}},{key:"getPattern",value:function(t){var n=this.patterns[t],i=this.getImage(t);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{var r={w:i.data.width+2,h:i.data.height+2,x:0,y:0},a=new e.ImagePosition(r,i);this.patterns[t]={bin:r,position:a}}return this._updatePatternAtlas(),this.patterns[t].position}},{key:"bind",value:function(t){var n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture(t,this.atlasImage,n.RGBA),this.atlasTexture&&this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}},{key:"_updatePatternAtlas",value:function(){var t=[];for(var n in this.patterns)t.push(this.patterns[n].bin);var i=e.potpack(t),r=i.w,a=i.h,o=this.atlasImage;for(var s in o.resize({width:r||1,height:a||1}),this.patterns){var l=this.patterns[s].bin,u=l.x+1,c=l.y+1,d=this.images[s].data,h=d.width,f=d.height;e.RGBAImage.copy(d,o,{x:0,y:0},{x:u,y:c},{width:h,height:f}),e.RGBAImage.copy(d,o,{x:0,y:f-1},{x:u,y:c-1},{width:h,height:1}),e.RGBAImage.copy(d,o,{x:0,y:0},{x:u,y:c+f},{width:h,height:1}),e.RGBAImage.copy(d,o,{x:h-1,y:0},{x:u-1,y:c},{width:1,height:f}),e.RGBAImage.copy(d,o,{x:0,y:0},{x:u+h,y:c},{width:1,height:f})}this.dirty=!0}},{key:"beginFrame",value:function(){this.callbackDispatchedThisFrame={}}},{key:"dispatchRenderCallbacks",value:function(e){var t,n=h(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!this.callbackDispatchedThisFrame[i]){this.callbackDispatchedThisFrame[i]=!0;var r=this.images[i];P(r)&&this.updateImage(i,r)}}}catch(a){n.e(a)}finally{n.f()}}}]),i}(e.Evented),D=new e.Properties({anchor:new e.DataConstantProperty(e.spec.light.anchor),position:new(function(){function t(){f(this,t),this.specification=e.spec.light.position}return p(t,[{key:"possiblyEvaluate",value:function(t,n){return function(t){var n=d(t,3),i=n[0],r=n[1],a=n[2],o=e.degToRad(r+90),s=e.degToRad(a);return{x:i*Math.cos(o)*Math.sin(s),y:i*Math.sin(o)*Math.sin(s),z:i*Math.cos(s),azimuthal:r,polar:a}}(t.expression.evaluate(n))}},{key:"interpolate",value:function(t,n,i){return{x:e.number(t.x,n.x,i),y:e.number(t.y,n.y,i),z:e.number(t.z,n.z,i),azimuthal:e.number(t.azimuthal,n.azimuthal,i),polar:e.number(t.polar,n.polar,i)}}}]),t}()),color:new e.DataConstantProperty(e.spec.light.color),intensity:new e.DataConstantProperty(e.spec.light.intensity)}),R=function(t){m(i,t);var n=y(i);function i(t){var r;return f(this,i),(r=n.call(this))._transitionable=new e.Transitionable(D),r.setLight(t),r._transitioning=r._transitionable.untransitioned(),r}return p(i,[{key:"getLight",value:function(){return this._transitionable.serialize()}},{key:"setLight",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._validate(e.validateLight,t,n))for(var i in t){var r=t[i];e.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),r):this._transitionable.setValue(i,r)}}},{key:"updateTransitions",value:function(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}},{key:"hasTransition",value:function(){return this._transitioning.hasTransition()}},{key:"recalculate",value:function(e){this.properties=this._transitioning.possiblyEvaluate(e)}},{key:"_validate",value:function(t,n,i){return(!i||!1!==i.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}]),i}(e.Evented),B=new e.Properties({source:new e.DataConstantProperty(e.spec.terrain.source),exaggeration:new e.DataConstantProperty(e.spec.terrain.exaggeration)}),F=function(t){m(i,t);var n=y(i);function i(t,r){var a;return f(this,i),(a=n.call(this))._transitionable=new e.Transitionable(B),a.set(t),a._transitioning=a._transitionable.untransitioned(),a.drapeRenderMode=r,a}return p(i,[{key:"get",value:function(){return this._transitionable.serialize()}},{key:"set",value:function(t){for(var n in t){var i=t[n];e.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-11),i):this._transitionable.setValue(n,i)}}},{key:"updateTransitions",value:function(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}},{key:"hasTransition",value:function(){return this._transitioning.hasTransition()}},{key:"recalculate",value:function(e){this.properties=this._transitioning.possiblyEvaluate(e)}}]),i}(e.Evented);function O(t,n,i,r){var a=e.smoothstep(45,65,i),o=N(t,r),s=d(o,2),l=s[0],u=s[1],c=e.length(n),h=1-Math.min(1,Math.exp((c-l)/(u-l)*-6));return h*=h*h,(h=Math.min(1,1.00747*h))*a*t.alpha}function N(e,t){var n=.5/Math.tan(.5*t);return[e.range[0]+n,e.range[1]+n]}var H=new e.Properties({range:new e.DataConstantProperty(e.spec.fog.range),color:new e.DataConstantProperty(e.spec.fog.color),"high-color":new e.DataConstantProperty(e.spec.fog["high-color"]),"space-color":new e.DataConstantProperty(e.spec.fog["space-color"]),"horizon-blend":new e.DataConstantProperty(e.spec.fog["horizon-blend"]),"star-intensity":new e.DataConstantProperty(e.spec.fog["star-intensity"])}),U=function(t){m(i,t);var n=y(i);function i(t,r){var a;return f(this,i),(a=n.call(this))._transitionable=new e.Transitionable(H),a.set(t),a._transitioning=a._transitionable.untransitioned(),a._transform=r,a}return p(i,[{key:"state",get:function(){var t=this._transform,n="globe"===t.projection.name,i=e.globeToMercatorTransition(t.zoom),r=this.properties.get("range"),a=[.5,3];return{range:n?[e.number(a[0],r[0],i),e.number(a[1],r[1],i)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}},{key:"get",value:function(){return this._transitionable.serialize()}},{key:"set",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._validate(e.validateFog,t,n)){for(var i=0,r=Object.keys(e.spec.fog);i<r.length;i++){var a=r[i];t&&void 0===t[a]&&(t[a]=e.spec.fog[a].default)}for(var o in t){var s=t[o];e.endsWith(o,"-transition")?this._transitionable.setTransition(o.slice(0,-11),s):this._transitionable.setValue(o,s)}}}},{key:"getOpacity",value:function(t){if(!this._transform.projection.supportsFog)return 0;var n=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.smoothstep(45,65,t))*n.a}},{key:"getOpacityAtLatLng",value:function(t,n){return this._transform.projection.supportsFog?function(t,n,i){var r=e.MercatorCoordinate.fromLngLat(n),a=i.elevation?i.elevation.getAtPointOrZero(r):0,o=[r.x,r.y,a];return e.transformMat4(o,o,i.mercatorFogMatrix),O(t,o,i.pitch,i._fov)}(this.state,t,n):0}},{key:"getFovAdjustedRange",value:function(e){return this._transform.projection.supportsFog?N(this.state,e):[0,1]}},{key:"updateTransitions",value:function(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}},{key:"hasTransition",value:function(){return this._transitioning.hasTransition()}},{key:"recalculate",value:function(e){this.properties=this._transitioning.possiblyEvaluate(e)}},{key:"_validate",value:function(t,n,i){return(!i||!1!==i.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}]),i}(e.Evented),j=function(){function t(n,i){var r=this;f(this,t),this.workerPool=n,this.actors=[],this.currentActor=0,this.id=e.uniqueId();for(var a=this.workerPool.acquire(this.id),o=0;o<a.length;o++){var s=new t.Actor(a[o],i,this.id);s.name="Worker ".concat(o),this.actors.push(s)}this.ready=!1,this.broadcast("checkIfReady",null,(function(){r.ready=!0}))}return p(t,[{key:"broadcast",value:function(t,n,i){e.asyncAll(this.actors,(function(e,i){e.send(t,n,i)}),i=i||function(){})}},{key:"getActor",value:function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}},{key:"remove",value:function(){this.actors.forEach((function(e){e.remove()})),this.actors=[],this.workerPool.release(this.id)}}]),t}();function V(t,n,i){return n*(e.EXTENT/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}j.Actor=e.Actor;var W=function(){function t(e,n,i,r){f(this,t),this.screenBounds=e,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}return p(t,[{key:"isPointQuery",value:function(){return 1===this.screenBounds.length}},{key:"bufferedScreenGeometry",value:function(t){return e.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}},{key:"bufferedCameraGeometry",value:function(t){var n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new e.Point(1,1)):this.screenBounds[1],r=e.polygonizeBounds(n,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<i.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?r[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(r[3]=this.cameraPoint)),e.bufferConvexPolygon(r,t)}},{key:"bufferedCameraGeometryGlobe",value:function(t){var n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new e.Point(1,1)):this.screenBounds[1],r=e.polygonizeBounds(n,i,t),a=this.cameraPoint.clone();switch(3*((a.y>n.y)+(a.y>i.y))+((a.x>n.x)+(a.x>i.x))){case 0:r[0]=a,r[4]=a.clone();break;case 1:r.splice(1,0,a);break;case 2:r[1]=a;break;case 3:r.splice(4,0,a);break;case 5:r.splice(2,0,a);break;case 6:r[3]=a;break;case 7:r.splice(3,0,a);break;case 8:r[2]=a}return r}},{key:"containsTile",value:function(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=t.queryPadding/n._pixelsPerMercatorPixel+1,o=i?this._bufferedCameraMercator(a,n):this._bufferedScreenMercator(a,n),s=t.tileID.wrap+(o.unwrapped?r:0),l=o.polygon.map((function(n){return e.getTilePoint(t.tileTransform,n,s)}));if(e.polygonIntersectsBox(l,0,0,e.EXTENT,e.EXTENT)){s=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);var u,c=this.screenGeometryMercator.polygon.map((function(n){return e.getTileVec3(t.tileTransform,n,s)})),d=c.map((function(t){return new e.Point(t[0],t[1])})),h=n.getFreeCameraOptions().position||new e.MercatorCoordinate(0,0,0),f=e.getTileVec3(t.tileTransform,h,s),p=c.map((function(t){var n=e.sub(t,t,f);return e.normalize(n,n),new e.Ray(f,n)})),m=V(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:d,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(u=e.getBounds(l),u.min.x=e.clamp(u.min.x,0,e.EXTENT),u.min.y=e.clamp(u.min.y,0,e.EXTENT),u.max.x=e.clamp(u.max.x,0,e.EXTENT),u.max.y=e.clamp(u.max.y,0,e.EXTENT),u),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:m}}}},{key:"_bufferedScreenMercator",value:function(e,t){var n,i=Z(e);return this._screenRaycastCache[i]?this._screenRaycastCache[i]:(n="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((function(e){return t.pointCoordinate3D(e)})),unwrapped:!0},this._screenRaycastCache[i]=n,n)}},{key:"_bufferedCameraMercator",value:function(e,t){var n,i=Z(e);return this._cameraRaycastCache[i]?this._cameraRaycastCache[i]:(n="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((function(e){return t.pointCoordinate3D(e)})),unwrapped:!0},this._cameraRaycastCache[i]=n,n)}},{key:"_projectAndResample",value:function(t,n){var i=function(t,n){var i=e.multiply([],n.pixelMatrix,n.globeMatrix),r=[0,-e.GLOBE_RADIUS,0,1],a=[0,e.GLOBE_RADIUS,0,1],o=[0,0,0,1];e.transformMat4$1(r,r,i),e.transformMat4$1(a,a,i),e.transformMat4$1(o,o,i);var s=new e.Point(r[0]/r[3],r[1]/r[3]),l=new e.Point(a[0]/a[3],a[1]/a[3]),u=e.polygonContainsPoint(t,s)&&r[3]<o[3],d=e.polygonContainsPoint(t,l)&&a[3]<o[3];if(!u&&!d)return null;var h=function(e,t,n){for(var i=1;i<e.length;i++){var r=q(t.pointCoordinate3D(e[i-1]).x),a=q(t.pointCoordinate3D(e[i]).x);if(n<0){if(r<a)return{idx:i,t:-r/(a-1-r)}}else if(a<r)return{idx:i,t:(1-r)/(a+1-r)}}return null}(t,n,u?-1:1);if(!h)return null;var f=h.idx,p=h.t,m=f>1?G(t.slice(0,f),n):[],y=f<t.length?G(t.slice(f),n):[];m=m.map((function(t){return new e.Point(q(t.x),t.y)})),y=y.map((function(t){return new e.Point(q(t.x),t.y)}));var g=c(m);0===g.length&&g.push(y[y.length-1]);var v,_=e.number(g[g.length-1].y,(0===y.length?m[0]:y[0]).y,p);return v=u?[new e.Point(0,_),new e.Point(0,0),new e.Point(1,0),new e.Point(1,_)]:[new e.Point(1,_),new e.Point(1,1),new e.Point(0,1),new e.Point(0,_)],g.push.apply(g,c(v)),0===y.length?g.push(m[0]):g.push.apply(g,c(y)),{polygon:g.map((function(t){return new e.MercatorCoordinate(t.x,t.y)})),unwrapped:!1}}(t,n);if(i)return i;var r=function(t,n){for(var i=!1,r=-1/0,a=0,o=0;o<t.length-1;o++)t[o].x>r&&(r=t[o].x,a=o);for(var s=0;s<t.length-1;s++){var l=(a+s)%(t.length-1),u=t[l],c=t[l+1];Math.abs(u.x-c.x)>.5&&(u.x<c.x?(u.x+=1,0===l&&(t[t.length-1].x+=1)):(c.x+=1,l+1===t.length-1&&(t[0].x+=1)),i=!0)}var d=e.mercatorXfromLng(n.center.lng);return i&&d<Math.abs(d-1)&&t.forEach((function(e){e.x-=1})),{polygon:t,unwrapped:i}}(G(t,n).map((function(t){return new e.Point(q(t.x),t.y)})),n);return{polygon:r.polygon.map((function(t){return new e.MercatorCoordinate(t.x,t.y)})),unwrapped:r.unwrapped}}}],[{key:"createFromScreenPoints",value:function(n,i){var r,a;if(n instanceof e.Point||"number"==typeof n[0]){var o=e.Point.convert(n);r=[o],a=i.isPointAboveHorizon(o)}else{var s=e.Point.convert(n[0]),l=e.Point.convert(n[1]);r=[s,l],a=e.polygonizeBounds(s,l).every((function(e){return i.isPointAboveHorizon(e)}))}return new t(r,i.getCameraPoint(),a,i)}}]),t}();function G(t,n){return e.resample(t,(function(e){var t=n.pointCoordinate3D(e);e.x=t.x,e.y=t.y}),1/256)}function q(e){return e<0?1+e%1:e%1}function Z(e){return 100*e|0}function X(t,n,i,r,a){var o=function(i,r){if(i)return a(i);if(r){t.url&&r.tiles&&t.tiles&&delete t.tiles;var o=e.pick(e.extend(r,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);r.vector_layers&&(o.vectorLayers=r.vector_layers,o.vectorLayerIds=o.vectorLayers.map((function(e){return e.id}))),o.tiles=n.canonicalizeTileset(o,t.url),a(null,o)}};return t.url?e.getJSON(n.transformRequest(n.normalizeSourceURL(t.url,null,i,r),e.ResourceType.Source),o):e.exported.frame((function(){return o(null,t)}))}var K,Y=function(){function t(n,i,r){f(this,t),this.bounds=e.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=i||0,this.maxzoom=r||24}return p(t,[{key:"validateBounds",value:function(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}},{key:"contains",value:function(t){var n=Math.pow(2,t.z),i=Math.floor(e.mercatorXfromLng(this.bounds.getWest())*n),r=Math.floor(e.mercatorYfromLat(this.bounds.getNorth())*n),a=Math.ceil(e.mercatorXfromLng(this.bounds.getEast())*n),o=Math.ceil(e.mercatorYfromLat(this.bounds.getSouth())*n);return t.x>=i&&t.x<a&&t.y>=r&&t.y<o}}]),t}(),J=function(){function e(t,n,i){f(this,e),this.context=t;var r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||n.destroy()}return p(e,[{key:"bind",value:function(){this.context.bindElementBuffer.set(this.buffer)}},{key:"updateData",value:function(e){var t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}},{key:"destroy",value:function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}]),e}(),$={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Q=function(){function e(t,n,i,r){f(this,e),this.length=n.length,this.attributes=i,this.itemSize=n.bytesPerElement,this.dynamicDraw=r,this.context=t;var a=t.gl;this.buffer=a.createBuffer(),t.bindVertexBuffer.set(this.buffer),a.bufferData(a.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW),this.dynamicDraw||n.destroy()}return p(e,[{key:"bind",value:function(){this.context.bindVertexBuffer.set(this.buffer)}},{key:"updateData",value:function(e){var t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}},{key:"enableAttributes",value:function(e,t){for(var n=0;n<this.attributes.length;n++){var i=t.attributes[this.attributes[n].name];void 0!==i&&e.enableVertexAttribArray(i)}}},{key:"setVertexAttribPointers",value:function(e,t,n){for(var i=0;i<this.attributes.length;i++){var r=this.attributes[i],a=t.attributes[r.name];void 0!==a&&e.vertexAttribPointer(a,r.components,e[$[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}},{key:"destroy",value:function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}]),e}(),ee=function(){function e(t){f(this,e),this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}return p(e,[{key:"get",value:function(){return this.current}},{key:"set",value:function(e){}},{key:"getDefault",value:function(){return this.default}},{key:"setDefault",value:function(){this.set(this.default)}}]),e}(),te=function(t){m(i,t);var n=y(i);function i(){return f(this,i),n.apply(this,arguments)}return p(i,[{key:"getDefault",value:function(){return e.Color.transparent}},{key:"set",value:function(e){var t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}]),i}(ee),ne=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return 1}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}]),n}(ee),ie=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return 0}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}]),n}(ee),re=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return[!0,!0,!0,!0]}},{key:"set",value:function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}]),n}(ee),ae=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return!0}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}]),n}(ee),oe=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return 255}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}]),n}(ee),se=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return{func:this.gl.ALWAYS,ref:0,mask:255}}},{key:"set",value:function(e){var t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}]),n}(ee),le=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){var e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}},{key:"set",value:function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}]),n}(ee),ue=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return!1}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}}]),n}(ee),ce=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return[0,1]}},{key:"set",value:function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}]),n}(ee),de=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return!1}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}}]),n}(ee),he=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return this.gl.LESS}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}]),n}(ee),fe=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return!1}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}}]),n}(ee),pe=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){var e=this.gl;return[e.ONE,e.ZERO]}},{key:"set",value:function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}]),n}(ee),me=function(t){m(i,t);var n=y(i);function i(){return f(this,i),n.apply(this,arguments)}return p(i,[{key:"getDefault",value:function(){return e.Color.transparent}},{key:"set",value:function(e){var t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}]),i}(ee),ye=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return this.gl.FUNC_ADD}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}]),n}(ee),ge=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return!1}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}}]),n}(ee),ve=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return this.gl.BACK}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}]),n}(ee),_e=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return this.gl.CCW}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}]),n}(ee),xe=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}]),n}(ee),be=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return this.gl.TEXTURE0}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}]),n}(ee),we=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){var e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}},{key:"set",value:function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}]),n}(ee),ke=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}}]),n}(ee),Te=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}}]),n}(ee),Ee=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}}]),n}(ee),Se=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}}]),n}(ee),Le=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}]),n}(ee),Me=function(e){m(n,e);var t=y(n);function n(e){var i;return f(this,n),(i=t.call(this,e)).vao=e.extVertexArrayObject,i}return p(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}]),n}(ee),Ae=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return 4}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}}]),n}(ee),Ce=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return!1}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}}]),n}(ee),Ie=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getDefault",value:function(){return!1}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}}]),n}(ee),Pe=function(e){m(n,e);var t=y(n);function n(e,i){var r;return f(this,n),(r=t.call(this,e)).context=e,r.parent=i,r}return p(n,[{key:"getDefault",value:function(){return null}}]),n}(ee),ze=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"setDirty",value:function(){this.dirty=!0}},{key:"set",value:function(e){if(e!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}}]),n}(Pe),De=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"attachment",value:function(){return this.gl.DEPTH_ATTACHMENT}},{key:"set",value:function(e){if(e!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}}]),n}(Pe),Re=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"attachment",value:function(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}]),n}(De),Be=function(){function e(t,n,i,r){f(this,e),this.context=t,this.width=n,this.height=i;var a=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new ze(t,a),r&&(this.depthAttachment=new De(t,a))}return p(e,[{key:"destroy",value:function(){var e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){var n=this.depthAttachment.get();n&&e.deleteRenderbuffer(n)}e.deleteFramebuffer(this.framebuffer)}}]),e}(),Fe=function(){function n(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(f(this,n),this.gl=e,this.isWebGL2=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),t){var i=e;this.extVertexArrayObject={createVertexArrayOES:i.createVertexArray.bind(e),deleteVertexArrayOES:i.deleteVertexArray.bind(e),bindVertexArrayOES:i.bindVertexArray.bind(e)}}this.clearColor=new te(this),this.clearDepth=new ne(this),this.clearStencil=new ie(this),this.colorMask=new re(this),this.depthMask=new ae(this),this.stencilMask=new oe(this),this.stencilFunc=new se(this),this.stencilOp=new le(this),this.stencilTest=new ue(this),this.depthRange=new ce(this),this.depthTest=new de(this),this.depthFunc=new he(this),this.blend=new fe(this),this.blendFunc=new pe(this),this.blendColor=new me(this),this.blendEquation=new ye(this),this.cullFace=new ge(this),this.cullFaceSide=new ve(this),this.frontFace=new _e(this),this.program=new xe(this),this.activeTexture=new be(this),this.viewport=new we(this),this.bindFramebuffer=new ke(this),this.bindRenderbuffer=new Te(this),this.bindTexture=new Ee(this),this.bindVertexBuffer=new Se(this),this.bindElementBuffer=new Le(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Me(this),this.pixelStoreUnpack=new Ae(this),this.pixelStoreUnpackPremultiplyAlpha=new Ce(this),this.pixelStoreUnpackFlipY=new Ie(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),t||(this.extTextureHalfFloat=e.getExtension("OES_texture_half_float")),(t||this.extTextureHalfFloat&&e.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=t||e.getExtension("OES_standard_derivatives"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}return p(n,[{key:"setDefault",value:function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}},{key:"setDirty",value:function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}},{key:"createIndexBuffer",value:function(e,t){return new J(this,e,t)}},{key:"createVertexBuffer",value:function(e,t,n){return new Q(this,e,t,n)}},{key:"createRenderbuffer",value:function(e,t,n){var i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),r}},{key:"createFramebuffer",value:function(e,t,n){return new Be(this,e,t,n)}},{key:"clear",value:function(e){var t=e.color,n=e.depth,i=e.stencil,r=this.gl,a=0;t&&(a|=r.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(a|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==i&&(a|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(a)}},{key:"setCullFace",value:function(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}},{key:"setDepthMode",value:function(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}},{key:"setStencilMode",value:function(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}},{key:"setColorMode",value:function(n){t(n.blendFunction,e.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}},{key:"unbindVAO",value:function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}]),n}(),Oe=function(t){m(i,t);var n=y(i);function i(t,a,o,s){var u;if(f(this,i),(u=n.call(this)).id=t,u.dispatcher=o,u.type="vector",u.minzoom=0,u.maxzoom=22,u.scheme="xyz",u.tileSize=512,u.reparseOverscaled=!0,u.isTileClipped=!0,u._loaded=!1,e.extend(r(u),e.pick(a,["url","scheme","tileSize","promoteId"])),u._options=e.extend({type:"vector"},a),u._collectResourceTiming=a.collectResourceTiming,512!==u.tileSize)throw new Error("vector tile sources must have a tileSize of 512");return u.setEventedParent(s),u._tileWorkers={},u._deduped=new e.DedupedRequest,l(u)}return p(i,[{key:"load",value:function(t){var n=this;this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"}));var i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=X(this._options,this.map._requestManager,i,r,(function(a,o){n._tileJSONRequest=null,n._loaded=!0,a?(i&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(i)),r&&2!==r.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(r)),n.fire(new e.ErrorEvent(a))):o&&(e.extend(n,o),o.bounds&&(n.tileBounds=new Y(o.bounds,n.minzoom,n.maxzoom)),e.postTurnstileEvent(o.tiles,n.map._requestManager._customAccessToken),n.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),n.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))),t&&t(a)}))}},{key:"loaded",value:function(){return this._loaded}},{key:"hasTile",value:function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}},{key:"onAdd",value:function(e){this.map=e,this.load()}},{key:"reload",value:function(){var e=this;this.cancelTileJSONRequest(),this.load((function(){return e.map.style._clearSource(e.id)}))}},{key:"setTiles",value:function(e){return this._options.tiles=e,this.reload(),this}},{key:"setUrl",value:function(e){return this.url=e,this._options.url=e,this.reload(),this}},{key:"onRemove",value:function(){this.cancelTileJSONRequest()}},{key:"serialize",value:function(){return e.extend({},this._options)}},{key:"loadTile",value:function(t,n){var i=this,r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),a={request:this.map._requestManager.transformRequest(r,e.ResourceType.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile};if(a.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=n:t.request=t.actor.send("reloadTile",a,s.bind(this));else if(t.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",a,s.bind(this),void 0,!0);else{var o=e.loadVectorTile.call({deduped:this._deduped},a,(function(e,n){e||!n?s.call(i,e):(a.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},t.actor&&t.actor.send("loadTile",a,s.bind(i),void 0,!0))}),!0);t.request={cancel:o}}function s(i,r){return delete t.request,t.aborted?n(null):i&&404!==i.status?n(i):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}},{key:"abortTile",value:function(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id})}},{key:"unloadTile",value:function(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}},{key:"hasTransition",value:function(){return!1}},{key:"afterUpdate",value:function(){this._tileWorkers={}}},{key:"cancelTileJSONRequest",value:function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}]),i}(e.Evented),Ne=function(t){m(i,t);var n=y(i);function i(t,a,o,s){var l;return f(this,i),(l=n.call(this)).id=t,l.dispatcher=o,l.setEventedParent(s),l.type="raster",l.minzoom=0,l.maxzoom=22,l.roundZoom=!0,l.scheme="xyz",l.tileSize=512,l._loaded=!1,l._options=e.extend({type:"raster"},a),e.extend(r(l),e.pick(a,["url","scheme","tileSize"])),l}return p(i,[{key:"load",value:function(t){var n=this;this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=X(this._options,this.map._requestManager,null,null,(function(i,r){n._tileJSONRequest=null,n._loaded=!0,i?n.fire(new e.ErrorEvent(i)):r&&(e.extend(n,r),r.bounds&&(n.tileBounds=new Y(r.bounds,n.minzoom,n.maxzoom)),e.postTurnstileEvent(r.tiles),n.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),n.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)}))}},{key:"loaded",value:function(){return this._loaded}},{key:"onAdd",value:function(e){this.map=e,this.load()}},{key:"reload",value:function(){var e=this;this.cancelTileJSONRequest(),this.load((function(){return e.map.style._clearSource(e.id)}))}},{key:"setTiles",value:function(e){return this._options.tiles=e,this.reload(),this}},{key:"setUrl",value:function(e){return this.url=e,this._options.url=e,this.reload(),this}},{key:"onRemove",value:function(){this.cancelTileJSONRequest()}},{key:"serialize",value:function(){return e.extend({},this._options)}},{key:"hasTile",value:function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}},{key:"loadTile",value:function(t,n){var i=this,r=e.exported.devicePixelRatio>=2,a=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);t.request=e.getImage(this.map._requestManager.transformRequest(a,e.ResourceType.Tile),(function(r,a,o,s){return delete t.request,t.aborted?(t.state="unloaded",n(null)):r?(t.state="errored",n(r)):a?(i.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:s}),t.setTexture(a,i.map.painter),t.state="loaded",e.cacheEntryPossiblyAdded(i.dispatcher),void n(null)):n(null)}))}},{key:"abortTile",value:function(e,t){e.request&&(e.request.cancel(),delete e.request),t()}},{key:"unloadTile",value:function(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}},{key:"hasTransition",value:function(){return!1}},{key:"cancelTileJSONRequest",value:function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}],[{key:"loadTileData",value:function(e,t,n){e.setTexture(t,n)}},{key:"unloadTileData",value:function(e,t){e.texture&&t.saveTileTexture(e.texture)}}]),i}(e.Evented);function He(t,n,i,r,a,o,s,l){var u=[t,i,a,n,r,o,1,1,1],c=[s,l,1],h=e.adjoint([],u),f=e.transformMat3(c,c,e.transpose(h,h)),p=d(f,3),m=p[0],y=p[1],g=p[2];return e.multiply$1(u,[m,0,0,0,y,0,0,0,g],u)}var Ue=function(t){m(i,t);var n=y(i);function i(e,t,r,a){var o;return f(this,i),(o=n.call(this)).id=e,o.dispatcher=r,o.coordinates=t.coordinates,o.type="image",o.minzoom=0,o.maxzoom=22,o.tileSize=512,o.tiles={},o._loaded=!1,o.setEventedParent(a),o.options=t,o._dirty=!1,o}return p(i,[{key:"load",value:function(t,n){var i=this;this._loaded=n||!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=e.getImage(this.map._requestManager.transformRequest(this.url,e.ResourceType.Image),(function(n,r){if(i._imageRequest=null,i._loaded=!0,n)i.fire(new e.ErrorEvent(n));else if(r){var a=e.window.HTMLImageElement;i.image=r instanceof a?e.exported.getImageData(r):r,i._dirty=!0,i.width=i.image.width,i.height=i.image.height,t&&(i.coordinates=t),i._finishLoading()}}))}},{key:"loaded",value:function(){return this._loaded}},{key:"updateImage",value:function(e){return this.image&&e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}},{key:"_finishLoading",value:function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})))}},{key:"onAdd",value:function(e){this.map=e,this.load()}},{key:"onRemove",value:function(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}},{key:"setCoordinates",value:function(t){this.coordinates=t,this._boundsArray=void 0;var n=t.map(e.MercatorCoordinate.fromLngLat);return this.tileID=function(t){var n,i=1/0,r=1/0,a=-1/0,o=-1/0,s=h(t);try{for(s.s();!(n=s.n()).done;){var l=n.value;i=Math.min(i,l.x),r=Math.min(r,l.y),a=Math.max(a,l.x),o=Math.max(o,l.y)}}catch(f){s.e(f)}finally{s.f()}var u=Math.max(a-i,o-r),c=Math.max(0,Math.floor(-Math.log(u)/Math.LN2)),d=Math.pow(2,c);return new e.CanonicalTileID(c,Math.floor((i+a)/2*d),Math.floor((r+o)/2*d))}(n),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this}},{key:"_clear",value:function(){this._boundsArray=void 0}},{key:"_prepareData",value:function(t){for(var n in this.tiles){var i=this.tiles[n];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}if(!this._boundsArray){var r=e.tileTransform(this.tileID,this.map.transform.projection),a=this.coordinates.map((function(t){var n=r.projection.project(t[0],t[1]);return e.getTilePoint(r,n)._round()})),o=d(a,4),s=o[0],l=o[1],u=o[2],c=o[3];this.perspectiveTransform=function(t,n,i,r,a,o,s,l,u,c){var d=He(0,0,t,0,0,n,t,n),h=He(i,r,a,o,s,l,u,c);return e.multiply$1(h,e.adjoint(d,d),h),[h[6]/h[8]*t/e.EXTENT,h[7]/h[8]*n/e.EXTENT]}(this.width,this.height,s.x,s.y,l.x,l.y,c.x,c.y,u.x,u.y);var h=this._boundsArray=new e.StructArrayLayout4i8;h.emplaceBack(s.x,s.y,0,0),h.emplaceBack(l.x,l.y,e.EXTENT,0),h.emplaceBack(c.x,c.y,0,e.EXTENT),h.emplaceBack(u.x,u.y,e.EXTENT,e.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(h,e.boundsAttributes.members),this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)}}},{key:"prepare",value:function(){if(0!==Object.keys(this.tiles).length&&this.image){var t=this.map.painter.context,n=t.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new e.Texture(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(t)}}},{key:"loadTile",value:function(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}},{key:"serialize",value:function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}},{key:"hasTransition",value:function(){return!1}}]),i}(e.Evented),je={vector:Oe,raster:Ne,"raster-dem":function(t){m(i,t);var n=y(i);function i(t,r,a,o){var s;return f(this,i),(s=n.call(this,t,r,a,o)).type="raster-dem",s.maxzoom=22,s._options=e.extend({type:"raster-dem"},r),s.encoding=r.encoding||"mapbox",s}return p(i,[{key:"loadTile",value:function(t,n){var i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(e,i){e&&(t.state="errored",n(e)),i&&(t.dem=i,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",n(null))}t.request=e.getImage(this.map._requestManager.transformRequest(i,e.ResourceType.Tile),function(i,a,o,s){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(i)t.state="errored",n(i);else if(a){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:s});var l=e.window.ImageBitmap&&a instanceof e.window.ImageBitmap&&(null==K&&(K=e.window.OffscreenCanvas&&new e.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof e.window.createImageBitmap),K),u=1-(a.width-e.prevPowerOfTwo(a.width))/2;u<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));var c=l?a:e.exported.getImageData(a,u),d={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:c,encoding:this.encoding,padding:u};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",d,r.bind(this),void 0,!0))}}.bind(this))}},{key:"_getNeighboringTiles",value:function(t){var n=t.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,a=0===n.x?t.wrap-1:t.wrap,o=(n.x+1+i)%i,s=n.x+1===i?t.wrap+1:t.wrap,l={};return l[new e.OverscaledTileID(t.overscaledZ,a,n.z,r,n.y).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,n.z,o,n.y).key]={backfilled:!1},n.y>0&&(l[new e.OverscaledTileID(t.overscaledZ,a,n.z,r,n.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,n.z,o,n.y-1).key]={backfilled:!1}),n.y+1<i&&(l[new e.OverscaledTileID(t.overscaledZ,a,n.z,r,n.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,n.z,o,n.y+1).key]={backfilled:!1}),l}},{key:"unloadTile",value:function(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}}]),i}(Ne),geojson:function(t){m(i,t);var n=y(i);function i(t,r,a,o){var s;f(this,i),(s=n.call(this)).id=t,s.type="geojson",s.minzoom=0,s.maxzoom=18,s.tileSize=512,s.isTileClipped=!0,s.reparseOverscaled=!0,s._loaded=!1,s.actor=a.getActor(),s.setEventedParent(o),s._data=r.data,s._options=e.extend({},r),s._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(s.maxzoom=r.maxzoom),r.type&&(s.type=r.type),r.attribution&&(s.attribution=r.attribution),s.promoteId=r.promoteId;var l=e.EXTENT/s.tileSize;return s.workerOptions=e.extend({source:s.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*l,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*l,extent:e.EXTENT,maxZoom:s.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:s.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:e.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*l,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),s}return p(i,[{key:"onAdd",value:function(e){this.map=e,this.setData(this._data)}},{key:"setData",value:function(e){return this._data=e,this._updateWorkerData(),this}},{key:"getClusterExpansionZoom",value:function(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this}},{key:"getClusterChildren",value:function(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this}},{key:"getClusterLeaves",value:function(e,t,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:n},i),this}},{key:"_updateWorkerData",value:function(){var t=this;if(this._pendingLoad)this._coalesce=!0;else{this.fire(new e.Event("dataloading",{dataType:"source"})),this._loaded=!1;var n=e.extend({},this.workerOptions),i=this._data;"string"==typeof i?(n.request=this.map._requestManager.transformRequest(e.exported.resolveURL(i),e.ResourceType.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(i),this._pendingLoad=this.actor.send("".concat(this.type,".loadData"),n,(function(n,i){if(t._loaded=!0,t._pendingLoad=null,n)t.fire(new e.ErrorEvent(n));else{var r={dataType:"source",sourceDataType:t._metadataFired?"content":"metadata"};t._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[t.id]&&(r.resourceTiming=i.resourceTiming[t.id]),t.fire(new e.Event("data",r)),t._metadataFired=!0}t._coalesce&&(t._updateWorkerData(),t._coalesce=!1)}))}}},{key:"loaded",value:function(){return this._loaded}},{key:"loadTile",value:function(t,n){var i=this,r=t.actor?"reloadTile":"loadTile";t.actor=this.actor,t.request=this.actor.send(r,{type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(e,a){return delete t.request,t.unloadVectorData(),t.aborted?n(null):e?n(e):(t.loadVectorData(a,i.map.painter,"reloadTile"===r),n(null))}),void 0,"loadTile"===r)}},{key:"abortTile",value:function(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}},{key:"unloadTile",value:function(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}},{key:"onRemove",value:function(){this._pendingLoad&&this._pendingLoad.cancel()}},{key:"serialize",value:function(){return e.extend({},this._options,{type:this.type,data:this._data})}},{key:"hasTransition",value:function(){return!1}}]),i}(e.Evented),video:function(t){m(i,t);var n=y(i);function i(e,t,r,a){var o;return f(this,i),(o=n.call(this,e,t,r,a)).roundZoom=!0,o.type="video",o.options=t,o}return p(i,[{key:"load",value:function(){var t=this;this._loaded=!1;var n=this.options;this.urls=[];var i,r=h(n.urls);try{for(r.s();!(i=r.n()).done;){var a=i.value;this.urls.push(this.map._requestManager.transformRequest(a,e.ResourceType.Source).url)}}catch(o){r.e(o)}finally{r.f()}e.getVideo(this.urls,(function(n,i){t._loaded=!0,n?t.fire(new e.ErrorEvent(n)):i&&(t.video=i,t.video.loop=!0,t.video.setAttribute("playsinline",""),t.video.addEventListener("playing",(function(){t.map.triggerRepaint()})),t.map&&t.video.play(),t._finishLoading())}))}},{key:"pause",value:function(){this.video&&this.video.pause()}},{key:"play",value:function(){this.video&&this.video.play()}},{key:"seek",value:function(t){if(this.video){var n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(n.start(0)," and ").concat(n.end(0),"-second mark.")))):this.video.currentTime=t}}},{key:"getVideo",value:function(){return this.video}},{key:"onAdd",value:function(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}},{key:"prepare",value:function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var t=this.map.painter.context,n=t.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}}},{key:"serialize",value:function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}},{key:"hasTransition",value:function(){return this.video&&!this.video.paused}}]),i}(Ue),image:Ue,canvas:function(t){m(i,t);var n=y(i);function i(t,r,a,o){var s;return f(this,i),s=n.call(this,t,r,a,o),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((function(e){return!Array.isArray(e)||2!==e.length||e.some((function(e){return"number"!=typeof e}))}))||s.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):s.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t),null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&s.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t),null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof e.window.HTMLCanvasElement||s.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):s.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t),null,'missing required property "canvas"'))),s.options=r,s.animate=void 0===r.animate||r.animate,s}return p(i,[{key:"load",value:function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}},{key:"getCanvas",value:function(){return this.canvas}},{key:"onAdd",value:function(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}},{key:"onRemove",value:function(){this.pause()}},{key:"prepare",value:function(){var t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var n=this.map.painter.context;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}}},{key:"serialize",value:function(){return{type:"canvas",coordinates:this.coordinates}}},{key:"hasTransition",value:function(){return this._playing}},{key:"_hasInvalidDimensions",value:function(){for(var e=0,t=[this.canvas.width,this.canvas.height];e<t.length;e++){var n=t[e];if(isNaN(n)||n<=0)return!0}return!1}}]),i}(Ue),custom:function(t){m(i,t);var n=y(i);function i(t,a,o,s){var l;return f(this,i),(l=n.call(this)).id=t,l.type="custom",l._dataType="raster",l._dispatcher=o,l._implementation=a,l.setEventedParent(s),l.scheme="xyz",l.minzoom=0,l.maxzoom=22,l.tileSize=512,l._loaded=!1,l.roundZoom=!0,l._implementation||l.fire(new e.ErrorEvent(new Error("Missing implementation for ".concat(l.id," custom source")))),l._implementation.loadTile||l.fire(new e.ErrorEvent(new Error("Missing loadTile implementation for ".concat(l.id," custom source")))),l._implementation.bounds&&(l.tileBounds=new Y(l._implementation.bounds,l.minzoom,l.maxzoom)),a.update=l._update.bind(r(l)),a.clearTiles=l._clearTiles.bind(r(l)),a.coveringTiles=l._coveringTiles.bind(r(l)),e.extend(r(l),e.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"])),l}return p(i,[{key:"serialize",value:function(){return e.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}},{key:"load",value:function(){this._loaded=!0,this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))}},{key:"loaded",value:function(){return this._loaded}},{key:"onAdd",value:function(t){this._map=t,this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}},{key:"onRemove",value:function(e){this._implementation.onRemove&&this._implementation.onRemove(e)}},{key:"hasTile",value:function(e){if(this._implementation.hasTile){var t=e.canonical,n=t.x,i=t.y,r=t.z;return this._implementation.hasTile({x:n,y:i,z:r})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}},{key:"loadTile",value:function(t,n){var i=t.tileID.canonical,r=i.x,a=i.y,o=i.z,s=new e.window.AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:r,y:a,z:o},{signal:s.signal})).then(function(i){return delete t.request,t.aborted?(t.state="unloaded",n(null)):void 0===i?(t.state="errored",n(null)):null===i?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",n(null)):function(t){return t instanceof e.window.ImageData||t instanceof e.window.HTMLCanvasElement||t instanceof e.window.ImageBitmap||t instanceof e.window.HTMLImageElement}(i)?(this.loadTileData(t,i),t.state="loaded",void n(null)):(t.state="errored",n(new Error("Can't infer data type for ".concat(this.id,", only raster data supported at the moment"))))}.bind(this)).catch((function(e){20!==e.code&&(t.state="errored",n(e))})),t.request.cancel=function(){return s.abort()}}},{key:"loadTileData",value:function(e,t){Ne.loadTileData(e,t,this._map.painter)}},{key:"unloadTileData",value:function(e){Ne.unloadTileData(e,this._map.painter)}},{key:"unloadTile",value:function(e,t){if(this.unloadTileData(e),this._implementation.unloadTile){var n=e.tileID.canonical,i=n.x,r=n.y,a=n.z;this._implementation.unloadTile({x:i,y:r,z:a})}t()}},{key:"abortTile",value:function(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}},{key:"hasTransition",value:function(){return!1}},{key:"_coveringTiles",value:function(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((function(e){return{x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}}))}},{key:"_clearTiles",value:function(){this._map.style._clearSource(this.id)}},{key:"_update",value:function(){this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))}}]),i}(e.Evented)},Ve=function(t,n,i,r){var a=new je[n.type](t,n,i,r);if(a.id!==t)throw new Error("Expected Source id to be ".concat(t," instead of ").concat(a.id));return e.bindAll(["load","abort","unload","serialize","prepare"],a),a};function We(t,n){var i=e.identity([]);return e.scale(i,i,[.5*t.width,.5*-t.height,1]),e.translate(i,i,[1,-1,0]),e.multiply(i,i,t.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(i)}function Ge(e,t,n,i,r,a,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=e.tilesIn(i,o,s);l.sort(Ze);var u,c=[],d=h(l);try{for(d.s();!(u=d.n()).done;){var f=u.value;c.push({wrappedTileID:f.tile.tileID.wrapped().key,queryResults:f.tile.queryRenderedFeatures(t,n,e._state,f,r,a,We(e.transform,f.tile.tileID),s)})}}catch(y){d.e(y)}finally{d.f()}var p=function(e){var t,n={},i={},r=h(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,o=a.queryResults,s=a.wrappedTileID,l=i[s]=i[s]||{};for(var u in o){var c,d=o[u],f=l[u]=l[u]||{},p=n[u]=n[u]||[],m=h(d);try{for(m.s();!(c=m.n()).done;){var g=c.value;f[g.featureIndex]||(f[g.featureIndex]=!0,p.push(g))}}catch(y){m.e(y)}finally{m.f()}}}}catch(y){r.e(y)}finally{r.f()}return n}(c);for(var m in p)p[m].forEach((function(t){var n=t.feature,i=n.layer;i&&"background"!==i.type&&"sky"!==i.type&&(n.source=i.source,i["source-layer"]&&(n.sourceLayer=i["source-layer"]),n.state=void 0!==n.id?e.getFeatureState(i["source-layer"],n.id):{})}));return p}function qe(e,t){for(var n=e.getRenderableIds().map((function(t){return e.getTileByID(t)})),i=[],r={},a=0;a<n.length;a++){var o=n[a],s=o.tileID.canonical.key;r[s]||(r[s]=!0,o.querySourceFeatures(i,t))}return i}function Ze(e,t){var n=e.tileID,i=t.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}function Xe(){return null!=Ta.workerClass?new Ta.workerClass:new e.window.Worker(Ta.workerUrl)}var Ke,Ye="mapboxgl_preloaded_worker_pool",Je=function(){function e(){f(this,e),this.active={}}return p(e,[{key:"acquire",value:function(t){if(!this.workers)for(this.workers=[];this.workers.length<e.workerCount;)this.workers.push(new Xe);return this.active[t]=!0,this.workers.slice()}},{key:"release",value:function(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((function(e){e.terminate()})),this.workers=null)}},{key:"isPreloaded",value:function(){return!!this.active[Ye]}},{key:"numActive",value:function(){return Object.keys(this.active).length}}]),e}();function $e(){return Ke||(Ke=new Je),Ke}function Qe(t,n){var i={};for(var r in t)"ref"!==r&&(i[r]=t[r]);return e.refProperties.forEach((function(e){e in n&&(i[e]=n[e])})),i}function et(e){e=e.slice();for(var t=Object.create(null),n=0;n<e.length;n++)t[e[n].id]=e[n];for(var i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=Qe(e[i],t[e[i].ref]));return e}Je.workerCount=2;var tt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function nt(e,t,n){n.push({command:tt.addSource,args:[e,t[e]]})}function it(e,t,n){t.push({command:tt.removeSource,args:[e]}),n[e]=!0}function rt(e,t,n,i){it(e,n,i),nt(e,t,n)}function at(e,n,i){var r;for(r in e[i])if(e[i].hasOwnProperty(r)&&"data"!==r&&!t(e[i][r],n[i][r]))return!1;for(r in n[i])if(n[i].hasOwnProperty(r)&&"data"!==r&&!t(e[i][r],n[i][r]))return!1;return!0}function ot(e,n,i,r,a,o){var s;for(s in n=n||{},e=e||{})e.hasOwnProperty(s)&&(t(e[s],n[s])||i.push({command:o,args:[r,s,n[s],a]}));for(s in n)n.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t(e[s],n[s])||i.push({command:o,args:[r,s,n[s],a]}))}function st(e){return e.id}function lt(e,t){return e[t.id]=t,e}var ut=function(){function t(e,n){f(this,t),this.reset(e,n)}return p(t,[{key:"reset",value:function(e,t){this.points=e||[],this._distances=[0];for(var n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}},{key:"lerp",value:function(t){if(1===this.points.length)return this.points[0];t=e.clamp(t,0,1);for(var n=1,i=this._distances[n],r=t*this.paddedLength+this.padding;i<r&&n<this._distances.length;)i=this._distances[++n];var a=n-1,o=this._distances[a],s=i-o,l=s>0?(r-o)/s:0;return this.points[a].mult(1-l).add(this.points[n].mult(l))}}]),t}(),ct=function(){function e(t,n,i){f(this,e);var r=this.boxCells=[],a=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(n/i);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),a.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}return p(e,[{key:"keysLength",value:function(){return this.boxKeys.length+this.circleKeys.length}},{key:"insert",value:function(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}},{key:"insertCircle",value:function(e,t,n,i){this._forEachCell(t-i,n-i,t+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(i)}},{key:"_insertBoxCell",value:function(e,t,n,i,r,a){this.boxCells[r].push(a)}},{key:"_insertCircleCell",value:function(e,t,n,i,r,a){this.circleCells[r].push(a)}},{key:"_query",value:function(e,t,n,i,r,a){if(n<0||e>this.width||i<0||t>this.height)return!r&&[];var o=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=i){if(r)return!0;for(var s=0;s<this.boxKeys.length;s++)o.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var l=0;l<this.circleKeys.length;l++){var u=this.circles[3*l],c=this.circles[3*l+1],d=this.circles[3*l+2];o.push({key:this.circleKeys[l],x1:u-d,y1:c-d,x2:u+d,y2:c+d})}return a?o.filter(a):o}return this._forEachCell(e,t,n,i,this._queryCell,o,{hitTest:r,seenUids:{box:{},circle:{}}},a),r?o.length>0:o}},{key:"_queryCircle",value:function(e,t,n,i,r){var a=e-n,o=e+n,s=t-n,l=t+n;if(o<0||a>this.width||l<0||s>this.height)return!i&&[];var u=[];return this._forEachCell(a,s,o,l,this._queryCellCircle,u,{hitTest:i,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},r),i?u.length>0:u}},{key:"query",value:function(e,t,n,i,r){return this._query(e,t,n,i,!1,r)}},{key:"hitTest",value:function(e,t,n,i,r){return this._query(e,t,n,i,!0,r)}},{key:"hitTestCircle",value:function(e,t,n,i){return this._queryCircle(e,t,n,!0,i)}},{key:"_queryCell",value:function(e,t,n,i,r,a,o,s){var l=o.seenUids,u=this.boxCells[r];if(null!==u){var c,d=this.bboxes,f=h(u);try{for(f.s();!(c=f.n()).done;){var p=c.value;if(!l.box[p]){l.box[p]=!0;var m=4*p;if(e<=d[m+2]&&t<=d[m+3]&&n>=d[m+0]&&i>=d[m+1]&&(!s||s(this.boxKeys[p]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[p],x1:d[m],y1:d[m+1],x2:d[m+2],y2:d[m+3]})}}}}catch(E){f.e(E)}finally{f.f()}}var y=this.circleCells[r];if(null!==y){var g,v=this.circles,_=h(y);try{for(_.s();!(g=_.n()).done;){var x=g.value;if(!l.circle[x]){l.circle[x]=!0;var b=3*x;if(this._circleAndRectCollide(v[b],v[b+1],v[b+2],e,t,n,i)&&(!s||s(this.circleKeys[x]))){if(o.hitTest)return a.push(!0),!0;var w=v[b],k=v[b+1],T=v[b+2];a.push({key:this.circleKeys[x],x1:w-T,y1:k-T,x2:w+T,y2:k+T})}}}}catch(E){_.e(E)}finally{_.f()}}}},{key:"_queryCellCircle",value:function(e,t,n,i,r,a,o,s){var l=o.circle,u=o.seenUids,c=this.boxCells[r];if(null!==c){var d,f=this.bboxes,p=h(c);try{for(p.s();!(d=p.n()).done;){var m=d.value;if(!u.box[m]){u.box[m]=!0;var y=4*m;if(this._circleAndRectCollide(l.x,l.y,l.radius,f[y+0],f[y+1],f[y+2],f[y+3])&&(!s||s(this.boxKeys[m])))return a.push(!0),!0}}}catch(k){p.e(k)}finally{p.f()}}var g=this.circleCells[r];if(null!==g){var v,_=this.circles,x=h(g);try{for(x.s();!(v=x.n()).done;){var b=v.value;if(!u.circle[b]){u.circle[b]=!0;var w=3*b;if(this._circlesCollide(_[w],_[w+1],_[w+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[b])))return a.push(!0),!0}}}catch(k){x.e(k)}finally{x.f()}}}},{key:"_forEachCell",value:function(e,t,n,i,r,a,o,s){for(var l=this._convertToXCellCoord(e),u=this._convertToYCellCoord(t),c=this._convertToXCellCoord(n),d=this._convertToYCellCoord(i),h=l;h<=c;h++)for(var f=u;f<=d;f++)if(r.call(this,e,t,n,i,this.xCellCount*f+h,a,o,s))return}},{key:"_convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"_convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}},{key:"_circlesCollide",value:function(e,t,n,i,r,a){var o=i-e,s=r-t,l=n+a;return l*l>o*o+s*s}},{key:"_circleAndRectCollide",value:function(e,t,n,i,r,a,o){var s=(a-i)/2,l=Math.abs(e-(i+s));if(l>s+n)return!1;var u=(o-r)/2,c=Math.abs(t-(r+u));if(c>u+n)return!1;if(l<=s||c<=u)return!0;var d=l-s,h=c-u;return d*d+h*h<=n*n}}]),e}(),dt={unknown:0,flipRequired:1,flipNotRequired:2},ht=Math.tan(85*Math.PI/180);function ft(t,n,i,r,a,o,s){var l=e.create();if(i)if("globe"===o.name){var u=e.calculateGlobeLabelMatrix(a,n);e.multiply(l,l,u)}else{var c=I([],s);l[0]=c[0],l[1]=c[1],l[4]=c[2],l[5]=c[3],r||e.rotateZ(l,l,a.angle)}else e.multiply(l,a.labelPlaneMatrix,t);return l}function pt(e,t,n,i,r,a,o){var s=ft(e,t,n,i,r,a,o);return"globe"===a.name&&n||(s[2]=s[6]=s[10]=s[14]=0),s}function mt(t,n,i,r,a,o,s){if(i){if("globe"===o.name){var l=ft(t,n,i,r,a,o,s);return e.invert(l,l),e.multiply(l,t,l),l}var u=e.clone(t),c=e.identity([]);return c[0]=s[0],c[1]=s[1],c[4]=s[2],c[5]=s[3],e.multiply(u,u,c),r||e.rotateZ(u,u,-a.angle),u}return a.glCoordMatrix}function yt(t,n,i,r){var a=[t,n,i,1];i?e.transformMat4$1(a,a,r):Lt(a,a,r);var o=a[3];return a[0]/=o,a[1]/=o,a[2]/=o,a}function gt(e,t){return Math.min(.5+e/t*.5,1.5)}function vt(e,t){var n=e[0]/e[3],i=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&i>=-t[1]&&i<=t[1]}function _t(t,n,i,r,a,o,s,l,u,c){var h=i.transform,f=r?t.textSizeData:t.iconSizeData,p=e.evaluateSizeForZoom(f,i.transform.zoom),m="globe"===h.projection.name,y=[256/i.width*2+1,256/i.height*2+1],g=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;g.clear();var v=null;m&&(v=r?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);for(var _,x=t.lineVertexArray,b=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,w=i.transform.width/i.transform.height,k=!1,T=0;T<b.length;T++){var E=b.get(T),S=E.numGlyphs,L=E.writingMode;if(L!==e.WritingMode.vertical||k||_===e.WritingMode.horizontal||(k=!0),_=L,!E.hidden&&L!==e.WritingMode.vertical||k){k=!1;var M=new e.Point(E.tileAnchorX,E.tileAnchorY),A=h.projection.projectTilePoint(M.x,M.y,c.canonical),C=A.x,I=A.y,P=A.z;if(u){var z=u(M),D=d(z,3);C+=D[0],I+=D[1],P+=D[2]}var R=[C,I,P,1];if(e.transformMat4$1(R,R,n),vt(R,y)){var B=gt(i.transform.cameraToCenterDistance,R[3]),F=e.evaluateSizeForFeature(f,p,E),O=s?F/B:F*B,N=yt(C,I,P,a);if(N[3]<=0)St(S,g);else{var H={},U=s?null:u,j=wt(E,O,!1,l,n,a,o,t.glyphOffsetArray,x,g,v,N,M,H,w,U,h.projection,c,s);k=j.useVertical,U&&j.needsFlipping&&(H={}),(j.notEnoughRoom||k||j.needsFlipping&&wt(E,O,!0,l,n,a,o,t.glyphOffsetArray,x,g,v,N,M,H,w,U,h.projection,c,s).notEnoughRoom)&&St(S,g)}}else St(S,g)}else St(S,g)}r?(t.text.dynamicLayoutVertexBuffer.updateData(g),v&&t.text.globeExtVertexBuffer.updateData(v)):(t.icon.dynamicLayoutVertexBuffer.updateData(g),v&&t.icon.globeExtVertexBuffer.updateData(v))}function xt(e,t,n,i,r,a,o,s,l,u,c,d,h,f,p,m){var y=s.lineStartIndex,g=s.glyphStartIndex,v=s.segment,_=g+s.numGlyphs,x=y+s.lineLength,b=t.getoffsetX(g),w=t.getoffsetX(_-1),k=Et(e*b,n,i,r,a,o,v,y,x,l,u,c,d,h,!0,f,p,m);if(!k)return null;var T=Et(e*w,n,i,r,a,o,v,y,x,l,u,c,d,h,!0,f,p,m);return T?{first:k,last:T}:null}function bt(t,n,i,r){return t===e.WritingMode.horizontal&&Math.abs(r)>Math.abs(i)?{useVertical:!0}:t===e.WritingMode.vertical?r>0?{needsFlipping:!0}:null:n!==dt.unknown&&function(e,t){return 0===e||Math.abs(t/e)>ht}(i,r)?n===dt.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function wt(t,n,i,r,a,o,s,l,u,c,h,f,p,m,y,g,v,_,x){var b=n/24,w=t.lineOffsetX*b,k=t.lineOffsetY*b,T=t.lineStartIndex,E=t.glyphStartIndex,S=t.numGlyphs,L=t.segment,M=t.writingMode,A=t.flipState,C=T+t.lineLength,I=function(t){if(h){var n=d(t.up,3),i=n[0],r=n[1],a=n[2],o=c.length;e.updateGlobeVertexNormal(h,o+0,i,r,a),e.updateGlobeVertexNormal(h,o+1,i,r,a),e.updateGlobeVertexNormal(h,o+2,i,r,a),e.updateGlobeVertexNormal(h,o+3,i,r,a)}var s=d(t.point,3),l=s[0],u=s[1],f=s[2];e.addDynamicAttributes(c,l,u,f,t.angle)};if(S>1){var P=xt(b,l,w,k,i,f,p,t,u,o,m,g,!1,v,_,x);if(!P)return{notEnoughRoom:!0};if(r&&!i){var z,D,R,B,F=d(P.first.point,3),O=F[0],N=F[1],H=F[2],U=d(P.last.point,3),j=U[0],V=U[1],W=U[2];z=yt(O,N,H,s),O=(D=d(z,2))[0],N=D[1],R=yt(j,V,W,s);var G=bt(M,A,((j=(B=d(R,2))[0])-O)*y,(V=B[1])-N);if(t.flipState=G&&G.needsFlipping?dt.flipRequired:dt.flipNotRequired,G)return G}I(P.first);for(var q=E+1;q<E+S-1;q++){var Z=Et(b*l.getoffsetX(q),w,k,i,f,p,L,T,C,u,o,m,g,!1,!1,v,_,x);if(!Z)return c.length-=4*(q-E),{notEnoughRoom:!0};I(Z)}I(P.last)}else{if(r&&!i){var X=yt(p.x,p.y,0,a),K=T+L+1,Y=new e.Point(u.getx(K),u.gety(K)),J=yt(Y.x,Y.y,0,a),$=J[3]>0?J:Tt(p,Y,X,1,a,void 0,v,_.canonical),Q=bt(M,A,($[0]-X[0])*y,$[1]-X[1]);if(t.flipState=Q&&Q.needsFlipping?dt.flipRequired:dt.flipNotRequired,Q)return Q}var ee=Et(b*l.getoffsetX(E),w,k,i,f,p,L,T,C,u,o,m,g,!1,!1,v,_,x);if(!ee)return{notEnoughRoom:!0};I(ee)}return{}}function kt(e,t,n,i,r){var a=i.projectTilePoint(e.x,e.y,t),o=a.x,s=a.y,l=a.z;if(!r)return yt(o,s,l,n);var u=r(e),c=d(u,3);return yt(o+c[0],s+c[1],l+c[2],n)}function Tt(t,n,i,r,a,o,s,l){var u=kt(t.sub(n)._unit()._add(t),l,a,s,o);return e.sub(u,i,u),e.normalize(u,u),e.scaleAndAdd(u,i,u,r)}function Et(t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,y,g,v){var _=r?t-n:t+n,x=_>0?1:-1,b=0;r&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);for(var w=l+s+(x>0?0:1)|0,k=a,T=a,E=0,S=0,L=Math.abs(_),M=[],A=[],C=o,I=C,P=function(){return Tt(I,C,T,L-E+1,d,f,y,g.canonical)};E+S<=L;){if((w+=x)<l||w>=u)return null;if(T=k,I=C,M.push(T),p&&A.push(I),C=new e.Point(c.getx(w),c.gety(w)),!(k=h[w])){var z=kt(C,g.canonical,d,y,f);k=z[3]>0?h[w]=z:P()}E+=S,S=e.distance(T,k)}m&&f&&(h[w]&&(k=P(),S=e.distance(T,k)),h[w]=k);var D=(L-E)/S,R=C.sub(I)._mult(D)._add(I),B=e.sub([],k,T),F=e.scaleAndAdd([],T,B,D),O=[0,0,1],N=B[0],H=B[1];if(v&&(0!==(O=y.upVector(g.canonical,R.x,R.y))[0]||0!==O[1]||1!==O[2])){var U=[O[2],0,-O[0]],j=e.cross([],O,U);e.normalize(U,U),e.normalize(j,j),N=e.dot(B,U),H=e.dot(B,j)}if(i){var V=e.cross([],O,B);e.normalize(V,V),e.scaleAndAdd(F,F,V,i*x)}var W=b+Math.atan2(H,N);return M.push(F),p&&A.push(R),{point:F,angle:W,path:M,tilePath:A,up:O}}function St(e,t){var n=t.length,i=n+4*e;t.resize(i),t.float32.fill(-1/0,4*n,4*i)}function Lt(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e[3]=n[3]*i+n[7]*r+n[15],e}var Mt=100,At=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ct(e.width+200,e.height+200,25),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ct(e.width+200,e.height+200,25);f(this,t),this.transform=e,this.grid=i,this.ignoredGrid=r,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Mt,this.screenBottomBoundary=e.height+Mt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=n}return p(t,[{key:"placeCollisionBox",value:function(e,t,n,i,r,a,o,s){var l=n.projectedAnchorX,u=n.projectedAnchorY,c=n.projectedAnchorZ,h=n.elevation,f=n.tileID,p=e.getProjection();if(h&&f){var m=p.upVector(f.canonical,n.tileAnchorX,n.tileAnchorY),y=d(m,3),g=y[0],v=y[1],_=y[2],x=p.upVectorScale(f.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=g*h*x,u+=v*h*x,c+=_*h*x}var b=this.projectAndGetPerspectiveRatio(o,l,u,c,n.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),w=a*b.perspectiveRatio,k=(n.x1*t+i.x-n.padding)*w+b.point.x,T=(n.y1*t+i.y-n.padding)*w+b.point.y,E=(n.x2*t+i.x+n.padding)*w+b.point.x,S=(n.y2*t+i.y+n.padding)*w+b.point.y,L=b.perspectiveRatio<=.55||b.occluded;return!this.isInsideGrid(k,T,E,S)||!r&&this.grid.hitTest(k,T,E,S,s)||L?{box:[],offscreen:!1,occluded:b.occluded}:{box:[k,T,E,S],offscreen:this.isOffscreen(k,T,E,S),occluded:!1}}},{key:"placeCollisionCircles",value:function(t,n,i,r,a,o,s,l,u,c,f,p,m,y,g){var v=[],_=this.transform.elevation,x=t.getProjection(),b=_?_.getAtTileOffsetFunc(g,this.transform.center.lat,this.transform.worldSize,x):null,w=new e.Point(i.tileAnchorX,i.tileAnchorY),k=x.projectTilePoint(w.x,w.y,g.canonical),T=k.x,E=k.y,S=k.z;if(b){var L=b(w),M=d(L,3);T+=M[0],E+=M[1],S+=M[2]}var A="globe"===x.name,C=this.projectAndGetPerspectiveRatio(s,T,E,S,g,A||!!_||this.transform.pitch>0,x),I=C.perspectiveRatio,P=(f?o/I:o*I)/e.ONE_EM,z=yt(T,E,S,l),D=C.signedDistanceFromCamera>0?xt(P,a,i.lineOffsetX*P,i.lineOffsetY*P,!1,z,w,i,r,l,{},_&&!f?b:null,f&&!!_,x,g,f):null,R=!1,B=!1,F=!0;if(D&&!C.occluded){for(var O=.5*m*I+y,N=new e.Point(-100,-100),H=new e.Point(this.screenRightBoundary,this.screenBottomBoundary),U=new ut,j=D.first,V=D.last,W=j.path.length,G=[],q=W-1;q>=1;q--)G.push(j.path[q]);for(var Z=1;Z<V.path.length;Z++)G.push(V.path[Z]);var X=2.5*O;u&&(G=G.map((function(e,t){var n=d(e,3),i=n[0],r=n[1],a=n[2];return b&&!A&&(a=b(t<W-1?j.tilePath[W-1-t]:V.tilePath[t-W+2])[2]),yt(i,r,a,u)})),G.some((function(e){return e[3]<=0}))&&(G=[]));var K=[];if(G.length>0){var Y,J=1/0,$=-1/0,Q=1/0,ee=-1/0,te=h(G);try{for(te.s();!(Y=te.n()).done;){var ne=Y.value;J=Math.min(J,ne[0]),Q=Math.min(Q,ne[1]),$=Math.max($,ne[0]),ee=Math.max(ee,ne[1])}}catch(ye){te.e(ye)}finally{te.f()}$>=N.x&&J<=H.x&&ee>=N.y&&Q<=H.y&&(K=[G.map((function(t){return new e.Point(t[0],t[1])}))],(J<N.x||$>H.x||Q<N.y||ee>H.y)&&(K=e.clipLine(K,N.x,N.y,H.x,H.y)))}var ie,re=h(K);try{for(re.s();!(ie=re.n()).done;){var ae=ie.value;U.reset(ae,.25*O);var oe=0;oe=U.length<=.5*O?1:Math.ceil(U.paddedLength/X)+1;for(var se=0;se<oe;se++){var le=se/Math.max(oe-1,1),ue=U.lerp(le),ce=ue.x+Mt,de=ue.y+Mt;v.push(ce,de,O,0);var he=ce-O,fe=de-O,pe=ce+O,me=de+O;if(F=F&&this.isOffscreen(he,fe,pe,me),B=B||this.isInsideGrid(he,fe,pe,me),!n&&this.grid.hitTestCircle(ce,de,O,p)&&(R=!0,!c))return{circles:[],offscreen:!1,collisionDetected:R,occluded:!1}}}}catch(ye){re.e(ye)}finally{re.f()}}return{circles:!c&&R||!B?[]:v,offscreen:F,collisionDetected:R,occluded:C.occluded}}},{key:"queryRenderedSymbols",value:function(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};var n,i=[],r=1/0,a=1/0,o=-1/0,s=-1/0,l=h(t);try{for(l.s();!(n=l.n()).done;){var u=n.value,c=new e.Point(u.x+Mt,u.y+Mt);r=Math.min(r,c.x),a=Math.min(a,c.y),o=Math.max(o,c.x),s=Math.max(s,c.y),i.push(c)}}catch(x){l.e(x)}finally{l.f()}var d,f=this.grid.query(r,a,o,s).concat(this.ignoredGrid.query(r,a,o,s)),p={},m={},y=h(f);try{for(y.s();!(d=y.n()).done;){var g=d.value,v=g.key;if(void 0===p[v.bucketInstanceId]&&(p[v.bucketInstanceId]={}),!p[v.bucketInstanceId][v.featureIndex]){var _=[new e.Point(g.x1,g.y1),new e.Point(g.x2,g.y1),new e.Point(g.x2,g.y2),new e.Point(g.x1,g.y2)];e.polygonIntersectsPolygon(i,_)&&(p[v.bucketInstanceId][v.featureIndex]=!0,void 0===m[v.bucketInstanceId]&&(m[v.bucketInstanceId]=[]),m[v.bucketInstanceId].push(v.featureIndex))}}}catch(x){y.e(x)}finally{y.f()}return m}},{key:"insertCollisionBox",value:function(e,t,n,i,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:i,collisionGroupID:r},e[0],e[1],e[2],e[3])}},{key:"insertCollisionCircles",value:function(e,t,n,i,r){for(var a=t?this.ignoredGrid:this.grid,o={bucketInstanceId:n,featureIndex:i,collisionGroupID:r},s=0;s<e.length;s+=4)a.insertCircle(o,e[s],e[s+1],e[s+2])}},{key:"projectAndGetPerspectiveRatio",value:function(t,n,i,r,a,o,s){var l=[n,i,r,1],u=!1;if(r||this.transform.pitch>0){if(e.transformMat4$1(l,l,t),this.fogState&&a&&"globe"!==s.name){var c=function(t,n,i,r,a,o){var s=o.calculateFogTileMatrix(a),l=[n,i,r];return e.transformMat4(l,l,s),O(t,l,o.pitch,o._fov)}(this.fogState,n,i,r,a.toUnwrapped(),this.transform);u=c>.9}}else Lt(l,l,t);var d=l[3];return{point:new e.Point((l[0]/d+1)/2*this.transform.width+Mt,(-l[1]/d+1)/2*this.transform.height+Mt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(s)/d*.5,1.5),signedDistanceFromCamera:d,occluded:o&&l[2]>d||u}}},{key:"isOffscreen",value:function(e,t,n,i){return n<Mt||e>=this.screenRightBoundary||i<Mt||t>this.screenBottomBoundary}},{key:"isInsideGrid",value:function(e,t,n,i){return n>=0&&e<this.gridRightBoundary&&i>=0&&t<this.gridBottomBoundary}},{key:"getViewportMatrix",value:function(){var t=e.identity([]);return e.translate(t,t,[-100,-100,0]),t}}]),t}();function Ct(t,n,i){var r=n.createTileMatrix(t,t.worldSize,i.toUnwrapped());return e.multiply(new Float32Array(16),t.projMatrix,r)}function It(e,t,n){if(t.projection.name===n.projection.name)return e.projMatrix;var i=n.clone();return i.setProjection(t.projection),Ct(i,t.getProjection(),e)}function Pt(e,t,n){return t.name===n.projection.name?e.projMatrix:Ct(n,t,e)}var zt=function(){function e(t,n,i,r){f(this,e),this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):r&&i?1:0,this.placed=i}return p(e,[{key:"isHidden",value:function(){return 0===this.opacity&&!this.placed}}]),e}(),Dt=function(){function e(t,n,i,r,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];f(this,e),this.text=new zt(t?t.text:null,n,i,a),this.icon=new zt(t?t.icon:null,n,r,a),this.clipped=o}return p(e,[{key:"isHidden",value:function(){return this.text.isHidden()&&this.icon.isHidden()}}]),e}(),Rt=p((function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];f(this,e),this.text=t,this.icon=n,this.skipFade=i,this.clipped=r})),Bt=p((function t(){f(this,t),this.invProjMatrix=e.create(),this.viewportMatrix=e.create(),this.circles=[]})),Ft=p((function e(t,n,i,r,a){f(this,e),this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=a})),Ot=function(){function e(t){f(this,e),this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}return p(e,[{key:"get",value:function(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){var t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:function(e){return e.collisionGroupID===t}}}return this.collisionGroups[e]}}]),e}();function Nt(t,n,i,r,a){var o=e.getAnchorAlignment(t),s=-(o.horizontalAlign-.5)*n,l=-(o.verticalAlign-.5)*i,u=e.evaluateVariableOffset(t,r);return new e.Point(s+u[0]*a,l+u[1]*a)}function Ht(t,n,i,r,a){var o=new e.Point(t,n);return i&&o._rotate(r?a:-a),o}var Ut=function(){function t(e,n,i,r,a){f(this,t),this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new At(this.transform,a),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new Ot(i),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}return p(t,[{key:"getBucketParts",value:function(t,n,i,r){var a=i.getBucket(n),o=i.latestFeatureIndex;if(a&&o&&n.id===a.layerIds[0]){var s=a.layers[0].layout,l=i.collisionBoxArray,u=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),c=i.tileSize/e.EXTENT,d=i.tileID.toUnwrapped();this.transform.setProjection(a.projection);var f,p,m,y=(f=i.tileID,p=a.getProjection(),m=this.transform,p.name===this.projection?m.calculateProjMatrix(f.toUnwrapped()):Ct(m,p,f)),g="map"===s.get("text-pitch-alignment"),v="map"===s.get("text-rotation-alignment");n.compileFilter();var _=n.dynamicFilter(),x=n.dynamicFilterNeedsFeature(),b=this.transform.calculatePixelsToTileUnitsMatrix(i),w=pt(y,i.tileID.canonical,g,v,this.transform,a.getProjection(),b),k=null;if(g){var T=mt(y,i.tileID.canonical,g,v,this.transform,a.getProjection(),b);k=e.multiply([],this.transform.labelPlaneMatrix,T)}var E=null;_&&i.latestFeatureIndex&&(E={unwrappedTileID:d,dynamicFilter:_,dynamicFilterNeedsFeature:x,featureIndex:i.latestFeatureIndex}),this.retainedQueryData[a.bucketInstanceId]=new Ft(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,i.tileID);var S={bucket:a,layout:s,posMatrix:y,textLabelPlaneMatrix:w,labelToScreenMatrix:k,clippingData:E,scale:u,textPixelRatio:c,holdingForFade:i.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:e.evaluateSizeForZoom(a.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.evaluateSizeForZoom(a.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(r){var L,M=h(a.sortKeyRanges);try{for(M.s();!(L=M.n()).done;){var A=L.value,C=A.sortKey,I=A.symbolInstanceStart,P=A.symbolInstanceEnd;t.push({sortKey:C,symbolInstanceStart:I,symbolInstanceEnd:P,parameters:S})}}catch(z){M.e(z)}finally{M.f()}}else t.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:S})}}},{key:"attemptAnchorPlacement",value:function(e,t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,y,g){var v,_=d.textOffset0,x=d.textOffset1,b=d.crossTileID,w=[_,x],k=Nt(e,n,i,w,r),T=this.collisionIndex.placeCollisionBox(f,r,t,Ht(k.x,k.y,a,o,this.transform.angle),c,s,l,u.predicate);if(m){var E=f.getSymbolInstanceIconSize(g,this.transform.zoom,d.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(f,E,m,Ht(k.x,k.y,a,o,this.transform.angle),c,s,l,u.predicate).box.length)return}if(T.box.length>0)return this.prevPlacement&&this.prevPlacement.variableOffsets[b]&&this.prevPlacement.placements[b]&&this.prevPlacement.placements[b].text&&(v=this.prevPlacement.variableOffsets[b].anchor),this.variableOffsets[b]={textOffset:w,width:n,height:i,anchor:e,textScale:r,prevAnchor:v},this.markUsedJustification(f,e,d,p),f.allowVerticalPlacement&&(this.markUsedOrientation(f,p,d),this.placedOrientations[b]=p),{shift:k,placedGlyphBoxes:T}}},{key:"placeLayerBucketPart",value:function(t,n,i,r){var a=this,o=t.parameters,s=o.bucket,l=o.layout,u=o.posMatrix,c=o.textLabelPlaneMatrix,d=o.labelToScreenMatrix,f=o.clippingData,p=o.textPixelRatio,m=o.holdingForFade,y=o.collisionBoxArray,g=o.partiallyEvaluatedTextSize,v=o.partiallyEvaluatedIconSize,_=o.collisionGroup,x=l.get("text-optional"),b=l.get("icon-optional"),w=l.get("text-allow-overlap"),k=l.get("icon-allow-overlap"),T="map"===l.get("text-rotation-alignment"),E="map"===l.get("text-pitch-alignment"),S="none"!==l.get("icon-text-fit"),L="viewport-y"===l.get("symbol-z-order");this.transform.setProjection(s.projection);var M=w&&(k||!s.hasIconData()||b),A=k&&(w||!s.hasTextData()||x);!s.collisionArrays&&y&&s.deserializeCollisionBoxes(y),i&&r&&s.updateCollisionDebugBuffers(this.transform.zoom,y);var C=function(t,r,o){var y=t.crossTileID,L=t.numVerticalGlyphVertices;if(f){var C={zoom:a.transform.zoom,pitch:a.transform.pitch},I=null;if(f.dynamicFilterNeedsFeature){var P=a.retainedQueryData[s.bucketInstanceId];I=f.featureIndex.loadFeature({featureIndex:t.featureIndex,bucketIndex:P.bucketIndex,sourceLayerIndex:P.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,f.dynamicFilter)(C,I,a.retainedQueryData[s.bucketInstanceId].tileID.canonical,new e.Point(t.tileAnchorX,t.tileAnchorY),a.transform.calculateDistanceTileData(f.unwrappedTileID)))return a.placements[y]=new Rt(!1,!1,!1,!0),void n.add(y)}if(!n.has(y))if(m)a.placements[y]=new Rt(!1,!1,!1);else{var z=!1,D=!1,R=!0,B=!1,F=!1,O=null,N={box:null,offscreen:null,occluded:null},H={box:null,offscreen:null,occluded:null},U=null,j=null,V=null,W=0,G=0,q=0;o.textFeatureIndex?W=o.textFeatureIndex:t.useRuntimeCollisionCircles&&(W=t.featureIndex),o.verticalTextFeatureIndex&&(G=o.verticalTextFeatureIndex);var Z=function(e){e.tileID=a.retainedQueryData[s.bucketInstanceId].tileID;var t=a.transform.elevation;(t||e.elevation)&&(e.elevation=t?t.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0)},X=o.textBox;if(X){Z(X);var K=function(n){var i=e.WritingMode.horizontal;if(s.allowVerticalPlacement&&!n&&a.prevPlacement){var r=a.prevPlacement.placedOrientations[y];r&&(a.placedOrientations[y]=r,i=r,a.markUsedOrientation(s,i,t))}return i},Y=function(t,n){if(s.allowVerticalPlacement&&L>0&&o.verticalTextBox){var i,r=h(s.writingModes);try{for(r.s();!(i=r.n()).done&&(i.value===e.WritingMode.vertical?(N=n(),H=N):N=t(),!(N&&N.box&&N.box.length)););}catch(a){r.e(a)}finally{r.f()}}else N=t()};if(l.get("text-variable-anchor")){var J=l.get("text-variable-anchor");if(a.prevPlacement&&a.prevPlacement.variableOffsets[y]){var $=a.prevPlacement.variableOffsets[y];J.indexOf($.anchor)>0&&(J=J.filter((function(e){return e!==$.anchor})),J.unshift($.anchor))}var Q=function(e,n,i){var o=s.getSymbolInstanceTextSize(g,t,a.transform.zoom,r),l=(e.x2-e.x1)*o+2*e.padding,c=(e.y2-e.y1)*o+2*e.padding,d=S&&!k?n:null;d&&Z(d);for(var h={box:[],offscreen:!1,occluded:!1},f=w?2*J.length:J.length,m=0;m<f;++m){var y=a.attemptAnchorPlacement(J[m%J.length],e,l,c,o,T,E,p,u,_,m>=J.length,t,r,s,i,d,g,v);if(y&&(h=y.placedGlyphBoxes)&&h.box&&h.box.length){z=!0,O=y.shift;break}}return h};Y((function(){return Q(X,o.iconBox,e.WritingMode.horizontal)}),(function(){var t=o.verticalTextBox;return t&&Z(t),s.allowVerticalPlacement&&!(N&&N.box&&N.box.length)&&L>0&&t?Q(t,o.verticalIconBox,e.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),N&&(z=N.box,R=N.offscreen,B=N.occluded);var ee=K(!(!N||!N.box));if(!z&&a.prevPlacement){var te=a.prevPlacement.variableOffsets[y];te&&(a.variableOffsets[y]=te,a.markUsedJustification(s,te.anchor,t,ee))}}else{var ne=function(n,i){var o=s.getSymbolInstanceTextSize(g,t,a.transform.zoom,r),l=a.collisionIndex.placeCollisionBox(s,o,n,new e.Point(0,0),w,p,u,_.predicate);return l&&l.box&&l.box.length&&(a.markUsedOrientation(s,i,t),a.placedOrientations[y]=i),l};Y((function(){return ne(X,e.WritingMode.horizontal)}),(function(){var t=o.verticalTextBox;return s.allowVerticalPlacement&&L>0&&t?(Z(t),ne(t,e.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),K(!!(N&&N.box&&N.box.length))}}if(z=(U=N)&&U.box&&U.box.length>0,R=U&&U.offscreen,B=U&&U.occluded,t.useRuntimeCollisionCircles){var ie=s.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),re=e.evaluateSizeForFeature(s.textSizeData,g,ie),ae=l.get("text-padding");j=a.collisionIndex.placeCollisionCircles(s,w,ie,s.lineVertexArray,s.glyphOffsetArray,re,u,c,d,i,E,_.predicate,t.collisionCircleDiameter*re/e.ONE_EM,ae,a.retainedQueryData[s.bucketInstanceId].tileID),z=w||j.circles.length>0&&!j.collisionDetected,R=R&&j.offscreen,B=j.occluded}if(o.iconFeatureIndex&&(q=o.iconFeatureIndex),o.iconBox){var oe=function(n){Z(n);var i=S&&O?Ht(O.x,O.y,T,E,a.transform.angle):new e.Point(0,0),r=s.getSymbolInstanceIconSize(v,a.transform.zoom,t.placedIconSymbolIndex);return a.collisionIndex.placeCollisionBox(s,r,n,i,k,p,u,_.predicate)};D=H&&H.box&&H.box.length&&o.verticalIconBox?(V=oe(o.verticalIconBox)).box.length>0:(V=oe(o.iconBox)).box.length>0,R=R&&V.offscreen,F=V.occluded}var se=x||0===t.numHorizontalGlyphVertices&&0===L,le=b||0===t.numIconVertices;if(se||le?le?se||(D=D&&z):z=D&&z:D=z=D&&z,z&&U&&U.box&&a.collisionIndex.insertCollisionBox(U.box,l.get("text-ignore-placement"),s.bucketInstanceId,H&&H.box&&G?G:W,_.ID),D&&V&&a.collisionIndex.insertCollisionBox(V.box,l.get("icon-ignore-placement"),s.bucketInstanceId,q,_.ID),j&&(z&&a.collisionIndex.insertCollisionCircles(j.circles,l.get("text-ignore-placement"),s.bucketInstanceId,W,_.ID),i)){var ue=s.bucketInstanceId,ce=a.collisionCircleArrays[ue];void 0===ce&&(ce=a.collisionCircleArrays[ue]=new Bt);for(var de=0;de<j.circles.length;de+=4)ce.circles.push(j.circles[de+0]),ce.circles.push(j.circles[de+1]),ce.circles.push(j.circles[de+2]),ce.circles.push(j.collisionDetected?1:0)}var he="globe"!==s.projection.name;M=M&&(he||!B),A=A&&(he||!F),a.placements[y]=new Rt(z||M,D||A,R||s.justReloaded),n.add(y)}};if(L)for(var I=s.getSortedSymbolIndexes(this.transform.angle),P=I.length-1;P>=0;--P){var z=I[P];C(s.symbolInstances.get(z),z,s.collisionArrays[z])}else for(var D=t.symbolInstanceStart;D<t.symbolInstanceEnd;D++)C(s.symbolInstances.get(D),D,s.collisionArrays[D]);if(i&&s.bucketInstanceId in this.collisionCircleArrays){var R=this.collisionCircleArrays[s.bucketInstanceId];e.invert(R.invProjMatrix,u),R.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}},{key:"markUsedJustification",value:function(t,n,i,r){var a=i.leftJustifiedTextSymbolIndex,o=i.centerJustifiedTextSymbolIndex,s=i.rightJustifiedTextSymbolIndex,l=i.verticalPlacedTextSymbolIndex,u=i.crossTileID,c=e.getAnchorJustification(n),d=r===e.WritingMode.vertical?l:"left"===c?a:"center"===c?o:"right"===c?s:-1;a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=d>=0&&a!==d?0:u),o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=d>=0&&o!==d?0:u),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=d>=0&&s!==d?0:u),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=d>=0&&l!==d?0:u)}},{key:"markUsedOrientation",value:function(t,n,i){var r=n===e.WritingMode.horizontal||n===e.WritingMode.horizontalOnly?n:0,a=n===e.WritingMode.vertical?n:0,o=i.leftJustifiedTextSymbolIndex,s=i.centerJustifiedTextSymbolIndex,l=i.rightJustifiedTextSymbolIndex,u=i.verticalPlacedTextSymbolIndex,c=t.text.placedSymbolArray;o>=0&&(c.get(o).placedOrientation=r),s>=0&&(c.get(s).placedOrientation=r),l>=0&&(c.get(l).placedOrientation=r),u>=0&&(c.get(u).placedOrientation=a)}},{key:"commit",value:function(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;var t=this.prevPlacement,n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;var i=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},a=t?t.variableOffsets:{},o=t?t.placedOrientations:{};for(var s in this.placements){var l=this.placements[s],u=r[s];u?(this.opacities[s]=new Dt(u,i,l.text,l.icon,null,l.clipped),n=n||l.text!==u.text.placed||l.icon!==u.icon.placed):(this.opacities[s]=new Dt(null,i,l.text,l.icon,l.skipFade,l.clipped),n=n||l.text||l.icon)}for(var c in r){var d=r[c];if(!this.opacities[c]){var h=new Dt(d,i,!1,!1);h.isHidden()||(this.opacities[c]=h,n=n||d.text.placed||d.icon.placed)}}for(var f in a)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=a[f]);for(var p in o)this.placedOrientations[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.placedOrientations[p]=o[p]);n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}},{key:"updateLayerOpacities",value:function(e,t){var n,i=new Set,r=h(t);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=a.getBucket(e);o&&a.latestFeatureIndex&&e.id===o.layerIds[0]&&this.updateBucketOpacities(o,i,a.collisionBoxArray)}}catch(s){r.e(s)}finally{r.f()}}},{key:"updateBucketOpacities",value:function(t,n,i){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();var r=t.layers[0].layout,a=!!t.layers[0].dynamicFilter(),o=new Dt(null,0,!1,!1,!0),s=r.get("text-allow-overlap"),l=r.get("icon-allow-overlap"),u=r.get("text-variable-anchor"),c="map"===r.get("text-rotation-alignment"),d="map"===r.get("text-pitch-alignment"),h="none"!==r.get("icon-text-fit"),f=new Dt(null,0,s&&(l||!t.hasIconData()||r.get("icon-optional")),l&&(s||!t.hasTextData()||r.get("text-optional")),!0);!t.collisionArrays&&i&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(i);for(var p=function(e,t,n){for(var i=0;i<t/4;i++)e.opacityVertexArray.emplaceBack(n)},m=0,y=0;y<t.symbolInstances.length;y++){var g=t.symbolInstances.get(y),v=g.numHorizontalGlyphVertices,_=g.numVerticalGlyphVertices,x=g.crossTileID,b=g.numIconVertices,w=n.has(x),k=this.opacities[x];w?k=o:k||(k=f,this.opacities[x]=k),n.add(x);var T=v>0||_>0,E=b>0,S=this.placedOrientations[x],L=S===e.WritingMode.vertical,M=S===e.WritingMode.horizontal||S===e.WritingMode.horizontalOnly;if(!T&&!E||k.isHidden()||m++,T){var A=Yt(k.text);p(t.text,v,L?Jt:A),p(t.text,_,M?Jt:A);var C=k.text.isHidden(),I=g.leftJustifiedTextSymbolIndex,P=g.centerJustifiedTextSymbolIndex,z=g.rightJustifiedTextSymbolIndex,D=g.verticalPlacedTextSymbolIndex,R=t.text.placedSymbolArray,B=C||L?1:0;I>=0&&(R.get(I).hidden=B),P>=0&&(R.get(P).hidden=B),z>=0&&(R.get(z).hidden=B),D>=0&&(R.get(D).hidden=C||M?1:0);var F=this.variableOffsets[x];F&&this.markUsedJustification(t,F.anchor,g,S);var O=this.placedOrientations[x];O&&(this.markUsedJustification(t,"left",g,O),this.markUsedOrientation(t,O,g))}if(E){var N=Yt(k.icon),H=g.placedIconSymbolIndex,U=g.verticalPlacedIconSymbolIndex,j=t.icon.placedSymbolArray,V=k.icon.isHidden()?1:0;H>=0&&(p(t.icon,b,L?Jt:N),j.get(H).hidden=V),U>=0&&(p(t.icon,g.numVerticalIconVertices,M?Jt:N),j.get(U).hidden=V)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){var W=t.collisionArrays[y];if(W){var G=new e.Point(0,0),q=!0;if(W.textBox||W.verticalTextBox){if(u){var Z=this.variableOffsets[x];Z?(G=Nt(Z.anchor,Z.width,Z.height,Z.textOffset,Z.textScale),c&&G._rotate(d?this.transform.angle:-this.transform.angle)):q=!1}a&&(q=!k.clipped),W.textBox&&jt(t.textCollisionBox.collisionVertexArray,k.text.placed,!q||L,G.x,G.y),W.verticalTextBox&&jt(t.textCollisionBox.collisionVertexArray,k.text.placed,!q||M,G.x,G.y)}var X=q&&Boolean(!M&&W.verticalIconBox);W.iconBox&&jt(t.iconCollisionBox.collisionVertexArray,k.icon.placed,X,h?G.x:0,h?G.y:0),W.verticalIconBox&&jt(t.iconCollisionBox.collisionVertexArray,k.icon.placed,!X,h?G.x:0,h?G.y:0)}}}if(t.fullyClipped=0===m,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){var K=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=K.invProjMatrix,t.placementViewportMatrix=K.viewportMatrix,t.collisionCircleArray=K.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}},{key:"symbolFadeChange",value:function(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}},{key:"zoomAdjustment",value:function(e){return Math.max(0,(this.transform.zoom-e)/1.5)}},{key:"hasTransitions",value:function(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}},{key:"stillRecent",value:function(e,t){var n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}},{key:"setStale",value:function(){this.stale=!0}}]),t}();function jt(e,t,n,i,r){e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0)}var Vt=Math.pow(2,25),Wt=Math.pow(2,24),Gt=Math.pow(2,17),qt=Math.pow(2,16),Zt=Math.pow(2,9),Xt=Math.pow(2,8),Kt=Math.pow(2,1);function Yt(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;var t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*Vt+t*Wt+n*Gt+t*qt+n*Zt+t*Xt+n*Kt+t}var Jt=0,$t=function(){function e(t){f(this,e),this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}return p(e,[{key:"continuePlacement",value:function(e,t,n,i,r){for(var a=this._bucketParts;this._currentTileIndex<e.length;)if(t.getBucketParts(a,i,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((function(e,t){return e.sortKey-t.sortKey})));this._currentPartIndex<a.length;){var o=a[this._currentPartIndex];if(t.placeLayerBucketPart(o,this._seenCrossTileIDs,n,0===o.symbolInstanceStart),this._currentPartIndex++,r())return!0}return!1}}]),e}(),Qt=function(){function t(e,n,i,r,a,o,s,l){f(this,t),this.placement=new Ut(e,a,o,s,l),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}return p(t,[{key:"isDone",value:function(){return this._done}},{key:"continuePlacement",value:function(t,n,i){for(var r=this,a=e.exported.now(),o=function(){var t=e.exported.now()-a;return!r._forceFullPlacement&&t>2};this._currentPlacementIndex>=0;){var s=n[t[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){if(this._inProgressLayer||(this._inProgressLayer=new $t(s)),this._inProgressLayer.continuePlacement(i[s.source],this.placement,this._showCollisionBoxes,s,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}},{key:"commit",value:function(e){return this.placement.commit(e),this.placement}}]),t}(),en=512/e.EXTENT/2,tn=function(){function t(n,i,r){f(this,t),this.tileID=n,this.bucketInstanceId=r,this.index=new e.KDBush(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];for(var a=n.canonical.x*e.EXTENT,o=n.canonical.y*e.EXTENT,s=0;s<i.length;s++){var l=i.get(s),u=l.key,c=l.crossTileID,d=l.tileAnchorX,h=l.tileAnchorY,p=Math.floor((a+d)*en),m=Math.floor((o+h)*en);this.index.add(p,m),this.keys.push(u),this.crossTileIDs.push(c)}this.index.finish()}return p(t,[{key:"findMatches",value:function(t,n,i){for(var r=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),a=en/Math.pow(2,n.canonical.z-this.tileID.canonical.z),o=n.canonical.x*e.EXTENT,s=n.canonical.y*e.EXTENT,l=0;l<t.length;l++){var u=t.get(l);if(!u.crossTileID){var c,d=u.key,f=u.tileAnchorX,p=u.tileAnchorY,m=Math.floor((o+f)*a),y=Math.floor((s+p)*a),g=this.index.range(m-r,y-r,m+r,y+r),v=h(g);try{for(v.s();!(c=v.n()).done;){var _=c.value,x=this.crossTileIDs[_];if(this.keys[_]===d&&!i.has(x)){i.add(x),u.crossTileID=x;break}}}catch(b){v.e(b)}finally{v.f()}}}}}]),t}(),nn=function(){function e(){f(this,e),this.maxCrossTileID=0}return p(e,[{key:"generate",value:function(){return++this.maxCrossTileID}}]),e}(),rn=function(){function e(){f(this,e),this.indexes={},this.usedCrossTileIDs={},this.lng=0}return p(e,[{key:"handleWrapJump",value:function(e){var t=Math.round((e-this.lng)/360);if(0!==t)for(var n in this.indexes){var i=this.indexes[n],r={};for(var a in i){var o=i[a];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+t),r[o.tileID.key]=o}this.indexes[n]=r}this.lng=e}},{key:"addBucket",value:function(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(var i=0;i<t.symbolInstances.length;i++)t.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);var r=this.usedCrossTileIDs[e.overscaledZ];for(var a in this.indexes){var o=this.indexes[a];if(Number(a)>e.overscaledZ)for(var s in o){var l=o[s];l.tileID.isChildOf(e)&&l.findMatches(t.symbolInstances,e,r)}else{var u=o[e.scaledTo(Number(a)).key];u&&u.findMatches(t.symbolInstances,e,r)}}for(var c=0;c<t.symbolInstances.length;c++){var d=t.symbolInstances.get(c);d.crossTileID||(d.crossTileID=n.generate(),r.add(d.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new tn(e,t.symbolInstances,t.bucketInstanceId),!0}},{key:"removeBucketCrossTileIDs",value:function(e,t){var n,i=h(t.crossTileIDs);try{for(i.s();!(n=i.n()).done;){var r=n.value;this.usedCrossTileIDs[e].delete(r)}}catch(a){i.e(a)}finally{i.f()}}},{key:"removeStaleBuckets",value:function(e){var t=!1;for(var n in this.indexes){var i=this.indexes[n];for(var r in i)e[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],t=!0)}return t}}]),e}(),an=function(){function e(){f(this,e),this.layerIndexes={},this.crossTileIDs=new nn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}return p(e,[{key:"addLayer",value:function(e,t,n,i){var r=this.layerIndexes[e.id];void 0===r&&(r=this.layerIndexes[e.id]=new rn);var a=!1,o={};"globe"!==i.name&&r.handleWrapJump(n);var s,l=h(t);try{for(l.s();!(s=l.n()).done;){var u=s.value,c=u.getBucket(e);c&&e.id===c.layerIds[0]&&(c.bucketInstanceId||(c.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(u.tileID,c,this.crossTileIDs)&&(a=!0),o[c.bucketInstanceId]=!0)}}catch(d){l.e(d)}finally{l.f()}return r.removeStaleBuckets(o)&&(a=!0),a}},{key:"pruneUnusedLayers",value:function(e){var t={};for(var n in e.forEach((function(e){t[e]=!0})),this.layerIndexes)t[n]||delete this.layerIndexes[n]}}]),e}(),on=function(t,n){return e.emitValidationErrors(t,n&&n.filter((function(e){return"source.canvas"!==e.identifier})))},sn=e.pick(tt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ln=e.pick(tt,["setCenter","setZoom","setBearing","setPitch"]),un={version:8,layers:[],sources:{}},cn={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0},dn=function(n){m(a,n);var i=y(a);function a(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(this,a),(n=i.call(this)).map=t,n.dispatcher=new j($e(),r(n)),n.imageManager=new z,n.imageManager.setEventedParent(r(n)),n.glyphManager=new e.GlyphManager(t._requestManager,o.localFontFamily?e.LocalGlyphMode.all:o.localIdeographFontFamily?e.LocalGlyphMode.ideographs:e.LocalGlyphMode.none,o.localFontFamily||o.localIdeographFontFamily),n.crossTileSymbolIndex=new an,n._layers={},n._num3DLayers=0,n._numSymbolLayers=0,n._numCircleLayers=0,n._serializedLayers={},n._sourceCaches={},n._otherSourceCaches={},n._symbolSourceCaches={},n._loaded=!1,n._availableImages=[],n._order=[],n._drapedFirstOrder=[],n._markersNeedUpdate=!1,n._resetUpdates(),n.dispatcher.broadcast("setReferrer",e.getReferrer());var s=r(n);return n._rtlTextPluginCallback=a.registerForPluginStateChange((function(t){s.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},(function(t,n){if(e.triggerPluginCompletionEvent(t),n&&n.every((function(e){return e})))for(var i in s._sourceCaches){var r=s._sourceCaches[i],a=r.getSource().type;"vector"!==a&&"geojson"!==a||r.reload()}}))})),n.on("data",(function(e){if("source"===e.dataType&&"metadata"===e.sourceDataType){var t=n.getSource(e.sourceId);if(t&&t.vectorLayerIds)for(var i in n._layers){var r=n._layers[i];r.source===t.id&&n._validateLayer(r)}}})),n}return p(a,[{key:"loadURL",value:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.Event("dataloading",{dataType:"style"}));var r="boolean"==typeof i.validate?i.validate:!e.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,i.accessToken);var a=this.map._requestManager.transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(a,(function(t,i){n._request=null,t?n.fire(new e.ErrorEvent(t)):i&&n._load(i,r)}))}},{key:"loadJSON",value:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.exported.frame((function(){n._request=null,n._load(t,!1!==i.validate)}))}},{key:"loadEmpty",value:function(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(un,!1)}},{key:"_updateLayerCount",value:function(e,t){var n=t?1:-1;e.is3D()&&(this._num3DLayers+=n),"circle"===e.type&&(this._numCircleLayers+=n),"symbol"===e.type&&(this._numSymbolLayers+=n)}},{key:"_load",value:function(t,n){if(!n||!on(this,e.validateStyle(t))){for(var i in this._loaded=!0,this.stylesheet=e.clone$1(t),this._updateMapProjection(),t.sources)this.addSource(i,t.sources[i],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);var r=et(this.stylesheet.layers);this._order=r.map((function(e){return e.id})),this._layers={},this._serializedLayers={};var a,o=h(r);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=e.createStyleLayer(s);l.setEventedParent(this,{layer:{id:l.id}}),this._layers[l.id]=l,this._serializedLayers[l.id]=l.serialize(),this._updateLayerCount(l,!0)}}catch(u){o.e(u)}finally{o.f()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new R(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load"))}}},{key:"terrainSetForDrapingOnly",value:function(){return!!this.terrain&&0===this.terrain.drapeRenderMode}},{key:"setProjection",value:function(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this._updateMapProjection()}},{key:"applyProjectionUpdate",value:function(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}},{key:"_updateMapProjection",value:function(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}},{key:"_loadSprite",value:function(t){var n=this;this._spriteRequest=function(t,n,i){var r,a,o,s=e.exported.devicePixelRatio>1?"@2x":"",l=e.getJSON(n.transformRequest(n.normalizeSpriteURL(t,s,".json"),e.ResourceType.SpriteJSON),(function(e,t){l=null,o||(o=e,r=t,c())})),u=e.getImage(n.transformRequest(n.normalizeSpriteURL(t,s,".png"),e.ResourceType.SpriteImage),(function(e,t){u=null,o||(o=e,a=t,c())}));function c(){if(o)i(o);else if(r&&a){var t=e.exported.getImageData(a),n={};for(var s in r){var l=r[s],u=l.width,c=l.height,d=l.x,h=l.y,f=l.sdf,p=l.pixelRatio,m=l.stretchX,y=l.stretchY,g=l.content,v=new e.RGBAImage({width:u,height:c});e.RGBAImage.copy(t,v,{x:d,y:h},{x:0,y:0},{width:u,height:c}),n[s]={data:v,pixelRatio:p,sdf:f,stretchX:m,stretchY:y,content:g}}i(null,n)}}return{cancel:function(){l&&(l.cancel(),l=null),u&&(u.cancel(),u=null)}}}(t,this.map._requestManager,(function(t,i){if(n._spriteRequest=null,t)n.fire(new e.ErrorEvent(t));else if(i)for(var r in i)n.imageManager.addImage(r,i[r]);n.imageManager.setLoaded(!0),n._availableImages=n.imageManager.listImages(),n.dispatcher.broadcast("setImages",n._availableImages),n.dispatcher.broadcast("spriteLoaded",!0),n.fire(new e.Event("data",{dataType:"style"}))}))}},{key:"_validateLayer",value:function(t){var n=this.getSource(t.source);if(n){var i=t.sourceLayer;i&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire(new e.ErrorEvent(new Error('Source layer "'.concat(i,'" does not exist on source "').concat(n.id,'" as specified by style layer "').concat(t.id,'"'))))}}},{key:"loaded",value:function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}},{key:"_serializeLayers",value:function(e){var t,n=[],i=h(e);try{for(i.s();!(t=i.n()).done;){var r=t.value,a=this._layers[r];"custom"!==a.type&&n.push(a.serialize())}}catch(o){i.e(o)}finally{i.f()}return n}},{key:"hasTransitions",value:function(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(var e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(var t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}},{key:"order",get:function(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}},{key:"isLayerDraped",value:function(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped():cn[e.type])}},{key:"_checkLoaded",value:function(){if(!this._loaded)throw new Error("Style is not done loading")}},{key:"update",value:function(t){if(this._loaded){var n=this._changed;if(this._changed){var i=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);for(var a in(i.length||r.length)&&this._updateWorkerLayers(i,r),this._updatedSources){var o=this._updatedSources[a];"reload"===o?this._reloadSource(a):"clear"===o&&this._clearSource(a)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}var l={};for(var u in this._sourceCaches){var c=this._sourceCaches[u];l[u]=c.used,c.used=!1}var d,f=h(this._order);try{for(f.s();!(d=f.n()).done;){var p=d.value,m=this._layers[p];if(m.recalculate(t,this._availableImages),!m.isHidden(t.zoom)){var y=this._getLayerSourceCache(m);y&&(y.used=!0)}var g=this.map.painter;if(g){var v=m.getProgramIds();if(!v)continue;var _,x=m.getProgramConfiguration(t.zoom),b=h(v);try{for(b.s();!(_=b.n()).done;){var w=_.value;g.useProgram(w,x)}}catch(E){b.e(E)}finally{b.f()}}}}catch(E){f.e(E)}finally{f.f()}for(var k in l){var T=this._sourceCaches[k];l[k]!==T.used&&T.getSource().fire(new e.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new e.Event("data",{dataType:"style"}))}}},{key:"_updateTilesForChangedImages",value:function(){var e=Object.keys(this._changedImages);if(e.length){for(var t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}},{key:"_updateWorkerLayers",value:function(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})}},{key:"_resetUpdates",value:function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}},{key:"setState",value:function(n){var i=this;if(this._checkLoaded(),on(this,e.validateStyle(n)))return!1;(n=e.clone$1(n)).layers=et(n.layers);var r=function(e,n){if(!e)return[{command:tt.setStyle,args:[n]}];var i=[];try{if(!t(e.version,n.version))return[{command:tt.setStyle,args:[n]}];t(e.center,n.center)||i.push({command:tt.setCenter,args:[n.center]}),t(e.zoom,n.zoom)||i.push({command:tt.setZoom,args:[n.zoom]}),t(e.bearing,n.bearing)||i.push({command:tt.setBearing,args:[n.bearing]}),t(e.pitch,n.pitch)||i.push({command:tt.setPitch,args:[n.pitch]}),t(e.sprite,n.sprite)||i.push({command:tt.setSprite,args:[n.sprite]}),t(e.glyphs,n.glyphs)||i.push({command:tt.setGlyphs,args:[n.glyphs]}),t(e.transition,n.transition)||i.push({command:tt.setTransition,args:[n.transition]}),t(e.light,n.light)||i.push({command:tt.setLight,args:[n.light]}),t(e.fog,n.fog)||i.push({command:tt.setFog,args:[n.fog]}),t(e.projection,n.projection)||i.push({command:tt.setProjection,args:[n.projection]});var r={},a=[];!function(e,n,i,r){var a;for(a in n=n||{},e=e||{})e.hasOwnProperty(a)&&(n.hasOwnProperty(a)||it(a,i,r));for(a in n)if(n.hasOwnProperty(a)){var o=n[a];e.hasOwnProperty(a)?t(e[a],o)||("geojson"===e[a].type&&"geojson"===o.type&&at(e,n,a)?i.push({command:tt.setGeoJSONSourceData,args:[a,o.data]}):rt(a,n,i,r)):nt(a,n,i)}}(e.sources,n.sources,a,r);var o=[];e.layers&&e.layers.forEach((function(e){e.source&&r[e.source]?i.push({command:tt.removeLayer,args:[e.id]}):o.push(e)}));var s=e.terrain;s&&r[s.source]&&(i.push({command:tt.setTerrain,args:[void 0]}),s=void 0),i=i.concat(a),t(s,n.terrain)||i.push({command:tt.setTerrain,args:[n.terrain]}),function(e,n,i){n=n||[];var r,a,o,s,l,u,c,d=(e=e||[]).map(st),h=n.map(st),f=e.reduce(lt,{}),p=n.reduce(lt,{}),m=d.slice(),y=Object.create(null);for(r=0,a=0;r<d.length;r++)o=d[r],p.hasOwnProperty(o)?a++:(i.push({command:tt.removeLayer,args:[o]}),m.splice(m.indexOf(o,a),1));for(r=0,a=0;r<h.length;r++)o=h[h.length-1-r],m[m.length-1-r]!==o&&(f.hasOwnProperty(o)?(i.push({command:tt.removeLayer,args:[o]}),m.splice(m.lastIndexOf(o,m.length-a),1)):a++,u=m[m.length-r],i.push({command:tt.addLayer,args:[p[o],u]}),m.splice(m.length-r,0,o),y[o]=!0);for(r=0;r<h.length;r++)if(s=f[o=h[r]],l=p[o],!y[o]&&!t(s,l))if(t(s.source,l.source)&&t(s["source-layer"],l["source-layer"])&&t(s.type,l.type)){for(c in ot(s.layout,l.layout,i,o,null,tt.setLayoutProperty),ot(s.paint,l.paint,i,o,null,tt.setPaintProperty),t(s.filter,l.filter)||i.push({command:tt.setFilter,args:[o,l.filter]}),t(s.minzoom,l.minzoom)&&t(s.maxzoom,l.maxzoom)||i.push({command:tt.setLayerZoomRange,args:[o,l.minzoom,l.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?ot(s[c],l[c],i,o,c.slice(6),tt.setPaintProperty):t(s[c],l[c])||i.push({command:tt.setLayerProperty,args:[o,c,l[c]]}));for(c in l)l.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?ot(s[c],l[c],i,o,c.slice(6),tt.setPaintProperty):t(s[c],l[c])||i.push({command:tt.setLayerProperty,args:[o,c,l[c]]}))}else i.push({command:tt.removeLayer,args:[o]}),u=m[m.lastIndexOf(o)+1],i.push({command:tt.addLayer,args:[l,u]})}(o,n.layers,i)}catch(e){console.warn("Unable to compute style diff:",e),i=[{command:tt.setStyle,args:[n]}]}return i}(this.serialize(),n).filter((function(e){return!(e.command in ln)}));if(0===r.length)return!1;var a=r.filter((function(e){return!(e.command in sn)}));if(a.length>0)throw new Error("Unimplemented: ".concat(a.map((function(e){return e.command})).join(", "),"."));return r.forEach((function(e){"setTransition"!==e.command&&"setProjection"!==e.command&&i[e.command].apply(i,e.args)})),this.stylesheet=n,this._updateMapProjection(),!0}},{key:"addImage",value:function(t,n){return this.getImage(t)?this.fire(new e.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,n),this._afterImageUpdated(t),this)}},{key:"updateImage",value:function(e,t){this.imageManager.updateImage(e,t)}},{key:"getImage",value:function(e){return this.imageManager.getImage(e)}},{key:"removeImage",value:function(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new e.ErrorEvent(new Error("No image with this name exists.")))}},{key:"_afterImageUpdated",value:function(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}))}},{key:"listImages",value:function(){return this._checkLoaded(),this._availableImages.slice()}},{key:"addSource",value:function(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(n).join(", "),"."));if(!(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(e.validateSource,"sources.".concat(t),n,null,r))){this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);var a=Ve(t,n,this.dispatcher,this);a.setEventedParent(this,(function(){return{isSourceLoaded:i._isSourceCacheLoaded(t),source:a.serialize(),sourceId:t}}));var o=function(n){var r=(n?"symbol:":"other:")+t,o=i._sourceCaches[r]=new e.SourceCache(r,a,n);(n?i._symbolSourceCaches:i._otherSourceCaches)[t]=o,o.style=i,o.onAdd(i.map)};o(!1),"vector"!==n.type&&"geojson"!==n.type||o(!0),a.onAdd&&a.onAdd(this.map),this._changed=!0}}},{key:"removeSource",value:function(t){this._checkLoaded();var n=this.getSource(t);if(!n)throw new Error("There is no source with this ID");for(var i in this._layers)if(this._layers[i].source===t)return this.fire(new e.ErrorEvent(new Error('Source "'.concat(t,'" cannot be removed while layer "').concat(i,'" is using it.'))));if(this.terrain&&this.terrain.get().source===t)return this.fire(new e.ErrorEvent(new Error('Source "'.concat(t,'" cannot be removed while terrain is using it.'))));var r,a=this._getSourceCaches(t),o=h(a);try{for(o.s();!(r=o.n()).done;){var s=r.value;delete this._sourceCaches[s.id],delete this._updatedSources[s.id],s.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:s.getSource().id})),s.setEventedParent(null),s.clearTiles()}}catch(l){o.e(l)}finally{o.f()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changed=!0,this}},{key:"setGeoJSONSourceData",value:function(e,t){this._checkLoaded(),this.getSource(e).setData(t),this._changed=!0}},{key:"getSource",value:function(e){var t=this._getSourceCache(e);return t&&t.getSource()}},{key:"_getSources",value:function(){var e=[];for(var t in this._otherSourceCaches){var n=this._getSourceCache(t);n&&e.push(n.getSource())}return e}},{key:"addLayer",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();var r=t.id;if(this.getLayer(r))this.fire(new e.ErrorEvent(new Error('Layer with id "'.concat(r,'" already exists on this map'))));else{var a;if("custom"===t.type){if(on(this,e.validateCustomStyleLayer(t)))return;a=e.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(r,t.source),t=e.clone$1(t),t=e.extend(t,{source:r})),this._validate(e.validateLayer,"layers.".concat(r),t,{arrayIndex:-1},i))return;a=e.createStyleLayer(t),this._validateLayer(a),a.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[a.id]=a.serialize(),this._updateLayerCount(a,!0)}var o=n?this._order.indexOf(n):this._order.length;if(n&&-1===o)this.fire(new e.ErrorEvent(new Error('Layer with id "'.concat(n,'" does not exist on this map.'))));else{this._order.splice(o,0,r),this._layerOrderChanged=!0,this._layers[r]=a;var s=this._getLayerSourceCache(a);if(this._removedLayers[r]&&a.source&&s&&"custom"!==a.type){var l=this._removedLayers[r];delete this._removedLayers[r],l.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",s.pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map),this._updateDrapeFirstLayers()}}}},{key:"moveLayer",value:function(t,n){if(this._checkLoaded(),this._changed=!0,this._layers[t]){if(t!==n){var i=this._order.indexOf(t);this._order.splice(i,1);var r=n?this._order.indexOf(n):this._order.length;n&&-1===r?this.fire(new e.ErrorEvent(new Error('Layer with id "'.concat(n,'" does not exist on this map.')))):(this._order.splice(r,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}}else this.fire(new e.ErrorEvent(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be moved."))))}},{key:"removeLayer",value:function(t){this._checkLoaded();var n=this._layers[t];if(n){n.setEventedParent(null),this._updateLayerCount(n,!1);var i=this._order.indexOf(t);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map),this._updateDrapeFirstLayers()}else this.fire(new e.ErrorEvent(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be removed."))))}},{key:"getLayer",value:function(e){return this._layers[e]}},{key:"hasLayer",value:function(e){return e in this._layers}},{key:"hasLayerType",value:function(e){for(var t in this._layers)if(this._layers[t].type===e)return!0;return!1}},{key:"setLayerZoomRange",value:function(t,n,i){this._checkLoaded();var r=this.getLayer(t);r?r.minzoom===n&&r.maxzoom===i||(null!=n&&(r.minzoom=n),null!=i&&(r.maxzoom=i),this._updateLayer(r)):this.fire(new e.ErrorEvent(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot have zoom extent."))))}},{key:"setFilter",value:function(n,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();var a=this.getLayer(n);if(a){if(!t(a.filter,i))return null==i?(a.filter=void 0,void this._updateLayer(a)):void(this._validate(e.validateFilter,"layers.".concat(a.id,".filter"),i,{layerType:a.type},r)||(a.filter=e.clone$1(i),this._updateLayer(a)))}else this.fire(new e.ErrorEvent(new Error("The layer '".concat(n,"' does not exist in the map's style and cannot be filtered."))))}},{key:"getFilter",value:function(t){var n=this.getLayer(t);return n&&e.clone$1(n.filter)}},{key:"setLayoutProperty",value:function(n,i,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();var o=this.getLayer(n);o?t(o.getLayoutProperty(i),r)||(o.setLayoutProperty(i,r,a),this._updateLayer(o)):this.fire(new e.ErrorEvent(new Error("The layer '".concat(n,"' does not exist in the map's style and cannot be styled."))))}},{key:"getLayoutProperty",value:function(t,n){var i=this.getLayer(t);if(i)return i.getLayoutProperty(n);this.fire(new e.ErrorEvent(new Error("The layer '".concat(t,"' does not exist in the map's style."))))}},{key:"setPaintProperty",value:function(n,i,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();var o=this.getLayer(n);o?t(o.getPaintProperty(i),r)||(o.setPaintProperty(i,r,a)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new e.ErrorEvent(new Error("The layer '".concat(n,"' does not exist in the map's style and cannot be styled."))))}},{key:"getPaintProperty",value:function(e,t){var n=this.getLayer(e);return n&&n.getPaintProperty(t)}},{key:"setFeatureState",value:function(t,n){this._checkLoaded();var i=t.source,r=t.sourceLayer,a=this.getSource(i);if(a){var o=a.type;if("geojson"===o&&r)this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));else if("vector"!==o||r){void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided.")));var s,l=this._getSourceCaches(i),u=h(l);try{for(u.s();!(s=u.n()).done;)s.value.setFeatureState(r,t.id,n)}catch(c){u.e(c)}finally{u.f()}}else this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error("The source '".concat(i,"' does not exist in the map's style."))))}},{key:"removeFeatureState",value:function(t,n){this._checkLoaded();var i=t.source,r=this.getSource(i);if(r){var a=r.type,o="vector"===a?t.sourceLayer:void 0;if("vector"!==a||o)if(n&&"string"!=typeof t.id&&"number"!=typeof t.id)this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));else{var s,l=this._getSourceCaches(i),u=h(l);try{for(u.s();!(s=u.n()).done;)s.value.removeFeatureState(o,t.id,n)}catch(c){u.e(c)}finally{u.f()}}else this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error("The source '".concat(i,"' does not exist in the map's style."))))}},{key:"getFeatureState",value:function(t){this._checkLoaded();var n=t.source,i=t.sourceLayer,r=this.getSource(n);if(r){if("vector"!==r.type||i)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(n)[0].getFeatureState(i,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error("The source '".concat(n,"' does not exist in the map's style."))))}},{key:"getTransition",value:function(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}},{key:"serialize",value:function(){var t={};for(var n in this._sourceCaches){var i=this._sourceCaches[n].getSource();t[i.id]||(t[i.id]=i.serialize())}return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},(function(e){return void 0!==e}))}},{key:"_updateLayer",value:function(e){this._updatedLayers[e.id]=!0;var t=this._getLayerSourceCache(e);e.source&&!this._updatedSources[e.source]&&t&&"raster"!==t.getSource().type&&(this._updatedSources[e.source]="reload",t.pause()),this._changed=!0,e.invalidateCompiledFilter()}},{key:"_flattenAndSortRenderedFeatures",value:function(e){for(var t=this,n=function(e){return"fill-extrusion"===t._layers[e].type},i={},r=[],a=this._order.length-1;a>=0;a--){var o=this._order[a];if(n(o)){i[o]=a;var s,l=h(e);try{for(l.s();!(s=l.n()).done;){var u=s.value[o];if(u){var c,d=h(u);try{for(d.s();!(c=d.n()).done;){var f=c.value;r.push(f)}}catch(E){d.e(E)}finally{d.f()}}}}catch(E){l.e(E)}finally{l.f()}}}r.sort((function(e,t){return t.intersectionZ-e.intersectionZ}));for(var p=[],m=this._order.length-1;m>=0;m--){var y=this._order[m];if(n(y))for(var g=r.length-1;g>=0;g--){var v=r[g].feature;if(i[v.layer.id]<m)break;p.push(v),r.pop()}else{var _,x=h(e);try{for(x.s();!(_=x.n()).done;){var b=_.value[y];if(b){var w,k=h(b);try{for(k.s();!(w=k.n()).done;){var T=w.value;p.push(T.feature)}}catch(E){k.e(E)}finally{k.f()}}}}catch(E){x.e(E)}finally{x.f()}}}return p}},{key:"queryRenderedFeatures",value:function(t,n,i){var r=this;n&&n.filter&&this._validate(e.validateFilter,"queryRenderedFeatures.filter",n.filter,null,n);var a={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];var o,s=h(n.layers);try{for(s.s();!(o=s.n()).done;){var l=o.value,u=this._layers[l];if(!u)return this.fire(new e.ErrorEvent(new Error("The layer '".concat(l,"' does not exist in the map's style and cannot be queried for features.")))),[];a[u.source]=!0}}catch(y){s.e(y)}finally{s.f()}}var c=[];n.availableImages=this._availableImages;var d=n&&n.layers?n.layers.some((function(e){var t=r.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),f=W.createFromScreenPoints(t,i);for(var p in this._sourceCaches){var m=this._sourceCaches[p].getSource().id;n.layers&&!a[m]||c.push(Ge(this._sourceCaches[p],this._layers,this._serializedLayers,f,n,i,d,!!this.map._showQueryGeometry))}return this.placement&&c.push(function(e,t,n,i,r,a,o){var s,l={},u=a.queryRenderedSymbols(i),c=[],d=h(Object.keys(u).map(Number));try{for(d.s();!(s=d.n()).done;){var f=s.value;c.push(o[f])}}catch(y){d.e(y)}finally{d.f()}c.sort(Ze);for(var p=function(){var n=g[m],i=n.featureIndex.lookupSymbolFeatures(u[n.bucketInstanceId],t,n.bucketIndex,n.sourceLayerIndex,r.filter,r.layers,r.availableImages,e);for(var a in i){var o=l[a]=l[a]||[],s=i[a];s.sort((function(e,t){var i=n.featureSortOrder;if(i){var r=i.indexOf(e.featureIndex);return i.indexOf(t.featureIndex)-r}return t.featureIndex-e.featureIndex}));var c,d=h(s);try{for(d.s();!(c=d.n()).done;){var f=c.value;o.push(f)}}catch(y){d.e(y)}finally{d.f()}}},m=0,g=c;m<g.length;m++)p();var v=function(t){l[t].forEach((function(i){var r=i.feature,a=n(e[t]);if(a){var o=a.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=o}}))};for(var _ in l)v(_);return l}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),f.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)}},{key:"querySourceFeatures",value:function(t,n){n&&n.filter&&this._validate(e.validateFilter,"querySourceFeatures.filter",n.filter,null,n);var i,r=this._getSourceCaches(t),a=[],o=h(r);try{for(o.s();!(i=o.n()).done;){var s=i.value;a=a.concat(qe(s,n))}}catch(l){o.e(l)}finally{o.f()}return a}},{key:"addSourceType",value:function(e,t,n){return a.getSourceType(e)?n(new Error('A source type called "'.concat(e,'" already exists.'))):(a.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},n):n(null,null))}},{key:"getLight",value:function(){return this.light.getLight()}},{key:"setLight",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkLoaded();var i=this.light.getLight(),r=!1;for(var a in e)if(!t(e[a],i[a])){r=!0;break}if(r){var o=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(e,n),this.light.updateTransitions(o)}}},{key:"getTerrain",value:function(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}},{key:"setTerrainForDraping",value:function(){this.setTerrain({source:"",exaggeration:0},0)}},{key:"setTerrain",value:function(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);var r=n;if(1===i){if("object"==typeof r.source){var a="terrain-dem-src";this.addSource(a,r.source),r=e.clone$1(r),r=e.extend(r,{source:a})}if(this._validate(e.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&i!==this.terrain.drapeRenderMode){if(!r)return;this._createTerrain(r,i)}else{for(var o=this.terrain,s=o.get(),l=0,u=Object.keys(e.spec.terrain);l<u.length;l++){var c=u[l];!r.hasOwnProperty(c)&&e.spec.terrain[c].default&&(r[c]=e.spec.terrain[c].default)}for(var d in r)if(!t(r[d],s[d])){o.set(r),this.stylesheet.terrain=r;var h=this._setTransitionParameters({duration:0});o.updateTransitions(h);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}},{key:"_createFog",value:function(e){var t=this.fog=new U(e,this.map.transform);this.stylesheet.fog=e;var n=this._setTransitionParameters({duration:0});t.updateTransitions(n)}},{key:"_updateMarkersOpacity",value:function(){var e=this;0!==this.map._markers.length&&this.map._requestDomTask((function(){var t,n=h(e.map._markers);try{for(n.s();!(t=n.n()).done;)t.value._evaluateOpacity()}catch(i){n.e(i)}finally{n.f()}}))}},{key:"getFog",value:function(){return this.fog?this.fog.get():null}},{key:"setFog",value:function(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){var n=this.fog,i=n.get();for(var r in 0===Object.keys(e).length&&n.set(e),e)if(!t(e[r],i[r])){n.set(e),this.stylesheet.fog=e;var a=this._setTransitionParameters({duration:0});n.updateTransitions(a);break}}else this._createFog(e);this._markersNeedUpdate=!0}},{key:"_setTransitionParameters",value:function(t){return{now:e.exported.now(),transition:e.extend(t,this.stylesheet.transition)}}},{key:"_updateDrapeFirstLayers",value:function(){var e,t,n=this;if(this.map._optimizeForTerrain&&this.terrain){var i=this._order.filter((function(e){return n.isLayerDraped(n._layers[e])})),r=this._order.filter((function(e){return!n.isLayerDraped(n._layers[e])}));this._drapedFirstOrder=[],(e=this._drapedFirstOrder).push.apply(e,c(i)),(t=this._drapedFirstOrder).push.apply(t,c(r))}}},{key:"_createTerrain",value:function(e,t){var n=this.terrain=new F(e,t);this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();var i=this._setTransitionParameters({duration:0});n.updateTransitions(i)}},{key:"_force3DLayerUpdate",value:function(){for(var e in this._layers){var t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}},{key:"_forceSymbolLayerUpdate",value:function(){for(var e in this._layers){var t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}},{key:"_validate",value:function(t,n,i,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!a||!1!==a.validate)&&on(this,t.call(e.validateStyle,e.extend({key:n,style:this.serialize(),value:i,styleSpec:e.spec},r)))}},{key:"_remove",value:function(){for(var t in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[t].setEventedParent(null);for(var n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}},{key:"_clearSource",value:function(e){var t,n=this._getSourceCaches(e),i=h(n);try{for(i.s();!(t=i.n()).done;)t.value.clearTiles()}catch(r){i.e(r)}finally{i.f()}}},{key:"_reloadSource",value:function(e){var t,n=this._getSourceCaches(e),i=h(n);try{for(i.s();!(t=i.n()).done;){var r=t.value;r.resume(),r.reload()}}catch(a){i.e(a)}finally{i.f()}}},{key:"_reloadSources",value:function(){var e,t=h(this._getSources());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.reload&&n.reload()}}catch(i){t.e(i)}finally{t.f()}}},{key:"_updateSources",value:function(e){for(var t in this._sourceCaches)this._sourceCaches[t].update(e)}},{key:"_generateCollisionBoxes",value:function(){for(var e in this._sourceCaches){var t=this._sourceCaches[e];t.resume(),t.reload()}}},{key:"_updatePlacement",value:function(t,n,i,r){var a,o=this,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=!1,u=!1,c={},d=h(this._order);try{var f=function(){var e=a.value,n=o._layers[e];if("symbol"!==n.type)return"continue";if(!c[n.source]){var i=o._getLayerSourceCache(n);if(!i)return"continue";c[n.source]=i.getRenderableIds(!0).map((function(e){return i.getTileByID(e)})).sort((function(e,t){return t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)}))}var r=o.crossTileSymbolIndex.addLayer(n,c[n.source],t.center.lng,t.projection);l=l||r};for(d.s();!(a=d.n()).done;)f()}catch(v){d.e(v)}finally{d.f()}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),s=s||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new e.Event("neworder")),(s||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.exported.now(),t.zoom))&&(this.pauseablePlacement=new Qt(t,this._order,s,n,i,r,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.exported.now()),u=!0),l&&this.pauseablePlacement.placement.setStale()),u||l){var p,m=h(this._order);try{for(m.s();!(p=m.n()).done;){var y=p.value,g=this._layers[y];"symbol"===g.type&&this.placement.updateLayerOpacities(g,c[g.source])}}catch(v){m.e(v)}finally{m.f()}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.exported.now())}},{key:"_releaseSymbolFadeTiles",value:function(){for(var e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}},{key:"getImages",value:function(e,t,n){this.imageManager.getImages(t.icons,n),this._updateTilesForChangedImages();var i=function(e){e&&e.setDependencies(t.tileID.key,t.type,t.icons)};i(this._otherSourceCaches[t.source]),i(this._symbolSourceCaches[t.source])}},{key:"getGlyphs",value:function(e,t,n){this.glyphManager.getGlyphs(t.stacks,n)}},{key:"getResource",value:function(t,n,i){return e.makeRequest(n,i)}},{key:"_getSourceCache",value:function(e){return this._otherSourceCaches[e]}},{key:"_getLayerSourceCache",value:function(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}},{key:"_getSourceCaches",value:function(e){var t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}},{key:"_isSourceCacheLoaded",value:function(t){var n=this._getSourceCaches(t);return 0===n.length?(this.fire(new e.ErrorEvent(new Error("There is no source with ID '".concat(t,"'")))),!1):n.every((function(e){return e.loaded()}))}},{key:"has3DLayers",value:function(){return this._num3DLayers>0}},{key:"hasSymbolLayers",value:function(){return this._numSymbolLayers>0}},{key:"hasCircleLayers",value:function(){return this._numCircleLayers>0}},{key:"_clearWorkerCaches",value:function(){this.dispatcher.broadcast("clearCaches")}},{key:"destroy",value:function(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}]),a}(e.Evented);dn.getSourceType=function(e){return je[e]},dn.setSourceType=function(e,t){je[e]=t},dn.registerForPluginStateChange=e.registerForPluginStateChange;var hn="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",fn="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",pn="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",mn="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",yn="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",gn={},vn={},_n=[];Tn(hn,_n),Tn(pn,_n),Tn(mn,_n),Tn(yn,_n),gn=En("",pn),vn=En(yn,mn);var xn=En("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),bn=hn,wn="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",kn={background:En("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:En("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:En("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:En("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:En("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:En("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:En("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:En("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:En("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:En("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:En("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:En("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:En("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:En("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:En("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:En("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:En("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:En("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:En("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:En("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:En("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:En("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:En("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:En("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:En("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:En("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",fn),skyboxGradient:En("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",fn),skyboxCapture:En("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:En("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:En("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Tn(e,t){var n,i=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n"),r=h(i);try{for(r.s();!(n=r.n()).done;){var a=n.value;if("#"===(a=a.trim())[0]&&a.includes("if")&&!a.includes("endif")){var o,s=(a=a.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim()).split(" "),l=h(s);try{for(l.s();!(o=l.n()).done;){var u=o.value;t.includes(u)||t.push(u)}}catch(c){l.e(c)}finally{l.f()}}}}catch(c){r.e(c)}finally{r.f()}}function En(e,t){var n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),r={},a=[].concat(_n);return Tn(e,a),Tn(t,a),{fragmentSource:e=e.replace(n,(function(e,t,n,i,a){return r[a]=!0,"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(a,"\nvarying ").concat(n," ").concat(i," ").concat(a,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(a,";\n#endif\n"):"\n#ifdef HAS_UNIFORM_u_".concat(a,"\n    ").concat(n," ").concat(i," ").concat(a," = u_").concat(a,";\n#endif\n")})),vertexSource:t=t.replace(n,(function(e,t,n,i,a){var o="float"===i?"vec2":"vec4",s=a.match(/color/)?"color":o;return r[a]?"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(a,"\nuniform lowp float u_").concat(a,"_t;\nattribute ").concat(n," ").concat(o," a_").concat(a,";\nvarying ").concat(n," ").concat(i," ").concat(a,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(a,";\n#endif\n"):"vec4"===s?"\n#ifndef HAS_UNIFORM_u_".concat(a,"\n    ").concat(a," = a_").concat(a,";\n#else\n    ").concat(n," ").concat(i," ").concat(a," = u_").concat(a,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(a,"\n    ").concat(a," = unpack_mix_").concat(s,"(a_").concat(a,", u_").concat(a,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(a," = u_").concat(a,";\n#endif\n"):"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(a,"\nuniform lowp float u_").concat(a,"_t;\nattribute ").concat(n," ").concat(o," a_").concat(a,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(a,";\n#endif\n"):"vec4"===s?"\n#ifndef HAS_UNIFORM_u_".concat(a,"\n    ").concat(n," ").concat(i," ").concat(a," = a_").concat(a,";\n#else\n    ").concat(n," ").concat(i," ").concat(a," = u_").concat(a,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(a,"\n    ").concat(n," ").concat(i," ").concat(a," = unpack_mix_").concat(s,"(a_").concat(a,", u_").concat(a,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(a," = u_").concat(a,";\n#endif\n")})),staticAttributes:i,usedDefines:a}}var Sn=function(){function e(){f(this,e),this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}return p(e,[{key:"bind",value:function(e,t,n,i,r,a,o){this.context=e;for(var s=this.boundPaintVertexBuffers.length!==i.length,l=0;!s&&l<i.length;l++)this.boundPaintVertexBuffers[l]!==i[l]&&(s=!0);for(var u=this.boundDynamicVertexBuffers.length!==o.length,c=0;!u&&c<o.length;c++)this.boundDynamicVertexBuffers[c]!==o[c]&&(u=!0);if(!e.extVertexArrayObject||!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==n||s||u||this.boundIndexBuffer!==r||this.boundVertexOffset!==a)this.freshBind(t,n,i,r,a,o);else{e.bindVertexArrayOES.set(this.vao);var d,f=h(o);try{for(f.s();!(d=f.n()).done;){var p=d.value;p&&p.bind()}}catch(m){f.e(m)}finally{f.f()}r&&r.dynamicDraw&&r.bind()}}},{key:"freshBind",value:function(e,t,n,i,r,a){var o,s=e.numAttributes,l=this.context,u=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),o=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffers=a;else{o=l.currentNumAttributes||0;for(var c=s;c<o;c++)u.disableVertexAttribArray(c)}t.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,r);var d,f=h(n);try{for(f.s();!(d=f.n()).done;){var p=d.value;p.enableAttributes(u,e),p.bind(),p.setVertexAttribPointers(u,e,r)}}catch(v){f.e(v)}finally{f.f()}var m,y=h(a);try{for(y.s();!(m=y.n()).done;){var g=m.value;g&&(g.enableAttributes(u,e),g.bind(),g.setVertexAttribPointers(u,e,r))}}catch(v){y.e(v)}finally{y.f()}i&&i.bind(),l.currentNumAttributes=s}},{key:"destroy",value:function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}]),e}();function Ln(t,n){var i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new e.MercatorCoordinate(0,r/i).toLngLat().lat,new e.MercatorCoordinate(0,(r+1)/i).toLngLat().lat]}function Mn(t,n,i,r,a,o,s){var l=t.context,u=l.gl,c=i.fbo;if(c){t.prepareDrawTile();var d=t.useProgram("hillshade");l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,c.colorAttachment.get());var h=function(e,t,n,i){var r=n.paint.get("hillshade-shadow-color"),a=n.paint.get("hillshade-highlight-color"),o=n.paint.get("hillshade-accent-color"),s=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var l=!e.options.moving;return{u_matrix:i||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),l),u_image:0,u_latrange:Ln(0,t.tileID),u_light:[n.paint.get("hillshade-exaggeration"),s],u_shadow:r,u_highlight:a,u_accent:o}}(t,i,r,t.terrain?n.projMatrix:null);t.prepareDrawProgram(l,d,n.toUnwrapped());var f=t.getTileBoundsBuffers(i),p=f.tileBoundsBuffer,m=f.tileBoundsIndexBuffer,y=f.tileBoundsSegments;d.draw(l,u.TRIANGLES,a,o,s,e.CullFaceMode.disabled,h,r.id,p,m,y)}}function An(t,n,i){if(n.needsDEMTextureUpload){var r=t.context,a=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||t.getTileTexture(i.stride);var o=i.getPixels();n.demTexture?n.demTexture.update(o,{premultiply:!1}):n.demTexture=new e.Texture(r,o,a.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}}function Cn(t,n,i,r,a,o){var s=t.context,l=s.gl;if(n.dem){var u=n.dem;if(s.activeTexture.set(l.TEXTURE1),An(t,n,u),n.demTexture){n.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);var c=u.dim;s.activeTexture.set(l.TEXTURE0);var d=n.fbo;if(!d){var h=new e.Texture(s,{width:c,height:c,data:null},l.RGBA);h.bind(l.LINEAR,l.CLAMP_TO_EDGE),(d=n.fbo=s.createFramebuffer(c,c,!0)).colorAttachment.set(h.texture)}s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,c,c]);var f=t.getMercatorTileBoundsBuffers(),p=f.tileBoundsBuffer,m=f.tileBoundsIndexBuffer,y=f.tileBoundsSegments;t.useProgram("hillshadePrepare").draw(s,l.TRIANGLES,r,a,o,e.CullFaceMode.disabled,function(t,n){var i=n.stride,r=e.create();return e.ortho(r,0,e.EXTENT,-e.EXTENT,0,0,1),e.translate(r,r,[0,-e.EXTENT,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:t.overscaledZ,u_unpack:n.unpackVector}}(n.tileID,u),i.id,p,m,y),n.needsHillshadePrepare=!1}}}var In=function(t){return{u_matrix:new e.UniformMatrix4f(t),u_image0:new e.Uniform1i(t),u_skirt_height:new e.Uniform1f(t)}},Pn=function(e,t){return{u_matrix:e,u_image0:0,u_skirt_height:t}},zn=function(e,t,n,i,r,a,o,s,l,u,c,d,h,f,p){return{u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(i),u_merc_matrix:n,u_zoom_transition:r,u_merc_center:a,u_image0:0,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:u,u_globe_pos:c,u_globe_radius:d,u_viewport:h,u_grid_matrix:p?Float32Array.from(p):new Float32Array(9),u_skirt_height:f}};function Dn(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}var Rn=new(function(){function e(){f(this,e),this.operations={}}return p(e,[{key:"newMorphing",value:function(e,t,n,i,r){if(e in this.operations){var a=this.operations[e];a.to.tileID.key!==n.tileID.key&&(a.queued=n)}else this.operations[e]={startTime:i,phase:0,duration:r,from:t,to:n,queued:null}}},{key:"getMorphValuesForProxy",value:function(e){if(!(e in this.operations))return null;var t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}},{key:"update",value:function(e){for(var t in this.operations){var n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}},{key:"_nextOp",value:function(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}},{key:"_validOp",value:function(e){return e.from.hasData()&&e.to.hasData()}}]),e}()),Bn={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Fn(e){return 6*Math.pow(1.5,22-e)}function On(e,t){var n=1<<e.z;return!t&&(0===e.x||e.x===n-1)||0===e.y||e.y===n-1}var Nn=function(e){return{u_matrix:e}};function Hn(t,n,i,r,a){if(a>0){var o=e.exported.now(),s=(o-t.timeAdded)/a,l=n?(o-n.timeAdded)/a:-1,u=i.getSource(),c=r.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),d=!n||Math.abs(n.tileID.overscaledZ-c)>Math.abs(t.tileID.overscaledZ-c),h=d&&t.refreshedUponExpiration?1:e.clamp(d?s:1-l,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),n?{opacity:1,mix:1-h}:{opacity:h,mix:0}}return{opacity:1,mix:0}}var Un=function(e){m(n,e);var t=y(n);function n(e){var i;f(this,n);var a={type:"raster-dem",maxzoom:e.transform.maxZoom},o=new j($e(),null),s=Ve("mock-dem",a,o,e.style);return i=t.call(this,"mock-dem",s,!1),s.setEventedParent(r(i)),i._sourceLoaded=!0,i}return p(n,[{key:"_loadTile",value:function(e,t){e.state="loaded",t(null)}}]),n}(e.SourceCache),jn=function(t){m(i,t);var n=y(i);function i(e){var t;f(this,i);var a=Ve("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new j($e(),null),e.style);return t=n.call(this,"proxy",a,!1),a.setEventedParent(r(t)),t.map=t.getSource().map=e,t.used=t._sourceLoaded=!0,t.renderCache=[],t.renderCachePool=[],t.proxyCachedFBO={},t}return p(i,[{key:"update",value:function(t,n,i){var r=this;if(!t.freezeTileCoverage){this.transform=t;var a=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((function(n,i){if(n[i.key]="",!r._tiles[i.key]){var a=new e.Tile(i,r._source.tileSize*i.overscaleFactor(),t.tileZoom);a.state="loaded",r._tiles[i.key]=a}return n}),{});for(var o in this._tiles)o in a||(this.freeFBO(o),this._tiles[o].unloadVectorData(),delete this._tiles[o])}}},{key:"freeFBO",value:function(e){var t=this.proxyCachedFBO[e];if(void 0!==t){var n,i=Object.values(t);(n=this.renderCachePool).push.apply(n,i),delete this.proxyCachedFBO[e]}}},{key:"deallocRenderCache",value:function(){this.renderCache.forEach((function(e){return e.fb.destroy()})),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}]),i}(e.SourceCache),Vn=function(e){m(n,e);var t=y(n);function n(e,i,r){var a;return f(this,n),(a=t.call(this,e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)).proxyTileKey=i,a.projMatrix=r,a}return p(n)}(e.OverscaledTileID),Wn=function(t){m(i,t);var n=y(i);function i(t,r){var a;f(this,i),(a=n.call(this)).painter=t,a.terrainTileForTile={},a.prevTerrainTileForTile={};var o=function(t){var n=new e.StructArrayLayout2i4,i=new e.StructArrayLayout3ui6,r=131;n.reserve(17161),i.reserve(33800);for(var a=e.EXTENT/128,o=e.EXTENT+a/2,s=o+a,l=-a;l<s;l+=a)for(var u=-a;u<s;u+=a){var c=u<0||u>o||l<0||l>o?24575:0,d=e.clamp(Math.round(u),0,e.EXTENT),h=e.clamp(Math.round(l),0,e.EXTENT);n.emplaceBack(d+c,h)}for(var f=function(e,t){var n=t*r+e;i.emplaceBack(n+1,n,n+r),i.emplaceBack(n+r,n+r+1,n+1)},p=1;p<129;p++)for(var m=1;m<129;m++)f(m,p);return[0,129].forEach((function(e){for(var t=0;t<130;t++)f(t,e),f(e,t)})),[n,i,32768]}(),s=d(o,3),l=s[0],u=s[1],c=s[2],h=t.context;a.gridBuffer=h.createVertexBuffer(l,e.posAttributes.members),a.gridIndexBuffer=h.createIndexBuffer(u),a.gridSegments=e.SegmentVector.simpleSegment(0,0,l.length,u.length),a.gridNoSkirtSegments=e.SegmentVector.simpleSegment(0,0,l.length,c),a.proxyCoords=[],a.proxiedCoords={},a._visibleDemTiles=[],a._drapedRenderBatches=[],a._sourceTilesOverlap={},a.proxySourceCache=new jn(r.map),a.orthoMatrix=e.create(),e.ortho(a.orthoMatrix,"globe"===a.painter.transform.projection.name?.015:0,e.EXTENT,0,e.EXTENT,0,1);var p=h.gl;return a._overlapStencilMode=new e.StencilMode({func:p.GEQUAL,mask:255},0,255,p.KEEP,p.KEEP,p.REPLACE),a._previousZoom=t.transform.zoom,a.pool=[],a._findCoveringTileCache={},a._tilesDirty={},a.style=r,a._useVertexMorphing=!0,a._exaggeration=1,a._mockSourceCache=new Un(r.map),a}return p(i,[{key:"style",set:function(e){var t=this;e.on("data",this._onStyleDataEvent.bind(this)),e.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=e,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",(function(){t._clearLineLayersFromRenderCache()}))}},{key:"update",value:function(t,n,i){var r=this;if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;var a=t.terrain.properties;this.sourceCache=0===t.terrain.drapeRenderMode?this._mockSourceCache:t._getSourceCache(a.get("source")),this._exaggeration=a.get("exaggeration");var o=function(){r.sourceCache.used&&e.warnOnce("Raster DEM source '".concat(r.sourceCache.id,"' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source."));var t=r.getScaledDemTileSize();r.sourceCache.update(n,t,!0),r.resetTileLookupCache(r.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),n.updateElevation(!0,i),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0}else this._disable()}},{key:"resetTileLookupCache",value:function(e){this._findCoveringTileCache[e]={}}},{key:"getScaledDemTileSize",value:function(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}},{key:"_checkRenderCacheEfficiency",value:function(){var t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&e.warnOnce("Terrain render cache efficiency is not optimal (".concat(t.efficiency,"%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '").concat(t.firstUndrapedLayer,"' or create a map using optimizeForTerrain: true option."))}},{key:"_onStyleDataEvent",value:function(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this._invalidateRenderCache=!0)}},{key:"_disable",value:function(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(var e in this._style._sourceCaches)this._style._sourceCaches[e].usedForTerrain=!1}},{key:"destroy",value:function(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((function(e){return e.fb.destroy()})),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}},{key:"_source",value:function(){return this.enabled?this.sourceCache:null}},{key:"isUsingMockSource",value:function(){return this.sourceCache===this._mockSourceCache}},{key:"exaggeration",value:function(){return this._exaggeration}},{key:"visibleDemTiles",get:function(){return this._visibleDemTiles}},{key:"drapeBufferSize",get:function(){var e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}},{key:"useVertexMorphing",set:function(e){this._useVertexMorphing=e}},{key:"updateTileBinding",value:function(t){var n=this;if(this.enabled){this.prevTerrainTileForTile=this.terrainTileForTile;var i=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=0===r._centerAltitude&&-1===this.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(r.center),-1),this._emptyDEMTextureDirty=!this._initializing);var a=this.proxyCoords=i.getIds().map((function(e){var t=i.getTileByID(e).tileID;return t.projMatrix=r.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,n){var i=n.transform.pointCoordinate(n.transform.getCameraPoint()),r=new e.Point(i.x,i.y);t.sort((function(t,n){if(n.overscaledZ-t.overscaledZ)return n.overscaledZ-t.overscaledZ;var i=new e.Point(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),a=new e.Point(n.canonical.x+(1<<n.canonical.z)*n.wrap,n.canonical.y),o=r.mult(1<<t.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(i)-o.distSqr(a)}))}(a,this.painter),this._previousZoom=r.zoom;var o=this.proxyToSource||{};this.proxyToSource={},a.forEach((function(e){n.proxyToSource[e.key]={}})),this.terrainTileForTile={};var s=this._style._sourceCaches;for(var l in s){var u=s[l];if(u.used&&(u!==this.sourceCache&&this.resetTileLookupCache(u.id),this._setupProxiedCoordsForOrtho(u,t[l],o),!u.usedForTerrain)){var c=t[l];u.getSource().reparseOverscaled&&this._assignTerrainTiles(c)}}this.proxiedCoords[i.id]=a.map((function(e){return new Vn(e,e.key,n.orthoMatrix)})),this._assignTerrainTiles(a),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=e.exported.now();var d={};this._visibleDemTiles=[];var f,p=h(this.proxyCoords);try{for(p.s();!(f=p.n()).done;){var m=f.value,y=this.terrainTileForTile[m.key];if(y){var g=y.tileID.key;g in d||(this._visibleDemTiles.push(y),d[g]=g)}}}catch(v){p.e(v)}finally{p.f()}}}},{key:"_assignTerrainTiles",value:function(e){var t=this;this._initializing||e.forEach((function(e){if(!t.terrainTileForTile[e.key]){var n=t._findTileCoveringTileID(e,t.sourceCache);n&&(t.terrainTileForTile[e.key]=n)}}))}},{key:"_prepareDEMTextures",value:function(){var e=this.painter.context,t=e.gl;for(var n in this.terrainTileForTile){var i=this.terrainTileForTile[n],r=i.dem;!r||i.demTexture&&!i.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),An(this.painter,i,r))}}},{key:"_prepareDemTileUniforms",value:function(e,t,n,i){if(!t||null==t.demTexture)return!1;var r=e.tileID.canonical,a=Math.pow(2,t.tileID.canonical.z-r.z),o=i||"";return n["u_dem_tl".concat(o)]=[r.x*a%1,r.y*a%1],n["u_dem_scale".concat(o)]=a,!0}},{key:"emptyDEMTexture",get:function(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}},{key:"emptyDepthBufferTexture",get:function(){var t=this.painter.context,n=t.gl;if(!this._emptyDepthBufferTexture){var i=new e.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new e.Texture(t,i,n.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}},{key:"_getLoadedAreaMinimum",value:function(){var e=0,t=this._visibleDemTiles.reduce((function(t,n){if(!n.dem)return t;var i=n.dem.tree.minimums[0];return i>0&&e++,t+i}),0);return e?t/e:0}},{key:"_updateEmptyDEMTexture",value:function(){var t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);var i=this._getLoadedAreaMinimum(),r=new e.RGBAImage({width:1,height:1},new Uint8Array(e.DEMData.pack(i,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;var a=this._emptyDEMTexture;return a?a.update(r,{premultiply:!1}):a=this._emptyDEMTexture=new e.Texture(t,r,n.RGBA,{premultiply:!1}),a}},{key:"setupElevationDraw",value:function(t,n,i){var r,a=this.painter.context,o=a.gl,s=(r=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:e.DEMData.getUnpackVector(r),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});s.u_dem_size=this.sourceCache.getSource().tileSize,s.u_exaggeration=this.exaggeration();var l=null,u=null,c=1;if(i&&i.morphing&&this._useVertexMorphing){var d=i.morphing.srcDemTile,h=i.morphing.dstDemTile;c=i.morphing.phase,d&&h&&(this._prepareDemTileUniforms(t,d,s,"_prev")&&(u=d),this._prepareDemTileUniforms(t,h,s)&&(l=h))}if(u&&l?(a.activeTexture.set(o.TEXTURE2),l.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),a.activeTexture.set(o.TEXTURE4),u.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_dem_lerp=c):(l=this.terrainTileForTile[t.tileID.key],a.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(t,l,s)?l.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE)),a.activeTexture.set(o.TEXTURE3),i&&i.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.u_depth_size_inv=[1,1]),i&&i.useMeterToDem&&l){var f=(1<<l.tileID.canonical.z)*e.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=f}if(i&&i.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),n.setTerrainUniformValues(a,s),"globe"===this.painter.transform.projection.name){var p=this.globeUniformValues(this.painter.transform,t.tileID.canonical,i&&i.useDenormalizedUpVectorScale);n.setGlobeUniformValues(a,p)}}},{key:"globeUniformValues",value:function(t,n,i){var r=t.projection;return{u_tile_tl_up:r.upVector(n,0,0),u_tile_tr_up:r.upVector(n,e.EXTENT,0),u_tile_br_up:r.upVector(n,e.EXTENT,e.EXTENT),u_tile_bl_up:r.upVector(n,0,e.EXTENT),u_tile_up_scale:i?e.globeMetersToEcef(1):r.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}},{key:"renderToBackBuffer",value:function(t){var n=this.painter,i=this.painter.context;0!==t.length&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,n,i,r,a){if("globe"===t.transform.projection.name)!function(t,n,i,r,a){var o,s,l=t.context,u=l.gl,c=t.options.showTerrainWireframe?2:0,f=t.transform,p=e.globeUseCustomAntiAliasing(t,l,f),m=function(e,n){if(s!==e){var i=[Bn[e],"PROJECTION_GLOBE_VIEW"];p&&i.push("CUSTOM_ANTIALIASING"),n&&i.push(Bn[c]),o=t.useProgram("globeRaster",null,i),s=e}},y=t.colorModeForRenderPass(),g=new e.DepthMode(u.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);Rn.update(a);var v=e.calculateGlobeMercatorMatrix(f),_=[e.mercatorXfromLng(f.center.lng),e.mercatorYfromLat(f.center.lat)],x=c?[!1,!0]:[!1],b=t.globeSharedBuffers,w=[f.width*e.exported.devicePixelRatio,f.height*e.exported.devicePixelRatio],k=Float32Array.from(f.globeMatrix),T={useDenormalizedUpVectorScale:!0};if(x.forEach((function(c){var f=t.transform,p=Fn(f.zoom)*n.exaggeration();s=-1;var x,E=c?u.LINES:u.TRIANGLES,S=h(r);try{for(S.s();!(x=S.n()).done;){var L=x.value,M=i.getTile(L),A=e.StencilMode.disabled,C=n.prevTerrainTileForTile[L.key],I=n.terrainTileForTile[L.key];Dn(C,I)&&Rn.newMorphing(L.key,C,I,a,250),l.activeTexture.set(u.TEXTURE0),M.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE);var P=Rn.getMorphValuesForProxy(L.key),z=P?1:0;P&&e.extend$1(T,{morphing:{srcDemTile:P.from,dstDemTile:P.to,phase:e.easeCubicInOut(P.phase)}});var D=e.tileCornersToBounds(L.canonical),R=e.getLatitudinalLod(D.getCenter().lat),B=e.getGridMatrix(L.canonical,D,R,f.worldSize/f._pixelsPerMercatorPixel),F=e.globeNormalizeECEF(e.globeTileBounds(L.canonical)),O=zn(f.projMatrix,k,v,F,e.globeToMercatorTransition(f.zoom),_,f.frustumCorners.TL,f.frustumCorners.TR,f.frustumCorners.BR,f.frustumCorners.BL,f.globeCenterInViewSpace,f.globeRadius,w,p,B);if(m(z,c),n.setupElevationDraw(M,o,T),t.prepareDrawProgram(l,o,L.toUnwrapped()),b){var N=c?b.getWirefameBuffers(t.context,R):b.getGridBuffers(R,0!==p),H=d(N,3),U=H[0],j=H[1],V=H[2];o.draw(l,E,g,A,y,e.CullFaceMode.backCCW,O,"globe_raster",U,j,V)}}}catch(W){S.e(W)}finally{S.f()}})),b){var E=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];p&&E.push("CUSTOM_ANTIALIASING"),o=t.useProgram("globeRaster",null,E);var S,L=h(r);try{var M=function(){var r=S.value,a=r.canonical,s=a.x,c=a.y,h=a.z,p=0===c,m=c===(1<<h)-1,v=b.getPoleBuffers(h),x=d(v,4),k=x[0],E=x[1],L=x[2],M=x[3];if(M&&(p||m)){var A=i.getTile(r);l.activeTexture.set(u.TEXTURE0),A.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE);var C=e.globePoleMatrixForTile(h,s,f),I=e.globeNormalizeECEF(e.globeTileBounds(r.canonical)),P=function(t,n){return t.draw(l,u.TRIANGLES,g,e.StencilMode.disabled,y,e.CullFaceMode.disabled,zn(f.projMatrix,C,C,I,0,_,f.frustumCorners.TL,f.frustumCorners.TR,f.frustumCorners.BR,f.frustumCorners.BL,f.globeCenterInViewSpace,f.globeRadius,w,0),"globe_pole_raster",n,L,M)};n.setupElevationDraw(A,o,T),t.prepareDrawProgram(l,o,r.toUnwrapped()),p&&P(o,k),m&&(C=e.scale(e.create(),C,[1,-1,1]),P(o,E))}};for(L.s();!(S=L.n()).done;)M()}catch(A){L.e(A)}finally{L.f()}}}(t,n,i,r,a);else{var o,s,l=t.context,u=l.gl,c=t.options.showTerrainWireframe?2:0,f=function(e,n){if(s!==e){var i=[Bn[e]];n&&i.push(Bn[c]),o=t.useProgram("terrainRaster",null,i),s=e}},p=t.colorModeForRenderPass(),m=new e.DepthMode(u.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);Rn.update(a);var y=t.transform,g=Fn(y.zoom)*n.exaggeration();(c?[!1,!0]:[!1]).forEach((function(c){s=-1;var v,_=c?u.LINES:u.TRIANGLES,x=c?n.getWirefameBuffer():[n.gridIndexBuffer,n.gridSegments],b=d(x,2),w=b[0],k=b[1],T=h(r);try{for(T.s();!(v=T.n()).done;){var E=v.value,S=i.getTile(E),L=e.StencilMode.disabled,M=n.prevTerrainTileForTile[E.key],A=n.terrainTileForTile[E.key];Dn(M,A)&&Rn.newMorphing(E.key,M,A,a,250),l.activeTexture.set(u.TEXTURE0),S.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST);var C=Rn.getMorphValuesForProxy(E.key),I=C?1:0,P=void 0;C&&(P={morphing:{srcDemTile:C.from,dstDemTile:C.to,phase:e.easeCubicInOut(C.phase)}});var z=Pn(E.projMatrix,On(E.canonical,y.renderWorldCopies)?g/10:g);f(I,c),n.setupElevationDraw(S,o,P),t.prepareDrawProgram(l,o,E.toUnwrapped()),o.draw(l,_,m,L,p,e.CullFaceMode.backCCW,z,"terrain_raster",n.gridBuffer,w,k)}}catch(D){T.e(D)}finally{T.f()}}))}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}},{key:"renderBatch",value:function(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;var n,i=this.painter,r=this.painter.context,a=this.proxySourceCache,o=this.proxiedCoords[a.id],s=this._drapedRenderBatches.shift(),l=[],u=i.style.order,c=0,d=h(o);try{for(d.s();!(n=d.n()).done;){var f=n.value,p=a.getTileByID(f.proxyTileKey),m=a.proxyCachedFBO[f.key]?a.proxyCachedFBO[f.key][t]:void 0,y=void 0!==m?a.renderCache[m]:this.pool[c++],g=void 0!==m;if(p.texture=y.tex,!g||y.dirty){var v=void 0;r.bindFramebuffer.set(y.fb.framebuffer),this.renderedToTile=!1,y.dirty&&(r.clear({color:e.Color.transparent,stencil:0}),y.dirty=!1);for(var _=s.start;_<=s.end;++_){var x=i.style._layers[u[_]];if(!x.isHidden(i.transform.zoom)){var b=i.style._getLayerSourceCache(x),w=b?this.proxyToSource[f.key][b.id]:[f];if(w){var k=w;r.viewport.set([0,0,y.fb.width,y.fb.height]),v!==(b?b.id:null)&&(this._setupStencil(y,w,x,b),v=b?b.id:null),i.renderLayer(i,b,x,k)}}}this.renderedToTile?(y.dirty=!0,l.push(p.tileID)):g||--c,5===c&&(c=0,this.renderToBackBuffer(l))}else l.push(p.tileID)}}catch(T){d.e(T)}finally{d.f()}return this.renderToBackBuffer(l),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),s.end+1}},{key:"postRender",value:function(){}},{key:"renderCacheEfficiency",value:function(e){var t=e.order.length;if(0===t)return{efficiency:100};for(var n,i=0,r=0,a=!1,o=0;o<t;++o){var s=e._layers[e.order[o]];this._style.isLayerDraped(s)?(a&&++i,++r):a||(a=!0,n=s.id)}return 0===r?{efficiency:100}:{efficiency:100*(1-i/r),firstUndrapedLayer:n}}},{key:"getMinElevationBelowMSL",value:function(){var e=0;return this._visibleDemTiles.filter((function(e){return e.dem})).forEach((function(t){e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}},{key:"raycast",value:function(e,t,n){if(!this._visibleDemTiles)return null;var i=this._visibleDemTiles.filter((function(e){return e.dem})).map((function(i){var r=i.tileID,a=1<<r.overscaledZ,o=r.canonical,s=o.x,l=o.y,u=s/a,c=(s+1)/a,d=l/a,h=(l+1)/a;return{minx:u,miny:d,maxx:c,maxy:h,t:i.dem.tree.raycastRoot(u,d,c,h,e,t,n),tile:i}}));i.sort((function(e,t){return(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)}));var r,a=h(i);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(null==o.t)return null;var s=o.tile.dem.tree.raycast(o.minx,o.miny,o.maxx,o.maxy,e,t,n);if(null!=s)return s}}catch(l){a.e(l)}finally{a.f()}return null}},{key:"_createFBO",value:function(){var t=this.painter.context,n=t.gl,i=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);var r=new e.Texture(t,{width:i[0],height:i[1],data:null},n.RGBA);r.bind(n.LINEAR,n.CLAMP_TO_EDGE);var a=t.createFramebuffer(i[0],i[1],!1);return a.colorAttachment.set(r.texture),a.depthAttachment=new Re(t,a.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,a.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):a.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:a,tex:r,dirty:!1}}},{key:"_initFBOPool",value:function(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}},{key:"_shouldDisableRenderCache",value:function(){var e=this;if(this._style.light&&this._style.light.hasTransition())return!0;for(var t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some((function(t){var n=e._style._layers[t],i=n.isHidden(e.painter.transform.zoom);return"custom"===n.type?!i&&n.shouldRedrape():!i&&n.hasTransition()}))}},{key:"_clearLineLayersFromRenderCache",value:function(){var t,n=!1,i=h(this._style._getSources());try{for(i.s();!(t=i.n()).done;)if(t.value instanceof Oe){n=!0;break}}catch(y){i.e(y)}finally{i.f()}if(n)for(var r={},a=0;a<this._style.order.length;++a){var o=this._style._layers[this._style.order[a]],s=this._style._getLayerSourceCache(o);if(s&&!r[s.id]&&!o.isHidden(this.painter.transform.zoom)&&"line"===o.type&&o.widthExpression()instanceof e.ZoomDependentExpression){r[s.id]=!0;var l,u=h(this.proxyCoords);try{for(u.s();!(l=u.n()).done;){var c=l.value,d=this.proxyToSource[c.key][s.id];if(d){var f,p=h(d);try{for(p.s();!(f=p.n()).done;){var m=f.value;this._clearRenderCacheForTile(s.id,m)}}catch(y){p.e(y)}finally{p.f()}}}}catch(y){u.e(y)}finally{u.f()}}}}},{key:"_clearRasterLayersFromRenderCache",value:function(){var e=!1;for(var t in this._style._sourceCaches)if(this._style._sourceCaches[t]._source instanceof Ne){e=!0;break}if(e)for(var n={},i=0;i<this._style.order.length;++i){var r=this._style._layers[this._style.order[i]],a=this._style._getLayerSourceCache(r);if(a&&!n[a.id]&&!r.isHidden(this.painter.transform.zoom)&&"raster"===r.type){var o,s=r.paint.get("raster-fade-duration"),l=h(this.proxyCoords);try{for(l.s();!(o=l.n()).done;){var u=o.value,c=this.proxyToSource[u.key][a.id];if(c){var d,f=h(c);try{for(f.s();!(d=f.n()).done;){var p=d.value,m=Hn(a.getTile(p),a.findLoadedParent(p,0),a,this.painter.transform,s);(1!==m.opacity||0!==m.mix)&&this._clearRenderCacheForTile(a.id,p)}}catch(y){f.e(y)}finally{f.f()}}}}catch(y){l.e(y)}finally{l.f()}}}}},{key:"_setupDrapedRenderBatches",value:function(){var e=this._style.order,t=e.length;if(0!==t){for(var n,i=[],r=0,a=this._style._layers[e[r]];!this._style.isLayerDraped(a)&&a.isHidden(this.painter.transform.zoom)&&++r<t;)a=this._style._layers[e[r]];for(;r<t;++r){var o=this._style._layers[e[r]];o.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(o)?void 0===n&&(n=r):void 0!==n&&(i.push({start:n,end:r-1}),n=void 0))}void 0!==n&&i.push({start:n,end:r-1}),this._drapedRenderBatches=i}}},{key:"_setupRenderCache",value:function(e){var t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){var n=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(var i=0;i<n.length;++i){var r,a=Object.values(n[i]);(r=t.renderCachePool).push.apply(r,a)}}}else{this._clearRasterLayersFromRenderCache();for(var o=this.proxyCoords,s=this._tilesDirty,l=o.length-1;l>=0;l--){var u=o[l];if(t.getTileByID(u.key),void 0!==t.proxyCachedFBO[u.key]){var d=e[u.key],f=this.proxyToSource[u.key],p=0,m=function(e){var t=f[e],n=d[e];if(!n||n.length!==t.length||t.some((function(t,i){return t!==n[i]||s[e]&&s[e].hasOwnProperty(t.key)})))return p=-1,"break";++p};for(var y in f)if("break"===m(y))break;for(var g in t.proxyCachedFBO[u.key])t.renderCache[t.proxyCachedFBO[u.key][g]].dirty=p<0||p!==Object.values(d).length}}var v=c(this._drapedRenderBatches);v.sort((function(e,t){return t.end-t.start-(e.end-e.start)}));var _,x=h(v);try{for(x.s();!(_=x.n()).done;){var b,w=_.value,k=h(o);try{for(k.s();!(b=k.n()).done;){var T=b.value;if(!t.proxyCachedFBO[T.key]){var E=t.renderCachePool.pop();void 0===E&&t.renderCache.length<50&&(E=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==E&&(t.proxyCachedFBO[T.key]={},t.proxyCachedFBO[T.key][w.start]=E,t.renderCache[E].dirty=!0)}}}catch(S){k.e(S)}finally{k.f()}}}catch(S){x.e(S)}finally{x.f()}this._tilesDirty={}}}},{key:"_setupStencil",value:function(e,t,n,i){if(i&&this._sourceTilesOverlap[i.id]){var r=this.painter.context,a=r.gl;if(t.length<=1)this._overlapStencilType=!1;else{var o;if(n.isTileClipped())o=t.length,this._overlapStencilMode.test={func:a.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);o=1,this._overlapStencilMode.test={func:a.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+o>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=o,this._overlapStencilMode.ref=this._stencilRef,n.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}}else this._overlapStencilType&&(this._overlapStencilType=!1)}},{key:"clipOrMaskOverlapStencilType",value:function(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}},{key:"stencilModeForRTTOverlap",value:function(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):e.StencilMode.disabled}},{key:"_renderTileClippingMasks",value:function(t,n){var i=this.painter,r=this.painter.context,a=r.gl;i._tileClippingMaskIDs={},r.setColorMode(e.ColorMode.disabled),r.setDepthMode(e.DepthMode.disabled);var o,s=i.useProgram("clippingMask"),l=h(t);try{for(l.s();!(o=l.n()).done;){var u=o.value,c=i._tileClippingMaskIDs[u.key]=--n;s.draw(r,a.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:a.ALWAYS,mask:0},c,255,a.KEEP,a.KEEP,a.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,Nn(u.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}catch(d){l.e(d)}finally{l.f()}}},{key:"pointCoordinate",value:function(t){var n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;var i=[t.x,t.y,1,1];e.transformMat4$1(i,i,n.pixelMatrixInverse),e.scale$1(i,i,1/i[3]),i[0]/=n.worldSize,i[1]/=n.worldSize;var r=n._camera.position,a=e.mercatorZfromAltitude(1,n.center.lat),o=[r[0],r[1],r[2]/a,0],s=e.subtract([],i.slice(0,3),o);e.normalize(s,s);var l=this.raycast(o,s,this._exaggeration);return null!==l&&l?(e.scaleAndAdd(o,o,s,l),o[3]=o[2],o[2]*=a,o):null}},{key:"drawDepth",value:function(){var t=this.painter,n=t.context,i=this.proxySourceCache,r=Math.ceil(t.width),a=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===a||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){var o=n.gl,s=n.createFramebuffer(r,a,!0);n.activeTexture.set(o.TEXTURE0);var l=new e.Texture(n,{width:r,height:a,data:null},o.RGBA);l.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.colorAttachment.set(l.texture);var u=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,r,a);s.depthAttachment.set(u),this._depthFBO=s,this._depthTexture=l}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,r,a]),function(t,n,i,r){if("globe"!==t.transform.projection.name){var a=t.context,o=a.gl;a.clear({depth:1});var s,l=t.useProgram("terrainDepth"),u=new e.DepthMode(o.LESS,e.DepthMode.ReadWrite,t.depthRangeFor3D),c=h(r);try{for(c.s();!(s=c.n()).done;){var d=s.value,f=i.getTile(d),p=Pn(d.projMatrix,0);n.setupElevationDraw(f,l),l.draw(a,o.TRIANGLES,u,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.backCCW,p,"terrain_depth",n.gridBuffer,n.gridIndexBuffer,n.gridNoSkirtSegments)}}catch(m){c.e(m)}finally{c.f()}}}(t,this,i,this.proxyCoords)}},{key:"_setupProxiedCoordsForOrtho",value:function(e,t,n){if(e.getSource()instanceof Ue)return this._setupProxiedCoordsForImageSource(e,t,n);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};for(var i=this.proxiedCoords[e.id]=[],r=this.proxyCoords,a=0;a<r.length;a++){var o=r[a],s=this._findTileCoveringTileID(o,e);if(s){var l=this._createProxiedId(o,s,n[o.key]&&n[o.key][e.id]);i.push(l),this.proxyToSource[o.key][e.id]=[l]}}for(var u=!1,c=0;c<t.length;c++){var d=e.getTile(t[c]);if(d&&d.hasData()){var h=this._findTileCoveringTileID(d.tileID,this.proxySourceCache);if(h&&h.tileID.canonical.z!==d.tileID.canonical.z){var f=this.proxyToSource[h.tileID.key][e.id],p=this._createProxiedId(h.tileID,d,n[h.tileID.key]&&n[h.tileID.key][e.id]);f?f.splice(f.length-1,0,p):this.proxyToSource[h.tileID.key][e.id]=[p],i.push(p),u=!0}}}this._sourceTilesOverlap[e.id]=u}},{key:"_setupProxiedCoordsForImageSource",value:function(t,n,i){if(t.getSource().loaded())for(var r=this.proxiedCoords[t.id]=[],a=this.proxyCoords,o=t.getSource(),s=new e.Point(o.tileID.x,o.tileID.y)._div(1<<o.tileID.z),l=o.coordinates.map(e.MercatorCoordinate.fromLngLat).reduce((function(e,t){return e.min.x=Math.min(e.min.x,t.x-s.x),e.min.y=Math.min(e.min.y,t.y-s.y),e.max.x=Math.max(e.max.x,t.x-s.x),e.max.y=Math.max(e.max.y,t.y-s.y),e}),{min:new e.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=function(t,n){var i=t.wrap+t.canonical.x/(1<<t.canonical.z),r=t.canonical.y/(1<<t.canonical.z),a=e.EXTENT/(1<<t.canonical.z),o=n.wrap+n.canonical.x/(1<<n.canonical.z),s=n.canonical.y/(1<<n.canonical.z);return i+a<o+l.min.x||i>o+l.max.x||r+a<s+l.min.y||r>s+l.max.y},c=0;c<a.length;c++)for(var d=a[c],h=0;h<n.length;h++){var f=t.getTile(n[h]);if(f&&f.hasData()&&!u(d,f.tileID)){var p=this._createProxiedId(d,f,i[d.key]&&i[d.key][t.id]),m=this.proxyToSource[d.key][t.id];m?m.push(p):this.proxyToSource[d.key][t.id]=[p],r.push(p)}}}},{key:"_createProxiedId",value:function(t,n,i){var r=this.orthoMatrix;if(i){var a=i.find((function(e){return e.key===n.tileID.key}));if(a)return a}if(n.tileID.key!==t.key){var o,s,l,u=t.canonical.z-n.tileID.canonical.z;r=e.create();var c=n.tileID.wrap-t.wrap<<t.overscaledZ;u>0?(s=(o=e.EXTENT>>u)*((n.tileID.canonical.x<<u)-t.canonical.x+c),l=o*((n.tileID.canonical.y<<u)-t.canonical.y)):(o=e.EXTENT<<-u,s=e.EXTENT*(n.tileID.canonical.x-(t.canonical.x+c<<-u)),l=e.EXTENT*(n.tileID.canonical.y-(t.canonical.y<<-u))),e.ortho(r,0,o,0,o,0,1),e.translate(r,r,[s,l,0])}return new Vn(n.tileID,t.key,r)}},{key:"_findTileCoveringTileID",value:function(t,n){var i=n.getTile(t);if(i&&i.hasData())return i;var r=this._findCoveringTileCache[n.id],a=r[t.key];if((i=a?n.getTileByID(a):null)&&i.hasData()||null===a)return i;var o=i?i.tileID:t,s=o.overscaledZ,l=n.getSource().minzoom,u=[];if(!a){var c=n.getSource().maxzoom;if(t.canonical.z>=c){var d=t.canonical.z-c;n.getSource().reparseOverscaled?(s=Math.max(t.canonical.z+2,n.transform.tileZoom),o=new e.OverscaledTileID(s,t.wrap,c,t.canonical.x>>d,t.canonical.y>>d)):0!==d&&(s=c,o=new e.OverscaledTileID(s,t.wrap,c,t.canonical.x>>d,t.canonical.y>>d))}o.key!==t.key&&(u.push(o.key),i=n.getTile(o))}var h=function(e){u.forEach((function(t){r[t]=e})),u.length=0};for(s-=1;s>=l&&(!i||!i.hasData());s--){i&&h(i.tileID.key);var f=o.calculateScaledKey(s);if((i=n.getTileByID(f))&&i.hasData())break;var p=r[f];if(null===p)break;void 0===p?u.push(f):i=n.getTileByID(p)}return h(i?i.tileID.key:null),i&&i.hasData()?i:null}},{key:"findDEMTileFor",value:function(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}},{key:"prepareDrawTile",value:function(){this.renderedToTile=!0}},{key:"_clearRenderCacheForTile",value:function(e,t){var n=this._tilesDirty[e];n||(n=this._tilesDirty[e]={}),n[t.key]=!0}},{key:"getWirefameBuffer",value:function(){if(!this.wireframeSegments){var t=function(t){for(var n=0,i=new e.StructArrayLayout2ui4,r=131,a=1;a<129;a++){for(var o=1;o<129;o++)n=a*r+o,i.emplaceBack(n,n+1),i.emplaceBack(n,n+r),i.emplaceBack(n+1,n+r),128===a&&i.emplaceBack(n+r,n+r+1);i.emplaceBack(n+1,n+1+r)}return i}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=e.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}]),i}(e.Elevation),Gn=function(){function t(n,i,r,a,o,s){f(this,t);var l=n.gl;this.program=l.createProgram();var u=function(e){for(var t=[],n=0;n<e.length;n++)if(null!==e[n]){var i=e[n].split(" ");t.push(i.pop())}return t}(r.staticAttributes),c=a?a.getBinderAttributes():[],d=u.concat(c),h=a?a.defines():[];h=h.concat(s.map((function(e){return"#define ".concat(e)})));var p=n.isWebGL2?"#version 300 es\n":"",m=p+h.concat(n.extStandardDerivatives&&0===p.length?"#extension GL_OES_standard_derivatives : enable\n".concat(wn):wn,wn,bn,xn.fragmentSource,vn.fragmentSource,r.fragmentSource).join("\n"),y=p+h.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",bn,xn.vertexSource,vn.vertexSource,gn.vertexSource,r.vertexSource).join("\n"),g=l.createShader(l.FRAGMENT_SHADER);if(l.isContextLost())this.failedToCreate=!0;else{l.shaderSource(g,m),l.compileShader(g),l.attachShader(this.program,g);var v=l.createShader(l.VERTEX_SHADER);if(l.isContextLost())this.failedToCreate=!0;else{l.shaderSource(v,y),l.compileShader(v),l.attachShader(this.program,v),this.attributes={},this.numAttributes=d.length;for(var _=0;_<this.numAttributes;_++)d[_]&&(l.bindAttribLocation(this.program,_,d[_]),this.attributes[d[_]]=_);l.linkProgram(this.program),l.deleteShader(v),l.deleteShader(g),this.fixedUniforms=o(n),this.binderUniforms=a?a.getUniforms(n):[],s.includes("TERRAIN")&&(this.terrainUniforms=function(t){return{u_dem:new e.Uniform1i(t),u_dem_prev:new e.Uniform1i(t),u_dem_unpack:new e.Uniform4f(t),u_dem_tl:new e.Uniform2f(t),u_dem_scale:new e.Uniform1f(t),u_dem_tl_prev:new e.Uniform2f(t),u_dem_scale_prev:new e.Uniform1f(t),u_dem_size:new e.Uniform1f(t),u_dem_lerp:new e.Uniform1f(t),u_exaggeration:new e.Uniform1f(t),u_depth:new e.Uniform1i(t),u_depth_size_inv:new e.Uniform2f(t),u_meter_to_dem:new e.Uniform1f(t),u_label_plane_matrix_inv:new e.UniformMatrix4f(t)}}(n)),s.includes("GLOBE")&&(this.globeUniforms=function(t){return{u_tile_tl_up:new e.Uniform3f(t),u_tile_tr_up:new e.Uniform3f(t),u_tile_br_up:new e.Uniform3f(t),u_tile_bl_up:new e.Uniform3f(t),u_tile_up_scale:new e.Uniform1f(t)}}(n)),s.includes("FOG")&&(this.fogUniforms=function(t){return{u_fog_matrix:new e.UniformMatrix4f(t),u_fog_range:new e.Uniform2f(t),u_fog_color:new e.Uniform4f(t),u_fog_horizon_blend:new e.Uniform1f(t),u_fog_temporal_offset:new e.Uniform1f(t),u_frustum_tl:new e.Uniform3f(t),u_frustum_tr:new e.Uniform3f(t),u_frustum_br:new e.Uniform3f(t),u_frustum_bl:new e.Uniform3f(t),u_globe_pos:new e.Uniform3f(t),u_globe_radius:new e.Uniform1f(t),u_globe_transition:new e.Uniform1f(t),u_is_globe:new e.Uniform1i(t),u_viewport:new e.Uniform2f(t)}}(n))}}}return p(t,[{key:"setTerrainUniformValues",value:function(e,t){if(this.terrainUniforms){var n=this.terrainUniforms;if(!this.failedToCreate)for(var i in e.program.set(this.program),t)n[i]&&n[i].set(this.program,i,t[i])}}},{key:"setGlobeUniformValues",value:function(e,t){if(this.globeUniforms){var n=this.globeUniforms;if(!this.failedToCreate)for(var i in e.program.set(this.program),t)n[i]&&n[i].set(this.program,i,t[i])}}},{key:"setFogUniformValues",value:function(e,t){if(this.fogUniforms){var n=this.fogUniforms;if(!this.failedToCreate)for(var i in e.program.set(this.program),t)n[i].set(this.program,i,t[i])}}},{key:"draw",value:function(e,t,n,r,a,o,s,l,u,c,d,f,p,m,y){var g,v=e.gl;if(!this.failedToCreate){e.program.set(this.program),e.setDepthMode(n),e.setStencilMode(r),e.setColorMode(a),e.setCullFace(o);for(var _=0,x=Object.keys(this.fixedUniforms);_<x.length;_++){var b=x[_];this.fixedUniforms[b].set(this.program,b,s[b])}m&&m.setUniforms(this.program,e,this.binderUniforms,f,{zoom:p});var w,k=(g={},i(g,v.LINES,2),i(g,v.TRIANGLES,3),i(g,v.LINE_STRIP,1),g)[t],T=h(d.get());try{for(T.s();!(w=T.n()).done;){var E=w.value,S=E.vaos||(E.vaos={});(S[l]||(S[l]=new Sn)).bind(e,this,u,m?m.getPaintVertexBuffers():[],c,E.vertexOffset,y||[]),v.drawElements(t,E.primitiveLength*k,v.UNSIGNED_SHORT,E.primitiveOffset*k*2)}}catch(L){T.e(L)}finally{T.f()}}}}],[{key:"cacheKey",value:function(e,t,n,i){var r,a="".concat(t).concat(i?i.cacheKey:""),o=h(n);try{for(o.s();!(r=o.n()).done;){var s=r.value;e.usedDefines.includes(s)&&(a+="/".concat(s))}}catch(l){o.e(l)}finally{o.f()}return a}}]),t}();function qn(e,t){var n=Math.pow(2,t.tileID.overscaledZ),i=t.tileSize*Math.pow(2,e.transform.tileZoom)/n,r=i*(t.tileID.canonical.x+t.tileID.wrap*n),a=i*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture.size,u_tile_units_to_pixels:1/V(t,1,e.transform.tileZoom),u_pixel_coord_upper:[r>>16,a>>16],u_pixel_coord_lower:[65535&r,65535&a]}}var Zn=e.create(),Xn=function(t,n,i,r,a,o,s,l,u,c,d){var h=n.style.light,f=h.properties.get("position"),p=[f.x,f.y,f.z],m=e.create$1();"viewport"===h.properties.get("anchor")&&(e.fromRotation(m,-n.transform.angle),e.transformMat3(p,p,m));var y=h.properties.get("color"),g=n.transform,v={u_matrix:t,u_lightpos:p,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[y.r,y.g,y.b],u_vertical_gradient:+i,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:a,u_edge_radius:o};return"globe"===g.projection.name&&(v.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],v.u_zoom_transition=u,v.u_inv_rot_matrix=d,v.u_merc_center=c,v.u_up_dir=g.projection.upVector(new e.CanonicalTileID(0,0,0),c[0]*e.EXTENT,c[1]*e.EXTENT),v.u_height_lift=l),v},Kn=function(t,n,i,r,a,o,s,l,u,c,d,h){var f=Xn(t,n,i,r,a,o,s,u,c,d,h),p={u_height_factor:-Math.pow(2,s.overscaledZ)/l.tileSize/8};return e.extend(f,qn(n,l),p)},Yn=function(e){return{u_matrix:e}},Jn=function(t,n,i){return e.extend(Yn(t),qn(n,i))},$n=function(e,t){return{u_matrix:e,u_world:t}},Qn=function(t,n,i,r){return e.extend(Jn(t,n,i),{u_world:r})},ei=e.create(),ti=function(t,n,i,r,a,o){var s,l=t.transform,u="globe"===l.projection.name;if("map"===o.paint.get("circle-pitch-alignment"))if(u){var c=e.globePixelsToTileUnits(l.zoom,n.canonical)*l._pixelsPerMercatorPixel;s=Float32Array.from([c,0,0,c])}else s=l.calculatePixelsToTileUnitsMatrix(i);else s=new Float32Array([l.pixelsToGLUnits[0],0,0,l.pixelsToGLUnits[1]]);var d={u_camera_to_center_distance:l.cameraToCenterDistance,u_matrix:t.translatePosMatrix(n.projMatrix,i,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:e.exported.devicePixelRatio,u_extrude_scale:s,u_inv_rot_matrix:ei,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(u){d.u_inv_rot_matrix=r,d.u_merc_center=a,d.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],d.u_zoom_transition=e.globeToMercatorTransition(l.zoom);var h=a[0]*e.EXTENT,f=a[1]*e.EXTENT;d.u_up_dir=l.projection.upVector(new e.CanonicalTileID(0,0,0),h,f)}return d},ni=function(e){var t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},ii=function(t,n,i,r){var a=e.EXTENT/i.tileSize;return{u_matrix:t,u_camera_to_center_distance:n.getCameraToCenterDistance(r),u_extrude_scale:[n.pixelsToGLUnits[0]/a,n.pixelsToGLUnits[1]/a]}},ri=function(e,t){return{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1}},ai=e.create(),oi=function(t,n,i,r,a,o,s){var l=t.transform,u="globe"===l.projection.name,c=u?e.globePixelsToTileUnits(l.zoom,n.canonical)*l._pixelsPerMercatorPixel:V(i,1,o),d={u_matrix:n.projMatrix,u_extrude_scale:c,u_intensity:s,u_inv_rot_matrix:ai,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(u){d.u_inv_rot_matrix=r,d.u_merc_center=a,d.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],d.u_zoom_transition=e.globeToMercatorTransition(l.zoom);var h=a[0]*e.EXTENT,f=a[1]*e.EXTENT;d.u_up_dir=l.projection.upVector(new e.CanonicalTileID(0,0,0),h,f)}return d},si=function(e,t,n,i,r,a,o){var s=e.transform,l=s.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:ci(e,t,n,i),u_pixels_to_tile_units:l,u_device_pixel_ratio:a,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:r,u_texsize:di(n)?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ui(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:o}},li=function(e,t,n,i,r){var a=e.transform;return{u_matrix:ci(e,t,n,i),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:a.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:r,u_image:0,u_tile_units_to_pixels:ui(t,a),u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ui(e,t){return 1/V(e,1,t.tileZoom)}function ci(e,t,n,i){return e.translatePosMatrix(i||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}function di(e){var t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}var hi=function(e,t,n,i,r,a){return{u_matrix:e,u_tl_parent:t,u_scale_parent:n,u_fade_t:i.mix,u_opacity:i.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(s=r.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(o=r.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:fi(r.paint.get("raster-hue-rotate")),u_perspective_transform:a};var o,s};function fi(e){e*=Math.PI/180;var t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}var pi,mi=e.create(),yi=function(t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,y){var g=a.transform,v={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:g.cameraToCenterDistance,u_rotate_symbol:+i,u_aspect_ratio:g.width/g.height,u_fade_change:a.options.fadeDuration?a.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:s,u_coord_matrix:l,u_is_text:+u,u_pitch_with_map:+r,u_texsize:c,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:mi,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:mi,u_up_vector:[0,-1,0]};return"globe"===y.name&&(v.u_tile_id=[d.canonical.x,d.canonical.y,1<<d.canonical.z],v.u_zoom_transition=h,v.u_inv_rot_matrix=p,v.u_merc_center=f,v.u_camera_forward=g._camera.forward(),v.u_ecef_origin=e.globeECEFOrigin(g.globeMatrix,d.toUnwrapped()),v.u_tile_matrix=Float32Array.from(g.globeMatrix),v.u_up_vector=m),v},gi=function(t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,y,g){return e.extend(yi(t,n,i,r,a,o,s,l,u,c,h,f,p,m,y,g),{u_gamma_scale:r?a.transform.cameraToCenterDistance*Math.cos(a.terrain?0:a.transform._pitch):1,u_device_pixel_ratio:e.exported.devicePixelRatio,u_is_halo:+d})},vi=function(t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,y){return e.extend(gi(t,n,i,r,a,o,s,l,!0,u,!0,d,h,f,p,m,y),{u_texsize_icon:c,u_texture_icon:1})},_i=function(e,t,n){return{u_matrix:e,u_opacity:t,u_color:n}},xi=function(t,n,i,r,a){return e.extend(function(e,t,n){var i=t.imageManager.getPattern(e.toString()),r=t.imageManager.getPixelSize(),a=r.width,o=r.height,s=Math.pow(2,n.tileID.overscaledZ),l=n.tileSize*Math.pow(2,t.transform.tileZoom)/s,u=l*(n.tileID.canonical.x+n.tileID.wrap*s),c=l*n.tileID.canonical.y;return{u_image:0,u_pattern_tl:i.tl,u_pattern_br:i.br,u_texsize:[a,o],u_pattern_size:i.displaySize,u_tile_units_to_pixels:1/V(n,1,t.transform.tileZoom),u_pixel_coord_upper:[u>>16,c>>16],u_pixel_coord_lower:[65535&u,65535&c]}}(r,i,a),{u_matrix:t,u_opacity:n})},bi={fillExtrusion:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_lightpos:new e.Uniform3f(t),u_lightintensity:new e.Uniform1f(t),u_lightcolor:new e.Uniform3f(t),u_vertical_gradient:new e.Uniform1f(t),u_opacity:new e.Uniform1f(t),u_edge_radius:new e.Uniform1f(t),u_ao:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_up_dir:new e.Uniform3f(t),u_height_lift:new e.Uniform1f(t)}},fillExtrusionPattern:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_lightpos:new e.Uniform3f(t),u_lightintensity:new e.Uniform1f(t),u_lightcolor:new e.Uniform3f(t),u_vertical_gradient:new e.Uniform1f(t),u_height_factor:new e.Uniform1f(t),u_edge_radius:new e.Uniform1f(t),u_ao:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_up_dir:new e.Uniform3f(t),u_height_lift:new e.Uniform1f(t),u_image:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_pixel_coord_upper:new e.Uniform2f(t),u_pixel_coord_lower:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t),u_opacity:new e.Uniform1f(t)}},fill:function(t){return{u_matrix:new e.UniformMatrix4f(t)}},fillPattern:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_image:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_pixel_coord_upper:new e.Uniform2f(t),u_pixel_coord_lower:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t)}},fillOutline:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_world:new e.Uniform2f(t)}},fillOutlinePattern:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_world:new e.Uniform2f(t),u_image:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_pixel_coord_upper:new e.Uniform2f(t),u_pixel_coord_lower:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t)}},circle:function(t){return{u_camera_to_center_distance:new e.Uniform1f(t),u_extrude_scale:new e.UniformMatrix2f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_up_dir:new e.Uniform3f(t)}},collisionBox:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_extrude_scale:new e.Uniform2f(t)}},collisionCircle:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_inv_matrix:new e.UniformMatrix4f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_viewport_size:new e.Uniform2f(t)}},debug:function(t){return{u_color:new e.UniformColor(t),u_matrix:new e.UniformMatrix4f(t),u_overlay:new e.Uniform1i(t),u_overlay_scale:new e.Uniform1f(t)}},clippingMask:function(t){return{u_matrix:new e.UniformMatrix4f(t)}},heatmap:function(t){return{u_extrude_scale:new e.Uniform1f(t),u_intensity:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_up_dir:new e.Uniform3f(t)}},heatmapTexture:function(t){return{u_image:new e.Uniform1i(t),u_color_ramp:new e.Uniform1i(t),u_opacity:new e.Uniform1f(t)}},hillshade:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_image:new e.Uniform1i(t),u_latrange:new e.Uniform2f(t),u_light:new e.Uniform2f(t),u_shadow:new e.UniformColor(t),u_highlight:new e.UniformColor(t),u_accent:new e.UniformColor(t)}},hillshadePrepare:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_image:new e.Uniform1i(t),u_dimension:new e.Uniform2f(t),u_zoom:new e.Uniform1f(t),u_unpack:new e.Uniform4f(t)}},line:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_pixels_to_tile_units:new e.UniformMatrix2f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_units_to_pixels:new e.Uniform2f(t),u_dash_image:new e.Uniform1i(t),u_gradient_image:new e.Uniform1i(t),u_image_height:new e.Uniform1f(t),u_texsize:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t),u_alpha_discard_threshold:new e.Uniform1f(t),u_trim_offset:new e.Uniform2f(t)}},linePattern:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_texsize:new e.Uniform2f(t),u_pixels_to_tile_units:new e.UniformMatrix2f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_image:new e.Uniform1i(t),u_units_to_pixels:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t),u_alpha_discard_threshold:new e.Uniform1f(t)}},raster:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_tl_parent:new e.Uniform2f(t),u_scale_parent:new e.Uniform1f(t),u_fade_t:new e.Uniform1f(t),u_opacity:new e.Uniform1f(t),u_image0:new e.Uniform1i(t),u_image1:new e.Uniform1i(t),u_brightness_low:new e.Uniform1f(t),u_brightness_high:new e.Uniform1f(t),u_saturation_factor:new e.Uniform1f(t),u_contrast_factor:new e.Uniform1f(t),u_spin_weights:new e.Uniform3f(t),u_perspective_transform:new e.Uniform2f(t)}},symbolIcon:function(t){return{u_is_size_zoom_constant:new e.Uniform1i(t),u_is_size_feature_constant:new e.Uniform1i(t),u_size_t:new e.Uniform1f(t),u_size:new e.Uniform1f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_rotate_symbol:new e.Uniform1i(t),u_aspect_ratio:new e.Uniform1f(t),u_fade_change:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_label_plane_matrix:new e.UniformMatrix4f(t),u_coord_matrix:new e.UniformMatrix4f(t),u_is_text:new e.Uniform1i(t),u_pitch_with_map:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_camera_forward:new e.Uniform3f(t),u_tile_matrix:new e.UniformMatrix4f(t),u_up_vector:new e.Uniform3f(t),u_ecef_origin:new e.Uniform3f(t),u_texture:new e.Uniform1i(t)}},symbolSDF:function(t){return{u_is_size_zoom_constant:new e.Uniform1i(t),u_is_size_feature_constant:new e.Uniform1i(t),u_size_t:new e.Uniform1f(t),u_size:new e.Uniform1f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_rotate_symbol:new e.Uniform1i(t),u_aspect_ratio:new e.Uniform1f(t),u_fade_change:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_label_plane_matrix:new e.UniformMatrix4f(t),u_coord_matrix:new e.UniformMatrix4f(t),u_is_text:new e.Uniform1i(t),u_pitch_with_map:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_texture:new e.Uniform1i(t),u_gamma_scale:new e.Uniform1f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_camera_forward:new e.Uniform3f(t),u_tile_matrix:new e.UniformMatrix4f(t),u_up_vector:new e.Uniform3f(t),u_ecef_origin:new e.Uniform3f(t),u_is_halo:new e.Uniform1i(t)}},symbolTextAndIcon:function(t){return{u_is_size_zoom_constant:new e.Uniform1i(t),u_is_size_feature_constant:new e.Uniform1i(t),u_size_t:new e.Uniform1f(t),u_size:new e.Uniform1f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_rotate_symbol:new e.Uniform1i(t),u_aspect_ratio:new e.Uniform1f(t),u_fade_change:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_label_plane_matrix:new e.UniformMatrix4f(t),u_coord_matrix:new e.UniformMatrix4f(t),u_is_text:new e.Uniform1i(t),u_pitch_with_map:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_texsize_icon:new e.Uniform2f(t),u_texture:new e.Uniform1i(t),u_texture_icon:new e.Uniform1i(t),u_gamma_scale:new e.Uniform1f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_is_halo:new e.Uniform1i(t)}},background:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_opacity:new e.Uniform1f(t),u_color:new e.UniformColor(t)}},backgroundPattern:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_opacity:new e.Uniform1f(t),u_image:new e.Uniform1i(t),u_pattern_tl:new e.Uniform2f(t),u_pattern_br:new e.Uniform2f(t),u_texsize:new e.Uniform2f(t),u_pattern_size:new e.Uniform2f(t),u_pixel_coord_upper:new e.Uniform2f(t),u_pixel_coord_lower:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t)}},terrainRaster:In,terrainDepth:In,skybox:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_sun_direction:new e.Uniform3f(t),u_cubemap:new e.Uniform1i(t),u_opacity:new e.Uniform1f(t),u_temporal_offset:new e.Uniform1f(t)}},skyboxGradient:function(t){return{u_matrix:new e.UniformMatrix4f(t),u_color_ramp:new e.Uniform1i(t),u_center_direction:new e.Uniform3f(t),u_radius:new e.Uniform1f(t),u_opacity:new e.Uniform1f(t),u_temporal_offset:new e.Uniform1f(t)}},skyboxCapture:function(t){return{u_matrix_3f:new e.UniformMatrix3f(t),u_sun_direction:new e.Uniform3f(t),u_sun_intensity:new e.Uniform1f(t),u_color_tint_r:new e.Uniform4f(t),u_color_tint_m:new e.Uniform4f(t),u_luminance:new e.Uniform1f(t)}},globeRaster:function(t){return{u_proj_matrix:new e.UniformMatrix4f(t),u_globe_matrix:new e.UniformMatrix4f(t),u_normalize_matrix:new e.UniformMatrix4f(t),u_merc_matrix:new e.UniformMatrix4f(t),u_zoom_transition:new e.Uniform1f(t),u_merc_center:new e.Uniform2f(t),u_image0:new e.Uniform1i(t),u_grid_matrix:new e.UniformMatrix3f(t),u_skirt_height:new e.Uniform1f(t),u_frustum_tl:new e.Uniform3f(t),u_frustum_tr:new e.Uniform3f(t),u_frustum_br:new e.Uniform3f(t),u_frustum_bl:new e.Uniform3f(t),u_globe_pos:new e.Uniform3f(t),u_globe_radius:new e.Uniform1f(t),u_viewport:new e.Uniform2f(t)}},globeAtmosphere:function(t){return{u_frustum_tl:new e.Uniform3f(t),u_frustum_tr:new e.Uniform3f(t),u_frustum_br:new e.Uniform3f(t),u_frustum_bl:new e.Uniform3f(t),u_horizon:new e.Uniform1f(t),u_transition:new e.Uniform1f(t),u_fadeout_range:new e.Uniform1f(t),u_color:new e.Uniform4f(t),u_high_color:new e.Uniform4f(t),u_space_color:new e.Uniform4f(t),u_star_intensity:new e.Uniform1f(t),u_star_density:new e.Uniform1f(t),u_star_size:new e.Uniform1f(t),u_temporal_offset:new e.Uniform1f(t),u_horizon_angle:new e.Uniform1f(t),u_rotation_matrix:new e.UniformMatrix4f(t)}}};function wi(t,n,i,r,a,o,s){for(var l=t.context,u=l.gl,c=t.transform,d=t.useProgram("collisionBox"),h=[],f=0,p=0,m=0;m<r.length;m++){var y=r[m],g=n.getTile(y),v=g.getBucket(i);if(v){var _=It(y,v,c),x=_;0===a[0]&&0===a[1]||(x=t.translatePosMatrix(_,g,a,o));var b=s?v.textCollisionBox:v.iconCollisionBox,w=v.collisionCircleArray;if(w.length>0){var k=e.create(),T=x;e.mul(k,v.placementInvProjMatrix,c.glCoordMatrix),e.mul(k,k,v.placementViewportMatrix),h.push({circleArray:w,circleOffset:p,transform:T,invTransform:k,projection:v.getProjection()}),p=f+=w.length/4}b&&(t.terrain&&t.terrain.setupElevationDraw(g,d),d.draw(l,u.LINES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,ii(x,c,g,v.getProjection()),i.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,null,c.zoom,null,[b.collisionVertexBuffer,b.collisionVertexBufferExt]))}}if(s&&h.length){var E=t.useProgram("collisionCircle"),S=new e.StructArrayLayout2f1f2i16;S.resize(4*f),S._trim();for(var L=0,M=0,A=h;M<A.length;M++)for(var C=A[M],I=0;I<C.circleArray.length/4;I++){var P=4*I,z=C.circleArray[P+0],D=C.circleArray[P+1],R=C.circleArray[P+2],B=C.circleArray[P+3];S.emplace(L++,z,D,R,B,0),S.emplace(L++,z,D,R,B,1),S.emplace(L++,z,D,R,B,2),S.emplace(L++,z,D,R,B,3)}(!pi||pi.length<2*f)&&(pi=function(t){var n=2*t,i=new e.StructArrayLayout3ui6;i.resize(n),i._trim();for(var r=0;r<n;r++){var a=6*r;i.uint16[a+0]=4*r+0,i.uint16[a+1]=4*r+1,i.uint16[a+2]=4*r+2,i.uint16[a+3]=4*r+2,i.uint16[a+4]=4*r+3,i.uint16[a+5]=4*r+0}return i}(f));for(var F,O=l.createIndexBuffer(pi,!0),N=l.createVertexBuffer(S,e.collisionCircleLayout.members,!0),H=0,U=h;H<U.length;H++){var j=U[H],V={u_matrix:j.transform,u_inv_matrix:j.invTransform,u_camera_to_center_distance:(F=c).getCameraToCenterDistance(j.projection),u_viewport_size:[F.width,F.height]};E.draw(l,u.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,V,i.id,N,O,e.SegmentVector.simpleSegment(0,2*j.circleOffset,j.circleArray.length,j.circleArray.length/2),null,c.zoom)}N.destroy(),O.destroy()}}var ki=e.create();function Ti(t,n){var i=t.width,r=t.height,a=t.anchor,o=t.textOffset,s=t.textScale,l=e.getAnchorAlignment(a),u=-(l.horizontalAlign-.5)*i,c=-(l.verticalAlign-.5)*r,d=e.evaluateVariableOffset(a,o);return new e.Point((u/s+d[0])*n,(c/s+d[1])*n)}function Ei(t,n,i,r,a,o,s,l,u,c,h){var f=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,m=t.icon.dynamicLayoutVertexArray,y={},g=t.getProjection(),v=Pt(l,g,o),_=o.elevation,x=g.upVectorScale(l.canonical,o.center.lat,o.worldSize).metersToTile;p.clear();for(var b=0;b<f.length;b++){var w=f.get(b),k=w.tileAnchorX,T=w.tileAnchorY,E=w.numGlyphs,S=w.hidden||!w.crossTileID||t.allowVerticalPlacement&&!w.placedOrientation?null:r[w.crossTileID];if(S){var L,M,A,C=0,I=0,P=0;if(_){var z=_?_.getAtTileOffset(l,k,T):0,D=g.upVector(l.canonical,k,T),R=d(D,3);C=z*R[0]*x,I=z*R[1]*x,P=z*R[2]*x}var B=yt(w.projectedAnchorX+C,w.projectedAnchorY+I,w.projectedAnchorZ+P,i?v:s),F=d(B,4),O=F[0],N=F[1],H=F[2],U=F[3],j=gt(o.getCameraToCenterDistance(g),U),V=a.evaluateSizeForFeature(t.textSizeData,c,w)*j/e.ONE_EM;i&&(V*=t.tilePixelRatio/u);var W=Ti(S,V);i?(M=yt((O=(L=g.projectTilePoint(k+W.x,T+W.y,l.canonical)).x)+C,(N=L.y)+I,(H=L.z)+P,s),O=(A=d(M,3))[0],N=A[1],H=A[2]):(n&&W._rotate(-o.angle),O+=W.x,N+=W.y,H=0);for(var G=t.allowVerticalPlacement&&w.placedOrientation===e.WritingMode.vertical?Math.PI/2:0,q=0;q<E;q++)e.addDynamicAttributes(p,O,N,H,G);h&&w.associatedIconIndex>=0&&(y[w.associatedIconIndex]={x:O,y:N,z:H,angle:G})}else St(E,p)}if(h){m.clear();for(var Z=t.icon.placedSymbolArray,X=0;X<Z.length;X++){var K=Z.get(X),Y=K.numGlyphs,J=y[X];if(K.hidden||!J)St(Y,m);else for(var $=J.x,Q=J.y,ee=J.z,te=J.angle,ne=0;ne<Y;ne++)e.addDynamicAttributes(m,$,Q,ee,te)}t.icon.dynamicLayoutVertexBuffer.updateData(m)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function Si(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function Li(t,n,i,r,a,o,s,l,u,c,d,f){var p=t.context,m=p.gl,y=t.transform,g="map"===l,v="map"===u,_=g&&"point"!==i.layout.get("symbol-placement"),x=g&&!v&&!_,b=void 0!==i.layout.get("symbol-sort-key").constantOr(1),w=!1,k=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),T=[e.mercatorXfromLng(y.center.lng),e.mercatorYfromLat(y.center.lat)],E=i.layout.get("text-variable-anchor"),S="globe"===y.projection.name,L=[],M=[0,-1,0],A=M;!S&&!y.mercatorFromTransition||g||(A=function(t){var n=t._camera.getWorldToCamera(t.worldSize,1),i=e.multiply([],n,t.globeMatrix);e.invert(i,i);var r=[0,0,0],a=[0,1,0,0];return e.transformMat4$1(a,a,i),r[0]=a[0],r[1]=a[1],r[2]=a[2],e.normalize(r,r),r}(y));var C,I=h(r);try{for(I.s();!(C=I.n()).done;){var P=C.value,z=n.getTile(P),D=z.getBucket(i);if(D&&("mercator"!==D.projection.name||!S)){var R=a?D.text:D.icon;if(R&&!D.fullyClipped&&R.segments.get().length){var B=R.programConfigurations.get(i.id),F=a||D.sdfIcons,O=a?D.textSizeData:D.iconSizeData,N=v||0!==y.pitch,H=e.evaluateSizeForZoom(O,y.zoom),U=void 0,j=void 0,V=void 0,W=void 0,G=[0,0],q=null;if(a)j=z.glyphAtlasTexture,V=m.LINEAR,U=z.glyphAtlasTexture.size,D.iconsInText&&(G=z.imageAtlasTexture.size,q=z.imageAtlasTexture,W=N||t.options.rotating||t.options.zooming||"composite"===O.kind||"camera"===O.kind?m.LINEAR:m.NEAREST);else{var Z=1!==i.layout.get("icon-size").constantOr(0)||D.iconsNeedLinear;j=z.imageAtlasTexture,V=F||t.options.rotating||t.options.zooming||Z||N?m.LINEAR:m.NEAREST,U=z.imageAtlasTexture.size}var X="globe"===D.projection.name,K=X?A:M,Y=X?e.globeToMercatorTransition(y.zoom):0,J=Pt(P,D.getProjection(),y),$=y.calculatePixelsToTileUnitsMatrix(z),Q=ft(J,z.tileID.canonical,v,g,y,D.getProjection(),$),ee=t.terrain&&v&&_?e.invert(e.create(),Q):ki,te=mt(J,z.tileID.canonical,v,g,y,D.getProjection(),$),ne=E&&D.hasTextData(),ie="none"!==i.layout.get("icon-text-fit")&&ne&&D.hasIconData();if(_){var re=y.elevation,ae=re?re.getAtTileOffsetFunc(P,y.center.lat,y.worldSize,D.getProjection()):null,oe=pt(J,z.tileID.canonical,v,g,y,D.getProjection(),$);_t(D,J,t,a,oe,te,v,c,ae,P)}var se=_||a&&E||ie,le=t.translatePosMatrix(J,z,o,s),ue=se?ki:Q,ce=t.translatePosMatrix(te,z,o,s,!0),de=D.getProjection().createInversionMatrix(y,P.canonical),he=[];t.terrainRenderModeElevated()&&v&&he.push("PITCH_WITH_MAP_TERRAIN"),X&&he.push("PROJECTION_GLOBE_VIEW"),se&&he.push("PROJECTED_POS_ON_VIEWPORT");var fe=F&&0!==i.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),pe=void 0;pe=F?D.iconsInText?vi(O.kind,H,x,v,t,le,ue,ce,U,G,P,Y,T,de,K,D.getProjection()):gi(O.kind,H,x,v,t,le,ue,ce,a,U,!0,P,Y,T,de,K,D.getProjection()):yi(O.kind,H,x,v,t,le,ue,ce,a,U,P,Y,T,de,K,D.getProjection());var me={program:t.useProgram(Si(F,a,D),B,he),buffers:R,uniformValues:pe,atlasTexture:j,atlasTextureIcon:q,atlasInterpolation:V,atlasInterpolationIcon:W,isSDF:F,hasHalo:fe,tile:z,labelPlaneMatrixInv:ee};if(b&&D.canOverlap){w=!0;var ye,ge=R.segments.get(),ve=h(ge);try{for(ve.s();!(ye=ve.n()).done;){var _e=ye.value;L.push({segments:new e.SegmentVector([_e]),sortKey:_e.sortKey,state:me})}}catch(Ee){ve.e(Ee)}finally{ve.f()}}else L.push({segments:R.segments,sortKey:0,state:me})}}}}catch(Ee){I.e(Ee)}finally{I.f()}w&&L.sort((function(e,t){return e.sortKey-t.sortKey}));for(var xe=0,be=L;xe<be.length;xe++){var we=be[xe],ke=we.state;if(t.terrain&&t.terrain.setupElevationDraw(ke.tile,ke.program,{useDepthForOcclusion:!S,labelPlaneMatrixInv:ke.labelPlaneMatrixInv}),p.activeTexture.set(m.TEXTURE0),ke.atlasTexture.bind(ke.atlasInterpolation,m.CLAMP_TO_EDGE),ke.atlasTextureIcon&&(p.activeTexture.set(m.TEXTURE1),ke.atlasTextureIcon&&ke.atlasTextureIcon.bind(ke.atlasInterpolationIcon,m.CLAMP_TO_EDGE)),ke.isSDF){var Te=ke.uniformValues;ke.hasHalo&&(Te.u_is_halo=1,Mi(ke.buffers,we.segments,i,t,ke.program,k,d,f,Te)),Te.u_is_halo=0}Mi(ke.buffers,we.segments,i,t,ke.program,k,d,f,ke.uniformValues)}}function Mi(t,n,i,r,a,o,s,l,u){var c=r.context,d=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.globeExtVertexBuffer];a.draw(c,c.gl.TRIANGLES,o,s,l,e.CullFaceMode.disabled,u,i.id,t.layoutVertexBuffer,t.indexBuffer,n,i.paint,r.transform.zoom,t.programConfigurations.get(i.id),d)}function Ai(t,n,i,r,a,o,s){var l,u,c,d,f,p=t.context.gl,m=i.paint.get("fill-pattern"),y=m&&m.constantOr(1);s?(u=y&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",l=p.LINES):(u=y?"fillPattern":"fill",l=p.TRIANGLES);var g,v=h(r);try{for(v.s();!(g=v.n()).done;){var _=g.value,x=n.getTile(_);if(!y||x.patternsLoaded()){var b=x.getBucket(i);if(b){t.prepareDrawTile();var w=b.programConfigurations.get(i.id),k=t.useProgram(u,w);y&&(t.context.activeTexture.set(p.TEXTURE0),x.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),w.updatePaintBuffers());var T=m.constantOr(null);if(T&&x.imageAtlas){var E=x.imageAtlas.patternPositions[T.toString()];E&&w.setConstantPatternPositions(E)}var S=t.translatePosMatrix(_.projMatrix,x,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(s){d=b.indexBuffer2,f=b.segments2;var L=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[p.drawingBufferWidth,p.drawingBufferHeight];c="fillOutlinePattern"===u&&y?Qn(S,t,x,L):$n(S,L)}else d=b.indexBuffer,f=b.segments,c=y?Jn(S,t,x):Yn(S);t.prepareDrawProgram(t.context,k,_.toUnwrapped()),k.draw(t.context,l,a,t.stencilModeForClipping(_),o,e.CullFaceMode.disabled,c,i.id,b.layoutVertexBuffer,d,f,i.paint,t.transform.zoom,w)}}}}catch(M){v.e(M)}finally{v.f()}}function Ci(t,n,i,r,a,o,s){var l=t.context,u=l.gl,c=t.transform,d=i.paint.get("fill-extrusion-pattern"),f=d.constantOr(1),p=i.paint.get("fill-extrusion-opacity"),m=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),i.paint.get("fill-extrusion-ambient-occlusion-radius")],y=i.layout.get("fill-extrusion-edge-radius"),g=y>0&&!i.paint.get("fill-extrusion-rounded-roof"),v=g?0:y,_="globe"===c.projection.name?e.fillExtrusionHeightLift():0,x="globe"===c.projection.name,b=x?e.globeToMercatorTransition(c.zoom):0,w=[e.mercatorXfromLng(c.center.lng),e.mercatorYfromLat(c.center.lat)],k=[];x&&k.push("PROJECTION_GLOBE_VIEW"),m[0]>0&&k.push("FAUX_AO"),g&&k.push("ZERO_ROOF_RADIUS");var T,E=h(r);try{for(E.s();!(T=E.n()).done;){var S=T.value,L=n.getTile(S),M=L.getBucket(i);if(M&&M.projection.name===c.projection.name){var A=M.programConfigurations.get(i.id),C=t.useProgram(f?"fillExtrusionPattern":"fillExtrusion",A,k);if(t.terrain){var I=t.terrain;if(t.style.terrainSetForDrapingOnly())I.setupElevationDraw(L,C,{useMeterToDem:!0});else{if(!M.enableTerrain)continue;if(I.setupElevationDraw(L,C,{useMeterToDem:!0}),Ii(l,n,S,M,i,I),!M.centroidVertexBuffer){var P=C.attributes.a_centroid_pos;void 0!==P&&u.vertexAttrib2f(P,0,0)}}}f&&(t.context.activeTexture.set(u.TEXTURE0),L.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),A.updatePaintBuffers());var z=d.constantOr(null);if(z&&L.imageAtlas){var D=L.imageAtlas.patternPositions[z.toString()];D&&A.setConstantPatternPositions(D)}var R=t.translatePosMatrix(S.projMatrix,L,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),B=c.projection.createInversionMatrix(c,S.canonical),F=i.paint.get("fill-extrusion-vertical-gradient"),O=f?Kn(R,t,F,p,m,v,S,L,_,b,w,B):Xn(R,t,F,p,m,v,S,_,b,w,B);t.prepareDrawProgram(l,C,S.toUnwrapped());var N=[];t.terrain&&N.push(M.centroidVertexBuffer),x&&N.push(M.layoutVertexExtBuffer),C.draw(l,l.gl.TRIANGLES,a,o,s,e.CullFaceMode.backCCW,O,i.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,i.paint,t.transform.zoom,A,N)}}}catch(H){E.e(H)}finally{E.f()}}function Ii(t,n,i,r,a,o){for(var s,l,u,c=[function(t){var n=t.canonical.x-1,i=t.wrap;return n<0&&(n=(1<<t.canonical.z)-1,i--),new e.OverscaledTileID(t.overscaledZ,i,t.canonical.z,n,t.canonical.y)},function(t){var n=t.canonical.x+1,i=t.wrap;return n===1<<t.canonical.z&&(n=0,i++),new e.OverscaledTileID(t.overscaledZ,i,t.canonical.z,n,t.canonical.y)},function(t){return new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1)},function(t){return new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)}],d=function(e){for(var t=n.getSource().minzoom,i=function(e){var t=n.getTileByID(e);if(t&&t.hasData())return t.getBucket(a)},r=0,o=[0,-1,1];r<o.length;r++){var s=o[r];if(!(e.overscaledZ+s<t)){var l=i(e.calculateScaledKey(e.overscaledZ+s));if(l)return l}}},f=[0,0,0],p=function(t,n){return f[0]=Math.min(t.min.y,n.min.y),f[1]=Math.max(t.max.y,n.max.y),f[2]=e.EXTENT-n.min.x>t.max.x?n.min.x-e.EXTENT:t.max.x,f},m=function(t,n){return f[0]=Math.min(t.min.x,n.min.x),f[1]=Math.max(t.max.x,n.max.x),f[2]=e.EXTENT-n.min.y>t.max.y?n.min.y-e.EXTENT:t.max.y,f},y=[function(e,t){return p(e,t)},function(e,t){return p(t,e)},function(e,t){return m(e,t)},function(e,t){return m(t,e)}],g=new e.Point(0,0),v=function(t,n,r,a,c){var d=[[a?r:t,a?t:r,0],[a?r:n,a?n:r,0]],h=c<0?e.EXTENT+c:c,f=[a?h:(t+n)/2,a?(t+n)/2:h,0];return 0===r&&c<0||0!==r&&c>0?o.getForTilePoints(u,[f],!0,l):d.push(f),o.getForTilePoints(i,d,!0,s),Math.max(d[0][2],d[1][2],f[2])/o.exaggeration()},_=0;_<4;_++){var x=(_<2?1:5)-_,b=r.borders[_];if(0!==b.length){var w=u=c[_](i),k=d(w);if(k&&k instanceof e.FillExtrusionBucket&&k.enableTerrain&&(r.borderDoneWithNeighborZ[_]!==k.canonical.z||k.borderDoneWithNeighborZ[x]!==r.canonical.z)&&(l=o.findDEMTileFor(w))&&l.dem){if(!s){var T=o.findDEMTileFor(i);if(!T||!T.dem)return;s=T}var E=k.borders[x],S=0,L=k.borderDoneWithNeighborZ[x]!==r.canonical.z;if(r.canonical.z===k.canonical.z){for(var M=0;M<b.length;M++){for(var A=r.featuresOnBorder[b[M]],C=A.borders[_],I=void 0;S<E.length&&!((I=k.featuresOnBorder[E[S]]).borders[x][1]>C[0]+3);)L&&k.encodeCentroid(void 0,I,!1),S++;if(I&&S<E.length){for(var P=S,z=0;!(I.borders[x][0]>C[1]-3)&&(z++,++S!==E.length);)I=k.featuresOnBorder[E[S]];if(I=k.featuresOnBorder[E[P]],A.intersectsCount()>1||I.intersectsCount()>1||1!==z){1!==z&&(S=P),r.encodeCentroid(void 0,A,!1),L&&k.encodeCentroid(void 0,I,!1);continue}var D=y[_](A,I),R=_%2?e.EXTENT-1:0;g.x=v(D[0],Math.min(e.EXTENT-1,D[1]),R,_<2,D[2]),g.y=0,r.encodeCentroid(g,A,!1),L&&k.encodeCentroid(g,I,!1)}else r.encodeCentroid(void 0,A,!1)}r.borderDoneWithNeighborZ[_]=k.canonical.z,r.needsCentroidUpdate=!0,L&&(k.borderDoneWithNeighborZ[x]=r.canonical.z,k.needsCentroidUpdate=!0)}else{var B,F=h(b);try{for(F.s();!(B=F.n()).done;){var O=B.value;r.encodeCentroid(void 0,r.featuresOnBorder[O],!1)}}catch(j){F.e(j)}finally{F.f()}if(L){var N,H=h(E);try{for(H.s();!(N=H.n()).done;){var U=N.value;k.encodeCentroid(void 0,k.featuresOnBorder[U],!1)}}catch(j){H.e(j)}finally{H.f()}k.borderDoneWithNeighborZ[x]=r.canonical.z,k.needsCentroidUpdate=!0}r.borderDoneWithNeighborZ[_]=k.canonical.z,r.needsCentroidUpdate=!0}}}}(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(t)}var Pi=new e.Color(1,0,0,1),zi=new e.Color(0,1,0,1),Di=new e.Color(0,0,1,1),Ri=new e.Color(1,0,1,1),Bi=new e.Color(0,1,1,1);function Fi(t,n,i){var r=t.context,a=t.transform,o=r.gl,s="globe"===a.projection.name,l=s?["PROJECTION_GLOBE_VIEW"]:null,u=i.projMatrix;if(s&&e.globeToMercatorTransition(a.zoom)>0){var c=e.transitionTileAABBinECEF(i.canonical,a),d=e.globeDenormalizeECEF(c);u=e.multiply(new Float32Array(16),a.globeMatrix,d),e.multiply(u,a.projMatrix,u)}var h=t.useProgram("debug",null,l),f=n.getTileByID(i.key);t.terrain&&t.terrain.setupElevationDraw(f,h);var p=e.DepthMode.disabled,m=e.StencilMode.disabled,y=t.colorModeForRenderPass(),g="$debug";r.activeTexture.set(o.TEXTURE0),t.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s?f._makeGlobeTileDebugBuffers(t.context,a):f._makeDebugTileBoundsBuffers(t.context,a.projection);var v=f._tileDebugBuffer||t.debugBuffer,_=f._tileDebugIndexBuffer||t.debugIndexBuffer,x=f._tileDebugSegments||t.debugSegments;h.draw(r,o.LINE_STRIP,p,m,y,e.CullFaceMode.disabled,ri(u,e.Color.red),g,v,_,x,null,null,null,[f._globeTileDebugBorderBuffer]);var b=f.latestRawTileData,w=Math.floor((b&&b.byteLength||0)/1024),k=n.getTile(i).tileSize,T=512/Math.min(k,512)*(i.overscaledZ/a.zoom)*.5,E=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(E+=" => ".concat(i.overscaledZ)),function(e,t){e.initDebugOverlayCanvas();var n=e.debugOverlayCanvas,i=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(t,E+=" ".concat(w,"kb"));var S=f._tileDebugTextBuffer||t.debugBuffer,L=f._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,M=f._tileDebugTextSegments||t.debugSegments;h.draw(r,o.TRIANGLES,p,m,e.ColorMode.alphaBlended,e.CullFaceMode.disabled,ri(u,e.Color.transparent,T),g,S,L,M,null,null,null,[f._globeTileDebugTextBuffer])}function Oi(e,t,n,i){Hi(e,0,t+n/2,e.transform.width,n,i)}function Ni(e,t,n,i){Hi(e,t-n/2,0,n,e.transform.height,i)}function Hi(t,n,i,r,a,o){var s=t.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(n*e.exported.devicePixelRatio,i*e.exported.devicePixelRatio,r*e.exported.devicePixelRatio,a*e.exported.devicePixelRatio),s.clear({color:o}),l.disable(l.SCISSOR_TEST)}var Ui=e.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]).members;function ji(e,t,n,i){e.emplaceBack(t,n,i)}var Vi=p((function t(n){f(this,t),this.vertexArray=new e.StructArrayLayout3f12,this.indices=new e.StructArrayLayout3ui6,ji(this.vertexArray,-1,-1,1),ji(this.vertexArray,1,-1,1),ji(this.vertexArray,-1,1,1),ji(this.vertexArray,1,1,1),ji(this.vertexArray,-1,-1,-1),ji(this.vertexArray,1,-1,-1),ji(this.vertexArray,-1,1,-1),ji(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Ui),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=e.SegmentVector.simpleSegment(0,0,36,12)}));function Wi(t,n,i,r,a,o){var s=t.gl,l=n.paint.get("sky-atmosphere-color"),u=n.paint.get("sky-atmosphere-halo-color"),c=n.paint.get("sky-atmosphere-sun-intensity"),d=function(e,t,n,i,r){return{u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:n,u_color_tint_r:[i.r,i.g,i.b,i.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}}(e.fromMat4(e.create$1(),r),a,c,l,u);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+o,n.skyboxTexture,0),i.draw(t,s.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.frontCW,d,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}var Gi=e.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),qi=function(){function t(n){f(this,t);var i=new e.StructArrayLayout5f20;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);var r=new e.StructArrayLayout3ui6;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(i,Gi.members),this.indexBuffer=n.createIndexBuffer(r),this.segments=e.SegmentVector.simpleSegment(0,0,4,2)}return p(t,[{key:"destroy",value:function(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}]),t}(),Zi={symbol:function(t,n,i,r,a){if("translucent"===t.renderPass){var o=e.StencilMode.disabled,s=t.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(t,n,i,r,a,o,s){var l,u=n.transform,c="map"===a,d="map"===o,f=h(t);try{for(f.s();!(l=f.n()).done;){var p=l.value,m=r.getTile(p),y=m.getBucket(i);if(y&&y.text&&y.text.segments.get().length){var g=e.evaluateSizeForZoom(y.textSizeData,u.zoom),v=Pt(p,y.getProjection(),u),_=u.calculatePixelsToTileUnitsMatrix(m),x=ft(v,m.tileID.canonical,d,c,u,y.getProjection(),_),b="none"!==i.layout.get("icon-text-fit")&&y.hasIconData();if(g){var w=Math.pow(2,u.zoom-m.tileID.overscaledZ);Ei(y,c,d,s,e.symbolSize,u,x,p,w,g,b)}}}}catch(k){f.e(k)}finally{f.f()}}(r,t,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),a),0!==i.paint.get("icon-opacity").constantOr(1)&&Li(t,n,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),o,s),0!==i.paint.get("text-opacity").constantOr(1)&&Li(t,n,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),o,s),n.map.showCollisionBoxes&&(wi(t,n,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),wi(t,n,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))}},circle:function(t,n,i,r){if("translucent"===t.renderPass){var a=i.paint.get("circle-opacity"),o=i.paint.get("circle-stroke-width"),s=i.paint.get("circle-stroke-opacity"),l=void 0!==i.layout.get("circle-sort-key").constantOr(1);if(0!==a.constantOr(1)||0!==o.constantOr(1)&&0!==s.constantOr(1)){for(var u=t.context,c=u.gl,d=t.transform,f=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),p=e.StencilMode.disabled,m=t.colorModeForRenderPass(),y="globe"===d.projection.name,g=[e.mercatorXfromLng(d.center.lng),e.mercatorYfromLat(d.center.lat)],v=[],_=0;_<r.length;_++){var x=r[_],b=n.getTile(x),w=b.getBucket(i);if(w&&w.projection.name===d.projection.name){var k=w.programConfigurations.get(i.id),T=ni(i);y&&T.push("PROJECTION_GLOBE_VIEW");var E=t.useProgram("circle",k,T),S=w.layoutVertexBuffer,L=w.globeExtVertexBuffer,M=w.indexBuffer,A=d.projection.createInversionMatrix(d,x.canonical),C={programConfiguration:k,program:E,layoutVertexBuffer:S,globeExtVertexBuffer:L,indexBuffer:M,uniformValues:ti(t,x,b,A,g,i),tile:b};if(l){var I,P=w.segments.get(),z=h(P);try{for(z.s();!(I=z.n()).done;){var D=I.value;v.push({segments:new e.SegmentVector([D]),sortKey:D.sortKey,state:C})}}catch(X){z.e(X)}finally{z.f()}}else v.push({segments:w.segments,sortKey:0,state:C})}}l&&v.sort((function(e,t){return e.sortKey-t.sortKey}));for(var R={useDepthForOcclusion:!y},B=0,F=v;B<F.length;B++){var O=F[B],N=O.state,H=N.programConfiguration,U=N.program,j=N.layoutVertexBuffer,V=N.globeExtVertexBuffer,W=N.indexBuffer,G=N.uniformValues,q=N.tile,Z=O.segments;t.terrain&&t.terrain.setupElevationDraw(q,U,R),t.prepareDrawProgram(u,U,q.tileID.toUnwrapped()),U.draw(u,c.TRIANGLES,f,p,m,e.CullFaceMode.disabled,G,i.id,j,W,Z,i.paint,d.zoom,H,[V])}}}},heatmap:function(t,n,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){var a=t.context,o=a.gl,s=e.StencilMode.disabled,l=new e.ColorMode([o.ONE,o.ONE],e.Color.transparent,[!0,!0,!0,!0]);!function(e,t,n,i){var r=e.gl,a=t.width*i,o=t.height*i;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,a,o]);var s=n.heatmapFbo;if(!s||s&&(s.width!==a||s.height!==o)){s&&s.destroy();var l=r.createTexture();r.bindTexture(r.TEXTURE_2D,l),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),s=n.heatmapFbo=e.createFramebuffer(a,o,!1),function(e,t,n,i,r,a){var o=e.gl;o.texImage2D(o.TEXTURE_2D,0,e.isWebGL2&&e.extRenderToTextureHalfFloat?o.RGBA16F:o.RGBA,r,a,0,o.RGBA,e.extRenderToTextureHalfFloat?e.isWebGL2?o.HALF_FLOAT:e.extTextureHalfFloat.HALF_FLOAT_OES:o.UNSIGNED_BYTE,null),i.colorAttachment.set(n)}(e,0,l,s,a,o)}else r.bindTexture(r.TEXTURE_2D,s.colorAttachment.get()),e.bindFramebuffer.set(s.framebuffer)}(a,t,i,"globe"===t.transform.projection.name?.5:.25),a.clear({color:e.Color.transparent});for(var u=t.transform,c="globe"===u.projection.name,d=c?["PROJECTION_GLOBE_VIEW"]:null,h=c?e.CullFaceMode.frontCCW:e.CullFaceMode.disabled,f=[e.mercatorXfromLng(u.center.lng),e.mercatorYfromLat(u.center.lat)],p=0;p<r.length;p++){var m=r[p];if(!n.hasRenderableParent(m)){var y=n.getTile(m),g=y.getBucket(i);if(g&&g.projection.name===u.projection.name){var v=g.programConfigurations.get(i.id),_=t.useProgram("heatmap",v,d),x=t.transform.zoom;t.terrain&&t.terrain.setupElevationDraw(y,_),t.prepareDrawProgram(a,_,m.toUnwrapped());var b=u.projection.createInversionMatrix(u,m.canonical);_.draw(a,o.TRIANGLES,e.DepthMode.disabled,s,l,h,oi(t,m,y,b,f,x,i.paint.get("heatmap-intensity")),i.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,i.paint,t.transform.zoom,v,c?[g.globeExtVertexBuffer]:null)}}}a.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,n){var i=t.context,r=i.gl,a=n.heatmapFbo;if(a){i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);var o=n.colorRampTexture;o||(o=n.colorRampTexture=new e.Texture(i,n.colorRamp,r.RGBA)),o.bind(r.LINEAR,r.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(i,r.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,function(e,t,n,i){return{u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}}(0,n),n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,n.paint,t.transform.zoom)}}(t,i))},line:function(t,n,i,r){if("translucent"===t.renderPass){var a=i.paint.get("line-opacity"),o=i.paint.get("line-width");if(0!==a.constantOr(1)&&0!==o.constantOr(1)){var s=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),l=t.colorModeForRenderPass(),u=t.terrain&&t.terrain.renderingToTexture?1:e.exported.devicePixelRatio,c=i.paint.get("line-dasharray"),f=c.constantOr(1),p=i.layout.get("line-cap"),m=i.paint.get("line-pattern"),y=m.constantOr(1),g=i.paint.get("line-gradient"),v=y?"linePattern":"line",_=t.context,x=_.gl,b=function(e){var t=[];di(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");var n=e.paint.get("line-trim-offset");0===n[0]&&0===n[1]||t.push("RENDER_LINE_TRIM_OFFSET");var i=e.paint.get("line-pattern").constantOr(1),r=1!==e.paint.get("line-opacity").constantOr(1);return!i&&r&&t.push("RENDER_LINE_ALPHA_DISCARD"),t}(i),w=b.includes("RENDER_LINE_ALPHA_DISCARD");t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(w=!1);var k,T=h(r);try{var E=function(){var r=k.value,a=n.getTile(r);if(y&&!a.patternsLoaded())return"continue";var o=a.getBucket(i);if(!o)return"continue";t.prepareDrawTile();var h=o.programConfigurations.get(i.id),T=t.useProgram(v,h,b),E=m.constantOr(null);if(E&&a.imageAtlas){var S=a.imageAtlas.patternPositions[E.toString()];S&&h.setConstantPatternPositions(S)}var L=c.constantOr(null),M=p.constantOr(null);if(!y&&L&&M&&a.lineAtlas){var A=a.lineAtlas.getDash(L,M);A&&h.setConstantPatternPositions(A)}var C=i.paint.get("line-trim-offset"),I=d(C,2),P=I[0],z=I[1];if("round"===M||"square"===M){var D=1;P!==z&&(0===P&&(P-=D),1===z&&(z+=D))}var R=t.terrain?r.projMatrix:null,B=y?li(t,a,i,R,u):si(t,a,i,R,o.lineClipsArray.length,u,[P,z]);if(g){var F=o.gradients[i.id],O=F.texture;if(i.gradientVersion!==F.version){var N=256;if(i.stepInterpolant){var H=n.getSource().maxzoom,U=r.canonical.z===H?Math.ceil(1<<t.transform.maxZoom-r.canonical.z):1;N=e.clamp(e.nextPowerOfTwo(o.maxLineLength/e.EXTENT*1024*U),256,_.maxTextureSize)}F.gradient=e.renderColorRamp({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:N,image:F.gradient||void 0,clips:o.lineClipsArray}),F.texture?F.texture.update(F.gradient):F.texture=new e.Texture(_,F.gradient,x.RGBA),F.version=i.gradientVersion,O=F.texture}_.activeTexture.set(x.TEXTURE1),O.bind(i.stepInterpolant?x.NEAREST:x.LINEAR,x.CLAMP_TO_EDGE)}f&&(_.activeTexture.set(x.TEXTURE0),a.lineAtlasTexture.bind(x.LINEAR,x.REPEAT),h.updatePaintBuffers()),y&&(_.activeTexture.set(x.TEXTURE0),a.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),h.updatePaintBuffers()),t.prepareDrawProgram(_,T,r.toUnwrapped());var j=function(n){T.draw(_,x.TRIANGLES,s,n,l,e.CullFaceMode.disabled,B,i.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,i.paint,t.transform.zoom,h,[o.layoutVertexBuffer2])};if(w){var V=t.stencilModeForClipping(r).ref;0===V&&t.terrain&&_.clear({stencil:0});var W={func:x.EQUAL,mask:255};B.u_alpha_discard_threshold=.8,j(new e.StencilMode(W,V,255,x.KEEP,x.KEEP,x.INVERT)),B.u_alpha_discard_threshold=0,j(new e.StencilMode(W,V,255,x.KEEP,x.KEEP,x.KEEP))}else j(t.stencilModeForClipping(r))};for(T.s();!(k=T.n()).done;)E()}catch(S){T.e(S)}finally{T.f()}w&&(t.resetStencilClippingMasks(),t.terrain&&_.clear({stencil:0}))}}},fill:function(t,n,i,r){var a=i.paint.get("fill-color"),o=i.paint.get("fill-opacity");if(0!==o.constantOr(1)){var s=t.colorModeForRenderPass(),l=i.paint.get("fill-pattern"),u=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===a.constantOr(e.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(t.renderPass===u){var c=t.depthModeForSublayer(1,"opaque"===t.renderPass?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly);Ai(t,n,i,r,c,s,!1)}if("translucent"===t.renderPass&&i.paint.get("fill-antialias")){var d=t.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,e.DepthMode.ReadOnly);Ai(t,n,i,r,d,s,!0)}}},"fill-extrusion":function(t,n,i,r){var a=i.paint.get("fill-extrusion-opacity");if(0!==a&&"translucent"===t.renderPass){var o=new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);if(1!==a||i.paint.get("fill-extrusion-pattern").constantOr(1))Ci(t,n,i,r,o,e.StencilMode.disabled,e.ColorMode.disabled),Ci(t,n,i,r,o,t.stencilModeFor3D(),t.colorModeForRenderPass()),t.resetStencilClippingMasks();else{var s=t.colorModeForRenderPass();Ci(t,n,i,r,o,e.StencilMode.disabled,s)}}},hillshade:function(t,n,i,r){if("offscreen"===t.renderPass||"translucent"===t.renderPass){var a,o=t.context,s=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),l=t.colorModeForRenderPass(),u=t.terrain&&t.terrain.renderingToTexture,c="translucent"!==t.renderPass||u?[{},r]:t.stencilConfigForOverlap(r),f=d(c,2),p=f[0],m=f[1],y=h(m);try{for(y.s();!(a=y.n()).done;){var g=a.value,v=n.getTile(g);if(v.needsHillshadePrepare&&"offscreen"===t.renderPass)Cn(t,v,i,s,e.StencilMode.disabled,l);else if("translucent"===t.renderPass){var _=u&&t.terrain?t.terrain.stencilModeForRTTOverlap(g):p[g.overscaledZ];Mn(t,g,v,i,s,_,l)}}}catch(x){y.e(x)}finally{y.f()}o.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()}},raster:function(t,n,i,r,a,o){if("translucent"===t.renderPass&&0!==i.paint.get("raster-opacity")&&r.length){var s,l=t.context,u=l.gl,c=n.getSource(),f=t.useProgram("raster"),p=t.colorModeForRenderPass(),m=t.terrain&&t.terrain.renderingToTexture,y=c instanceof Ue||m?[{},r]:t.stencilConfigForOverlap(r),g=d(y,2),v=g[0],_=g[1],x=_[_.length-1].overscaledZ,b=!t.options.moving,w=h(_);try{for(w.s();!(s=w.n()).done;){var k=s.value,T=m?e.DepthMode.disabled:t.depthModeForSublayer(k.overscaledZ-x,1===i.paint.get("raster-opacity")?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly,u.LESS),E=k.toUnwrapped(),S=n.getTile(k);if(!m||S&&S.hasData()){var L=m?k.projMatrix:t.transform.calculateProjMatrix(E,b),M=t.terrain&&m?t.terrain.stencilModeForRTTOverlap(k):v[k.overscaledZ],A=o?0:i.paint.get("raster-fade-duration");S.registerFadeDuration(A);var C=n.findLoadedParent(k,0),I=Hn(S,C,n,t.transform,A),P=void 0,z=void 0;t.terrain&&t.terrain.prepareDrawTile();var D="nearest"===i.paint.get("raster-resampling")?u.NEAREST:u.LINEAR;l.activeTexture.set(u.TEXTURE0),S.texture.bind(D,u.CLAMP_TO_EDGE),l.activeTexture.set(u.TEXTURE1),C?(C.texture.bind(D,u.CLAMP_TO_EDGE),P=Math.pow(2,C.tileID.overscaledZ-S.tileID.overscaledZ),z=[S.tileID.canonical.x*P%1,S.tileID.canonical.y*P%1]):S.texture.bind(D,u.CLAMP_TO_EDGE),S.texture.useMipmap&&l.extTextureFilterAnisotropic&&t.transform.pitch>20&&u.texParameterf(u.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax);var R=hi(L,z||[0,0],P||1,I,i,c instanceof Ue?c.perspectiveTransform:[0,0]);if(t.prepareDrawProgram(l,f,E),c instanceof Ue)c.boundsBuffer&&c.boundsSegments&&f.draw(l,u.TRIANGLES,T,e.StencilMode.disabled,p,e.CullFaceMode.disabled,R,i.id,c.boundsBuffer,t.quadTriangleIndexBuffer,c.boundsSegments);else{var B=t.getTileBoundsBuffers(S),F=B.tileBoundsBuffer,O=B.tileBoundsIndexBuffer,N=B.tileBoundsSegments;f.draw(l,u.TRIANGLES,T,M,p,e.CullFaceMode.disabled,R,i.id,F,O,N)}}}}catch(H){w.e(H)}finally{w.f()}t.resetStencilClippingMasks()}},background:function(t,n,i,r){var a=i.paint.get("background-color"),o=i.paint.get("background-opacity");if(0!==o){var s=t.context,l=s.gl,u=t.transform,c=u.tileSize,d=i.paint.get("background-pattern");if(!t.isPatternMissing(d)){var f=!d&&1===a.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===f){var p,m=e.StencilMode.disabled,y=t.depthModeForSublayer(0,"opaque"===f?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly),g=t.colorModeForRenderPass(),v=t.useProgram(d?"backgroundPattern":"background"),_=r;_||(p=t.getBackgroundTiles(),_=Object.values(p).map((function(e){return e.tileID}))),d&&(s.activeTexture.set(l.TEXTURE0),t.imageManager.bind(t.context));var x,b=h(_);try{for(b.s();!(x=b.n()).done;){var w=x.value,k=w.toUnwrapped(),T=r?w.projMatrix:t.transform.calculateProjMatrix(k);t.prepareDrawTile();var E=n?n.getTile(w):p?p[w.key]:new e.Tile(w,c,u.zoom,t),S=d?xi(T,o,t,d,{tileID:w,tileSize:c}):_i(T,o,a);t.prepareDrawProgram(s,v,k);var L=t.getTileBoundsBuffers(E),M=L.tileBoundsBuffer,A=L.tileBoundsIndexBuffer,C=L.tileBoundsSegments;v.draw(s,l.TRIANGLES,y,m,g,e.CullFaceMode.disabled,S,i.id,M,A,C)}}catch(I){b.e(I)}finally{b.f()}}}}},sky:function(t,n,i){var r=t.transform,a="mercator"===r.projection.name||"globe"===r.projection.name?1:e.smoothstep(7,8,r.zoom),o=i.paint.get("sky-opacity")*a;if(0!==o){var s=t.context,l=i.paint.get("sky-type"),u=new e.DepthMode(s.gl.LEQUAL,e.DepthMode.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===l?"offscreen"===t.renderPass?i.needsSkyboxCapture(t)&&(function(t,n,i,r){var a=t.context,o=a.gl,s=n.skyboxFbo;if(!s){s=n.skyboxFbo=a.createFramebuffer(32,32,!1),n.skyboxGeometry=new Vi(a),n.skyboxTexture=a.gl.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,n.skyboxTexture),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR);for(var l=0;l<6;++l)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,o.RGBA,32,32,0,o.RGBA,o.UNSIGNED_BYTE,null)}a.bindFramebuffer.set(s.framebuffer),a.viewport.set([0,0,32,32]);var u=n.getCenter(t,!0),c=t.useProgram("skyboxCapture"),d=new Float64Array(16);e.identity(d),e.rotateY(d,d,.5*-Math.PI),Wi(a,n,c,d,u,0),e.identity(d),e.rotateY(d,d,.5*Math.PI),Wi(a,n,c,d,u,1),e.identity(d),e.rotateX(d,d,.5*-Math.PI),Wi(a,n,c,d,u,2),e.identity(d),e.rotateX(d,d,.5*Math.PI),Wi(a,n,c,d,u,3),e.identity(d),Wi(a,n,c,d,u,4),e.identity(d),e.rotateY(d,d,Math.PI),Wi(a,n,c,d,u,5),a.viewport.set([0,0,t.width,t.height])}(t,i),i.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,n,i,r,a){var o=t.context,s=o.gl,l=t.transform,u=t.useProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,n.skyboxTexture);var c=function(e,t,n,i,r){return{u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:i,u_temporal_offset:r}}(l.skyboxMatrix,n.getCenter(t,!1),0,r,a);t.prepareDrawProgram(o,u),u.draw(o,s.TRIANGLES,i,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,c,"skybox",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(t,i,u,o,c):"gradient"===l&&"sky"===t.renderPass&&function(t,n,i,r,a){var o=t.context,s=o.gl,l=t.transform,u=t.useProgram("skyboxGradient");n.skyboxGeometry||(n.skyboxGeometry=new Vi(o)),o.activeTexture.set(s.TEXTURE0);var c=n.colorRampTexture;c||(c=n.colorRampTexture=new e.Texture(o,n.colorRamp,s.RGBA)),c.bind(s.LINEAR,s.CLAMP_TO_EDGE);var d=function(t,n,i,r,a){return{u_matrix:t,u_color_ramp:0,u_center_direction:n,u_radius:e.degToRad(i),u_opacity:r,u_temporal_offset:a}}(l.skyboxMatrix,n.getCenter(t,!1),n.paint.get("sky-gradient-radius"),r,a);t.prepareDrawProgram(o,u),u.draw(o,s.TRIANGLES,i,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,d,"skyboxGradient",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(t,i,u,o,c)}},debug:function(e,t,n){for(var i=0;i<n.length;i++)Fi(e,t,n[i])},custom:function(t,n,i,r){var a=t.context,o=i.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&i.isLayerDraped()){if("offscreen"===t.renderPass){var s=o.prerender;if(s){if(t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){var l=t.transform.pointMerc;s.call(o,a.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.globeToMercatorTransition(t.transform.zoom),[l.x,l.y],t.transform.pixelsPerMeterRatio)}else s.call(o,a.gl,t.transform.customLayerMatrix());a.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){var u=o.renderToTile;if(u){var c=r[0].canonical,d=new e.MercatorCoordinate(c.x+r[0].wrap*(1<<c.z),c.y,c.z);a.setDepthMode(e.DepthMode.disabled),a.setStencilMode(e.StencilMode.disabled),a.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),u.call(o,a.gl,d),a.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),a.setStencilMode(e.StencilMode.disabled);var h="3d"===o.renderingMode?new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,e.DepthMode.ReadOnly);if(a.setDepthMode(h),"globe"===t.transform.projection.name){var f=t.transform.pointMerc;o.render(a.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.globeToMercatorTransition(t.transform.zoom),[f.x,f.y],t.transform.pixelsPerMeterRatio)}else o.render(a.gl,t.transform.customLayerMatrix());a.setDirty(),t.setBaseState(),a.bindFramebuffer.set(null)}}else e.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}},Xi=function(){function t(n,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];f(this,t),this.context=new Fe(n,r),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=e.SourceCache.maxUnderzooming+e.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}return p(t,[{key:"updateTerrain",value:function(e,t){var n=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(n||this._terrain&&this._terrain.enabled){this._terrain||(this._terrain=new Wn(this,e));var i=this._terrain;this.transform.elevation=n?i:null,i.update(e,this.transform,t)}}},{key:"_updateFog",value:function(e){var t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)this.transform.fogCullDistSq=null;else{var n=t.getFovAdjustedRange(this.transform._fov),i=d(n,2),r=i[0],a=i[1];if(r>a)this.transform.fogCullDistSq=null;else{var o=r+.78*(a-r);this.transform.fogCullDistSq=o*o}}}},{key:"terrain",get:function(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}},{key:"resize",value:function(t,n){if(this.width=t*e.exported.devicePixelRatio,this.height=n*e.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style){var i,r=h(this.style.order);try{for(r.s();!(i=r.n()).done;){var a=i.value;this.style._layers[a].resize()}}catch(o){r.e(o)}finally{r.f()}}}},{key:"setup",value:function(){var t=this.context,n=new e.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(e.EXTENT,0),n.emplaceBack(0,e.EXTENT),n.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(n,e.posAttributes.members),this.tileExtentSegments=e.SegmentVector.simpleSegment(0,0,4,2);var i=new e.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(e.EXTENT,0),i.emplaceBack(0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT),this.debugBuffer=t.createVertexBuffer(i,e.posAttributes.members),this.debugSegments=e.SegmentVector.simpleSegment(0,0,4,5);var r=new e.StructArrayLayout2i4;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,e.posAttributes.members),this.viewportSegments=e.SegmentVector.simpleSegment(0,0,4,2);var a=new e.StructArrayLayout4i8;a.emplaceBack(0,0,0,0),a.emplaceBack(e.EXTENT,0,e.EXTENT,0),a.emplaceBack(0,e.EXTENT,0,e.EXTENT),a.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(a,e.boundsAttributes.members),this.mercatorBoundsSegments=e.SegmentVector.simpleSegment(0,0,4,2);var o=new e.StructArrayLayout3ui6;o.emplaceBack(0,1,2),o.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(o);for(var s=new e.StructArrayLayout1ui2,l=0,u=[0,1,3,2,0];l<u.length;l++){var c=u[l];s.emplaceBack(c)}this.debugIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.Texture(t,new e.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=e.create();var d=this.context.gl;this.stencilClearMode=new e.StencilMode({func:d.ALWAYS,mask:0},0,255,d.ZERO,d.ZERO,d.ZERO),this.loadTimeStamps.push(e.window.performance.now()),this.atmosphereBuffer=new qi(this.context)}},{key:"getMercatorTileBoundsBuffers",value:function(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}},{key:"getTileBoundsBuffers",value:function(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}},{key:"clearStencil",value:function(){var t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(t,n.TRIANGLES,e.DepthMode.disabled,this.stencilClearMode,e.ColorMode.disabled,e.CullFaceMode.disabled,Nn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}},{key:"resetStencilClippingMasks",value:function(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}},{key:"_renderTileClippingMasks",value:function(t,n,i){if(n&&this.currentStencilSource!==n.id&&t.isTileClipped()&&i&&0!==i.length){if(this._tileClippingMaskIDs&&!this.terrain){var r,a=!1,o=h(i);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(void 0===this._tileClippingMaskIDs[s.key]){a=!0;break}}}catch(b){o.e(b)}finally{o.f()}if(!a)return}this.currentStencilSource=n.id;var l=this.context,u=l.gl;this.nextStencilID+i.length>256&&this.clearStencil(),l.setColorMode(e.ColorMode.disabled),l.setDepthMode(e.DepthMode.disabled);var c=this.useProgram("clippingMask");this._tileClippingMaskIDs={};var d,f=h(i);try{for(f.s();!(d=f.n()).done;){var p=d.value,m=n.getTile(p),y=this._tileClippingMaskIDs[p.key]=this.nextStencilID++,g=this.getTileBoundsBuffers(m),v=g.tileBoundsBuffer,_=g.tileBoundsIndexBuffer,x=g.tileBoundsSegments;c.draw(l,u.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:u.ALWAYS,mask:0},y,255,u.KEEP,u.KEEP,u.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,Nn(p.projMatrix),"$clipping",v,_,x)}}catch(b){f.e(b)}finally{f.f()}}}},{key:"stencilModeFor3D",value:function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,n=this.context.gl;return new e.StencilMode({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}},{key:"stencilModeForClipping",value:function(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);var n=this.context.gl;return new e.StencilMode({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}},{key:"stencilConfigForOverlap",value:function(t){var n=this.context.gl,r=t.sort((function(e,t){return t.overscaledZ-e.overscaledZ})),a=r[r.length-1].overscaledZ,o=r[0].overscaledZ-a+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();for(var s={},l=0;l<o;l++)s[l+a]=new e.StencilMode({func:n.GEQUAL,mask:255},l+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[s,r]}return[i({},a,e.StencilMode.disabled),r]}},{key:"colorModeForRenderPass",value:function(){var t=this.context.gl;if(this._showOverdrawInspector){var n=1/8;return new e.ColorMode([t.CONSTANT_COLOR,t.ONE],new e.Color(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?e.ColorMode.unblended:e.ColorMode.alphaBlended}},{key:"depthModeForSublayer",value:function(t,n,i){if(!this.opaquePassEnabledForLayer())return e.DepthMode.disabled;var r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new e.DepthMode(i||this.context.gl.LEQUAL,n,[r,r])}},{key:"opaquePassEnabledForLayer",value:function(){return this.currentLayer<this.opaquePassCutoff}},{key:"render",value:function(t,n){var i=this;this.style=t,this.options=n,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.exported.now()),this.imageManager.beginFrame();var r=this.style.order,a=this.style._sourceCaches;for(var o in a){var s=a[o];s.used&&s.prepare(this.context)}var l={},u={},c={};for(var d in a){var f=a[d];l[d]=f.getVisibleCoordinates(),u[d]=l[d].slice().reverse(),c[d]=f.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var p=0;p<r.length;p++)if(this.style._layers[r[p]].is3D()){this.opaquePassCutoff=p;break}if(this.terrain&&(this.terrain.updateTileBinding(c),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.GlobeSharedBuffers(this.context)),e.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";var m,y=h(r);try{for(y.s();!(m=y.n()).done;){var g=m.value,v=this.style._layers[g],_=t._getLayerSourceCache(v);if(v.hasOffscreenPass()&&!v.isHidden(this.transform.zoom)){var x=_?u[_.id]:void 0;("custom"===v.type||v.isSky()||x&&x.length)&&this.renderLayer(this,_,v,x)}}}catch(I){y.e(I)}finally{y.f()}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon];var b=this.terrain;if(b&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&b.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:n.showOverdrawInspector?e.Color.black:e.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){var w=this.style._layers[r[this.currentLayer]],k=t._getLayerSourceCache(w);if(!w.isSky()){var T=k?u[k.id]:void 0;this._renderTileClippingMasks(w,k,T),this.renderLayer(this,k,w,T)}}if(this.style.fog&&this.transform.projection.supportsFog&&function(t,n){var i=t.context,r=i.gl,a=t.transform,o=new e.DepthMode(r.LEQUAL,e.DepthMode.ReadOnly,[0,1]),s=t.useProgram("globeAtmosphere",null,"globe"===a.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),l=e.globeToMercatorTransition(a.zoom),u=n.properties.get("color").toArray01(),c=n.properties.get("high-color").toArray01(),d=n.properties.get("space-color").toArray01PremultipliedAlpha(),h=e.identity$1([]);e.rotateY$1(h,h,-e.degToRad(a._center.lng)),e.rotateX$1(h,h,e.degToRad(a._center.lat)),e.rotateZ$1(h,h,a.angle),e.rotateX$1(h,h,-a._pitch);var f=e.fromQuat(new Float32Array(16),h),p=e.mapValue(n.properties.get("star-intensity"),0,1,0,.25),m=5e-4,y=e.mapValue(n.properties.get("horizon-blend"),0,1,m,.25),g=e.globeUseCustomAntiAliasing(t,i,a)&&y===m?a.worldSize/(2*Math.PI*1.025)-1:a.globeRadius,v=t.frameCounter/1e3%1,_=e.length(a.globeCenterInViewSpace),x=Math.sqrt(Math.pow(_,2)-Math.pow(g,2)),b=Math.acos(x/_),w=function(t,n,i,r,a,o,s,l,u,c,d,h,f,p){return{u_frustum_tl:t,u_frustum_tr:n,u_frustum_br:i,u_frustum_bl:r,u_horizon:a,u_transition:o,u_fadeout_range:s,u_color:l,u_high_color:u,u_space_color:c,u_star_intensity:d,u_star_size:5*e.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:h,u_horizon_angle:f,u_rotation_matrix:p}}(a.frustumCorners.TL,a.frustumCorners.TR,a.frustumCorners.BR,a.frustumCorners.BL,a.frustumCorners.horizon,l,y,u,c,d,p,v,b,f);t.prepareDrawProgram(i,s);var k=t.atmosphereBuffer;k&&s.draw(i,r.TRIANGLES,o,e.StencilMode.disabled,e.ColorMode.alphaBlended,e.CullFaceMode.backCW,w,"skybox",k.vertexBuffer,k.indexBuffer,k.segments)}(this,this.style.fog),this.renderPass="sky",(e.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){var E=this.style._layers[r[this.currentLayer]],S=t._getLayerSourceCache(E);E.isSky()&&this.renderLayer(this,S,E,S?u[S.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;){var L=this.style._layers[r[this.currentLayer]],M=t._getLayerSourceCache(L);if(L.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(L)){if(L.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer)}else{var A=M?("symbol"===L.type?c:u)[M.id]:void 0;this._renderTileClippingMasks(L,M,M?l[M.id]:void 0),this.renderLayer(this,M,L,A),++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){var C=null;e.values(this.style._layers).forEach((function(e){var n=t._getLayerSourceCache(e);n&&!e.isHidden(i.transform.zoom)&&(!C||C.getSource().maxzoom<n.getSource().maxzoom)&&(C=n)})),C&&this.options.showTileBoundaries&&Zi.debug(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(e){var t=e.transform.padding;Oi(e,e.transform.height-(t.top||0),3,Pi),Oi(e,t.bottom||0,3,zi),Ni(e,t.left||0,3,Di),Ni(e,e.transform.width-(t.right||0),3,Ri);var n=e.transform.centerPoint;!function(e,t,n,i){Hi(e,t-1,n-10,2,20,i),Hi(e,t-10,n-1,20,2,i)}(e,n.x,e.transform.height-n.y,Bi)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(e.window.performance.now()),this.saveCanvasCopy())}}},{key:"renderLayer",value:function(e,t,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||i&&i.length)&&(this.id=n.id,this.gpuTimingStart(n),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(n.type)||e.terrain&&"custom"===n.type)&&Zi[n.type](e,t,n,i,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}},{key:"gpuTimingStart",value:function(e){if(this.options.gpuTiming){var t=this.context.extTimerQuery,n=this.gpuTimers[e.id];n||(n=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:t.createQueryEXT()}),n.calls++,t.beginQueryEXT(t.TIME_ELAPSED_EXT,n.query)}}},{key:"gpuTimingDeferredRenderStart",value:function(){if(this.options.gpuTimingDeferredRender){var e=this.context.extTimerQuery,t=e.createQueryEXT();this.deferredRenderGpuTimeQueries.push(t),e.beginQueryEXT(e.TIME_ELAPSED_EXT,t)}}},{key:"gpuTimingDeferredRenderEnd",value:function(){if(this.options.gpuTimingDeferredRender){var e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}}},{key:"gpuTimingEnd",value:function(){if(this.options.gpuTiming){var e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}}},{key:"collectGpuTimers",value:function(){var e=this.gpuTimers;return this.gpuTimers={},e}},{key:"collectDeferredRenderGpuQueries",value:function(){var e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}},{key:"queryGpuTimers",value:function(e){var t={};for(var n in e){var i=e[n],r=this.context.extTimerQuery,a=r.getQueryObjectEXT(i.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(i.query),t[n]=a}return t}},{key:"queryGpuTimeDeferredRender",value:function(e){if(!this.options.gpuTimingDeferredRender)return 0;var t,n=this.context.extTimerQuery,i=0,r=h(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;i+=n.getQueryObjectEXT(a,n.QUERY_RESULT_EXT)/1e6,n.deleteQueryEXT(a)}}catch(o){r.e(o)}finally{r.f()}return i}},{key:"translatePosMatrix",value:function(t,n,i,r,a){if(!i[0]&&!i[1])return t;var o=a?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(o){var s=Math.sin(o),l=Math.cos(o);i=[i[0]*l-i[1]*s,i[0]*s+i[1]*l]}var u=[a?i[0]:V(n,i[0],this.transform.zoom),a?i[1]:V(n,i[1],this.transform.zoom),0],c=new Float32Array(16);return e.translate(c,t,u),c}},{key:"saveTileTexture",value:function(e){var t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}},{key:"getTileTexture",value:function(e){var t=this._tileTextures[e];return t&&t.length>0?t.pop():null}},{key:"isPatternMissing",value:function(e){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString())}},{key:"terrainRenderModeElevated",value:function(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}},{key:"currentGlobalDefines",value:function(){var e=this.terrain&&this.terrain.renderingToTexture,t=this.terrain&&0===this.terrain.exaggeration(),n=this.style&&this.style.fog,i=[];return this.terrainRenderModeElevated()&&i.push("TERRAIN"),"globe"===this.transform.projection.name&&i.push("GLOBE"),t&&i.push("ZERO_EXAGGERATION"),n&&!e&&0!==n.getOpacity(this.transform.pitch)&&i.push("FOG"),e&&i.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&i.push("OVERDRAW_INSPECTOR"),i}},{key:"useProgram",value:function(e,t,n){this.cache=this.cache||{};var i=n||[],r=this.currentGlobalDefines().concat(i),a=Gn.cacheKey(kn[e],e,r,t);return this.cache[a]||(this.cache[a]=new Gn(this.context,e,kn[e],t,bi[e],r)),this.cache[a]}},{key:"setCustomLayerDefaults",value:function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}},{key:"setBaseState",value:function(){var e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}},{key:"initDebugOverlayCanvas",value:function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=e.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}},{key:"destroy",value:function(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}},{key:"prepareDrawTile",value:function(){this.terrain&&this.terrain.prepareDrawTile()}},{key:"prepareDrawProgram",value:function(t,n,i){if(!this.terrain||!this.terrain.renderingToTexture){var r=this.style.fog;if(r){var a=r.getOpacity(this.transform.pitch),o=function(t,n,i,r,a,o,s,l,u,c,d){var h=t.transform,f=n.properties.get("color").toArray01();f[3]=r;var p=t.frameCounter/1e3%1;return{u_fog_matrix:i?h.calculateFogTileMatrix(i):t.identityMat,u_fog_range:n.getFovAdjustedRange(h._fov),u_fog_color:f,u_fog_horizon_blend:n.properties.get("horizon-blend"),u_fog_temporal_offset:p,u_frustum_tl:a,u_frustum_tr:o,u_frustum_br:s,u_frustum_bl:l,u_globe_pos:u,u_globe_radius:c,u_viewport:d,u_globe_transition:e.globeToMercatorTransition(h.zoom),u_is_globe:+("globe"===h.projection.name)}}(this,r,i,a,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.exported.devicePixelRatio,this.transform.height*e.exported.devicePixelRatio]);n.setFogUniformValues(t,o)}}}},{key:"setTileLoadedFlag",value:function(e){this.tileLoaded=e}},{key:"saveCanvasCopy",value:function(){var e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}},{key:"canvasCopy",value:function(){var e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}},{key:"getCanvasCopiesAndTimestamps",value:function(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}},{key:"averageElevationNeedsEasing",value:function(){if(!this.transform._elevation)return!1;var e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}},{key:"getBackgroundTiles",value:function(){var t,n=this._backgroundTiles,i=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512}),a=h(r);try{for(a.s();!(t=a.n()).done;){var o=t.value;i[o.key]=n[o.key]||new e.Tile(o,512,this.transform.tileZoom,this)}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"clearBackgroundTiles",value:function(){this._backgroundTiles={}}}]),t}(),Ki=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(f(this,t),isNaN(e)||e<0||isNaN(n)||n<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=i,this.right=r}return p(t,[{key:"interpolate",value:function(t,n,i){return null!=n.top&&null!=t.top&&(this.top=e.number(t.top,n.top,i)),null!=n.bottom&&null!=t.bottom&&(this.bottom=e.number(t.bottom,n.bottom,i)),null!=n.left&&null!=t.left&&(this.left=e.number(t.left,n.left,i)),null!=n.right&&null!=t.right&&(this.right=e.number(t.right,n.right,i)),this}},{key:"getCenter",value:function(t,n){var i=e.clamp((this.left+t-this.right)/2,0,t),r=e.clamp((this.top+n-this.bottom)/2,0,n);return new e.Point(i,r)}},{key:"equals",value:function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}},{key:"clone",value:function(){return new t(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),t}();function Yi(t,n){var i=e.getColumn(t,3);e.fromQuat(t,n),e.setColumn(t,3,i)}function Ji(t,n){var i=e.identity$1([]);return e.rotateZ$1(i,i,-n),e.rotateX$1(i,i,-t),i}function $i(t,n){var i=[t[0],t[1],0],r=[n[0],n[1],0];if(e.length(i)>=1e-15){var a=e.normalize([],i);e.scale$2(r,a,e.dot(r,a)),n[0]=r[0],n[1]=r[1]}var o=e.cross([],n,t);if(e.len(o)<1e-15)return null;var s=Math.atan2(-o[1],o[0]);return Ji(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),s)}var Qi=function(){function t(e,n){f(this,t),this.position=e,this.orientation=n}return p(t,[{key:"position",get:function(){return this._position},set:function(t){if(t){var n=t instanceof e.MercatorCoordinate?t:new e.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=e.wrap(n.x,0,1)),this._position=n}else this._position=null}},{key:"lookAtPoint",value:function(t,n){if(this.orientation=null,this.position){var i=this.position,r=this._elevation?this._elevation.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(t)):0,a=e.MercatorCoordinate.fromLngLat(t,r),o=[a.x-i.x,a.y-i.y,a.z-i.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=$i(o,n)}}},{key:"setPitchBearing",value:function(t,n){this.orientation=Ji(e.degToRad(t),e.degToRad(-n))}}]),t}(),er=function(){function t(n,i){f(this,t),this._transform=e.identity([]),this.orientation=i,this.position=n}return p(t,[{key:"mercatorPosition",get:function(){var t=this.position;return new e.MercatorCoordinate(t[0],t[1],t[2])}},{key:"position",get:function(){var t=e.getColumn(this._transform,3);return[t[0],t[1],t[2]]},set:function(t){var n;t&&e.setColumn(this._transform,3,[(n=t)[0],n[1],n[2],1])}},{key:"orientation",get:function(){return this._orientation},set:function(t){this._orientation=t||e.identity$1([]),t&&Yi(this._transform,this._orientation)}},{key:"getPitchBearing",value:function(){var e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}},{key:"setPitchBearing",value:function(e,t){this._orientation=Ji(e,t),Yi(this._transform,this._orientation)}},{key:"forward",value:function(){var t=e.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}},{key:"up",value:function(){var t=e.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}},{key:"right",value:function(){var t=e.getColumn(this._transform,0);return[t[0],t[1],t[2]]}},{key:"getCameraToWorld",value:function(t,n){var i=new Float64Array(16);return e.invert(i,this.getWorldToCamera(t,n)),i}},{key:"getWorldToCameraPosition",value:function(t,n,i){var r=this.position;e.scale$2(r,r,-t);var a=new Float64Array(16);return e.fromScaling(a,[i,i,i]),e.translate(a,a,r),a[10]*=n,a}},{key:"getWorldToCamera",value:function(t,n){var i=new Float64Array(16),r=new Float64Array(4),a=this.position;return e.conjugate(r,this._orientation),e.scale$2(a,a,-t),e.fromQuat(i,r),e.translate(i,i,a),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=n,i[9]*=n,i[10]*=n,i[11]*=n,i}},{key:"getCameraToClipPerspective",value:function(t,n,i,r){var a=new Float64Array(16);return e.perspective(a,t,n,i,r),a}},{key:"getDistanceToElevation",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=0===t?0:e.mercatorZfromAltitude(t,n?e.latFromMercatorY(this.position[1]):this.position[1]),r=this.forward();return(i-this.position[2])/r[2]}},{key:"clone",value:function(){return new t(c(this.position),c(this.orientation))}}]),t}();function tr(t,n){var i=ir(t.projection,t.zoom,t.width,t.height),r=function(t,n,i,r,a){var o=new e.LngLat(i.lng-180*rr,i.lat),s=new e.LngLat(i.lng+180*rr,i.lat),l=t.project(o.lng,o.lat),u=t.project(s.lng,s.lat),c=-Math.atan2(u.y-l.y,u.x-l.x),d=e.MercatorCoordinate.fromLngLat(i);d.y=e.clamp(d.y,-1+rr,1-rr);var h=d.toLngLat(),f=t.project(h.lng,h.lat),p=e.MercatorCoordinate.fromLngLat(h);p.x+=rr;var m=p.toLngLat(),y=t.project(m.lng,m.lat),g=or(y.x-f.x,y.y-f.y,c),v=e.MercatorCoordinate.fromLngLat(h);v.y+=rr;var _=v.toLngLat(),x=t.project(_.lng,_.lat),b=or(x.x-f.x,x.y-f.y,c),w=Math.abs(g.x)/Math.abs(b.y),k=e.identity([]);e.rotateZ(k,k,-c*(1-(a?0:r)));var T=e.identity([]);return e.scale(T,T,[1,1-(1-w)*r,1]),T[4]=-b.x/b.y*r,e.rotateZ(T,T,c),e.multiply(T,k,T),T}(t.projection,0,t.center,i,n),a=nr(t);return e.scale(r,r,[a,a,1]),r}function nr(t){var n=t.projection,i=ir(t.projection,t.zoom,t.width,t.height),r=ar(n,t.center),a=ar(n,e.LngLat.convert(n.center));return Math.pow(2,r*i+(1-i)*a)}function ir(t,n,i,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=t.range;if(!o)return 0;var s=Math.min(a,Math.max(i,r)),l=Math.log(s/1024)/Math.LN2;return e.smoothstep(o[0]+l,o[1]+l,n)}var rr=1/4e4;function ar(t,n){var i=e.clamp(n.lat,-e.MAX_MERCATOR_LATITUDE,e.MAX_MERCATOR_LATITUDE),r=new e.LngLat(n.lng-180*rr,i),a=new e.LngLat(n.lng+180*rr,i),o=t.project(r.lng,i),s=t.project(a.lng,i),l=e.MercatorCoordinate.fromLngLat(r),u=e.MercatorCoordinate.fromLngLat(a),c=s.x-o.x,d=s.y-o.y,h=u.x-l.x,f=u.y-l.y,p=Math.sqrt((h*h+f*f)/(c*c+d*d));return Math.log(p)/Math.LN2}function or(e,t,n){var i=Math.cos(n),r=Math.sin(n);return{x:e*i-t*r,y:e*r+t*i}}var sr=function(){function n(t,i,r,a,o,s,l){f(this,n),this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==a?60:a,this.setProjection(s),this.setMaxBounds(l),this.width=0,this.height=0,this._center=new e.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ki,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new er,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}return p(n,[{key:"clone",value:function(){var e=new n(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}},{key:"elevation",get:function(){return this._elevation},set:function(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}},{key:"updateElevation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||n)&&this._updateCameraOnTerrain(),(e||n)&&this._constrainCamera(t),this._calcMatrices()}},{key:"getProjection",value:function(){return e.pick(this.projection,["name","center","parallels"])}},{key:"setProjection",value:function(n){this.projectionOptions=n||{name:"mercator"};var i=this.projection?this.getProjection():void 0;this.projection=e.getProjection(this.projectionOptions);var r=!t(i,this.getProjection());return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}},{key:"setMercatorFromTransition",value:function(){var t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.getProjection({name:"mercator"});var n=t!==this.projection.name;return n&&this._calcMatrices(),n}},{key:"minZoom",get:function(){return this._minZoom},set:function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}},{key:"minPitch",get:function(){return this._minPitch},set:function(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies},set:function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"cameraWorldSizeForFog",get:function(){var e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}},{key:"cameraWorldSize",get:function(){var e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}},{key:"pixelsPerMeter",get:function(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}},{key:"cameraPixelsPerMeter",get:function(){return e.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new e.Point(this.width,this.height)}},{key:"bearing",get:function(){return e.wrap(this.rotation,-180,180)},set:function(e){this.rotation=e}},{key:"rotation",get:function(){return-this.angle/Math.PI*180},set:function(t){var n,i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=(n=new e.ARRAY_TYPE(4),e.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n),function(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);e[0]=i*l+a*s,e[1]=r*l+o*s,e[2]=i*-s+a*l,e[3]=r*-s+o*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(t){var n=e.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}},{key:"aspect",get:function(){return this.width/this.height}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.degToRad(t),this._calcMatrices())}},{key:"fovX",get:function(){return this._fov}},{key:"fovY",get:function(){var e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}},{key:"averageElevation",get:function(){return this._averageElevation},set:function(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}},{key:"zoom",get:function(){return this._zoom},set:function(e){var t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}},{key:"_setZoom",value:function(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}},{key:"_updateCameraOnTerrain",value:function(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);var e=this._elevation;this._centerAltitude=e.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=e.exaggeration(),this._updateSeaLevelZoom()}},{key:"_updateSeaLevelZoom",value:function(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}},{key:"sampleAverageElevation",value:function(){if(!this._elevation)return 0;for(var t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop(),r=0,a=0,o=0;o<n.length;o++){var s=new e.Point(n[o][0]*this.width,i+n[o][1]*(this.height-i)),l=t.pointCoordinate(s);if(l){var u=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*u,a+=u}}return 0===a?NaN:r/a}},{key:"center",get:function(){return this._center},set:function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}},{key:"_updateZoomFromElevation",value:function(){if(null!=this._seaLevelZoom&&this._elevation){var e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),n=this.pixelsPerMeter/this.worldSize*t,i=this._mercatorZfromZoom(e),r=this._mercatorZfromZoom(this._maxZoom),a=Math.max(i-n,r);this._setZoom(this._zoomFromMercatorZ(a))}}},{key:"padding",get:function(){return this._edgeInsets.toJSON()},set:function(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}},{key:"computeZoomRelativeTo",value:function(t){var n,i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));n=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];var r=e.length(e.sub([],this._camera.position,n));return e.clamp(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}},{key:"setFreeCameraOptions",value:function(t){if(this.height&&(t.position||t.orientation)){this._updateCameraState();var n=!1;if(t.orientation&&!e.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){var i=[t.position.x,t.position.y,t.position.z];e.exactEquals$1(i,this._camera.position)||(this._setCameraPosition(i),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}}},{key:"getFreeCameraOptions",value:function(){this._updateCameraState();var t=this._camera.position,n=new Qi;return n.position=new e.MercatorCoordinate(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}},{key:"_setCameraOrientation",value:function(t){if(!e.length$1(t))return!1;e.normalize$1(t,t);var n=e.transformQuat([],[0,0,-1],t),i=e.transformQuat([],[0,-1,0],t);if(i[2]<0)return!1;var r=$i(n,i);return!!r&&(this._camera.orientation=r,!0)}},{key:"_setCameraPosition",value:function(t){var n=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;t[2]=e.clamp(t[2],r/i,r/n),this._camera.position=t}},{key:"centerPoint",get:function(){return this._edgeInsets.getCenter(this.width,this.height)}},{key:"fovAboveCenter",get:function(){return this._fov*(.5+this.centerOffset.y/this.height)}},{key:"isPaddingEqual",value:function(e){return this._edgeInsets.equals(e)}},{key:"interpolatePadding",value:function(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}},{key:"coveringZoomLevel",value:function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}},{key:"getVisibleUnwrappedCoordinates",value:function(t){var n=[new e.UnwrappedTileID(0,t)];if(this.renderWorldCopies)for(var i=this.pointCoordinate(new e.Point(0,0)),r=this.pointCoordinate(new e.Point(this.width,0)),a=this.pointCoordinate(new e.Point(this.width,this.height)),o=this.pointCoordinate(new e.Point(0,this.height)),s=Math.floor(Math.min(i.x,r.x,a.x,o.x)),l=Math.floor(Math.max(i.x,r.x,a.x,o.x)),u=1,c=s-u;c<=l+u;c++)0!==c&&n.push(new e.UnwrappedTileID(c,t));return n}},{key:"coveringTiles",value:function(t){var n=this,i=this.coveringZoomLevel(t),r=i,a=this.elevation&&!t.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);var s=this.locationCoordinate(this.center),l=this.center.lat,u=1<<i,c=[u*s.x,u*s.y,0],d="globe"===this.projection.name,h=!d,f=e.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,h),p=d?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),m=u*e.mercatorZfromAltitude(1,this.center.lat),y=this._camera.position[2]/e.mercatorZfromAltitude(1,this.center.lat),g=[u*p.x,u*p.y,y*(h?1:m)],v=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),_=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?i:0,x=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,b=t.isTerrainDEM?-x:this._elevation?this._elevation.getMinElevationBelowMSL():0,w=this.projection.isReprojectedInTileSpace?nr(this):1,k=function(t){var i=1/4e4,r=new e.MercatorCoordinate(t.x+i,t.y,t.z),a=new e.MercatorCoordinate(t.x,t.y+i,t.z),o=t.toLngLat(),s=r.toLngLat(),l=a.toLngLat(),u=n.locationCoordinate(o),c=n.locationCoordinate(s),d=n.locationCoordinate(l),h=Math.hypot(c.x-u.x,c.y-u.y),f=Math.hypot(d.x-u.x,d.y-u.y);return Math.sqrt(h*f)*w/i},T=function(t){var i=x,r=b;return{aabb:e.tileAABB(n,u,0,0,0,t,r,i,n.projection),zoom:0,x:0,y:0,minZ:r,maxZ:i,wrap:t,fullyVisible:!1}},E=[],S=[],L=i,M=t.reparseOverscaled?r:i,A=function(e){return e*e},C=A((y-this._centerAltitude)*m),I=function(e){if(n._elevation&&e.tileID&&o){var t=n._elevation.getMinMaxForTile(e.tileID),i=e.aabb;t?(i.min[2]=t.min,i.max[2]=t.max,i.center[2]=(i.min[2]+i.max[2])/2):(e.shouldSplit=P(e),e.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=n._centerAltitude))}},P=function(t){if(t.zoom<_)return!0;if(t.zoom===L)return!1;if(null!=t.shouldSplit)return t.shouldSplit;var i=t.aabb.distanceX(g),o=t.aabb.distanceY(g),s=C,u=1;if(d){s=A(t.aabb.distanceZ(g));var c=Math.pow(2,t.zoom),h=e.latFromMercatorY((t.y+1)/c),f=e.latFromMercatorY(t.y/c),p=Math.min(Math.max(l,h),f),y=e.circumferenceAtLatitude(p)/e.circumferenceAtLatitude(l);if(u=p===l?1/Math.max(1,n._mercatorScaleRatio-.3):Math.min(1,y/n._mercatorScaleRatio),n.zoom<=e.GLOBE_ZOOM_THRESHOLD_MIN&&t.zoom===L-1&&y>=.9)return!0}else if(a&&(s=A(t.aabb.distanceZ(g)*m)),n.projection.isReprojectedInTileSpace&&r<=5){var x=Math.pow(2,t.zoom),b=k(new e.MercatorCoordinate((t.x+.5)/x,(t.y+.5)/x));u=b>.85?1:b}var w=i*i+o*o+s,T=A((1<<L-t.zoom)*v*u*function(e,t){if(t*A(.707)<e)return 1;var n=Math.sqrt(t/e);return n/(1.4144271570014144+(Math.pow(1.1,n-1.4144271570014144+1)-1)/(1.1-1)-1)}(Math.max(s,C),w));return w<T};if(this.renderWorldCopies)for(var z=1;z<=3;z++)E.push(T(-z)),E.push(T(z));for(E.push(T(0));E.length>0;){var D=E.pop(),R=D.x,B=D.y,F=D.fullyVisible;if(!F){var O=D.aabb.intersects(f);if(0===O)continue;F=2===O}if(D.zoom!==L&&P(D))for(var N=0;N<4;N++){var H=(R<<1)+N%2,U=(B<<1)+(N>>1),j={aabb:o?D.aabb.quadrant(N):e.tileAABB(this,u,D.zoom+1,H,U,D.wrap,D.minZ,D.maxZ,this.projection),zoom:D.zoom+1,x:H,y:U,wrap:D.wrap,fullyVisible:F,tileID:void 0,shouldSplit:void 0,minZ:D.minZ,maxZ:D.maxZ};a&&!d&&(j.tileID=new e.OverscaledTileID(D.zoom+1===L?M:D.zoom+1,D.wrap,D.zoom+1,H,U),I(j)),E.push(j)}else{var V=D.zoom===L?M:D.zoom;if(t.minzoom&&t.minzoom>V)continue;var W=c[0]-(.5+R+(D.wrap<<D.zoom))*(1<<i-D.zoom),G=c[1]-.5-B,q=D.tileID?D.tileID:new e.OverscaledTileID(V,D.wrap,D.zoom,R,B);S.push({tileID:q,distanceSq:W*W+G*G})}}if(this.fogCullDistSq){var Z=this.fogCullDistSq,X=this.horizonLineFromTop();S=S.filter((function(i){var r=[0,0,0,1],a=[e.EXTENT,e.EXTENT,0,1],o=n.calculateFogTileMatrix(i.tileID.toUnwrapped());e.transformMat4$1(r,r,o),e.transformMat4$1(a,a,o);var s=e.getAABBPointSquareDist(r,a);if(0===s)return!0;var l=!1,u=n._elevation;if(u&&s>Z&&0!==X){var c,d=n.calculateProjMatrix(i.tileID.toUnwrapped());t.isTerrainDEM||(c=u.getMinMaxForTile(i.tileID)),c||(c={min:b,max:x});var h=e.furthestTileCorner(n.rotation),f=[h[0]*e.EXTENT,h[1]*e.EXTENT,c.max];e.transformMat4(f,f,d),l=(1-f[1])*n.height*.5<X}return s<Z||l}))}return S.sort((function(e,t){return e.distanceSq-t.distanceSq})).map((function(e){return e.tileID}))}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}},{key:"unmodified",get:function(){return this._unmodified}},{key:"zoomScale",value:function(e){return Math.pow(2,e)}},{key:"scaleZoom",value:function(e){return Math.log(e)/Math.LN2}},{key:"project",value:function(t){var n=e.clamp(t.lat,-e.MAX_MERCATOR_LATITUDE,e.MAX_MERCATOR_LATITUDE),i=this.projection.project(t.lng,n);return new e.Point(i.x*this.worldSize,i.y*this.worldSize)}},{key:"unproject",value:function(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}},{key:"point",get:function(){return this.project(this.center)}},{key:"pointMerc",get:function(){return this.point._div(this.worldSize)}},{key:"pixelsPerMeterRatio",get:function(){return this.pixelsPerMeter/e.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}},{key:"setLocationAtPoint",value:function(t,n){var i,r,a=this.centerPoint;if("globe"===this.projection.name){var o=this.worldSize;i=(n.x-a.x)/o,r=(n.y-a.y)/o}else{var s=this.pointCoordinate(n),l=this.pointCoordinate(a);i=s.x-l.x,r=s.y-l.y}var u=this.locationCoordinate(t);this.setLocation(new e.MercatorCoordinate(u.x-i,u.y-r))}},{key:"setLocation",value:function(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}},{key:"locationPoint",value:function(e){return this.projection.locationPoint(this,e)}},{key:"locationPoint3D",value:function(e){return this.projection.locationPoint(this,e,!0)}},{key:"pointLocation",value:function(e){return this.coordinateLocation(this.pointCoordinate(e))}},{key:"pointLocation3D",value:function(e){return this.coordinateLocation(this.pointCoordinate3D(e))}},{key:"locationCoordinate",value:function(t,n){var i=n?e.mercatorZfromAltitude(n,t.lat):void 0,r=this.projection.project(t.lng,t.lat);return new e.MercatorCoordinate(r.x,r.y,i)}},{key:"coordinateLocation",value:function(e){return this.projection.unproject(e.x,e.y)}},{key:"pointRayIntersection",value:function(t,n){var i=null!=n?n:this._centerAltitude,r=[t.x,t.y,0,1],a=[t.x,t.y,1,1];e.transformMat4$1(r,r,this.pixelMatrixInverse),e.transformMat4$1(a,a,this.pixelMatrixInverse);var o=a[3];e.scale$1(r,r,1/r[3]),e.scale$1(a,a,1/o);var s=r[2],l=a[2];return{p0:r,p1:a,t:s===l?0:(i-s)/(l-s)}}},{key:"screenPointToMercatorRay",value:function(t){var n=[t.x,t.y,0,1],i=[t.x,t.y,1,1];return e.transformMat4$1(n,n,this.pixelMatrixInverse),e.transformMat4$1(i,i,this.pixelMatrixInverse),e.scale$1(n,n,1/n[3]),e.scale$1(i,i,1/i[3]),n[2]=e.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,i[2]=e.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,e.scale$1(n,n,1/this.worldSize),e.scale$1(i,i,1/this.worldSize),new e.Ray([n[0],n[1],n[2]],e.normalize([],e.sub([],i,n)))}},{key:"rayIntersectionCoordinate",value:function(t){var n=t.p0,i=t.p1,r=t.t,a=e.mercatorZfromAltitude(n[2],this._center.lat),o=e.mercatorZfromAltitude(i[2],this._center.lat);return new e.MercatorCoordinate(e.number(n[0],i[0],r)/this.worldSize,e.number(n[1],i[1],r)/this.worldSize,e.number(a,o,r))}},{key:"pointCoordinate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._centerAltitude;return this.projection.pointCoordinate(this,e.x,e.y,t)}},{key:"pointCoordinate3D",value:function(t){if(!this.elevation)return this.pointCoordinate(t);var n=this.projection.pointCoordinate3D(this,t.x,t.y);if(n)return new e.MercatorCoordinate(n[0],n[1],n[2]);var i=0,r=this.horizonLineFromTop();if(t.y>r)return this.pointCoordinate(t);for(var a=.02*r,o=t.clone(),s=0;s<10&&r-i>a;s++){o.y=e.number(i,r,.66);var l=this.projection.pointCoordinate3D(this,o.x,o.y);l?(r=o.y,n=l):i=o.y}return n?new e.MercatorCoordinate(n[0],n[1],n[2]):this.pointCoordinate(t)}},{key:"isPointAboveHorizon",value:function(e){return this.projection.isPointAboveHorizon(this,e)}},{key:"isPointOnSurface",value:function(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(t);var n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}},{key:"_coordinatePoint",value:function(t,n){var i=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,r=[t.x*this.worldSize,t.y*this.worldSize,i+t.toAltitude(),1];return e.transformMat4$1(r,r,this.pixelMatrix),r[3]>0?new e.Point(r[0]/r[3],r[1]/r[3]):new e.Point(Number.MAX_VALUE,Number.MAX_VALUE)}},{key:"_getBoundsNonRectangular",value:function(){var t=this,n=this._edgeInsets,i=n.top,r=n.left,a=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,s=this.pointLocation3D(new e.Point(r,i)),l=this.pointLocation3D(new e.Point(o,i)),u=this.pointLocation3D(new e.Point(o,a)),c=this.pointLocation3D(new e.Point(r,a)),h=Math.min(s.lng,l.lng,u.lng,c.lng),f=Math.max(s.lng,l.lng,u.lng,c.lng),p=Math.min(s.lat,l.lat,u.lat,c.lat),m=Math.max(s.lat,l.lat,u.lat,c.lat),y=Math.pow(2,-this.zoom)/16*270,g="globe"===this.projection.name?1:4,v=function n(i,r,a,o,s){var l=(i+a)/2,u=(r+o)/2,c=new e.Point(l,u),d=t.pointLocation3D(c),v=d.lng,_=d.lat,x=Math.max(0,h-v,p-_,v-f,_-m);h=Math.min(h,v),f=Math.max(f,v),p=Math.min(p,_),m=Math.max(m,_),(s<g||x>y)&&(n(i,r,l,u,s+1),n(l,u,a,o,s+1))};if(v(r,i,o,i,1),v(o,i,o,a,1),v(o,a,r,a,1),v(r,a,r,i,1),"globe"===this.projection.name){var _=e.polesInViewport(this),x=d(_,2),b=x[0],w=x[1];b?(m=90,f=180,h=-180):w&&(p=-90,f=180,h=-180)}return new e.LngLatBounds(new e.LngLat(h,p),new e.LngLat(f,m))}},{key:"_getBoundsRectangular",value:function(t,n){var i=this._edgeInsets,r=i.top,a=i.left,o=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,l=new e.Point(a,r),u=new e.Point(s,r),c=new e.Point(s,o),d=new e.Point(a,o),h=this.pointCoordinate(l,t),f=this.pointCoordinate(u,t),p=this.pointCoordinate(c,n),m=this.pointCoordinate(d,n),y=function(e,t){return(t.y-e.y)/(t.x-e.x)};return h.y>1&&f.y>=0?h=new e.MercatorCoordinate((1-m.y)/y(m,h)+m.x,1):h.y<0&&f.y<=1&&(h=new e.MercatorCoordinate(-m.y/y(m,h)+m.x,0)),f.y>1&&h.y>=0?f=new e.MercatorCoordinate((1-p.y)/y(p,f)+p.x,1):f.y<0&&h.y<=1&&(f=new e.MercatorCoordinate(-p.y/y(p,f)+p.x,0)),(new e.LngLatBounds).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(m)).extend(this.coordinateLocation(p))}},{key:"_getBoundsRectangularTerrain",value:function(){var e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);var t=e.visibleDemTiles.reduce((function(e,t){if(t.dem){var n=t.dem.tree;e.min=Math.min(e.min,n.minimums[0]),e.max=Math.max(e.max,n.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}},{key:"getBounds",value:function(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}},{key:"horizonLineFromTop",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,n=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,n):n}},{key:"getMaxBounds",value:function(){return this.maxBounds}},{key:"setMaxBounds",value:function(t){this.maxBounds=t,this.minLat=-e.MAX_MERCATOR_LATITUDE,this.maxLat=e.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=e.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=e.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=e.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}},{key:"calculatePosMatrix",value:function(e,t){return this.projection.createTileMatrix(this,t,e)}},{key:"calculateDistanceTileData",value:function(t){var n=t.key,i=this._distanceTileDataCache;if(i[n])return i[n];var r=t.canonical,a=1/this.height,o=this.cameraWorldSize,s=o/this.zoomScale(r.z),l=(r.x+Math.pow(2,r.z)*t.wrap)*s,u=r.y*s,c=this.point;c.x*=o/this.worldSize,c.y*=o/this.worldSize;var d=this.angle,h=Math.sin(-d),f=-Math.cos(-d);return i[n]={bearing:[h,f],center:[(c.x-l)*a,(c.y-u)*a],scale:s/e.EXTENT*a},i[n]}},{key:"calculateFogTileMatrix",value:function(t){var n=t.key,i=this._fogTileMatrixCache;if(i[n])return i[n];var r=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.multiply(r,this.worldToFogMatrix,r),i[n]=new Float32Array(r),i[n]}},{key:"calculateProjMatrix",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.key,r=n?this._alignedProjMatrixCache:this._projMatrixCache;if(r[i])return r[i];var a=this.calculatePosMatrix(t,this.worldSize);return e.multiply(a,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.alignedProjMatrix:this.projMatrix,a),r[i]=new Float32Array(a),r[i]}},{key:"calculatePixelsToTileUnitsMatrix",value:function(t){var n=t.tileID.key,i=this._pixelsToTileUnitsCache;if(i[n])return i[n];var r=function(t,n){var i,r,a,o,s,l,u,c,d=t.tileTransform.scale*e.EXTENT/(t.tileSize*Math.pow(2,n.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return i=new Float32Array(4),o=(r=n.inverseAdjustmentMatrix)[1],s=r[2],l=r[3],c=(a=[d,d])[1],i[0]=r[0]*(u=a[0]),i[1]=o*u,i[2]=s*c,i[3]=l*c,i}(t,this);return i[n]=r,i[n]}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"globeToMercatorMatrix",value:function(){if("globe"===this.projection.name){var t=1/this.worldSize,n=e.fromScaling([],[t,t,t]);return e.multiply(n,n,this.globeMatrix),n}}},{key:"recenterOnTerrain",value:function(){if(this._elevation&&"globe"!==this.projection.name){var t=this._elevation;this._updateCameraState();var n=e.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(n),r=this._camera.forward(),a=e.mercatorZfromAltitude(1,this._center.lat);i[2]/=a,r[2]/=a,e.normalize(r,r);var o=t.raycast(i,r,t.exaggeration());if(o){var s=e.scaleAndAdd([],i,r,o),l=new e.MercatorCoordinate(s[0],s[1],e.mercatorZfromAltitude(s[2],e.latFromMercatorY(s[1]))),u=(l.z+e.length([l.x-i[0],l.y-i[1],l.z-i[2]*a]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(u),this._centerAltitude=l.toAltitude(),this._center=this.coordinateLocation(l),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}}},{key:"_constrainCamera",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._elevation){var n=this._elevation,i=e.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),o=n.getAtPointOrZero(a(e.MercatorCoordinate,c(r))),s=this.pixelsPerMeter/this.worldSize*o,l=this._minimumHeightOverTerrain(),u=r[2]-s;if(u<=l)if(u<0||t){var d=this.locationCoordinate(this._center,this._centerAltitude),h=[r[0],r[1],d.z-r[2]],f=e.length(h);h[2]-=(l-u)/this._pixelsPerMercatorPixel;var p=e.length(h);if(0===p)return;e.scale$2(h,h,f/p*this._pixelsPerMercatorPixel),this._camera.position=[r[0],r[1],d.z*this._pixelsPerMercatorPixel-h[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}}},{key:"_constrain",value:function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){var n=this.center;return n.lat=e.clamp(n.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(n.lng=e.clamp(n.lng,this.minLng,this.maxLng)),this.center=n,void(this._constraining=!1)}var i=this._unmodified,r=this.point,a=r.x,o=r.y,s=0,l=a,u=o,c=this.width/2,d=this.height/2,h=this.worldMinY*this.scale,f=this.worldMaxY*this.scale;if(o-d<h&&(u=h+d),o+d>f&&(u=f-d),f-h<this.height&&(s=Math.max(s,this.height/(f-h)),u=(f+h)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){var p=this.worldMinX*this.scale,m=this.worldMaxX*this.scale,y=this.worldSize/2-(p+m)/2;(l=(a+y+this.worldSize)%this.worldSize-y)-c<p&&(l=p+c),l+c>m&&(l=m-c),m-p<this.width&&(s=Math.max(s,this.width/(m-p)),l=(m+p)/2)}l===a&&u===o||(this.center=this.unproject(new e.Point(l,u))),s&&(this.zoom+=this.scaleZoom(s)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}}},{key:"_minZoomForBounds",value:function(){var e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}},{key:"_maxCameraBoundsDistance",value:function(){return this._mercatorZfromZoom(this._minZoomForBounds())}},{key:"_calcMatrices",value:function(){if(this.height){var t=this.centerOffset,n=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.mercatorZfromAltitude(1,this.center.lat)/e.mercatorZfromAltitude(1,e.GLOBE_SCALE_MATCH_LATITUDE));var i=ir(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,i),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;var r="meters"===this.projection.zAxisUnit?n:1,a=this._camera.getWorldToCamera(this.worldSize,r),o=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);o[8]=2*-t.x/this.width,o[9]=2*t.y/this.height;var s=e.mul([],o,a);if(this.projection.isReprojectedInTileSpace){var l=this.locationCoordinate(this.center),u=e.identity([]);e.translate(u,u,[l.x*this.worldSize,l.y*this.worldSize,0]),e.multiply(u,u,tr(this)),e.translate(u,u,[-l.x*this.worldSize,-l.y*this.worldSize,0]),e.multiply(s,s,u),this.inverseAdjustmentMatrix=function(e){var t=tr(e,!0);return I([],[t[0],t[1],t[4],t[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=e.scale([],s,[this.worldSize,this.worldSize,this.worldSize/r,1]),this.projMatrix=s,this.invProjMatrix=e.invert(new Float64Array(16),this.projMatrix);var c=e.invert([],o);this.frustumCorners=e.FrustumCorners.fromInvProjectionMatrix(c,this.horizonLineFromTop(),this.height);var d=new Float32Array(16);e.identity(d),e.scale(d,d,[1,-1,1]),e.rotateX(d,d,this._pitch),e.rotateZ(d,d,this.angle);var h=e.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),f=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;h[8]=2*-t.x/this.width,h[9]=2*(t.y+f)/this.height,this.skyboxMatrix=e.multiply(d,h,d);var p=this.point,m=p.x,y=p.y,g=this.width%2/2,v=this.height%2/2,_=Math.cos(this.angle),x=Math.sin(this.angle),b=m-Math.round(m)+_*g+x*v,w=y-Math.round(y)+_*v+x*g,k=new Float64Array(s);if(e.translate(k,k,[b>.5?b-1:b,w>.5?w-1:w,0]),this.alignedProjMatrix=k,s=e.create(),e.scale(s,s,[this.width/2,-this.height/2,1]),e.translate(s,s,[1,-1,0]),this.labelPlaneMatrix=s,s=e.create(),e.scale(s,s,[1,-1,1]),e.translate(s,s,[-1,-1,0]),e.scale(s,s,[2/this.width,2/this.height,1]),this.glCoordMatrix=s,this.pixelMatrix=e.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},!(s=e.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=s,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.calculateGlobeMatrix(this);var T=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.transformMat4(T,T,a),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=s;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}}},{key:"_calcFogMatrices",value:function(){this._fogTileMatrixCache={};var t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,i=this._camera.position,r=1/this.height/this._pixelsPerMercatorPixel,a=[t,t,n];e.scale$2(a,a,r),e.scale$2(i,i,-1),e.multiply$2(i,i,a);var o=e.create();e.translate(o,o,i),e.scale(o,o,a),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,r)}},{key:"_computeCameraPosition",value:function(e){var t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,n=this._camera.forward(),i=this.point,r=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[i.x/this.worldSize-n[0]*r,i.y/this.worldSize-n[1]*r,e/this.worldSize*this._centerAltitude-n[2]*r]}},{key:"_updateCameraState",value:function(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}},{key:"_translateCameraConstrained",value:function(t){var n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=this._camera.position[2],r=t[2],a=1;this.projection.wrap&&(this.center=this.center.wrap()),r>0&&(a=Math.min((n-i)/r,1)),this._camera.position=e.scaleAndAdd([],this._camera.position,t,a),this._updateStateFromCamera()}},{key:"_updateStateFromCamera",value:function(){var t=this._camera.position,n=this._camera.forward(),i=this._camera.getPitchBearing(),r=i.pitch,a=i.bearing,o=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.degToRad(this._maxPitch)),l=Math.max((t[2]-o)/Math.cos(r),s),u=this._zoomFromMercatorZ(l);e.scaleAndAdd(t,t,n,l),this._pitch=e.clamp(r,e.degToRad(this.minPitch),e.degToRad(this.maxPitch)),this.angle=e.wrap(a,-Math.PI,Math.PI),this._setZoom(e.clamp(u,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}},{key:"_worldSizeFromZoom",value:function(e){return Math.pow(2,e)*this.tileSize}},{key:"_mercatorZfromZoom",value:function(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}},{key:"_minimumHeightOverTerrain",value:function(){var e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}},{key:"_zoomFromMercatorZ",value:function(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}},{key:"zoomFromMercatorZAdjusted",value:function(t){for(var n=0,i=e.GLOBE_ZOOM_THRESHOLD_MAX,r=0,a=1/0;i-n>1e-6&&i>n;){var o=n+.5*(i-n),s=this.tileSize*Math.pow(2,o),l=this.getCameraToCenterDistance(this.projection,o,s),u=this.scaleZoom(l/(t*this.tileSize)),c=Math.abs(o-u);c<a&&(a=c,r=o),o<u?n=o:i=o}return r}},{key:"_terrainEnabled",value:function(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}},{key:"anyCornerOffEdge",value:function(t,n){var i=Math.min(t.x,n.x),r=Math.max(t.x,n.x),a=Math.min(t.y,n.y),o=Math.max(t.y,n.y);if(a<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;for(var s=[new e.Point(i,a),new e.Point(r,o),new e.Point(i,o),new e.Point(r,a)],l=this.renderWorldCopies?-3:0,u=this.renderWorldCopies?4:1,c=0,d=s;c<d.length;c++){var h=d[c],f=this.pointRayIntersection(h);if(f.t<0)return!0;var p=this.rayIntersectionCoordinate(f);if(p.x<l||p.y<0||p.x>u||p.y>1)return!0}return!1}},{key:"isHorizonVisible",value:function(){return this.pitch+e.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.Point(0,0),new e.Point(this.width,this.height))}},{key:"zoomDeltaToMovement",value:function(t,n){var i=e.length(e.sub([],this._camera.position,t)),r=this._zoomFromMercatorZ(i)+n;return i-this._mercatorZfromZoom(r)}},{key:"getCameraPoint",value:function(){if("globe"===this.projection.name){var t=function(t,n){var i=d(t,3),r=[i[0],i[1],i[2],1];e.transformMat4$1(r,r,n);var a=r[3]=Math.max(r[3],1e-6);return r[0]/=a,r[1]/=a,r[2]/=a,r}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.Point(t[0],t[1])}var n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.Point(0,n))}},{key:"getCameraToCenterDistance",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.worldSize,i=ir(e,t,this.width,this.height,1024),r=e.pixelSpaceConversion(this.center.lat,n,i);return.5/Math.tan(.5*this._fov)*this.height*r}},{key:"getWorldToCameraMatrix",value:function(){var t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.multiply(t,t,this.globeMatrix),t}}]),n}();function lr(e,t){var n=!1,i=null,r=function r(){i=null,n&&(e(),i=setTimeout(r,t),n=!1)};return function(){return n=!0,i||r(),i}}var ur=function(){function t(n){f(this,t),this._hashName=n&&encodeURIComponent(n),e.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=lr(this._updateHashUnthrottled.bind(this),300)}return p(t,[{key:"addTo",value:function(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}},{key:"remove",value:function(){return this._map?(this._map.off("moveend",this._updateHash),e.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}},{key:"getHashString",value:function(){var t=this._map;if(!t)return"";var n=cr(t);if(this._hashName){var i=this._hashName,r=!1,a=e.window.location.hash.slice(1).split("&").map((function(e){var t=e.split("=")[0];return t===i?(r=!0,"".concat(t,"=").concat(n)):e})).filter((function(e){return e}));return r||a.push("".concat(i,"=").concat(n)),"#".concat(a.join("&"))}return"#".concat(n)}},{key:"_getCurrentHash",value:function(){var t,n=this,i=e.window.location.hash.replace("#","");return this._hashName?(i.split("&").map((function(e){return e.split("=")})).forEach((function(e){e[0]===n._hashName&&(t=e)})),(t&&t[1]||"").split("/")):i.split("/")}},{key:"_onHashChange",value:function(){var e=this._map;if(!e)return!1;var t=this._getCurrentHash();if(t.length>=3&&!t.some((function(e){return isNaN(e)}))){var n=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:n,pitch:+(t[4]||0)}),!0}return!1}},{key:"_updateHashUnthrottled",value:function(){var t=e.window.location.href.replace(/(#.+)?$/,this.getHashString());e.window.history.replaceState(e.window.history.state,null,t)}}]),t}();function cr(e,t){var n=e.getCenter(),i=Math.round(100*e.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,r),o=Math.round(n.lng*a)/a,s=Math.round(n.lat*a)/a,l=e.getBearing(),u=e.getPitch(),c=t?"/".concat(o,"/").concat(s,"/").concat(i):"".concat(i,"/").concat(s,"/").concat(o);return(l||u)&&(c+="/"+Math.round(10*l)/10),u&&(c+="/".concat(Math.round(u))),c}var dr={linearity:.3,easing:e.bezier(0,0,.3,1)},hr=e.extend({deceleration:2500,maxSpeed:1400},dr),fr=e.extend({deceleration:20,maxSpeed:1400},dr),pr=e.extend({deceleration:1e3,maxSpeed:360},dr),mr=e.extend({deceleration:1e3,maxSpeed:90},dr),yr=function(){function t(e){f(this,t),this._map=e,this.clear()}return p(t,[{key:"clear",value:function(){this._inertiaBuffer=[]}},{key:"record",value:function(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.exported.now(),settings:t})}},{key:"_drainInertiaBuffer",value:function(){for(var t=this._inertiaBuffer,n=e.exported.now();t.length>0&&n-t[0].time>160;)t.shift()}},{key:"_onMoveEnd",value:function(t){if(!this._map._prefersReducedMotion()&&(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2))){var n,i={zoom:0,bearing:0,pitch:0,pan:new e.Point(0,0),pinchAround:void 0,around:void 0},r=h(this._inertiaBuffer);try{for(r.s();!(n=r.n()).done;){var a=n.value.settings;i.zoom+=a.zoomDelta||0,i.bearing+=a.bearingDelta||0,i.pitch+=a.pitchDelta||0,a.panDelta&&i.pan._add(a.panDelta),a.around&&(i.around=a.around),a.pinchAround&&(i.pinchAround=a.pinchAround)}}catch(p){r.e(p)}finally{r.f()}var o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(i.pan.mag()){var l=vr(i.pan.mag(),o,e.extend({},hr,t||{}));s.offset=i.pan.mult(l.amount/i.pan.mag()),s.center=this._map.transform.center,gr(s,l)}if(i.zoom){var u=vr(i.zoom,o,fr);s.zoom=this._map.transform.zoom+u.amount,gr(s,u)}if(i.bearing){var c=vr(i.bearing,o,pr);s.bearing=this._map.transform.bearing+e.clamp(c.amount,-179,179),gr(s,c)}if(i.pitch){var d=vr(i.pitch,o,mr);s.pitch=this._map.transform.pitch+d.amount,gr(s,d)}if(s.zoom||s.bearing){var f=void 0===i.pinchAround?i.around:i.pinchAround;s.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),s.noMoveStart=!0,s}}}]),t}();function gr(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function vr(t,n,i){var r=i.maxSpeed,a=i.linearity,o=i.deceleration,s=e.clamp(t*a/(n/1e3),-r,r),l=Math.abs(s)/(o*a);return{easing:i.easing,duration:1e3*l,amount:s*(l/2)}}var _r=function(t){m(i,t);var n=y(i);function i(t,r,a){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};f(this,i);var l=L(r.getCanvasContainer(),a),u=r.unproject(l);return(o=n.call(this,t,e.extend({point:l,lngLat:u,originalEvent:a},s)))._defaultPrevented=!1,o.target=r,o}return p(i,[{key:"preventDefault",value:function(){this._defaultPrevented=!0}},{key:"defaultPrevented",get:function(){return this._defaultPrevented}}]),i}(e.Event),xr=function(t){m(i,t);var n=y(i);function i(t,r,a){var o;f(this,i);var s="touchend"===t?a.changedTouches:a.touches,l=M(r.getCanvasContainer(),s),u=l.map((function(e){return r.unproject(e)})),c=l.reduce((function(e,t,n,i){return e.add(t.div(i.length))}),new e.Point(0,0));return(o=n.call(this,t,{points:l,point:c,lngLats:u,lngLat:r.unproject(c),originalEvent:a}))._defaultPrevented=!1,o}return p(i,[{key:"preventDefault",value:function(){this._defaultPrevented=!0}},{key:"defaultPrevented",get:function(){return this._defaultPrevented}}]),i}(e.Event),br=function(e){m(n,e);var t=y(n);function n(e,i,r){var a;return f(this,n),(a=t.call(this,e,{originalEvent:r}))._defaultPrevented=!1,a}return p(n,[{key:"preventDefault",value:function(){this._defaultPrevented=!0}},{key:"defaultPrevented",get:function(){return this._defaultPrevented}}]),n}(e.Event),wr=function(){function t(e,n){f(this,t),this._map=e,this._clickTolerance=n.clickTolerance}return p(t,[{key:"reset",value:function(){this._mousedownPos=void 0}},{key:"wheel",value:function(e){return this._firePreventable(new br(e.type,this._map,e))}},{key:"mousedown",value:function(e,t){return this._mousedownPos=t,this._firePreventable(new _r(e.type,this._map,e))}},{key:"mouseup",value:function(e){this._map.fire(new _r(e.type,this._map,e))}},{key:"preclick",value:function(t){var n=e.extend({},t);n.type="preclick",this._map.fire(new _r(n.type,this._map,n))}},{key:"click",value:function(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new _r(e.type,this._map,e)))}},{key:"dblclick",value:function(e){return this._firePreventable(new _r(e.type,this._map,e))}},{key:"mouseover",value:function(e){this._map.fire(new _r(e.type,this._map,e))}},{key:"mouseout",value:function(e){this._map.fire(new _r(e.type,this._map,e))}},{key:"touchstart",value:function(e){return this._firePreventable(new xr(e.type,this._map,e))}},{key:"touchmove",value:function(e){this._map.fire(new xr(e.type,this._map,e))}},{key:"touchend",value:function(e){this._map.fire(new xr(e.type,this._map,e))}},{key:"touchcancel",value:function(e){this._map.fire(new xr(e.type,this._map,e))}},{key:"_firePreventable",value:function(e){if(this._map.fire(e),e.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){}},{key:"disable",value:function(){}}]),t}(),kr=function(){function e(t){f(this,e),this._map=t}return p(e,[{key:"reset",value:function(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}},{key:"mousemove",value:function(e){this._map.fire(new _r(e.type,this._map,e))}},{key:"mousedown",value:function(){this._delayContextMenu=!0}},{key:"mouseup",value:function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _r("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}},{key:"contextmenu",value:function(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new _r(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){}},{key:"disable",value:function(){}}]),e}(),Tr=function(){function t(e,n){f(this,t),this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}return p(t,[{key:"isEnabled",value:function(){return!!this._enabled}},{key:"isActive",value:function(){return!!this._active}},{key:"enable",value:function(){this.isEnabled()||(this._enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this._enabled=!1)}},{key:"mousedown",value:function(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(k(),this._startPos=this._lastPos=t,this._active=!0)}},{key:"mousemoveWindow",value:function(e,t){var n=this;if(this._active){var i=t,r=this._startPos,a=this._lastPos;if(!(!r||!a||a.equals(i)||!this._box&&i.dist(r)<this._clickTolerance)){this._lastPos=i,this._box||(this._box=v("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));var o=Math.min(r.x,i.x),s=Math.max(r.x,i.x),l=Math.min(r.y,i.y),u=Math.max(r.y,i.y);this._map._requestDomTask((function(){n._box&&(n._box.style.transform="translate(".concat(o,"px,").concat(l,"px)"),n._box.style.width=s-o+"px",n._box.style.height=u-l+"px")}))}}}},{key:"mouseupWindow",value:function(t,n){var i=this;if(this._active){var r=this._startPos,a=n;if(r&&0===t.button){if(this.reset(),S(),r.x!==a.x||r.y!==a.y)return this._map.fire(new e.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:function(e){return e.fitScreenCoordinates(r,a,i._map.getBearing(),{linear:!1})}};this._fireEvent("boxzoomcancel",t)}}}},{key:"keydown",value:function(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}},{key:"blur",value:function(){this.reset()}},{key:"reset",value:function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),T(),delete this._startPos,delete this._lastPos}},{key:"_fireEvent",value:function(t,n){return this._map.fire(new e.Event(t,{originalEvent:n}))}}]),t}();function Er(e,t){for(var n={},i=0;i<e.length;i++)n[e[i].identifier]=t[i];return n}var Sr=function(){function t(e){f(this,t),this.reset(),this.numTouches=e.numTouches}return p(t,[{key:"reset",value:function(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}},{key:"touchstart",value:function(t,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=function(t){var n,i=new e.Point(0,0),r=h(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;i._add(a)}}catch(o){r.e(o)}finally{r.f()}return i.div(t.length)}(n),this.touches=Er(i,n)))}},{key:"touchmove",value:function(e,t,n){if(!this.aborted&&this.centroid){var i=Er(n,t);for(var r in this.touches){var a=i[r];(!a||a.dist(this.touches[r])>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var i=!this.aborted&&this.centroid;if(this.reset(),i)return i}}}]),t}(),Lr=function(){function e(t){f(this,e),this.singleTap=new Sr(t),this.numTaps=t.numTaps,this.reset()}return p(e,[{key:"reset",value:function(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(e,t,n){this.singleTap.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.singleTap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var i=this.singleTap.touchend(e,t,n);if(i){var r=e.timeStamp-this.lastTime<500,a=!this.lastTap||this.lastTap.dist(i)<30;if(r&&a||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}]),e}(),Mr=function(){function e(){f(this,e),this._zoomIn=new Lr({numTouches:1,numTaps:2}),this._zoomOut=new Lr({numTouches:2,numTaps:1}),this.reset()}return p(e,[{key:"reset",value:function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}},{key:"touchstart",value:function(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var i=this,r=this._zoomIn.touchend(e,t,n),a=this._zoomOut.touchend(e,t,n);return r?(this._active=!0,e.preventDefault(),setTimeout((function(){return i.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(r)},{originalEvent:e})}}):a?(this._active=!0,e.preventDefault(),setTimeout((function(){return i.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(a)},{originalEvent:e})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}(),Ar={0:1,2:2},Cr=function(){function e(t){f(this,e),this.reset(),this._clickTolerance=t.clickTolerance||1}return p(e,[{key:"blur",value:function(){this.reset()}},{key:"reset",value:function(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}},{key:"_correctButton",value:function(e,t){return!1}},{key:"_move",value:function(e,t){return{}}},{key:"mousedown",value:function(e,t){if(!this._lastPoint){var n=A(e);this._correctButton(e,n)&&(this._lastPoint=t,this._eventButton=n)}}},{key:"mousemoveWindow",value:function(e,t){var n=this._lastPoint;if(n)if(e.preventDefault(),null!=this._eventButton&&function(e,t){var n=Ar[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(n,t)}},{key:"mouseupWindow",value:function(e){this._lastPoint&&A(e)===this._eventButton&&(this._moved&&S(),this.reset())}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}(),Ir=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"mousedown",value:function(e,t){o(s(n.prototype),"mousedown",this).call(this,e,t),this._lastPoint&&(this._active=!0)}},{key:"_correctButton",value:function(e,t){return 0===t&&!e.ctrlKey}},{key:"_move",value:function(e,t){return{around:t,panDelta:t.sub(e)}}}]),n}(Cr),Pr=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"_move",value:function(e,t){var n=.8*(t.x-e.x);if(n)return this._active=!0,{bearingDelta:n}}},{key:"contextmenu",value:function(e){e.preventDefault()}}]),n}(Cr),zr=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"_move",value:function(e,t){var n=-.5*(t.y-e.y);if(n)return this._active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(e){e.preventDefault()}}]),n}(Cr),Dr=function(){function t(n,i){f(this,t),this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),e.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}return p(t,[{key:"reset",value:function(){this._active=!1,this._touches={},this._sum=new e.Point(0,0)}},{key:"touchstart",value:function(e,t,n){return this._calculateTransform(e,t,n)}},{key:"touchmove",value:function(t,n,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length&&!e.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,i)}}},{key:"touchend",value:function(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"_calculateTransform",value:function(t,n,i){i.length>0&&(this._active=!0);var r=Er(i,n),a=new e.Point(0,0),o=new e.Point(0,0),s=0;for(var l in r){var u=r[l],c=this._touches[l];c&&(a._add(u),o._add(u.sub(c)),s++,r[l]=u)}if(this._touches=r,!(s<this._minTouches)&&o.mag()){var d=o.div(s);return this._sum._add(d),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(s),panDelta:d}}}},{key:"enable",value:function(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}},{key:"disable",value:function(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}},{key:"isEnabled",value:function(){return!!this._enabled}},{key:"isActive",value:function(){return!!this._active}},{key:"_addTouchPanBlocker",value:function(){this._map&&!this._alertContainer&&(this._alertContainer=v("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}},{key:"_showTouchPanBlockerAlert",value:function(){var e=this;this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((function(){e._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),e._alertContainer.setAttribute("role","null")}),500)}}]),t}(),Rr=function(){function e(){f(this,e),this.reset()}return p(e,[{key:"reset",value:function(){this._active=!1,this._firstTwoTouches=void 0}},{key:"_start",value:function(e){}},{key:"_move",value:function(e,t,n){return{}}},{key:"touchstart",value:function(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}},{key:"touchmove",value:function(e,t,n){var i=this._firstTwoTouches;if(i){e.preventDefault();var r=d(i,2),a=r[0],o=r[1],s=Br(n,t,a),l=Br(n,t,o);if(s&&l){var u=this._aroundCenter?null:s.add(l).div(2);return this._move([s,l],u,e)}}}},{key:"touchend",value:function(e,t,n){if(this._firstTwoTouches){var i=d(this._firstTwoTouches,2),r=i[0],a=i[1],o=Br(n,t,r),s=Br(n,t,a);o&&s||(this._active&&S(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}();function Br(e,t,n){for(var i=0;i<e.length;i++)if(e[i].identifier===n)return t[i]}function Fr(e,t){return Math.log(e/t)/Math.LN2}var Or=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"reset",value:function(){o(s(n.prototype),"reset",this).call(this),this._distance=0,this._startDistance=0}},{key:"_start",value:function(e){this._startDistance=this._distance=e[0].dist(e[1])}},{key:"_move",value:function(e,t){var n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Fr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Fr(this._distance,n),pinchAround:t}}}]),n}(Rr);function Nr(e,t){return 180*e.angleWith(t)/Math.PI}var Hr=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"reset",value:function(){o(s(n.prototype),"reset",this).call(this),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}},{key:"_start",value:function(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}},{key:"_move",value:function(e,t){var n=this._vector;if(this._vector=e[0].sub(e[1]),n&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Nr(this._vector,n),pinchAround:t}}},{key:"_isBelowThreshold",value:function(e){this._minDiameter=Math.min(this._minDiameter,e.mag());var t=25/(Math.PI*this._minDiameter)*360,n=this._startVector;if(!n)return!1;var i=Nr(e,n);return Math.abs(i)<t}}]),n}(Rr);function Ur(e){return Math.abs(e.y)>Math.abs(e.x)}var jr=function(t){m(i,t);var n=y(i);function i(e){var t;return f(this,i),(t=n.call(this))._map=e,t}return p(i,[{key:"reset",value:function(){o(s(i.prototype),"reset",this).call(this),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}},{key:"_start",value:function(e){this._lastPoints=e,Ur(e[0].sub(e[1]))&&(this._valid=!1)}},{key:"_move",value:function(t,n,i){var r=this._lastPoints;if(r){var a=t[0].sub(r[0]),o=t[1].sub(r[1]);return this._map._cooperativeGestures&&!e.isFullscreen()&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(a,o,i.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(a.y+o.y)/2*-.5})}}},{key:"gestureBeginsVertically",value:function(e,t,n){if(void 0!==this._valid)return this._valid;var i=e.mag()>=2,r=t.mag()>=2;if(i||r){if(!i||!r)return null==this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;var a=e.y>0==t.y>0;return Ur(e)&&Ur(t)&&a}}}]),i}(Rr),Vr={panStep:100,bearingStep:15,pitchStep:10},Wr=function(){function e(){f(this,e);var t=Vr;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}return p(e,[{key:"blur",value:function(){this.reset()}},{key:"reset",value:function(){this._active=!1}},{key:"keydown",value:function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=0,i=0,r=0,a=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),a=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),a=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:function(s){var l=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Gr,zoom:n?Math.round(l)+n*(e.shiftKey?2:1):l,bearing:s.getBearing()+i*t._bearingStep,pitch:s.getPitch()+r*t._pitchStep,offset:[-a*t._panStep,-o*t._panStep],center:s.getCenter()},{originalEvent:e})}}}}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}},{key:"disableRotation",value:function(){this._rotationDisabled=!0}},{key:"enableRotation",value:function(){this._rotationDisabled=!1}}]),e}();function Gr(e){return e*(2-e)}var qr=4.000244140625,Zr=function(){function t(n,i){f(this,t),this._map=n,this._el=n.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,e.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}return p(t,[{key:"setZoomRate",value:function(e){this._defaultZoomRate=e}},{key:"setWheelZoomRate",value:function(e){this._wheelZoomRate=e}},{key:"isEnabled",value:function(){return!!this._enabled}},{key:"isActive",value:function(){return this._active||void 0!==this._finishTimeout}},{key:"isZooming",value:function(){return!!this._zooming}},{key:"enable",value:function(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}},{key:"disable",value:function(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}},{key:"wheel",value:function(t){if(this.isEnabled()){if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}var n=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,i=e.exported.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%qr==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}}},{key:"_onTimeout",value:function(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}},{key:"_start",value:function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var t=L(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}}},{key:"renderFrame",value:function(){var t=this;if(this._frameId&&(this._frameId=null,this.isActive())){var n=this._map.transform;"wheel"===this._type&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);var i=function(){return n._terrainEnabled()&&t._aroundCoord?n.computeZoomRelativeTo(t._aroundCoord):n.zoom};if(0!==this._delta){var r="wheel"===this._type&&Math.abs(this._delta)>qr?this._wheelZoomRate:this._defaultZoomRate,a=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&0!==a&&(a=1/a);var o=i(),s=Math.pow(2,o),l="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):s;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(l*a))),"wheel"===this._type&&(this._startZoom=o,this._easing=this._smoothOutEasing(200)),this._delta=0}var u,c="number"==typeof this._targetZoom?this._targetZoom:i(),d=this._startZoom,h=this._easing,f=!1;if("wheel"===this._type&&d&&h){var p=Math.min((e.exported.now()-this._lastWheelEventTime)/200,1),m=h(p);u=e.number(d,c,m),p<1?this._frameId||(this._frameId=!0):f=!0}else u=c,f=!0;return this._active=!0,f&&(this._active=!1,this._finishTimeout=setTimeout((function(){t._zooming=!1,t._handler._triggerRenderFrame(),delete t._targetZoom,delete t._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!f,zoomDelta:u-i(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}}},{key:"_smoothOutEasing",value:function(t){var n=e.ease;if(this._prevEase){var i=this._prevEase,r=(e.exported.now()-i.start)/i.duration,a=i.easing(r+.01)-i.easing(r),o=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.0729-o*o);n=e.bezier(o,s,.25,1)}return this._prevEase={start:e.exported.now(),duration:t,easing:n},n}},{key:"blur",value:function(){this.reset()}},{key:"reset",value:function(){this._active=!1}},{key:"_addScrollZoomBlocker",value:function(){this._map&&!this._alertContainer&&(this._alertContainer=v("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(e.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}},{key:"_showBlockerAlert",value:function(){var e=this;this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((function(){e._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),e._alertContainer.setAttribute("role","null")}),200)}}]),t}(),Xr=function(){function e(t,n){f(this,e),this._clickZoom=t,this._tapZoom=n}return p(e,[{key:"enable",value:function(){this._clickZoom.enable(),this._tapZoom.enable()}},{key:"disable",value:function(){this._clickZoom.disable(),this._tapZoom.disable()}},{key:"isEnabled",value:function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}},{key:"isActive",value:function(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}]),e}(),Kr=function(){function e(){f(this,e),this.reset()}return p(e,[{key:"reset",value:function(){this._active=!1}},{key:"blur",value:function(){this.reset()}},{key:"dblclick",value:function(e,t){return e.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}(),Yr=function(){function e(){f(this,e),this._tap=new Lr({numTouches:1,numTaps:1}),this.reset()}return p(e,[{key:"reset",value:function(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}},{key:"touchstart",value:function(e,t,n){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=t[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(e,t,n))}},{key:"touchmove",value:function(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;var i=t[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(e,t,n)&&(this._tapTime=e.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}(),Jr=function(){function e(t,n,i){f(this,e),this._el=t,this._mousePan=n,this._touchPan=i}return p(e,[{key:"enable",value:function(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}},{key:"disable",value:function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}},{key:"isEnabled",value:function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}},{key:"isActive",value:function(){return this._mousePan.isActive()||this._touchPan.isActive()}}]),e}(),$r=function(){function e(t,n,i){f(this,e),this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=i}return p(e,[{key:"enable",value:function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}},{key:"disable",value:function(){this._mouseRotate.disable(),this._mousePitch.disable()}},{key:"isEnabled",value:function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}},{key:"isActive",value:function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}]),e}(),Qr=function(){function e(t,n,i,r){f(this,e),this._el=t,this._touchZoom=n,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}return p(e,[{key:"enable",value:function(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}},{key:"disable",value:function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this._rotationDisabled=!0,this._touchRotate.disable()}},{key:"enableRotation",value:function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}]),e}(),ea=function(e){return e.zoom||e.drag||e.pitch||e.rotate},ta=function(e){m(n,e);var t=y(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n)}(e.Event),na=function(){function t(){f(this,t),this.constants=[1,1,.01],this.radius=0}return p(t,[{key:"setup",value:function(t,n){var i=e.sub([],n,t);this.radius=e.length(i[2]<0?e.div([],i,this.constants):[i[0],i[1],0])}},{key:"projectRay",value:function(t){e.div(t,t,this.constants),e.normalize(t,t),e.mul$1(t,t,this.constants);var n=e.scale$2([],t,this.radius);if(n[2]>0){var i=e.scale$2([],[0,0,1],e.dot(n,[0,0,1])),r=e.scale$2([],e.normalize([],[n[0],n[1],0]),this.radius),a=e.add([],n,e.scale$2([],e.sub([],e.add([],r,i),n),2));n[0]=a[0],n[1]=a[1]}return n}}]),t}();function ia(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var ra=function(){function t(n,i){f(this,t),this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yr(n),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new na,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),e.bindAll(["handleEvent","handleWindowEvent"],this);var r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[e.window.document,"mousemove",{capture:!0}],[e.window.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[e.window,"blur",void 0]];var a,o=h(this._listeners);try{for(o.s();!(a=o.n()).done;){var s=d(a.value,3),l=s[0],u=s[1],c=s[2];l.addEventListener(u,l===e.window.document?this.handleWindowEvent:this.handleEvent,c)}}catch(p){o.e(p)}finally{o.f()}}return p(t,[{key:"destroy",value:function(){var t,n=h(this._listeners);try{for(n.s();!(t=n.n()).done;){var i=d(t.value,3),r=i[0],a=i[1],o=i[2];r.removeEventListener(a,r===e.window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(s){n.e(s)}finally{n.f()}}},{key:"_addDefaultHandlers",value:function(e){var t=this._map,n=t.getCanvasContainer();this._add("mapEvent",new wr(t,e));var i=t.boxZoom=new Tr(t,e);this._add("boxZoom",i);var r=new Mr,a=new Kr;t.doubleClickZoom=new Xr(a,r),this._add("tapZoom",r),this._add("clickZoom",a);var o=new Yr;this._add("tapDragZoom",o);var s=t.touchPitch=new jr(t);this._add("touchPitch",s);var l=new Pr(e),u=new zr(e);t.dragRotate=new $r(e,l,u),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",u,["mouseRotate"]);var c=new Ir(e),d=new Dr(t,e);t.dragPan=new Jr(n,c,d),this._add("mousePan",c),this._add("touchPan",d,["touchZoom","touchRotate"]);var h=new Hr,f=new Or;t.touchZoomRotate=new Qr(n,f,h,o),this._add("touchRotate",h,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]),this._add("blockableMapEvent",new kr(t));var p=t.scrollZoom=new Zr(t,this);this._add("scrollZoom",p,["mousePan"]);var m=t.keyboard=new Wr;this._add("keyboard",m);for(var y=0,g=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];y<g.length;y++){var v=g[y];e.interactive&&e[v]&&t[v].enable(e[v])}}},{key:"_add",value:function(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}},{key:"stop",value:function(e){if(!this._updatingCamera){var t,n=h(this._handlers);try{for(n.s();!(t=n.n()).done;)t.value.handler.reset()}catch(i){n.e(i)}finally{n.f()}this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}},{key:"isActive",value:function(){var e,t=h(this._handlers);try{for(t.s();!(e=t.n()).done;)if(e.value.handler.isActive())return!0}catch(n){t.e(n)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this._eventsInProgress.rotate}},{key:"isMoving",value:function(){return!!ea(this._eventsInProgress)||this.isZooming()}},{key:"_isDragging",value:function(){return!!this._eventsInProgress.drag}},{key:"_blockedByActive",value:function(e,t,n){for(var i in e)if(i!==n&&(!t||t.indexOf(i)<0))return!0;return!1}},{key:"handleWindowEvent",value:function(e){this.handleEvent(e,"".concat(e.type,"Window"))}},{key:"_getMapTouches",value:function(e){var t,n=[],i=h(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._el.contains(r.target)&&n.push(r)}}catch(a){i.e(a)}finally{i.f()}return n}},{key:"handleEvent",value:function(e,t){this._updatingCamera=!0;var n,i="renderFrame"===e.type,r=i?void 0:e,a={needsRenderFrame:!1},o={},s={},l=e.touches?this._getMapTouches(e.touches):void 0,u=l?M(this._el,l):i?void 0:L(this._el,e),c=h(this._handlers);try{for(c.s();!(n=c.n()).done;){var d=n.value,f=d.handlerName,p=d.handler,m=d.allowed;if(p.isEnabled()){var y=void 0;this._blockedByActive(s,m,f)?p.reset():p[t||e.type]&&(y=p[t||e.type](e,u,l),this.mergeHandlerResult(a,o,y,f,r),y&&y.needsRenderFrame&&this._triggerRenderFrame()),(y||p.isActive())&&(s[f]=p)}}}catch(x){c.e(x)}finally{c.f()}var g={};for(var v in this._previousActiveHandlers)s[v]||(g[v]=r);this._previousActiveHandlers=s,(Object.keys(g).length||ia(a))&&(this._changes.push([a,o,g]),this._triggerRenderFrame()),(Object.keys(s).length||ia(a))&&this._map._stop(!0),this._updatingCamera=!1;var _=a.cameraAnimation;_&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],_(this._map))}},{key:"mergeHandlerResult",value:function(t,n,i,r,a){if(i){e.extend(t,i);var o={handlerName:r,originalEvent:i.originalEvent||a};void 0!==i.zoomDelta&&(n.zoom=o),void 0!==i.panDelta&&(n.drag=o),void 0!==i.pitchDelta&&(n.pitch=o),void 0!==i.bearingDelta&&(n.rotate=o)}}},{key:"_applyChanges",value:function(){var t,n={},i={},r={},a=h(this._changes);try{for(a.s();!(t=a.n()).done;){var o=d(t.value,3),s=o[0],l=o[1],u=o[2];s.panDelta&&(n.panDelta=(n.panDelta||new e.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(n.around=s.around),void 0!==s.aroundCoord&&(n.aroundCoord=s.aroundCoord),void 0!==s.pinchAround&&(n.pinchAround=s.pinchAround),s.noInertia&&(n.noInertia=s.noInertia),e.extend(i,l),e.extend(r,u)}}catch(c){a.e(c)}finally{a.f()}this._updateMapTransform(n,i,r),this._changes=[]}},{key:"_updateMapTransform",value:function(t,n,i){var r=this,a=this._map,o=a.transform,s=function(e){return[e.x,e.y,e.z]};if(function(e){var t=r._eventsInProgress.drag;return t&&!r._handlersById[t.handlerName].isActive()}()&&!ia(t)){var l=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",l!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&a._stop(!0),ia(t)){var u=t.panDelta,c=t.zoomDelta,d=t.bearingDelta,h=t.pitchDelta,f=t.around,p=t.aroundCoord,m=t.pinchAround;o._isCameraConstrained&&(c>0&&(c=0),o._isCameraConstrained=!1),void 0!==m&&(f=m),(c||function(e){return n[e]&&!r._eventsInProgress[e]}("drag"))&&f&&(this._dragOrigin=s(o.pointCoordinate3D(f)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",a._stop(!0),f=f||a.transform.centerPoint,d&&(o.bearing+=d),h&&(o.pitch+=h),o._updateCameraState();var y=[0,0,0];if(u)if("mercator"===o.projection.name){var g=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(f).dir),v=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(f.sub(u)).dir);y[0]=v[0]-g[0],y[1]=v[1]-g[1]}else{var _=o.pointCoordinate(f);if("globe"===o.projection.name){u=u.rotate(-o.angle);var x=o._pixelsPerMercatorPixel/o.worldSize;y[0]=-u.x*e.mercatorScale(e.latFromMercatorY(_.y))*x,y[1]=-u.y*e.mercatorScale(o.center.lat)*x}else{var b=o.pointCoordinate(f.sub(u));_&&b&&(y[0]=b.x-_.x,y[1]=b.y-_.y)}}var w=o.zoom,k=[0,0,0];if(c){var T=s(p||o.pointCoordinate3D(f)),E={dir:e.normalize([],e.sub([],T,o._camera.position))};if(E.dir[2]<0){var S=o.zoomDeltaToMovement(T,c);e.scale$2(k,E.dir,S)}}var L=e.add(y,y,k);o._translateCameraConstrained(L),c&&Math.abs(o.zoom-w)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,i,!0)}else this._fireEvents(n,i,!0)}},{key:"_fireEvents",value:function(t,n,i){var r=this,a=ea(this._eventsInProgress),o=ea(t),s={};for(var l in t){var u=t[l].originalEvent;this._eventsInProgress[l]||(s["".concat(l,"start")]=u),this._eventsInProgress[l]=t[l]}for(var c in!a&&o&&this._fireEvent("movestart",o.originalEvent),s)this._fireEvent(c,s[c]);for(var d in o&&this._fireEvent("move",o.originalEvent),t){var h=t[d].originalEvent;this._fireEvent(d,h)}var f,p={};for(var m in this._eventsInProgress){var y=this._eventsInProgress[m],g=y.handlerName,v=y.originalEvent;this._handlersById[g].isActive()||(delete this._eventsInProgress[m],f=n[g]||v,p["".concat(m,"end")]=f)}for(var _ in p)this._fireEvent(_,p[_]);var x=ea(this._eventsInProgress);if(i&&(a||o)&&!x){this._updatingCamera=!0;var b=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),w=function(e){return 0!==e&&-r._bearingSnap<e&&e<r._bearingSnap};b?(w(b.bearing||this._map.getBearing())&&(b.bearing=0),this._map.easeTo(b,{originalEvent:f})):(this._map.fire(new e.Event("moveend",{originalEvent:f})),w(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}},{key:"_fireEvent",value:function(t,n){this._map.fire(new e.Event(t,n?{originalEvent:n}:{}))}},{key:"_requestFrame",value:function(){var e=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(t){e._frameId=void 0,e.handleEvent(new ta("renderFrame",{timeStamp:t})),e._applyChanges()}))}},{key:"_triggerRenderFrame",value:function(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}]),t}(),aa="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.",oa=function(t){m(i,t);var n=y(i);function i(t,a){var o;return f(this,i),(o=n.call(this))._moving=!1,o._zooming=!1,o.transform=t,o._bearingSnap=a.bearingSnap,o._respectPrefersReducedMotion=!1!==a.respectPrefersReducedMotion,e.bindAll(["_renderFrameCallback"],r(o)),o}return p(i,[{key:"getCenter",value:function(){return new e.LngLat(this.transform.center.lng,this.transform.center.lat)}},{key:"setCenter",value:function(e,t){return this.jumpTo({center:e},t)}},{key:"panBy",value:function(t,n,i){return t=e.Point.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},n),i)}},{key:"panTo",value:function(t,n,i){return this.easeTo(e.extend({center:t},n),i)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"setZoom",value:function(e,t){return this.jumpTo({zoom:e},t),this}},{key:"zoomTo",value:function(t,n,i){return this.easeTo(e.extend({zoom:t},n),i)}},{key:"zoomIn",value:function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}},{key:"zoomOut",value:function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"setBearing",value:function(e,t){return this.jumpTo({bearing:e},t),this}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(e,t){return this.jumpTo({padding:e},t),this}},{key:"rotateTo",value:function(t,n,i){return this.easeTo(e.extend({bearing:t},n),i)}},{key:"resetNorth",value:function(t,n){return this.rotateTo(0,e.extend({duration:1e3},t),n),this}},{key:"resetNorthPitch",value:function(t,n){return this.easeTo(e.extend({bearing:0,pitch:0,duration:1e3},t),n),this}},{key:"snapToNorth",value:function(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setPitch",value:function(e,t){return this.jumpTo({pitch:e},t),this}},{key:"cameraForBounds",value:function(t,n){t=e.LngLatBounds.convert(t);var i=n&&n.bearing||0,r=n&&n.pitch||0,a=t.getNorthWest(),o=t.getSouthEast();return this._cameraForBounds(this.transform,a,o,i,r,n)}},{key:"_extendCameraOptions",value:function(t){var n={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=e.extend({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){var i=t.padding;t.padding={top:i,bottom:i,right:i,left:i}}return t.padding=e.extend(n,t.padding),t}},{key:"_minimumAABBFrustumDistance",value:function(e,t){var n=t.max[0]-t.min[0],i=t.max[1]-t.min[1];return n/i>e.aspect?n/(2*Math.tan(.5*e.fovX)*e.aspect):i/(2*Math.tan(.5*e.fovY)*e.aspect)}},{key:"_cameraForBoundsOnGlobe",value:function(t,n,i,r,a,o){var s=t.clone(),l=this._extendCameraOptions(o);s.bearing=r,s.pitch=a;var u=e.LngLat.convert(n),c=e.LngLat.convert(i),d=.5*(u.lat+c.lat),h=.5*(u.lng+c.lng),f=e.latLngToECEF(d,h),p=e.normalize([],f),m=e.normalize([],e.cross([],p,[0,1,0])),y=e.cross([],m,p),g=[m[0],m[1],m[2],0,y[0],y[1],y[2],0,p[0],p[1],p[2],0,0,0,0,1],v=[f,e.latLngToECEF(u.lat,u.lng),e.latLngToECEF(c.lat,u.lng),e.latLngToECEF(c.lat,c.lng),e.latLngToECEF(u.lat,c.lng),e.latLngToECEF(d,u.lng),e.latLngToECEF(d,c.lng),e.latLngToECEF(u.lat,h),e.latLngToECEF(c.lat,h)],_=e.Aabb.fromPoints(v.map((function(t){return[e.dot(m,t),e.dot(y,t),e.dot(p,t)]}))),x=e.transformMat4([],_.center,g);0===e.squaredLength(x)&&e.set(x,0,0,1),e.normalize(x,x),e.scale$2(x,x,e.GLOBE_RADIUS),s.center=e.ecefToLatLng(x);var b=s.getWorldToCameraMatrix(),w=e.invert(new Float64Array(16),b);_=e.Aabb.applyTransform(_,e.multiply([],b,g)),e.transformMat4(x,x,b);var k=.5*(_.max[2]-_.min[2]),T=this._minimumAABBFrustumDistance(s,_),E=e.scale$2([],[0,0,1],k),S=e.add(E,x,E),L=T+(0===s.pitch?0:e.distance(x,S)),M=s.globeCenterInViewSpace,A=e.sub([],x,[M[0],M[1],M[2]]);e.normalize(A,A),e.scale$2(A,A,L);var C=e.add([],x,A);e.transformMat4(C,C,w);var I=e.earthRadius/e.GLOBE_RADIUS,P=e.length(C),z=e.mercatorZfromAltitude(Math.max(P*I-e.earthRadius,Number.EPSILON),0),D=Math.min(s.zoomFromMercatorZAdjusted(z),l.maxZoom);return D>.5*(e.GLOBE_ZOOM_THRESHOLD_MIN+e.GLOBE_ZOOM_THRESHOLD_MAX)?(s.setProjection({name:"mercator"}),s.zoom=D,this._cameraForBounds(s,n,i,r,a,o)):{center:s.center,zoom:D,bearing:r,pitch:a}}},{key:"queryTerrainElevation",value:function(t,n){var i=this.transform.elevation;return i?(n=e.extend({},{exaggerated:!0},n),i.getAtPoint(e.MercatorCoordinate.fromLngLat(t),null,n.exaggerated)):null}},{key:"_cameraForBounds",value:function(t,n,i,r,a,o){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,n,i,r,a,o);var s=t.clone(),l=this._extendCameraOptions(o),u=s.padding;s.bearing=r,s.pitch=a;var c=e.LngLat.convert(n),d=e.LngLat.convert(i),h=new e.LngLat(c.lng,d.lat),f=new e.LngLat(d.lng,c.lat),p=s.project(c),m=s.project(d),y=this.queryTerrainElevation(c),g=this.queryTerrainElevation(d),v=this.queryTerrainElevation(h),_=this.queryTerrainElevation(f),x=[[p.x,p.y,Math.min(y||0,g||0,v||0,_||0)],[m.x,m.y,Math.max(y||0,g||0,v||0,_||0)]],b=e.Aabb.fromPoints(x),w=s.getWorldToCameraMatrix(),k=e.invert(new Float64Array(16),w);b=e.Aabb.applyTransform(b,w);var T=e.sub([],b.max,b.min),E=u.left||0,S=u.right||0,L=u.bottom||0,M=u.top||0,A=l.padding,C=A.left,I=A.right,P=A.top,z=A.bottom,D=.5*(E+S),R=.5*(M+L),B=Math.min(s.scaleZoom(s.scale*Math.min((s.width-(E+S+C+I))/T[0],(s.height-(L+M+z+P))/T[1])),l.maxZoom),F=s.scale/s.zoomScale(B);b=new e.Aabb([b.min[0]-(C+D)*F,b.min[1]-(z+R)*F,b.min[2]],[b.max[0]+(I+D)*F,b.max[1]+(P+R)*F,b.max[2]]);var O=.5*T[2],N=this._minimumAABBFrustumDistance(s,b),H=[0,0,1,0];e.transformMat4$1(H,H,w),e.normalize$2(H,H);var U=e.scale$2([],H,N+O),j=e.add([],b.center,U),V=("number"==typeof l.offset.x&&"number"==typeof l.offset.y?new e.Point(l.offset.x,l.offset.y):e.Point.convert(l.offset)).rotate(-e.degToRad(r));b.center[0]-=V.x*F,b.center[1]+=V.y*F,e.transformMat4(b.center,b.center,k),e.transformMat4(j,j,k);var W=[b.center[0],b.center[1],j[2]*s.pixelsPerMeter];e.scale$2(W,W,1/s.worldSize);var G=e.lngFromMercatorX(W[0]),q=e.latFromMercatorY(W[1]),Z=Math.min(s._zoomFromMercatorZ(W[2]),l.maxZoom),X=new e.LngLat(G,q);return s.mercatorFromTransition&&Z<.5*(e.GLOBE_ZOOM_THRESHOLD_MIN+e.GLOBE_ZOOM_THRESHOLD_MAX)?(s.setProjection({name:"globe"}),s.zoom=Z,this._cameraForBounds(s,n,i,r,a,o)):{center:X,zoom:Z,bearing:r,pitch:a}}},{key:"fitBounds",value:function(e,t,n){var i=this.cameraForBounds(e,t);return this._fitInternal(i,t,n)}},{key:"fitScreenCoordinates",value:function(t,n,i,r,a){var o=e.Point.convert(t),s=e.Point.convert(n),l=new e.Point(Math.min(o.x,s.x),Math.min(o.y,s.y)),u=new e.Point(Math.max(o.x,s.x),Math.max(o.y,s.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(o,s))return this;var c=this.transform.pointLocation3D(l),d=this.transform.pointLocation3D(u),h=this.transform.pointLocation3D(new e.Point(l.x,u.y)),f=this.transform.pointLocation3D(new e.Point(u.x,l.y)),p=[Math.min(c.lng,d.lng,h.lng,f.lng),Math.min(c.lat,d.lat,h.lat,f.lat)],m=[Math.max(c.lng,d.lng,h.lng,f.lng),Math.max(c.lat,d.lat,h.lat,f.lat)],y=r&&r.pitch?r.pitch:this.getPitch(),g=this._cameraForBounds(this.transform,p,m,i,y,r);return this._fitInternal(g,r,a)}},{key:"_fitInternal",value:function(t,n,i){return t?(delete(n=e.extend(t,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}},{key:"jumpTo",value:function(t,n){this.stop();var i=t.preloadOnly?this.transform.clone():this.transform,r=!1,a=!1,o=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(r=!0,i.zoom=+t.zoom),void 0!==t.center&&(i.center=e.LngLat.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(a=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(o=!0,i.pitch=+t.pitch),null==t.padding||i.isPaddingEqual(t.padding)||(i.padding=t.padding),t.preloadOnly?(this._preloadTiles(i),this):(this.fire(new e.Event("movestart",n)).fire(new e.Event("move",n)),r&&this.fire(new e.Event("zoomstart",n)).fire(new e.Event("zoom",n)).fire(new e.Event("zoomend",n)),a&&this.fire(new e.Event("rotatestart",n)).fire(new e.Event("rotate",n)).fire(new e.Event("rotateend",n)),o&&this.fire(new e.Event("pitchstart",n)).fire(new e.Event("pitch",n)).fire(new e.Event("pitchend",n)),this.fire(new e.Event("moveend",n)))}},{key:"getFreeCameraOptions",value:function(){return this.transform.projection.supportsFreeCamera||e.warnOnce(aa),this.transform.getFreeCameraOptions()}},{key:"setFreeCameraOptions",value:function(t,n){var i=this.transform;if(!i.projection.supportsFreeCamera)return e.warnOnce(aa),this;this.stop();var r=i.zoom,a=i.pitch,o=i.bearing;i.setFreeCameraOptions(t);var s=r!==i.zoom,l=a!==i.pitch,u=o!==i.bearing;return this.fire(new e.Event("movestart",n)).fire(new e.Event("move",n)),s&&this.fire(new e.Event("zoomstart",n)).fire(new e.Event("zoom",n)).fire(new e.Event("zoomend",n)),u&&this.fire(new e.Event("rotatestart",n)).fire(new e.Event("rotate",n)).fire(new e.Event("rotateend",n)),l&&this.fire(new e.Event("pitchstart",n)).fire(new e.Event("pitch",n)).fire(new e.Event("pitchend",n)),this.fire(new e.Event("moveend",n)),this}},{key:"easeTo",value:function(t,n){var i=this;this._stop(!1,t.easeId),(!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);var r,a,o,s=this.transform,l=this.getZoom(),u=this.getBearing(),c=this.getPitch(),d=this.getPadding(),h="zoom"in t?+t.zoom:l,f="bearing"in t?this._normalizeBearing(t.bearing,u):u,p="pitch"in t?+t.pitch:c,m="padding"in t?t.padding:s.padding,y=e.Point.convert(t.offset);if("globe"===s.projection.name){var g=e.MercatorCoordinate.fromLngLat(s.center),v=y.rotate(-s.angle);g.x+=v.x/s.worldSize,g.y+=v.y/s.worldSize;var _=g.toLngLat(),x=e.LngLat.convert(t.center||_);this._normalizeCenter(x),r=s.centerPoint.add(v),a=new e.Point(g.x,g.y).mult(s.worldSize),o=new e.Point(e.mercatorXfromLng(x.lng),e.mercatorYfromLat(x.lat)).mult(s.worldSize).sub(a)}else{r=s.centerPoint.add(y);var b=s.pointLocation(r),w=e.LngLat.convert(t.center||b);this._normalizeCenter(w),a=s.project(b),o=s.project(w).sub(a)}var k,T,E=s.zoomScale(h-l);t.around&&(k=e.LngLat.convert(t.around),T=s.locationPoint(k));var S=this._zooming||h!==l,L=this._rotating||u!==f,M=this._pitching||p!==c,A=!s.isPaddingEqual(m),C=function(s){return function(g){if(S&&(s.zoom=e.number(l,h,g)),L&&(s.bearing=e.number(u,f,g)),M&&(s.pitch=e.number(c,p,g)),A&&(s.interpolatePadding(d,m,g),r=s.centerPoint.add(y)),k)s.setLocationAtPoint(k,T);else{var v=s.zoomScale(s.zoom-l),_=h>l?Math.min(2,E):Math.max(.5,E),x=Math.pow(_,1-g),b=s.unproject(a.add(o.mult(g*x)).mult(v));s.setLocationAtPoint(s.renderWorldCopies?b.wrap():b,r)}return t.preloadOnly||i._fireMoveEvents(n),s}};if(t.preloadOnly){var I=this._emulate(C,t.duration,s);return this._preloadTiles(I),this}var P={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=S,this._rotating=L,this._pitching=M,this._padding=A,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,P),this._ease(C(s),(function(e){s.recenterOnTerrain(),i._afterEase(n,e)}),t),this}},{key:"_prepareEase",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",n||i.moving||this.fire(new e.Event("movestart",t)),this._zooming&&!i.zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new e.Event("pitchstart",t))}},{key:"_fireMoveEvents",value:function(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t))}},{key:"_afterEase",value:function(t,n){if(!this._easeId||!n||this._easeId!==n){this._easeId=void 0,this.transform.cameraElevationReference="ground";var i=this._zooming,r=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new e.Event("zoomend",t)),r&&this.fire(new e.Event("rotateend",t)),a&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t))}}},{key:"flyTo",value:function(t,n){var i=this;if(this._prefersReducedMotion(t)){var r=e.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);var a=this.transform,o=this.getZoom(),s=this.getBearing(),l=this.getPitch(),u=this.getPadding(),c="zoom"in t?e.clamp(+t.zoom,a.minZoom,a.maxZoom):o,d="bearing"in t?this._normalizeBearing(t.bearing,s):s,h="pitch"in t?+t.pitch:l,f="padding"in t?t.padding:a.padding,p=a.zoomScale(c-o),m=e.Point.convert(t.offset),y=a.centerPoint.add(m),g=a.pointLocation(y),v=e.LngLat.convert(t.center||g);this._normalizeCenter(v);var _=a.project(g),x=a.project(v).sub(_),b=t.curve,w=Math.max(a.width,a.height),k=w/p,T=x.mag();if("minZoom"in t){var E=e.clamp(Math.min(t.minZoom,o,c),a.minZoom,a.maxZoom),S=w/a.zoomScale(E-o);b=Math.sqrt(S/T*2)}var L=b*b;function M(e){var t=(k*k-w*w+(e?-1:1)*L*L*T*T)/(2*(e?k:w)*L*T);return Math.log(Math.sqrt(t*t+1)-t)}function A(e){return(Math.exp(e)-Math.exp(-e))/2}function C(e){return(Math.exp(e)+Math.exp(-e))/2}var I=M(0),P=function(e){return C(I)/C(I+b*e)},z=function(e){return w*((C(I)*(A(t=I+b*e)/C(t))-A(I))/L)/T;var t},D=(M(1)-I)/b;if(Math.abs(T)<1e-6||!isFinite(D)){if(Math.abs(w-k)<1e-6)return this.easeTo(t,n);var R=k<w?-1:1;D=Math.abs(Math.log(k/w))/b,z=function(){return 0},P=function(e){return Math.exp(R*b*e)}}t.duration="duration"in t?+t.duration:1e3*D/("screenSpeed"in t?+t.screenSpeed/b:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);var B=s!==d,F=h!==l,O=!a.isPaddingEqual(f),N=function(r){return function(a){var p=a*D,g=1/P(p);r.zoom=1===a?c:o+r.scaleZoom(g),B&&(r.bearing=e.number(s,d,a)),F&&(r.pitch=e.number(l,h,a)),O&&(r.interpolatePadding(u,f,a),y=r.centerPoint.add(m));var b=1===a?v:r.unproject(_.add(x.mult(z(p))).mult(g));return r.setLocationAtPoint(r.renderWorldCopies?b.wrap():b,y),r._updateCameraOnTerrain(),t.preloadOnly||i._fireMoveEvents(n),r}};if(t.preloadOnly){var H=this._emulate(N,t.duration,a);return this._preloadTiles(H),this}return this._zooming=!0,this._rotating=B,this._pitching=F,this._padding=O,this._prepareEase(n,!1),this._ease(N(a),(function(){return i._afterEase(n)}),t),this}},{key:"isEasing",value:function(){return!!this._easeFrameId}},{key:"stop",value:function(){return this._stop()}},{key:"_stop",value:function(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){var n=this._onEaseEnd;this._onEaseEnd=void 0,n.call(this,t)}if(!e){var i=this.handlers;i&&i.stop(!1)}return this}},{key:"_ease",value:function(t,n,i){!1===i.animate||0===i.duration?(t(1),n()):(this._easeStart=e.exported.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}},{key:"_renderFrameCallback",value:function(){var t=Math.min((e.exported.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}},{key:"_normalizeBearing",value:function(t,n){t=e.wrap(t,-180,180);var i=Math.abs(t-n);return Math.abs(t-360-n)<i&&(t-=360),Math.abs(t+360-n)<i&&(t+=360),t}},{key:"_normalizeCenter",value:function(e){var t=this.transform;if(t.renderWorldCopies&&!t.maxBounds){var n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}},{key:"_prefersReducedMotion",value:function(t){return this._respectPrefersReducedMotion&&e.exported.prefersReducedMotion&&!(t&&t.essential)}},{key:"_emulate",value:function(e,t,n){for(var i=Math.ceil(15*t/1e3),r=[],a=e(n.clone()),o=0;o<=i;o++){var s=a(o/i);r.push(s.clone())}return r}}]),i}(e.Evented),sa=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f(this,t),this.options=n,e.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}return p(t,[{key:"getDefaultPosition",value:function(){return"bottom-right"}},{key:"onAdd",value:function(e){var t=this.options&&this.options.compact;return this._map=e,this._container=v("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=v("button","mapboxgl-ctrl-attrib-button",this._container),v("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=v("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}},{key:"onRemove",value:function(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}},{key:"_setElementTitle",value:function(e,t){var n=this._map._getUIString("AttributionControl.".concat(t));e.setAttribute("aria-label",n),e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}},{key:"_toggleAttribution",value:function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}},{key:"_updateEditLink",value:function(){var t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.config.ACCESS_TOKEN}];if(t){var i=n.reduce((function(e,t,i){return t.value&&(e+="".concat(t.key,"=").concat(t.value).concat(i<n.length-1?"&":"")),e}),"?");t.href="".concat(e.config.FEEDBACK_URL,"/").concat(i,"#").concat(cr(this._map,!0)),t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}},{key:"_updateData",value:function(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}},{key:"_updateAttributions",value:function(){if(this._map.style){var e=[];if(this._map.style.stylesheet){var t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}var n=this._map.style._sourceCaches;for(var i in n){var r=n[i];if(r.used){var a=r.getSource();a.attribution&&e.indexOf(a.attribution)<0&&e.push(a.attribution)}}e.sort((function(e,t){return e.length-t.length})),e=e.filter((function(t,n){for(var i=n+1;i<e.length;i++)if(e[i].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[].concat(c(this.options.customAttribution),c(e)):e.unshift(this.options.customAttribution));var o=e.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,e.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}}},{key:"_updateCompact",value:function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}]),t}(),la=function(){function t(){f(this,t),e.bindAll(["_updateLogo","_updateCompact"],this)}return p(t,[{key:"onAdd",value:function(e){this._map=e,this._container=v("div","mapboxgl-ctrl");var t=v("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}},{key:"onRemove",value:function(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}},{key:"getDefaultPosition",value:function(){return"bottom-left"}},{key:"_updateLogo",value:function(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}},{key:"_logoRequired",value:function(){if(!this._map.style)return!0;var e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(var t in e){var n=e[t].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}},{key:"_updateCompact",value:function(){var e=this._container.children;if(e.length){var t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}]),t}(),ua=function(){function e(){f(this,e),this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}return p(e,[{key:"add",value:function(e){var t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}},{key:"remove",value:function(e){var t,n=this._currentlyRunning,i=n?this._queue.concat(n):this._queue,r=h(i);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(a.id===e)return void(a.cancelled=!0)}}catch(o){r.e(o)}finally{r.f()}}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._currentlyRunning=this._queue;this._queue=[];var n,i=h(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(!r.cancelled&&(r.callback(e),this._cleared))break}}catch(a){i.e(a)}finally{i.f()}this._cleared=!1,this._currentlyRunning=!1}},{key:"clear",value:function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}]),e}();function ca(t,n,i){if(t=new e.LngLat(t.lng,t.lat),n){var r=new e.LngLat(t.lng-360,t.lat),a=new e.LngLat(t.lng+360,t.lat),o=360*Math.ceil(Math.abs(t.lng-i.center.lng)/360),s=i.locationPoint(t).distSqr(n),l=n.x<0||n.y<0||n.x>i.width||n.y>i.height;i.locationPoint(r).distSqr(n)<s&&(l||Math.abs(r.lng-i.center.lng)<o)?t=r:i.locationPoint(a).distSqr(n)<s&&(l||Math.abs(a.lng-i.center.lng)<o)&&(t=a)}for(;Math.abs(t.lng-i.center.lng)>180;){var u=i.locationPoint(t);if(u.x>=0&&u.y>=0&&u.x<=i.width&&u.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}var da={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},ha=function(t){m(i,t);var n=y(i);function i(t,a){var o;if(f(this,i),o=n.call(this),(t instanceof e.window.HTMLElement||a)&&(t=e.extend({element:t},a)),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],r(o)),o._anchor=t&&t.anchor||"center",o._color=t&&t.color||"#3FB1CE",o._scale=t&&t.scale||1,o._draggable=t&&t.draggable||!1,o._clickTolerance=t&&t.clickTolerance||0,o._isDragging=!1,o._state="inactive",o._rotation=t&&t.rotation||0,o._rotationAlignment=t&&t.rotationAlignment||"auto",o._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",o._updateMoving=function(){return o._update(!0)},o._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)o._element=t.element,o._offset=e.Point.convert(t&&t.offset||[0,0]);else{o._defaultMarker=!0,o._element=v("div");var s=41,u=27,c=_("svg",{display:"block",height:s*o._scale+"px",width:u*o._scale+"px",viewBox:"0 0 ".concat(u," ").concat(s)},o._element),d=_("radialGradient",{id:"shadowGradient"},_("defs",{},c));_("stop",{offset:"10%","stop-opacity":.4},d),_("stop",{offset:"100%","stop-opacity":.05},d),_("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c),_("path",{fill:o._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),_("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),_("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),o._offset=e.Point.convert(t&&t.offset||[0,-14])}o._element.hasAttribute("aria-label")||o._element.setAttribute("aria-label","Map marker"),o._element.classList.add("mapboxgl-marker"),o._element.addEventListener("dragstart",(function(e){e.preventDefault()})),o._element.addEventListener("mousedown",(function(e){e.preventDefault()}));var h=o._element.classList;for(var p in da)h.remove("mapboxgl-marker-anchor-".concat(p));return h.add("mapboxgl-marker-anchor-".concat(o._anchor)),o._popup=null,l(o)}return p(i,[{key:"addTo",value:function(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}},{key:"remove",value:function(){var e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}},{key:"getLngLat",value:function(){return this._lngLat}},{key:"setLngLat",value:function(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}},{key:"getElement",value:function(){return this._element}},{key:"setPopup",value:function(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){var t=38.1,n=13.5,i=Math.sqrt(Math.pow(n,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[i,-1*(t-n+i)],"bottom-right":[-i,-1*(t-n+i)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}},{key:"_onKeyPress",value:function(e){var t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()}},{key:"_onMapClick",value:function(e){var t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()}},{key:"getPopup",value:function(){return this._popup}},{key:"togglePopup",value:function(){var e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}},{key:"_behindTerrain",value:function(){var e=this._map,t=this._pos;if(!e||!t)return!1;var n=e.unproject(t),i=e.getFreeCameraOptions();if(!i.position)return!1;var r=i.position.toLngLat();return r.distanceTo(n)<.9*r.distanceTo(this._lngLat)}},{key:"_evaluateOpacity",value:function(){var t=this._map;if(t){var n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)this._clearFadeTimer();else{var i,r=t.unproject(n);t._showingGlobe()&&e.isLngLatBehindGlobe(t.transform,this._lngLat)?i=0:(i=1-t._queryFogOpacity(r),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(i*=this._occludedOpacity)),this._element.style.opacity="".concat(i),this._element.style.pointerEvents=i>0?"auto":"none",this._popup&&this._popup._setOpacity(i),this._fadeTimer=null}}}},{key:"_clearFadeTimer",value:function(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}},{key:"_updateDOM",value:function(){var e=this._pos;if(e&&this._map){var t=this._offset.mult(this._scale);this._element.style.transform="\n            translate(".concat(e.x,"px,").concat(e.y,"px)\n            ").concat(da[this._anchor],"\n            ").concat(this._calculateXYTransform()," ").concat(this._calculateZTransform(),"\n            translate(").concat(t.x,"px,").concat(t.y,"px)\n        ")}}},{key:"_calculateXYTransform",value:function(){var t=this._pos,n=this._map,i=this.getPitchAlignment();if(!n||!t||"map"!==i)return"";if(!n._showingGlobe()){var r=n.getPitch();return r?"rotateX(".concat(r,"deg)"):""}var a=e.radToDeg(e.globeTiltAtLngLat(n.transform,this._lngLat)),o=t.sub(e.globeCenterToScreenPoint(n.transform)),s=Math.abs(o.x)+Math.abs(o.y);if(0===s)return"";var l=a/s;return"rotateX(".concat(-o.y*l,"deg) rotateY(").concat(o.x*l,"deg)")}},{key:"_calculateZTransform",value:function(){var t=this._pos,n=this._map;if(!n||!t)return"";var i=0,r=this.getRotationAlignment();if("map"===r)if(n._showingGlobe()){var a=n.project(new e.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),o=n.project(new e.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(a);i=e.radToDeg(Math.atan2(o.y,o.x))-90}else i=-n.getBearing();else if("horizon"===r){var s=e.smoothstep(4,6,n.getZoom()),l=e.globeCenterToScreenPoint(n.transform);l.y+=s*n.transform.height;var u=t.sub(l),c=e.radToDeg(Math.atan2(u.y,u.x));i=(c>90?c-270:c+90)*(1-s)}return(i+=this._rotation)?"rotateZ(".concat(i,"deg)"):""}},{key:"_update",value:function(t){var n=this;e.window.cancelAnimationFrame(this._updateFrameId);var i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=ca(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),!0===t?this._updateFrameId=e.window.requestAnimationFrame((function(){n._element&&n._pos&&n._anchor&&(n._pos=n._pos.round(),n._updateDOM())})):this._pos=this._pos.round(),i._requestDomTask((function(){n._map&&(n._element&&n._pos&&n._anchor&&n._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!n._fadeTimer&&(n._fadeTimer=setTimeout(n._evaluateOpacity.bind(n),60)))})))}},{key:"getOffset",value:function(){return this._offset}},{key:"setOffset",value:function(t){return this._offset=e.Point.convert(t),this._update(),this}},{key:"_onMove",value:function(t){var n=this._map;if(n){var i=this._pointerdownPos,r=this._positionDelta;if(i&&r){if(!this._isDragging){var a=this._clickTolerance||n._clickTolerance;if(t.point.dist(i)<a)return;this._isDragging=!0}this._pos=t.point.sub(r),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag"))}}}},{key:"_onUp",value:function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;var t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive"}},{key:"_addDragHandler",value:function(e){var t=this._map,n=this._pos;t&&n&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(n),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}},{key:"setDraggable",value:function(e){this._draggable=!!e;var t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}},{key:"isDraggable",value:function(){return this._draggable}},{key:"setRotation",value:function(e){return this._rotation=e||0,this._update(),this}},{key:"getRotation",value:function(){return this._rotation}},{key:"setRotationAlignment",value:function(e){return this._rotationAlignment=e||"auto",this._update(),this}},{key:"getRotationAlignment",value:function(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}},{key:"setPitchAlignment",value:function(e){return this._pitchAlignment=e||"auto",this._update(),this}},{key:"getPitchAlignment",value:function(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}},{key:"setOccludedOpacity",value:function(e){return this._occludedOpacity=e||.2,this._update(),this}},{key:"getOccludedOpacity",value:function(){return this._occludedOpacity}}]),i}(e.Evented),fa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},pa=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ma(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e.Point(0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom";if("number"==typeof t){var i=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(n){case"top":return new e.Point(0,t);case"top-left":return new e.Point(i,i);case"top-right":return new e.Point(-i,i);case"bottom":return new e.Point(0,-t);case"bottom-left":return new e.Point(i,-i);case"bottom-right":return new e.Point(-i,-i);case"left":return new e.Point(t,0);case"right":return new e.Point(-t,0)}return new e.Point(0,0)}return t instanceof e.Point||Array.isArray(t)?e.Point.convert(t):e.Point.convert(t[n]||[0,0])}var ya=function(){function t(e){f(this,t),this.jumpTo(e)}return p(t,[{key:"getValue",value:function(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;var n=e.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}},{key:"isEasing",value:function(e){return e>=this._startTime&&e<=this._endTime}},{key:"jumpTo",value:function(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}},{key:"easeTo",value:function(e,t,n){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+n}}]),t}(),ga={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},va={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},_a={showCompass:!0,showZoom:!0,visualizePitch:!1},xa=function(){function t(n,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];f(this,t),this._clickTolerance=10,this.element=i,this.mouseRotate=new Pr({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,r&&(this.mousePitch=new zr({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}return p(t,[{key:"down",value:function(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),k()}},{key:"move",value:function(e,t){var n=this.map,i=this.mouseRotate.mousemoveWindow(e,t),r=i&&i.bearingDelta;if(r&&n.setBearing(n.getBearing()+r),this.mousePitch){var a=this.mousePitch.mousemoveWindow(e,t),o=a&&a.pitchDelta;o&&n.setPitch(n.getPitch()+o)}}},{key:"off",value:function(){var e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}},{key:"offTemp",value:function(){T(),e.window.removeEventListener("mousemove",this.mousemove),e.window.removeEventListener("mouseup",this.mouseup)}},{key:"mousedown",value:function(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:function(){return t.preventDefault()}}),L(this.element,t)),e.window.addEventListener("mousemove",this.mousemove),e.window.addEventListener("mouseup",this.mouseup)}},{key:"mousemove",value:function(e){this.move(e,L(this.element,e))}},{key:"mouseup",value:function(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}},{key:"touchstart",value:function(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=M(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return e.preventDefault()}},this._startPos))}},{key:"touchmove",value:function(e){1!==e.targetTouches.length?this.reset():(this._lastPos=M(this.element,e.targetTouches)[0],this.move({preventDefault:function(){return e.preventDefault()}},this._lastPos))}},{key:"touchend",value:function(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}},{key:"reset",value:function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}]),t}(),ba={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},wa={maxWidth:100,unit:"metric"},ka={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ta={version:e.version,supported:n,setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:function(t){m(c,t);var a=y(c);function c(t){var n;if(f(this,c),e.LivePerformanceUtils.mark(e.PerformanceMarkers.create),null!=(t=e.extend({},va,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.isSafariWithAntialiasingBug(e.window)&&(t.antialias=!1,e.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),(n=a.call(this,new sr(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t))._interactive=t.interactive,n._minTileCacheSize=t.minTileCacheSize,n._maxTileCacheSize=t.maxTileCacheSize,n._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,n._preserveDrawingBuffer=t.preserveDrawingBuffer,n._antialias=t.antialias,n._useWebGL2=t.useWebGL2,n._trackResize=t.trackResize,n._bearingSnap=t.bearingSnap,n._refreshExpiredTiles=t.refreshExpiredTiles,n._fadeDuration=t.fadeDuration,n._isInitialLoad=!0,n._crossSourceCollisions=t.crossSourceCollisions,n._collectResourceTiming=t.collectResourceTiming,n._optimizeForTerrain=t.optimizeForTerrain,n._language=n._parseLanguage(t.language),n._worldview=t.worldview,n._renderTaskQueue=new ua,n._domRenderTaskQueue=new ua,n._controls=[],n._markers=[],n._popups=[],n._mapId=e.uniqueId(),n._locale=e.extend({},ga,t.locale),n._clickTolerance=t.clickTolerance,n._cooperativeGestures=t.cooperativeGestures,n._performanceMetricsCollection=t.performanceMetricsCollection,n._containerWidth=0,n._containerHeight=0,n._averageElevationLastSampledAt=-1/0,n._averageElevationExaggeration=0,n._averageElevation=new ya(0),n._interactionRange=[1/0,-1/0],n._visibilityHidden=0,n._useExplicitProjection=!1,n._requestManager=new e.RequestManager(t.transformRequest,t.accessToken,t.testMode),n._silenceAuthErrors=!!t.testMode,"string"==typeof t.container){if(n._container=e.window.document.getElementById(t.container),!n._container)throw new Error("Container '".concat(t.container,"' not found."))}else{if(!(t.container instanceof e.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");n._container=t.container}if(n._container.childNodes.length>0&&e.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&n.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],r(n)),n._setupContainer(),n._setupPainter(),void 0===n.painter)throw new Error("Failed to initialize WebGL.");return n.on("move",(function(){return n._update(!1)})),n.on("moveend",(function(){return n._update(!1)})),n.on("zoom",(function(){return n._update(!0)})),void 0!==e.window&&(e.window.addEventListener("online",n._onWindowOnline,!1),e.window.addEventListener("resize",n._onWindowResize,!1),e.window.addEventListener("orientationchange",n._onWindowResize,!1),e.window.addEventListener("webkitfullscreenchange",n._onWindowResize,!1),e.window.addEventListener("visibilitychange",n._onVisibilityChange,!1)),n.handlers=new ra(r(n),t),n._localFontFamily=t.localFontFamily,n._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&n.setStyle(t.style,{localFontFamily:n._localFontFamily,localIdeographFontFamily:n._localIdeographFontFamily}),t.projection&&n.setProjection(t.projection),n._hash=t.hash&&new ur("string"==typeof t.hash&&t.hash||void 0).addTo(r(n)),n._hash&&n._hash._onHashChange()||(n.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(n.resize(),n.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),n.resize(),t.attributionControl&&n.addControl(new sa({customAttribution:t.customAttribution})),n._logoControl=new la,n.addControl(n._logoControl,t.logoPosition),n.on("style.load",(function(){n.transform.unmodified&&n.jumpTo(n.style.stylesheet)})),n.on("data",(function(t){n._update("style"===t.dataType),n.fire(new e.Event("".concat(t.dataType,"data"),t))})),n.on("dataloading",(function(t){n.fire(new e.Event("".concat(t.dataType,"dataloading"),t))})),l(n)}return p(c,[{key:"_getMapId",value:function(){return this._mapId}},{key:"addControl",value:function(t,n){if(void 0===n&&(n=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var i=t.onAdd(this);this._controls.push(t);var r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}},{key:"removeControl",value:function(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var n=this._controls.indexOf(t);return n>-1&&this._controls.splice(n,1),t.onRemove(this),this}},{key:"hasControl",value:function(e){return this._controls.indexOf(e)>-1}},{key:"getContainer",value:function(){return this._container}},{key:"getCanvasContainer",value:function(){return this._canvasContainer}},{key:"getCanvas",value:function(){return this._canvas}},{key:"resize",value:function(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));var n=!this._moving;return n&&this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t)),this.fire(new e.Event("resize",t)),n&&this.fire(new e.Event("moveend",t)),this}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()||null}},{key:"setMaxBounds",value:function(t){return this.transform.setMaxBounds(e.LngLatBounds.convert(t)),this._update()}},{key:"setMinZoom",value:function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}},{key:"getLanguage",value:function(){return this._language}},{key:"_parseLanguage",value:function(t){return"auto"===t?e.window.navigator.language:Array.isArray(t)?0===t.length?void 0:t.map((function(t){return"auto"===t?e.window.navigator.language:t})):t}},{key:"setLanguage",value:function(e){var t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style._reloadSources();var n,i=h(this._controls);try{for(i.s();!(n=i.n()).done;){var r=n.value;r._setLanguage&&r._setLanguage(this._language)}}catch(a){i.e(a)}finally{i.f()}return this}},{key:"getWorldview",value:function(){return this._worldview}},{key:"setWorldview",value:function(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style._reloadSources(),this):this}},{key:"getProjection",value:function(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}},{key:"_showingGlobe",value:function(){return"globe"===this.transform.projection.name}},{key:"setProjection",value:function(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.stylesheet?this.style.stylesheet.projection:null)}},{key:"_updateProjectionTransition",value:function(){if("globe"===this.getProjection().name){var t,n=this.transform,i=n.projection.name;"globe"===i&&n.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX?(n.setMercatorFromTransition(),t=!0):"mercator"===i&&n.zoom<e.GLOBE_ZOOM_THRESHOLD_MAX&&(n.setProjection({name:"globe"}),t=!0),t&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}}},{key:"_prioritizeAndUpdateProjection",value:function(e,t){return this._updateProjection(e||t||{name:"mercator"})}},{key:"_updateProjection",value:function(t){var n;if(n="globe"===t.name&&this.transform.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),n){for(var i in this.painter.clearBackgroundTiles(),this.style._sourceCaches)this.style._sourceCaches[i].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}},{key:"project",value:function(t){return this.transform.locationPoint3D(e.LngLat.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation3D(e.Point.convert(t))}},{key:"isMoving",value:function(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}},{key:"isZooming",value:function(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}},{key:"isRotating",value:function(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}},{key:"_isDragging",value:function(){return this.handlers&&this.handlers._isDragging()||!1}},{key:"_createDelegatedListener",value:function(e,t,n){var r=this;if("mouseenter"===e||"mouseover"===e){var a=!1,o=function(i){var o=t.filter((function(e){return r.getLayer(e)})),s=o.length?r.queryRenderedFeatures(i.point,{layers:o}):[];s.length?a||(a=!0,n.call(r,new _r(e,r,i.originalEvent,{features:s}))):a=!1},s=function(){a=!1};return{layers:new Set(t),listener:n,delegates:{mousemove:o,mouseout:s}}}if("mouseleave"===e||"mouseout"===e){var l=!1,u=function(i){var a=t.filter((function(e){return r.getLayer(e)}));(a.length?r.queryRenderedFeatures(i.point,{layers:a}):[]).length?l=!0:l&&(l=!1,n.call(r,new _r(e,r,i.originalEvent)))},c=function(t){l&&(l=!1,n.call(r,new _r(e,r,t.originalEvent)))};return{layers:new Set(t),listener:n,delegates:{mousemove:u,mouseout:c}}}var d=function(e){var i=t.filter((function(e){return r.getLayer(e)})),a=i.length?r.queryRenderedFeatures(e.point,{layers:i}):[];a.length&&(e.features=a,n.call(r,e),delete e.features)};return{layers:new Set(t),listener:n,delegates:i({},e,d)}}},{key:"on",value:function(e,t,n){if(void 0===n)return o(s(c.prototype),"on",this).call(this,e,t);Array.isArray(t)||(t=[t]);var i=this._createDelegatedListener(e,t,n);for(var r in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i),i.delegates)this.on(r,i.delegates[r]);return this}},{key:"once",value:function(e,t,n){if(void 0===n)return o(s(c.prototype),"once",this).call(this,e,t);Array.isArray(t)||(t=[t]);var i=this._createDelegatedListener(e,t,n);for(var r in i.delegates)this.once(r,i.delegates[r]);return this}},{key:"off",value:function(e,t,n){var i=this;if(void 0===n)return o(s(c.prototype),"off",this).call(this,e,t);t=new Set(Array.isArray(t)?t:[t]);var r=function(e,t){if(e.size!==t.size)return!1;var n,i=h(e);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(!t.has(r))return!1}}catch(a){i.e(a)}finally{i.f()}return!0},a=this._delegatedListeners?this._delegatedListeners[e]:void 0;return a&&function(e){for(var a=0;a<e.length;a++){var o=e[a];if(o.listener===n&&r(o.layers,t)){for(var s in o.delegates)i.off(s,o.delegates[s]);return e.splice(a,1),i}}}(a),this}},{key:"queryRenderedFeatures",value:function(t,n){return this.style?(void 0!==n||void 0===t||t instanceof e.Point||Array.isArray(t)||(n=t,t=void 0),this.style.queryRenderedFeatures(t=t||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}},{key:"querySourceFeatures",value:function(e,t){return this.style.querySourceFeatures(e,t)}},{key:"isPointOnSurface",value:function(t){var n=this.transform.projection.name;return"globe"!==n&&"mercator"!==n&&e.warnOnce("".concat(n," projection does not support isPointOnSurface, this API may behave unexpectedly.")),this.transform.isPointOnSurface(e.Point.convert(t))}},{key:"setStyle",value:function(t,n){return!1!==(n=e.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(t,n))}},{key:"_getUIString",value:function(e){var t=this._locale[e];if(null==t)throw new Error("Missing UI string '".concat(e,"'"));return t}},{key:"_updateStyle",value:function(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new dn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}},{key:"_lazyInitEmptyStyle",value:function(){this.style||(this.style=new dn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}},{key:"_diffStyle",value:function(t,n){var i=this;if("string"==typeof t){var r=this._requestManager.normalizeStyleURL(t),a=this._requestManager.transformRequest(r,e.ResourceType.Style);e.getJSON(a,(function(t,r){t?i.fire(new e.ErrorEvent(t)):r&&i._updateDiff(r,n)}))}else"object"==typeof t&&this._updateDiff(t,n)}},{key:"_updateDiff",value:function(t,n){try{this.style.setState(t)&&this._update(!0)}catch(u){e.warnOnce("Unable to perform style diff: ".concat(u.message||u.error||u,".  Rebuilding the style from scratch.")),this._updateStyle(t,n)}}},{key:"getStyle",value:function(){if(this.style)return this.style.serialize()}},{key:"isStyleLoaded",value:function(){return this.style?this.style.loaded():(e.warnOnce("There is no style added to the map."),!1)}},{key:"addSource",value:function(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}},{key:"isSourceLoaded",value:function(e){return!!this.style&&this.style._isSourceCacheLoaded(e)}},{key:"areTilesLoaded",value:function(){var e=this.style&&this.style._sourceCaches;for(var t in e){var n=e[t]._tiles;for(var i in n){var r=n[i];if("loaded"!==r.state&&"errored"!==r.state)return!1}}return!0}},{key:"addSourceType",value:function(e,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}},{key:"removeSource",value:function(e){return this.style.removeSource(e),this._updateTerrain(),this._update(!0)}},{key:"getSource",value:function(e){return this.style.getSource(e)}},{key:"addImage",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.pixelRatio,a=void 0===r?1:r,o=i.sdf,s=void 0!==o&&o,l=i.stretchX,u=i.stretchY,c=i.content;if(this._lazyInitEmptyStyle(),n instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&n instanceof e.window.ImageBitmap){var d=e.exported.getImageData(n),h=d.width,f=d.height,p=d.data;this.style.addImage(t,{data:new e.RGBAImage({width:h,height:f},p),pixelRatio:a,stretchX:l,stretchY:u,content:c,sdf:s,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{var m=n.width,y=n.height,g=n;this.style.addImage(t,{data:new e.RGBAImage({width:m,height:y},new Uint8Array(g.data)),pixelRatio:a,stretchX:l,stretchY:u,content:c,sdf:s,version:0,userImage:g}),g.onAdd&&g.onAdd(this,t)}}},{key:"updateImage",value:function(t,n){var i=this.style.getImage(t);if(i){var r=n instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&n instanceof e.window.ImageBitmap?e.exported.getImageData(n):n,a=r.width,o=r.height;void 0!==a&&void 0!==o?a===i.data.width&&o===i.data.height?(i.data.replace(r.data,!(n instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&n instanceof e.window.ImageBitmap)),this.style.updateImage(t,i)):this.fire(new e.ErrorEvent(new Error("The width and height of the updated image (".concat(a,", ").concat(o,")\n                must be that same as the previous version of the image\n                (").concat(i.data.width,", ").concat(i.data.height,")")))):this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}else this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")))}},{key:"hasImage",value:function(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)}},{key:"removeImage",value:function(e){this.style.removeImage(e)}},{key:"loadImage",value:function(t,n){e.getImage(this._requestManager.transformRequest(t,e.ResourceType.Image),(function(t,i){n(t,i instanceof e.window.HTMLImageElement?e.exported.getImageData(i):i)}))}},{key:"listImages",value:function(){return this.style.listImages()}},{key:"addLayer",value:function(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}},{key:"moveLayer",value:function(e,t){return this.style.moveLayer(e,t),this._update(!0)}},{key:"removeLayer",value:function(e){return this.style.removeLayer(e),this._update(!0)}},{key:"getLayer",value:function(e){return this.style.getLayer(e)}},{key:"setLayerZoomRange",value:function(e,t,n){return this.style.setLayerZoomRange(e,t,n),this._update(!0)}},{key:"setFilter",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.style.setFilter(e,t,n),this._update(!0)}},{key:"getFilter",value:function(e){return this.style.getFilter(e)}},{key:"setPaintProperty",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.style.setPaintProperty(e,t,n,i),this._update(!0)}},{key:"getPaintProperty",value:function(e,t){return this.style.getPaintProperty(e,t)}},{key:"setLayoutProperty",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.style.setLayoutProperty(e,t,n,i),this._update(!0)}},{key:"getLayoutProperty",value:function(e,t){return this.style.getLayoutProperty(e,t)}},{key:"setLight",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}},{key:"getLight",value:function(){return this.style.getLight()}},{key:"setTerrain",value:function(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}},{key:"getTerrain",value:function(){return this.style?this.style.getTerrain():null}},{key:"setFog",value:function(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}},{key:"getFog",value:function(){return this.style?this.style.getFog():null}},{key:"_queryFogOpacity",value:function(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.LngLat.convert(t),this.transform):0}},{key:"setFeatureState",value:function(e,t){return this.style.setFeatureState(e,t),this._update()}},{key:"removeFeatureState",value:function(e,t){return this.style.removeFeatureState(e,t),this._update()}},{key:"getFeatureState",value:function(e){return this.style.getFeatureState(e)}},{key:"_updateContainerDimensions",value:function(){if(this._container){for(var t,n,i,r=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300,o=this._container;o&&(!n||!i);){var s=e.window.getComputedStyle(o).transform;s&&"none"!==s&&((t=s.match(/matrix.*\((.+)\)/)[1].split(", "))[0]&&"0"!==t[0]&&"1"!==t[0]&&(n=t[0]),t[3]&&"0"!==t[3]&&"1"!==t[3]&&(i=t[3])),o=o.parentElement}this._containerWidth=n?Math.abs(r/n):r,this._containerHeight=i?Math.abs(a/i):a}}},{key:"_detectMissingCSS",value:function(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}},{key:"_setupContainer",value:function(){var e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=v("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();var t=this._canvasContainer=v("div","mapboxgl-canvas-container",e);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=v("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);var n=this._controlContainer=v("div","mapboxgl-control-container",e),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(e){i[e]=v("div","mapboxgl-ctrl-".concat(e),n)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}},{key:"_resizeCanvas",value:function(t,n){var i=e.exported.devicePixelRatio||1;this._canvas.width=i*Math.ceil(t),this._canvas.height=i*Math.ceil(n),this._canvas.style.width="".concat(t,"px"),this._canvas.style.height="".concat(n,"px")}},{key:"_addMarker",value:function(e){this._markers.push(e)}},{key:"_removeMarker",value:function(e){var t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}},{key:"_addPopup",value:function(e){this._popups.push(e)}},{key:"_removePopup",value:function(e){var t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}},{key:"_setupPainter",value:function(){var t=this,i=e.extend({},n.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._useWebGL2&&this._canvas.getContext("webgl2",i),a=r||this._canvas.getContext("webgl",i)||this._canvas.getContext("experimental-webgl",i);a?(this._useWebGL2&&!r&&e.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),e.storeAuthState(a,!0),this.painter=new Xi(a,this.transform,!!r),this.on("data",(function(e){"source"===e.dataType&&t.painter.setTileLoadedFlag(!0)})),e.exported$1.testSupport(a)):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")))}},{key:"_contextLost",value:function(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}))}},{key:"_contextRestored",value:function(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}))}},{key:"_onMapScroll",value:function(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}},{key:"loaded",value:function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}},{key:"_update",value:function(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}},{key:"_requestRenderFrame",value:function(e){return this._update(),this._renderTaskQueue.add(e)}},{key:"_cancelRenderFrame",value:function(e){this._renderTaskQueue.remove(e)}},{key:"_requestDomTask",value:function(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}},{key:"_render",value:function(t){var n,i=this,r=this.painter.context.extTimerQuery,a=e.exported.now();if(this.listens("gpu-timing-frame")&&(n=r.createQueryEXT(),r.beginQueryEXT(r.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],e.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],e.window.performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),!this._removed){this._updateProjectionTransition();var o=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,l=this.transform.pitch,u=e.exported.now(),c=new e.EvaluationParameters(s,{now:u,fadeDuration:o,pitch:l,transition:this.style.getTransition()});this.style.update(c)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);var d=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),d=this._updateAverageElevation(a),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):d=this._updateAverageElevation(a),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){var h=e.exported.now()-a;r.endQueryEXT(r.TIME_ELAPSED_EXT,n),setTimeout((function(){var t=r.getQueryObjectEXT(n,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(n),i.fire(new e.Event("gpu-timing-frame",{cpuTime:h,gpuTime:t})),e.window.performance.mark("frame-gpu",{startTime:a,detail:{gpuTime:t}})}),50)}if(this.listens("gpu-timing-layer")){var f=this.painter.collectGpuTimers();setTimeout((function(){var t=i.painter.queryGpuTimers(f);i.fire(new e.Event("gpu-timing-layer",{layerTimes:t}))}),50)}if(this.listens("gpu-timing-deferred-render")){var p=this.painter.collectDeferredRenderGpuQueries();setTimeout((function(){var t=i.painter.queryGpuTimeDeferredRender(p);i.fire(new e.Event("gpu-timing-deferred-render",{gpuTime:t}))}),50)}var m=this._sourcesDirty||this._styleDirty||this._placementDirty||d;if(m||this._repaint)this.triggerRepaint();else{var y=!this.isMoving()&&this.loaded();if(y&&(d=this._updateAverageElevation(a,!0)),d)this.triggerRepaint();else if(this._triggerFrame(!1),y&&(this.fire(new e.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){var g=this._calculateSpeedIndex();this.fire(new e.Event("speedindexcompleted",{speedIndex:g})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||m||(this._fullyLoaded=!0,e.LivePerformanceUtils.mark(e.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&e.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}}},{key:"_forceMarkerAndPopupUpdate",value:function(e){var t,n=h(this._markers);try{for(n.s();!(t=n.n()).done;){var i=t.value;e&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update()}}catch(s){n.e(s)}finally{n.f()}var r,a=h(this._popups);try{for(a.s();!(r=a.n()).done;){var o=r.value;!e||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}}catch(s){a.e(s)}finally{a.f()}}},{key:"_updateAverageElevation",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=function(e){return t.transform.averageElevation=e,t._update(!1),!0};if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);if((n||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){var r=this.transform.averageElevation,a=this.transform.sampleAverageElevation(),o=!1;this.transform.elevation&&(o=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(a)?a=0:this._averageElevationLastSampledAt=e;var s=Math.abs(r-a);if(s>1){if(this._isInitialLoad||o)return this._averageElevation.jumpTo(a),i(a);this._averageElevation.easeTo(a,e,300)}else if(s>1e-4)return this._averageElevation.jumpTo(a),i(a)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}},{key:"_authenticate",value:function(){var t=this;e.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(function(n){if(n&&(n.message===e.AUTH_ERR_MSG||401===n.status)){var i=t.painter.context.gl;e.storeAuthState(i,!1),t._logoControl instanceof la&&t._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),t._silenceAuthErrors||t.fire(new e.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(function(){}))}},{key:"_updateTerrain",value:function(){var e=this._isDragging();this.painter.updateTerrain(this.style,e)}},{key:"_calculateSpeedIndex",value:function(){var e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());var n=this.painter.context.gl,i=n.createFramebuffer();function r(e){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);var t=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,t),t}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(r(e),t.canvasCopies.map(r),t.timeStamps)}},{key:"_canvasPixelComparison",value:function(e,t,n){for(var i=n[1]-n[0],r=e.length/4,a=0;a<t.length;a++){for(var o=t[a],s=0,l=0;l<o.length;l+=4)o[l]===e[l]&&o[l+1]===e[l+1]&&o[l+2]===e[l+2]&&o[l+3]===e[l+3]&&(s+=1);i+=(n[a+2]-n[a+1])*(1-s/r)}return i}},{key:"remove",value:function(){this._hash&&this._hash.remove();var t,n=h(this._controls);try{for(n.s();!(t=n.n()).done;)t.value.onRemove(this)}catch(r){n.e(r)}finally{n.f()}this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1),e.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));var i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),e.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new e.Event("remove"))}},{key:"triggerRepaint",value:function(){this._triggerFrame(!0)}},{key:"_triggerFrame",value:function(t){var n=this;this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.exported.frame((function(e){var t=!!n._renderNextFrame;n._frame=null,n._renderNextFrame=null,t&&n._render(e)})))}},{key:"_preloadTiles",value:function(t){var n=this,i=this.style?Object.values(this.style._sourceCaches):[];return e.asyncAll(i,(function(e,n){return e._preloadTiles(t,n)}),(function(){n.triggerRepaint()})),this}},{key:"_onWindowOnline",value:function(){this._update()}},{key:"_onWindowResize",value:function(e){this._trackResize&&this.resize({originalEvent:e})._update()}},{key:"_onVisibilityChange",value:function(){"hidden"===e.window.document.visibilityState&&this._visibilityHidden++}},{key:"showTileBoundaries",get:function(){return!!this._showTileBoundaries},set:function(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}},{key:"showTerrainWireframe",get:function(){return!!this._showTerrainWireframe},set:function(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}},{key:"speedIndexTiming",get:function(){return!!this._speedIndexTiming},set:function(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}},{key:"showPadding",get:function(){return!!this._showPadding},set:function(e){this._showPadding!==e&&(this._showPadding=e,this._update())}},{key:"showCollisionBoxes",get:function(){return!!this._showCollisionBoxes},set:function(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}},{key:"showOverdrawInspector",get:function(){return!!this._showOverdrawInspector},set:function(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}},{key:"repaint",get:function(){return!!this._repaint},set:function(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}},{key:"vertices",get:function(){return!!this._vertices},set:function(e){this._vertices=e,this._update()}},{key:"showTileAABBs",get:function(){return!!this._showTileAABBs},set:function(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}},{key:"_setCacheLimits",value:function(t,n){e.setCacheLimits(t,n)}},{key:"version",get:function(){return e.version}}]),c}(oa),NavigationControl:function(){function t(n){var i=this;f(this,t),this.options=e.extend({},_a,n),this._container=v("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(e){return e.preventDefault()})),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(e){i._map&&i._map.zoomIn({},{originalEvent:e})})),v("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(e){i._map&&i._map.zoomOut({},{originalEvent:e})})),v("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(e){var t=i._map;t&&(i.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=v("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}return p(t,[{key:"_updateZoomButtons",value:function(){var e=this._map;if(e){var t=e.getZoom(),n=t===e.getMaxZoom(),i=t===e.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}}},{key:"_rotateCompassArrow",value:function(){var e=this,t=this._map;if(t){var n=this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5),") rotateX(").concat(t.transform.pitch,"deg) rotateZ(").concat(t.transform.angle*(180/Math.PI),"deg)"):"rotate(".concat(t.transform.angle*(180/Math.PI),"deg)");t._requestDomTask((function(){e._compassIcon&&(e._compassIcon.style.transform=n)}))}}},{key:"onAdd",value:function(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new xa(e,this._compass,this.options.visualizePitch)),this._container}},{key:"onRemove",value:function(){var e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}},{key:"_createButton",value:function(e,t){var n=v("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}},{key:"_setButtonTitle",value:function(e,t){if(this._map){var n=this._map._getUIString("NavigationControl.".concat(t));e.setAttribute("aria-label",n),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}}}]),t}(),GeolocateControl:function(t){m(i,t);var n=y(i);function i(t){var a;return f(this,i),(a=n.call(this)).options=e.extend({geolocation:e.window.navigator.geolocation},ba,t),e.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],r(a)),a._updateMarkerRotationThrottled=lr(a._updateMarkerRotation,20),a._numberOfWatches=0,a}return p(i,[{key:"onAdd",value:function(e){return this._map=e,this._container=v("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}},{key:"onRemove",value:function(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}},{key:"_checkGeolocationSupport",value:function(t){var n=this,i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!!n.options.geolocation;n._supportsGeolocation=e,t(e)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((function(e){return i("denied"!==e.state)})).catch((function(){return i()})):i()}},{key:"_isOutOfMapMaxBounds",value:function(e){var t=this._map.getMaxBounds(),n=e.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}},{key:"_setErrorState",value:function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}},{key:"_onSuccess",value:function(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish()}}},{key:"_updateCamera",value:function(t){var n=new e.LngLat(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,r=this._map.getBearing(),a=e.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(i),a,{geolocateSource:!0})}},{key:"_updateMarker",value:function(t){if(t){var n=new e.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}},{key:"_updateCircleRadius",value:function(){var t=this._map.transform,n=e.mercatorZfromAltitude(1,t._center.lat)*t.worldSize,i=Math.ceil(2*this._accuracy*n);this._circleElement.style.width="".concat(i,"px"),this._circleElement.style.height="".concat(i,"px")}},{key:"_onZoom",value:function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}},{key:"_updateMarkerRotation",value:function(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}},{key:"_onError",value:function(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish()}}},{key:"_finish",value:function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}},{key:"_setupUI",value:function(t){var n=this;if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(function(e){return e.preventDefault()})),this._geolocateButton=v("button","mapboxgl-ctrl-geolocate",this._container),v("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{var r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=v("div","mapboxgl-user-location"),this._dotElement.appendChild(v("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(v("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ha({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=v("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ha({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(t){t.geolocateSource||"ACTIVE_LOCK"!==n._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(n._watchState="BACKGROUND",n._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),n._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),n.fire(new e.Event("trackuserlocationend")))}))}}},{key:"_onDeviceOrientation",value:function(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}},{key:"trigger",value:function(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}},{key:"_addDeviceOrientationListener",value:function(){var t=this,n=function(){e.window.addEventListener("ondeviceorientationabsolute"in e.window?"deviceorientationabsolute":"deviceorientation",t._onDeviceOrientation)};void 0!==e.window.DeviceMotionEvent&&"function"==typeof e.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(e){"granted"===e&&n()})).catch(console.error):n()}},{key:"_clearWatch",value:function(){this.options.geolocation.clearWatch(this._geolocationWatchID),e.window.removeEventListener("deviceorientation",this._onDeviceOrientation),e.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}}]),i}(e.Evented),AttributionControl:sa,ScaleControl:function(){function t(n){f(this,t),this.options=e.extend({},wa,n),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),e.bindAll(["_update","_setScale","setUnit"],this)}return p(t,[{key:"getDefaultPosition",value:function(){return"bottom-left"}},{key:"_update",value:function(){var e=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,i=t._containerWidth/2-e/2,r=t.unproject([i,n]),a=t.unproject([i+e,n]),o=r.distanceTo(a);if("imperial"===this.options.unit){var s=3.2808*o;s>5280?this._setScale(e,s/5280,"mile"):this._setScale(e,s,"foot")}else"nautical"===this.options.unit?this._setScale(e,o/1852,"nautical-mile"):o>=1e3?this._setScale(e,o/1e3,"kilometer"):this._setScale(e,o,"meter")}},{key:"_setScale",value:function(e,t,n){var i=this;this._map._requestDomTask((function(){var r=function(e){var t=Math.pow(10,"".concat(Math.floor(e)).length-1),n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){var t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(t),a=r/t;i._container.innerHTML=i._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(i._language,{style:"unit",unitDisplay:"short",unit:n}).format(r):"".concat(r,"&nbsp;").concat(ka[n]),i._container.style.width=e*a+"px"}))}},{key:"onAdd",value:function(e){return this._map=e,this._language=e.getLanguage(),this._container=v("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}},{key:"onRemove",value:function(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}},{key:"_setLanguage",value:function(e){this._language=e,this._update()}},{key:"setUnit",value:function(e){this.options.unit=e,this._update()}}]),t}(),FullscreenControl:function(){function t(n){f(this,t),this._fullscreen=!1,n&&n.container&&(n.container instanceof e.window.HTMLElement?this._container=n.container:e.warnOnce("Full screen control 'container' must be a DOM element.")),e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in e.window.document&&(this._fullscreenchange="webkitfullscreenchange")}return p(t,[{key:"onAdd",value:function(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=v("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}},{key:"onRemove",value:function(){this._controlContainer.remove(),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}},{key:"_checkFullscreenSupport",value:function(){return!(!e.window.document.fullscreenEnabled&&!e.window.document.webkitFullscreenEnabled)}},{key:"_setupUI",value:function(){var t=this._fullscreenButton=v("button","mapboxgl-ctrl-fullscreen",this._controlContainer);v("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}},{key:"_updateTitle",value:function(){var e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}},{key:"_getTitle",value:function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}},{key:"_isFullscreen",value:function(){return this._fullscreen}},{key:"_changeIcon",value:function(){(e.window.document.fullscreenElement||e.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}},{key:"_onClickFullscreen",value:function(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}}]),t}(),Popup:function(t){m(i,t);var n=y(i);function i(t){var a;return f(this,i),(a=n.call(this)).options=e.extend(Object.create(fa),t),e.bindAll(["_update","_onClose","remove","_onMouseEvent"],r(a)),a._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[]),a}return p(i,[{key:"addTo",value:function(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.Event("open")),this}},{key:"isOpen",value:function(){return!!this._map}},{key:"remove",value:function(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);var t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.Event("close")),this}},{key:"getLngLat",value:function(){return this._lngLat}},{key:"setLngLat",value:function(t){this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update();var n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}},{key:"trackPointer",value:function(){this._trackPointer=!0,this._pos=null,this._update();var e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}},{key:"getElement",value:function(){return this._container}},{key:"setText",value:function(t){return this.setDOMContent(e.window.document.createTextNode(t))}},{key:"setHTML",value:function(t){var n,i=e.window.document.createDocumentFragment(),r=e.window.document.createElement("body");for(r.innerHTML=t;n=r.firstChild;)i.appendChild(n);return this.setDOMContent(i)}},{key:"getMaxWidth",value:function(){return this._container&&this._container.style.maxWidth}},{key:"setMaxWidth",value:function(e){return this.options.maxWidth=e,this._update(),this}},{key:"setDOMContent",value:function(e){var t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=v("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){var n=this._closeButton=v("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.setAttribute("aria-hidden","true"),n.innerHTML="&#215;",n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}},{key:"addClassName",value:function(e){return this._classList.add(e),this._updateClassList(),this}},{key:"removeClassName",value:function(e){return this._classList.delete(e),this._updateClassList(),this}},{key:"setOffset",value:function(e){return this.options.offset=e,this._update(),this}},{key:"toggleClassName",value:function(e){var t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}},{key:"_onMouseEvent",value:function(e){this._update(e.point)}},{key:"_getAnchor",value:function(e){if(this.options.anchor)return this.options.anchor;var t=this._map,n=this._container,i=this._pos;if(!t||!n||!i)return"bottom";var r=n.offsetWidth,a=n.offsetHeight,o=i.x<r/2,s=i.x>t.transform.width-r/2;if(i.y+e<a)return o?"top-left":s?"top-right":"top";if(i.y>t.transform.height-a){if(o)return"bottom-left";if(s)return"bottom-right"}return o?"left":s?"right":"bottom"}},{key:"_updateClassList",value:function(){var e=this._container;if(e){var t=c(this._classList);t.push("mapboxgl-popup"),this._anchor&&t.push("mapboxgl-popup-anchor-".concat(this._anchor)),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}}},{key:"_update",value:function(t){var n=this,i=this._map,r=this._content;if(i&&(this._lngLat||this._trackPointer)&&r){var a=this._container;if(a||(a=this._container=v("div","mapboxgl-popup",i.getContainer()),this._tip=v("div","mapboxgl-popup-tip",a),a.appendChild(r)),this.options.maxWidth&&a.style.maxWidth!==this.options.maxWidth&&(a.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ca(this._lngLat,this._pos,i.transform)),!this._trackPointer||t){var o=this._pos=this._trackPointer&&t?t:i.project(this._lngLat),s=ma(this.options.offset),l=this._anchor=this._getAnchor(s.y),u=ma(this.options.offset,l),c=o.add(u).round();i._requestDomTask((function(){n._container&&l&&(n._container.style.transform="".concat(da[l]," translate(").concat(c.x,"px,").concat(c.y,"px)"))}))}if(!this._marker&&i._showingGlobe()){var d=e.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(d)}this._updateClassList()}}},{key:"_focusFirstElement",value:function(){if(this.options.focusAfterOpen&&this._container){var e=this._container.querySelector(pa);e&&e.focus()}}},{key:"_onClose",value:function(){this.remove()}},{key:"_setOpacity",value:function(e){this._container&&(this._container.style.opacity="".concat(e)),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}}]),i}(e.Evented),Marker:ha,Style:dn,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.Point,MercatorCoordinate:e.MercatorCoordinate,FreeCameraOptions:Qi,Evented:e.Evented,config:e.config,prewarm:function(){$e().acquire(Ye)},clearPrewarmedResources:function(){var e=Ke;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Ye),Ke=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return e.config.ACCESS_TOKEN},set accessToken(t){e.config.ACCESS_TOKEN=t},get baseApiUrl(){return e.config.API_URL},set baseApiUrl(t){e.config.API_URL=t},get workerCount(){return Je.workerCount},set workerCount(e){Je.workerCount=e},get maxParallelImageRequests(){return e.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage:function(t){e.clearTileCache(t)},workerUrl:"",workerClass:null,setNow:e.exported.setNow,restoreNow:e.exported.restoreNow};return Ta})),n}()},463:function(e,t,n){"use strict";var i=n(791),r=n(296);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var c=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(e,t,n,i,r,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var y={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){y[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];y[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){y[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){y[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){y[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){y[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){y[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){y[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){y[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function _(e,t,n,i){var r=y.hasOwnProperty(t)?y[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!d.call(p,e)||!d.call(f,e)&&(h.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,v);y[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,v);y[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,v);y[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){y[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),y.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){y[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),w=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),L=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var z=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function R(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=D&&e[D]||e["@@iterator"])?e:null}var B,F=Object.assign;function O(e){if(void 0===B)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);B=t&&t[1]||""}return"\n"+B+e}var N=!1;function H(e,t){if(!e||N)return"";N=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var i=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){i=u}e.call(t.prototype)}else{try{throw Error()}catch(u){i=u}e()}}catch(u){if(u&&i&&"string"===typeof u.stack){for(var r=u.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s]){var l="\n"+r[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=s);break}}}finally{N=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?O(e):""}function U(e){switch(e.tag){case 5:return O(e.type);case 16:return O("Lazy");case 13:return O("Suspense");case 19:return O("SuspenseList");case 0:case 2:case 15:return e=H(e.type,!1);case 11:return e=H(e.type.render,!1);case 1:return e=H(e.type,!0);default:return""}}function j(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case k:return"Fragment";case w:return"Portal";case E:return"Profiler";case T:return"StrictMode";case A:return"Suspense";case C:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case L:return(e.displayName||"Context")+".Consumer";case S:return(e._context.displayName||"Context")+".Provider";case M:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case I:return null!==(t=e.displayName||null)?t:j(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return j(e(t))}catch(n){}}return null}function V(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(t);case 8:return t===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function W(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function G(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=G(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Z(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=G(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function K(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=W(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&_(e,"checked",t,!1)}function $(e,t){J(e,t);var n=W(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,W(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Q(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+W(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:W(n)}}function ae(e,t){var n=W(t.value),i=W(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ue,ce,de=(ce=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ue=ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return ce(e,t)}))}:ce);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ye(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=me(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(fe).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var ge=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,ke=null,Te=null;function Ee(e){if(e=_r(e)){if("function"!==typeof we)throw Error(a(280));var t=e.stateNode;t&&(t=br(t),we(e.stateNode,e.type,t))}}function Se(e){ke?Te?Te.push(e):Te=[e]:ke=e}function Le(){if(ke){var e=ke,t=Te;if(Te=ke=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Me(e,t){return e(t)}function Ae(){}var Ce=!1;function Ie(e,t,n){if(Ce)return e(t,n);Ce=!0;try{return Me(e,t,n)}finally{Ce=!1,(null!==ke||null!==Te)&&(Ae(),Le())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var i=br(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var ze=!1;if(c)try{var De={};Object.defineProperty(De,"passive",{get:function(){ze=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(ce){ze=!1}function Re(e,t,n,i,r,a,o,s,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(c){this.onError(c)}}var Be=!1,Fe=null,Oe=!1,Ne=null,He={onError:function(e){Be=!0,Fe=e}};function Ue(e,t,n,i,r,a,o,s,l){Be=!1,Fe=null,Re.apply(He,arguments)}function je(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ve(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function We(e){if(je(e)!==e)throw Error(a(188))}function Ge(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=je(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return We(r),e;if(o===i)return We(r),t;o=o.sibling}throw Error(a(188))}if(n.return!==i.return)n=r,i=o;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=o;break}if(l===i){s=!0,i=r,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,i=r;break}if(l===i){s=!0,i=o,n=r;break}l=l.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==i)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Ze=r.unstable_scheduleCallback,Xe=r.unstable_cancelCallback,Ke=r.unstable_shouldYield,Ye=r.unstable_requestPaint,Je=r.unstable_now,$e=r.unstable_getCurrentPriorityLevel,Qe=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,at=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/lt|0)|0},st=Math.log,lt=Math.LN2;var ut=64,ct=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~r;0!==s?i=dt(s):0!==(a&=o)&&(i=dt(a))}else 0!==(o=n&~r)?i=dt(o):0!==a&&(i=dt(a));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(a=t&-t)||16===r&&0!==(4194240&a)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-ot(t)),i|=e[n],t&=~r;return i}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ut;return 0===(4194240&(ut<<=1))&&(ut=64),e}function yt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-ot(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var _t=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,wt,kt,Tt,Et,St=!1,Lt=[],Mt=null,At=null,Ct=null,It=new Map,Pt=new Map,zt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Rt(e,t){switch(e){case"focusin":case"focusout":Mt=null;break;case"dragenter":case"dragleave":At=null;break;case"mouseover":case"mouseout":Ct=null;break;case"pointerover":case"pointerout":It.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function Bt(e,t,n,i,r,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},null!==t&&(null!==(t=_r(t))&&wt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ft(e){var t=vr(e.target);if(null!==t){var n=je(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ve(n)))return e.blockedOn=t,void Et(e.priority,(function(){kt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ot(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Kt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=_r(n))&&wt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);xe=i,n.target.dispatchEvent(i),xe=null,t.shift()}return!0}function Nt(e,t,n){Ot(e)&&n.delete(t)}function Ht(){St=!1,null!==Mt&&Ot(Mt)&&(Mt=null),null!==At&&Ot(At)&&(At=null),null!==Ct&&Ot(Ct)&&(Ct=null),It.forEach(Nt),Pt.forEach(Nt)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,St||(St=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ht)))}function jt(e){function t(t){return Ut(t,e)}if(0<Lt.length){Ut(Lt[0],e);for(var n=1;n<Lt.length;n++){var i=Lt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Mt&&Ut(Mt,e),null!==At&&Ut(At,e),null!==Ct&&Ut(Ct,e),It.forEach(t),Pt.forEach(t),n=0;n<zt.length;n++)(i=zt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<zt.length&&null===(n=zt[0]).blockedOn;)Ft(n),null===n.blockedOn&&zt.shift()}var Vt=x.ReactCurrentBatchConfig,Wt=!0;function Gt(e,t,n,i){var r=_t,a=Vt.transition;Vt.transition=null;try{_t=1,Zt(e,t,n,i)}finally{_t=r,Vt.transition=a}}function qt(e,t,n,i){var r=_t,a=Vt.transition;Vt.transition=null;try{_t=4,Zt(e,t,n,i)}finally{_t=r,Vt.transition=a}}function Zt(e,t,n,i){if(Wt){var r=Kt(e,t,n,i);if(null===r)Wi(e,t,i,Xt,n),Rt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Mt=Bt(Mt,e,t,n,i,r),!0;case"dragenter":return At=Bt(At,e,t,n,i,r),!0;case"mouseover":return Ct=Bt(Ct,e,t,n,i,r),!0;case"pointerover":var a=r.pointerId;return It.set(a,Bt(It.get(a)||null,e,t,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,Pt.set(a,Bt(Pt.get(a)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Rt(e,i),4&t&&-1<Dt.indexOf(e)){for(;null!==r;){var a=_r(r);if(null!==a&&bt(a),null===(a=Kt(e,t,n,i))&&Wi(e,t,i,Xt,n),a===r)break;r=a}null!==r&&i.stopPropagation()}else Wi(e,t,i,null,n)}}var Xt=null;function Kt(e,t,n,i){if(Xt=null,null!==(e=vr(e=be(i))))if(null===(t=je(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ve(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($e()){case Qe:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Jt=null,$t=null,Qt=null;function en(){if(Qt)return Qt;var e,t,n=$t,i=n.length,r="value"in Jt?Jt.value:Jt.textContent,a=r.length;for(e=0;e<i&&n[e]===r[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===r[a-t];t++);return Qt=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,i,r,a){for(var o in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,ln,un={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cn=an(un),dn=F({},un,{view:0,detail:0}),hn=an(dn),fn=F({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:En,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(on=e.screenX-ln.screenX,sn=e.screenY-ln.screenY):sn=on=0,ln=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=an(fn),mn=an(F({},fn,{dataTransfer:0})),yn=an(F({},dn,{relatedTarget:0})),gn=an(F({},un,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=F({},un,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),_n=an(vn),xn=an(F({},un,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=kn[e])&&!!t[e]}function En(){return Tn}var Sn=F({},dn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:En,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Ln=an(Sn),Mn=an(F({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),An=an(F({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:En})),Cn=an(F({},un,{propertyName:0,elapsedTime:0,pseudoElement:0})),In=F({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=an(In),zn=[9,13,27,32],Dn=c&&"CompositionEvent"in window,Rn=null;c&&"documentMode"in document&&(Rn=document.documentMode);var Bn=c&&"TextEvent"in window&&!Rn,Fn=c&&(!Dn||Rn&&8<Rn&&11>=Rn),On=String.fromCharCode(32),Nn=!1;function Hn(e,t){switch(e){case"keyup":return-1!==zn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var jn=!1;var Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vn[e.type]:"textarea"===t}function Gn(e,t,n,i){Se(i),0<(t=qi(t,"onChange")).length&&(n=new cn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var qn=null,Zn=null;function Xn(e){Oi(e,0)}function Kn(e){if(Z(xr(e)))return e}function Yn(e,t){if("change"===e)return t}var Jn=!1;if(c){var $n;if(c){var Qn="oninput"in document;if(!Qn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Qn="function"===typeof ei.oninput}$n=Qn}else $n=!1;Jn=$n&&(!document.documentMode||9<document.documentMode)}function ti(){qn&&(qn.detachEvent("onpropertychange",ni),Zn=qn=null)}function ni(e){if("value"===e.propertyName&&Kn(Zn)){var t=[];Gn(t,Zn,e,be(e)),Ie(Xn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Zn=n,(qn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Kn(Zn)}function ai(e,t){if("click"===e)return Kn(t)}function oi(e,t){if("input"===e||"change"===e)return Kn(t)}var si="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function li(e,t){if(si(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!d.call(t,r)||!si(e[r],t[r]))return!1}return!0}function ui(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ci(e,t){var n,i=ui(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ui(i)}}function di(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?di(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function fi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pi(e){var t=hi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&di(n.ownerDocument.documentElement,n)){if(null!==i&&fi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,a=Math.min(i.start,r);i=void 0===i.end?a:Math.min(i.end,r),!e.extend&&a>i&&(r=i,i=a,a=r),r=ci(n,a);var o=ci(n,i);r&&o&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),a>i?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mi=c&&"documentMode"in document&&11>=document.documentMode,yi=null,gi=null,vi=null,_i=!1;function xi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_i||null==yi||yi!==X(i)||("selectionStart"in(i=yi)&&fi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},vi&&li(vi,i)||(vi=i,0<(i=qi(gi,"onSelect")).length&&(t=new cn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=yi)))}function bi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wi={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},ki={},Ti={};function Ei(e){if(ki[e])return ki[e];if(!wi[e])return e;var t,n=wi[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ti)return ki[e]=n[t];return e}c&&(Ti=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Si=Ei("animationend"),Li=Ei("animationiteration"),Mi=Ei("animationstart"),Ai=Ei("transitionend"),Ci=new Map,Ii="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pi(e,t){Ci.set(e,t),l(t,[e])}for(var zi=0;zi<Ii.length;zi++){var Di=Ii[zi];Pi(Di.toLowerCase(),"on"+(Di[0].toUpperCase()+Di.slice(1)))}Pi(Si,"onAnimationEnd"),Pi(Li,"onAnimationIteration"),Pi(Mi,"onAnimationStart"),Pi("dblclick","onDoubleClick"),Pi("focusin","onFocus"),Pi("focusout","onBlur"),Pi(Ai,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ri="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Bi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ri));function Fi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,o,s,l,u){if(Ue.apply(this,arguments),Be){if(!Be)throw Error(a(198));var c=Fe;Be=!1,Fe=null,Oe||(Oe=!0,Ne=c)}}(i,t,void 0,e),e.currentTarget=null}function Oi(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var a=void 0;if(t)for(var o=i.length-1;0<=o;o--){var s=i[o],l=s.instance,u=s.currentTarget;if(s=s.listener,l!==a&&r.isPropagationStopped())break e;Fi(r,s,u),a=l}else for(o=0;o<i.length;o++){if(l=(s=i[o]).instance,u=s.currentTarget,s=s.listener,l!==a&&r.isPropagationStopped())break e;Fi(r,s,u),a=l}}}if(Oe)throw e=Ne,Oe=!1,Ne=null,e}function Ni(e,t){var n=t[mr];void 0===n&&(n=t[mr]=new Set);var i=e+"__bubble";n.has(i)||(Vi(t,e,2,!1),n.add(i))}function Hi(e,t,n){var i=0;t&&(i|=4),Vi(n,e,i,t)}var Ui="_reactListening"+Math.random().toString(36).slice(2);function ji(e){if(!e[Ui]){e[Ui]=!0,o.forEach((function(t){"selectionchange"!==t&&(Bi.has(t)||Hi(t,!1,e),Hi(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ui]||(t[Ui]=!0,Hi("selectionchange",!1,t))}}function Vi(e,t,n,i){switch(Yt(t)){case 1:var r=Gt;break;case 4:r=qt;break;default:r=Zt}n=r.bind(null,t,n,e),r=void 0,!ze||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Wi(e,t,n,i,r){var a=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;o=o.return}for(;null!==s;){if(null===(o=vr(s)))return;if(5===(l=o.tag)||6===l){i=a=o;continue e}s=s.parentNode}}i=i.return}Ie((function(){var i=a,r=be(n),o=[];e:{var s=Ci.get(e);if(void 0!==s){var l=cn,u=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Ln;break;case"focusin":u="focus",l=yn;break;case"focusout":u="blur",l=yn;break;case"beforeblur":case"afterblur":l=yn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=An;break;case Si:case Li:case Mi:l=gn;break;case Ai:l=Cn;break;case"scroll":l=hn;break;case"wheel":l=Pn;break;case"copy":case"cut":case"paste":l=_n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Mn}var c=0!==(4&t),d=!c&&"scroll"===e,h=c?null!==s?s+"Capture":null:s;c=[];for(var f,p=i;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==h&&(null!=(m=Pe(p,h))&&c.push(Gi(p,m,f)))),d)break;p=p.return}0<c.length&&(s=new l(s,u,null,n,r),o.push({event:s,listeners:c}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xe||!(u=n.relatedTarget||n.fromElement)||!vr(u)&&!u[pr])&&(l||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=i,null!==(u=(u=n.relatedTarget||n.toElement)?vr(u):null)&&(u!==(d=je(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(l=null,u=i),l!==u)){if(c=pn,m="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(c=Mn,m="onPointerLeave",h="onPointerEnter",p="pointer"),d=null==l?s:xr(l),f=null==u?s:xr(u),(s=new c(m,p+"leave",l,n,r)).target=d,s.relatedTarget=f,m=null,vr(r)===i&&((c=new c(h,p+"enter",u,n,r)).target=f,c.relatedTarget=d,m=c),d=m,l&&u)e:{for(h=u,p=0,f=c=l;f;f=Zi(f))p++;for(f=0,m=h;m;m=Zi(m))f++;for(;0<p-f;)c=Zi(c),p--;for(;0<f-p;)h=Zi(h),f--;for(;p--;){if(c===h||null!==h&&c===h.alternate)break e;c=Zi(c),h=Zi(h)}c=null}else c=null;null!==l&&Xi(o,s,l,c,!1),null!==u&&null!==d&&Xi(o,d,u,c,!0)}if("select"===(l=(s=i?xr(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var y=Yn;else if(Wn(s))if(Jn)y=oi;else{y=ri;var g=ii}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(y=ai);switch(y&&(y=y(e,i))?Gn(o,y,n,r):(g&&g(e,s,i),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=i?xr(i):window,e){case"focusin":(Wn(g)||"true"===g.contentEditable)&&(yi=g,gi=i,vi=null);break;case"focusout":vi=gi=yi=null;break;case"mousedown":_i=!0;break;case"contextmenu":case"mouseup":case"dragend":_i=!1,xi(o,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":xi(o,n,r)}var v;if(Dn)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else jn?Hn(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(Fn&&"ko"!==n.locale&&(jn||"onCompositionStart"!==_?"onCompositionEnd"===_&&jn&&(v=en()):($t="value"in(Jt=r)?Jt.value:Jt.textContent,jn=!0)),0<(g=qi(i,_)).length&&(_=new xn(_,e,null,n,r),o.push({event:_,listeners:g}),v?_.data=v:null!==(v=Un(n))&&(_.data=v))),(v=Bn?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Nn=!0,On);case"textInput":return(e=t.data)===On&&Nn?null:e;default:return null}}(e,n):function(e,t){if(jn)return"compositionend"===e||!Dn&&Hn(e,t)?(e=en(),Qt=$t=Jt=null,jn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=qi(i,"onBeforeInput")).length&&(r=new xn("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=v))}Oi(o,t)}))}function Gi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=Pe(e,n))&&i.unshift(Gi(e,a,r)),null!=(a=Pe(e,t))&&i.push(Gi(e,a,r))),e=e.return}return i}function Zi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xi(e,t,n,i,r){for(var a=t._reactName,o=[];null!==n&&n!==i;){var s=n,l=s.alternate,u=s.stateNode;if(null!==l&&l===i)break;5===s.tag&&null!==u&&(s=u,r?null!=(l=Pe(n,a))&&o.unshift(Gi(n,l,s)):r||null!=(l=Pe(n,a))&&o.push(Gi(n,l,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Ki=/\r\n?/g,Yi=/\u0000|\uFFFD/g;function Ji(e){return("string"===typeof e?e:""+e).replace(Ki,"\n").replace(Yi,"")}function $i(e,t,n){if(t=Ji(t),Ji(e)!==t&&n)throw Error(a(425))}function Qi(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,ar="function"===typeof Promise?Promise:void 0,or="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ar?function(e){return ar.resolve(null).then(e).catch(sr)}:ir;function sr(e){setTimeout((function(){throw e}))}function lr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void jt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);jt(t)}function ur(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function cr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var dr=Math.random().toString(36).slice(2),hr="__reactFiber$"+dr,fr="__reactProps$"+dr,pr="__reactContainer$"+dr,mr="__reactEvents$"+dr,yr="__reactListeners$"+dr,gr="__reactHandles$"+dr;function vr(e){var t=e[hr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pr]||n[hr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=cr(e);null!==e;){if(n=e[hr])return n;e=cr(e)}return t}n=(e=n).parentNode}return null}function _r(e){return!(e=e[hr]||e[pr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function br(e){return e[fr]||null}var wr=[],kr=-1;function Tr(e){return{current:e}}function Er(e){0>kr||(e.current=wr[kr],wr[kr]=null,kr--)}function Sr(e,t){kr++,wr[kr]=e.current,e.current=t}var Lr={},Mr=Tr(Lr),Ar=Tr(!1),Cr=Lr;function Ir(e,t){var n=e.type.contextTypes;if(!n)return Lr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Pr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function zr(){Er(Ar),Er(Mr)}function Dr(e,t,n){if(Mr.current!==Lr)throw Error(a(168));Sr(Mr,t),Sr(Ar,n)}function Rr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(a(108,V(e)||"Unknown",r));return F({},n,i)}function Br(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Lr,Cr=Mr.current,Sr(Mr,e),Sr(Ar,Ar.current),!0}function Fr(e,t,n){var i=e.stateNode;if(!i)throw Error(a(169));n?(e=Rr(e,t,Cr),i.__reactInternalMemoizedMergedChildContext=e,Er(Ar),Er(Mr),Sr(Mr,e)):Er(Ar),Sr(Ar,n)}var Or=null,Nr=!1,Hr=!1;function Ur(e){null===Or?Or=[e]:Or.push(e)}function jr(){if(!Hr&&null!==Or){Hr=!0;var e=0,t=_t;try{var n=Or;for(_t=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Or=null,Nr=!1}catch(r){throw null!==Or&&(Or=Or.slice(e+1)),Ze(Qe,jr),r}finally{_t=t,Hr=!1}}return null}var Vr=[],Wr=0,Gr=null,qr=0,Zr=[],Xr=0,Kr=null,Yr=1,Jr="";function $r(e,t){Vr[Wr++]=qr,Vr[Wr++]=Gr,Gr=e,qr=t}function Qr(e,t,n){Zr[Xr++]=Yr,Zr[Xr++]=Jr,Zr[Xr++]=Kr,Kr=e;var i=Yr;e=Jr;var r=32-ot(i)-1;i&=~(1<<r),n+=1;var a=32-ot(t)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Yr=1<<32-ot(t)+r|n<<r|i,Jr=a+e}else Yr=1<<a|n<<r|i,Jr=e}function ea(e){null!==e.return&&($r(e,1),Qr(e,1,0))}function ta(e){for(;e===Gr;)Gr=Vr[--Wr],Vr[Wr]=null,qr=Vr[--Wr],Vr[Wr]=null;for(;e===Kr;)Kr=Zr[--Xr],Zr[Xr]=null,Jr=Zr[--Xr],Zr[Xr]=null,Yr=Zr[--Xr],Zr[Xr]=null}var na=null,ia=null,ra=!1,aa=null;function oa(e,t){var n=Pu(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function sa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,ia=ur(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,ia=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Kr?{id:Yr,overflow:Jr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Pu(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,ia=null,!0);default:return!1}}function la(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ua(e){if(ra){var t=ia;if(t){var n=t;if(!sa(e,t)){if(la(e))throw Error(a(418));t=ur(n.nextSibling);var i=na;t&&sa(e,t)?oa(i,n):(e.flags=-4097&e.flags|2,ra=!1,na=e)}}else{if(la(e))throw Error(a(418));e.flags=-4097&e.flags|2,ra=!1,na=e}}}function ca(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function da(e){if(e!==na)return!1;if(!ra)return ca(e),ra=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=ia)){if(la(e))throw ha(),Error(a(418));for(;t;)oa(e,t),t=ur(t.nextSibling)}if(ca(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ia=ur(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ia=null}}else ia=na?ur(e.stateNode.nextSibling):null;return!0}function ha(){for(var e=ia;e;)e=ur(e.nextSibling)}function fa(){ia=na=null,ra=!1}function pa(e){null===aa?aa=[e]:aa.push(e)}var ma=x.ReactCurrentBatchConfig;function ya(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var ga=Tr(null),va=null,_a=null,xa=null;function ba(){xa=_a=va=null}function wa(e){var t=ga.current;Er(ga),e._currentValue=t}function ka(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Ta(e,t){va=e,xa=_a=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xs=!0),e.firstContext=null)}function Ea(e){var t=e._currentValue;if(xa!==e)if(e={context:e,memoizedValue:t,next:null},null===_a){if(null===va)throw Error(a(308));_a=e,va.dependencies={lanes:0,firstContext:e}}else _a=_a.next=e;return t}var Sa=null;function La(e){null===Sa?Sa=[e]:Sa.push(e)}function Ma(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,La(t)):(n.next=r.next,r.next=n),t.interleaved=n,Aa(e,i)}function Aa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ca=!1;function Ia(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Pa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function za(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Da(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Al)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Aa(e,n)}return null===(r=i.interleaved)?(t.next=t,La(i)):(t.next=r.next,r.next=t),i.interleaved=t,Aa(e,n)}function Ra(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Ba(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=t:a=a.next=t}else r=a=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Fa(e,t,n,i){var r=e.updateQueue;Ca=!1;var a=r.firstBaseUpdate,o=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var l=s,u=l.next;l.next=null,null===o?a=u:o.next=u,o=l;var c=e.alternate;null!==c&&((s=(c=c.updateQueue).lastBaseUpdate)!==o&&(null===s?c.firstBaseUpdate=u:s.next=u,c.lastBaseUpdate=l))}if(null!==a){var d=r.baseState;for(o=0,c=u=l=null,s=a;;){var h=s.lane,f=s.eventTime;if((i&h)===h){null!==c&&(c=c.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,m=s;switch(h=t,f=n,m.tag){case 1:if("function"===typeof(p=m.payload)){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=m.payload)?p.call(f,d,h):p)||void 0===h)break e;d=F({},d,h);break e;case 2:Ca=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[s]:h.push(s))}else f={eventTime:f,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===c?(u=c=f,l=d):c=c.next=f,o|=h;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(h=s).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===c&&(l=d),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,null!==(t=r.shared.interleaved)){r=t;do{o|=r.lane,r=r.next}while(r!==t)}else null===a&&(r.shared.lanes=0);Fl|=o,e.lanes=o,e.memoizedState=d}}function Oa(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(a(191,r));r.call(i)}}}var Na=(new i.Component).refs;function Ha(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Ua={isMounted:function(e){return!!(e=e._reactInternals)&&je(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tu(),r=nu(e),a=za(i,r);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Da(e,a,r))&&(iu(t,e,r,i),Ra(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tu(),r=nu(e),a=za(i,r);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Da(e,a,r))&&(iu(t,e,r,i),Ra(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tu(),i=nu(e),r=za(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Da(e,r,i))&&(iu(t,e,i,n),Ra(t,e,i))}};function ja(e,t,n,i,r,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(r,a))}function Va(e,t,n){var i=!1,r=Lr,a=t.contextType;return"object"===typeof a&&null!==a?a=Ea(a):(r=Pr(t)?Cr:Mr.current,a=(i=null!==(i=t.contextTypes)&&void 0!==i)?Ir(e,r):Lr),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Ua,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a),t}function Wa(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Ua.enqueueReplaceState(t,t.state,null)}function Ga(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=Na,Ia(e);var a=t.contextType;"object"===typeof a&&null!==a?r.context=Ea(a):(a=Pr(t)?Cr:Mr.current,r.context=Ir(e,a)),r.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(Ha(e,t,a,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Ua.enqueueReplaceState(r,r.state,null),Fa(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function qa(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var i=n.stateNode}if(!i)throw Error(a(147,e));var r=i,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=r.refs;t===Na&&(t=r.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function Za(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Xa(e){return(0,e._init)(e._payload)}function Ka(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Du(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Ou(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function u(e,t,n,i){var a=n.type;return a===k?d(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===P&&Xa(a)===t.type)?((i=r(t,n.props)).ref=qa(e,t,n),i.return=e,i):((i=Ru(n.type,n.key,n.props,null,e.mode,i)).ref=qa(e,t,n),i.return=e,i)}function c(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Nu(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function d(e,t,n,i,a){return null===t||7!==t.tag?((t=Bu(n,e.mode,i,a)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ou(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Ru(t.type,t.key,t.props,null,e.mode,n)).ref=qa(e,null,t),n.return=e,n;case w:return(t=Nu(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(te(t)||R(t))return(t=Bu(t,e.mode,n,null)).return=e,t;Za(e,t)}return null}function f(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===r?u(e,t,n,i):null;case w:return n.key===r?c(e,t,n,i):null;case P:return f(e,t,(r=n._init)(n._payload),i)}if(te(n)||R(n))return null!==r?null:d(e,t,n,i,null);Za(e,n)}return null}function p(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case b:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case w:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case P:return p(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||R(i))return d(t,e=e.get(n)||null,i,r,null);Za(t,i)}return null}function m(r,a,s,l){for(var u=null,c=null,d=a,m=a=0,y=null;null!==d&&m<s.length;m++){d.index>m?(y=d,d=null):y=d.sibling;var g=f(r,d,s[m],l);if(null===g){null===d&&(d=y);break}e&&d&&null===g.alternate&&t(r,d),a=o(g,a,m),null===c?u=g:c.sibling=g,c=g,d=y}if(m===s.length)return n(r,d),ra&&$r(r,m),u;if(null===d){for(;m<s.length;m++)null!==(d=h(r,s[m],l))&&(a=o(d,a,m),null===c?u=d:c.sibling=d,c=d);return ra&&$r(r,m),u}for(d=i(r,d);m<s.length;m++)null!==(y=p(d,r,m,s[m],l))&&(e&&null!==y.alternate&&d.delete(null===y.key?m:y.key),a=o(y,a,m),null===c?u=y:c.sibling=y,c=y);return e&&d.forEach((function(e){return t(r,e)})),ra&&$r(r,m),u}function y(r,s,l,u){var c=R(l);if("function"!==typeof c)throw Error(a(150));if(null==(l=c.call(l)))throw Error(a(151));for(var d=c=null,m=s,y=s=0,g=null,v=l.next();null!==m&&!v.done;y++,v=l.next()){m.index>y?(g=m,m=null):g=m.sibling;var _=f(r,m,v.value,u);if(null===_){null===m&&(m=g);break}e&&m&&null===_.alternate&&t(r,m),s=o(_,s,y),null===d?c=_:d.sibling=_,d=_,m=g}if(v.done)return n(r,m),ra&&$r(r,y),c;if(null===m){for(;!v.done;y++,v=l.next())null!==(v=h(r,v.value,u))&&(s=o(v,s,y),null===d?c=v:d.sibling=v,d=v);return ra&&$r(r,y),c}for(m=i(r,m);!v.done;y++,v=l.next())null!==(v=p(m,r,y,v.value,u))&&(e&&null!==v.alternate&&m.delete(null===v.key?y:v.key),s=o(v,s,y),null===d?c=v:d.sibling=v,d=v);return e&&m.forEach((function(e){return t(r,e)})),ra&&$r(r,y),c}return function e(i,a,o,l){if("object"===typeof o&&null!==o&&o.type===k&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case b:e:{for(var u=o.key,c=a;null!==c;){if(c.key===u){if((u=o.type)===k){if(7===c.tag){n(i,c.sibling),(a=r(c,o.props.children)).return=i,i=a;break e}}else if(c.elementType===u||"object"===typeof u&&null!==u&&u.$$typeof===P&&Xa(u)===c.type){n(i,c.sibling),(a=r(c,o.props)).ref=qa(i,c,o),a.return=i,i=a;break e}n(i,c);break}t(i,c),c=c.sibling}o.type===k?((a=Bu(o.props.children,i.mode,l,o.key)).return=i,i=a):((l=Ru(o.type,o.key,o.props,null,i.mode,l)).ref=qa(i,a,o),l.return=i,i=l)}return s(i);case w:e:{for(c=o.key;null!==a;){if(a.key===c){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(i,a.sibling),(a=r(a,o.children||[])).return=i,i=a;break e}n(i,a);break}t(i,a),a=a.sibling}(a=Nu(o,i.mode,l)).return=i,i=a}return s(i);case P:return e(i,a,(c=o._init)(o._payload),l)}if(te(o))return m(i,a,o,l);if(R(o))return y(i,a,o,l);Za(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(i,a.sibling),(a=r(a,o)).return=i,i=a):(n(i,a),(a=Ou(o,i.mode,l)).return=i,i=a),s(i)):n(i,a)}}var Ya=Ka(!0),Ja=Ka(!1),$a={},Qa=Tr($a),eo=Tr($a),to=Tr($a);function no(e){if(e===$a)throw Error(a(174));return e}function io(e,t){switch(Sr(to,t),Sr(eo,e),Sr(Qa,$a),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Er(Qa),Sr(Qa,t)}function ro(){Er(Qa),Er(eo),Er(to)}function ao(e){no(to.current);var t=no(Qa.current),n=le(t,e.type);t!==n&&(Sr(eo,e),Sr(Qa,n))}function oo(e){eo.current===e&&(Er(Qa),Er(eo))}var so=Tr(0);function lo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var uo=[];function co(){for(var e=0;e<uo.length;e++)uo[e]._workInProgressVersionPrimary=null;uo.length=0}var ho=x.ReactCurrentDispatcher,fo=x.ReactCurrentBatchConfig,po=0,mo=null,yo=null,go=null,vo=!1,_o=!1,xo=0,bo=0;function wo(){throw Error(a(321))}function ko(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!si(e[n],t[n]))return!1;return!0}function To(e,t,n,i,r,o){if(po=o,mo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ho.current=null===e||null===e.memoizedState?ss:ls,e=n(i,r),_o){o=0;do{if(_o=!1,xo=0,25<=o)throw Error(a(301));o+=1,go=yo=null,t.updateQueue=null,ho.current=us,e=n(i,r)}while(_o)}if(ho.current=os,t=null!==yo&&null!==yo.next,po=0,go=yo=mo=null,vo=!1,t)throw Error(a(300));return e}function Eo(){var e=0!==xo;return xo=0,e}function So(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===go?mo.memoizedState=go=e:go=go.next=e,go}function Lo(){if(null===yo){var e=mo.alternate;e=null!==e?e.memoizedState:null}else e=yo.next;var t=null===go?mo.memoizedState:go.next;if(null!==t)go=t,yo=e;else{if(null===e)throw Error(a(310));e={memoizedState:(yo=e).memoizedState,baseState:yo.baseState,baseQueue:yo.baseQueue,queue:yo.queue,next:null},null===go?mo.memoizedState=go=e:go=go.next=e}return go}function Mo(e,t){return"function"===typeof t?t(e):t}function Ao(e){var t=Lo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=yo,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var s=r.next;r.next=o.next,o.next=s}i.baseQueue=r=o,n.pending=null}if(null!==r){o=r.next,i=i.baseState;var l=s=null,u=null,c=o;do{var d=c.lane;if((po&d)===d)null!==u&&(u=u.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:e(i,c.action);else{var h={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===u?(l=u=h,s=i):u=u.next=h,mo.lanes|=d,Fl|=d}c=c.next}while(null!==c&&c!==o);null===u?s=i:u.next=l,si(i,t.memoizedState)||(xs=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=u,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{o=r.lane,mo.lanes|=o,Fl|=o,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Co(e){var t=Lo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{o=e(o,s.action),s=s.next}while(s!==r);si(o,t.memoizedState)||(xs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function Io(){}function Po(e,t){var n=mo,i=Lo(),r=t(),o=!si(i.memoizedState,r);if(o&&(i.memoizedState=r,xs=!0),i=i.queue,Wo(Ro.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||null!==go&&1&go.memoizedState.tag){if(n.flags|=2048,No(9,Do.bind(null,n,i,r,t),void 0,null),null===Cl)throw Error(a(349));0!==(30&po)||zo(n,t,r)}return r}function zo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Do(e,t,n,i){t.value=n,t.getSnapshot=i,Bo(t)&&Fo(e)}function Ro(e,t,n){return n((function(){Bo(t)&&Fo(e)}))}function Bo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!si(e,n)}catch(i){return!0}}function Fo(e){var t=Aa(e,1);null!==t&&iu(t,e,1,-1)}function Oo(e){var t=So();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Mo,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,mo,e),[t.memoizedState,e]}function No(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Ho(){return Lo().memoizedState}function Uo(e,t,n,i){var r=So();mo.flags|=e,r.memoizedState=No(1|t,n,void 0,void 0===i?null:i)}function jo(e,t,n,i){var r=Lo();i=void 0===i?null:i;var a=void 0;if(null!==yo){var o=yo.memoizedState;if(a=o.destroy,null!==i&&ko(i,o.deps))return void(r.memoizedState=No(t,n,a,i))}mo.flags|=e,r.memoizedState=No(1|t,n,a,i)}function Vo(e,t){return Uo(8390656,8,e,t)}function Wo(e,t){return jo(2048,8,e,t)}function Go(e,t){return jo(4,2,e,t)}function qo(e,t){return jo(4,4,e,t)}function Zo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Xo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,jo(4,4,Zo.bind(null,t,e),n)}function Ko(){}function Yo(e,t){var n=Lo();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ko(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Jo(e,t){var n=Lo();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ko(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function $o(e,t,n){return 0===(21&po)?(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=n):(si(n,t)||(n=mt(),mo.lanes|=n,Fl|=n,e.baseState=!0),t)}function Qo(e,t){var n=_t;_t=0!==n&&4>n?n:4,e(!0);var i=fo.transition;fo.transition={};try{e(!1),t()}finally{_t=n,fo.transition=i}}function es(){return Lo().memoizedState}function ts(e,t,n){var i=nu(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},is(e))rs(t,n);else if(null!==(n=Ma(e,t,n,i))){iu(n,e,i,tu()),as(n,t,i)}}function ns(e,t,n){var i=nu(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(is(e))rs(t,r);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(r.hasEagerState=!0,r.eagerState=s,si(s,o)){var l=t.interleaved;return null===l?(r.next=r,La(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(u){}null!==(n=Ma(e,t,r,i))&&(iu(n,e,i,r=tu()),as(n,t,i))}}function is(e){var t=e.alternate;return e===mo||null!==t&&t===mo}function rs(e,t){_o=vo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function as(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,vt(e,n)}}var os={readContext:Ea,useCallback:wo,useContext:wo,useEffect:wo,useImperativeHandle:wo,useInsertionEffect:wo,useLayoutEffect:wo,useMemo:wo,useReducer:wo,useRef:wo,useState:wo,useDebugValue:wo,useDeferredValue:wo,useTransition:wo,useMutableSource:wo,useSyncExternalStore:wo,useId:wo,unstable_isNewReconciler:!1},ss={readContext:Ea,useCallback:function(e,t){return So().memoizedState=[e,void 0===t?null:t],e},useContext:Ea,useEffect:Vo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Uo(4194308,4,Zo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Uo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Uo(4,2,e,t)},useMemo:function(e,t){var n=So();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=So();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=ts.bind(null,mo,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},So().memoizedState=e},useState:Oo,useDebugValue:Ko,useDeferredValue:function(e){return So().memoizedState=e},useTransition:function(){var e=Oo(!1),t=e[0];return e=Qo.bind(null,e[1]),So().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=mo,r=So();if(ra){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Cl)throw Error(a(349));0!==(30&po)||zo(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,Vo(Ro.bind(null,i,o,e),[e]),i.flags|=2048,No(9,Do.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=So(),t=Cl.identifierPrefix;if(ra){var n=Jr;t=":"+t+"R"+(n=(Yr&~(1<<32-ot(Yr)-1)).toString(32)+n),0<(n=xo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=bo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ls={readContext:Ea,useCallback:Yo,useContext:Ea,useEffect:Wo,useImperativeHandle:Xo,useInsertionEffect:Go,useLayoutEffect:qo,useMemo:Jo,useReducer:Ao,useRef:Ho,useState:function(){return Ao(Mo)},useDebugValue:Ko,useDeferredValue:function(e){return $o(Lo(),yo.memoizedState,e)},useTransition:function(){return[Ao(Mo)[0],Lo().memoizedState]},useMutableSource:Io,useSyncExternalStore:Po,useId:es,unstable_isNewReconciler:!1},us={readContext:Ea,useCallback:Yo,useContext:Ea,useEffect:Wo,useImperativeHandle:Xo,useInsertionEffect:Go,useLayoutEffect:qo,useMemo:Jo,useReducer:Co,useRef:Ho,useState:function(){return Co(Mo)},useDebugValue:Ko,useDeferredValue:function(e){var t=Lo();return null===yo?t.memoizedState=e:$o(t,yo.memoizedState,e)},useTransition:function(){return[Co(Mo)[0],Lo().memoizedState]},useMutableSource:Io,useSyncExternalStore:Po,useId:es,unstable_isNewReconciler:!1};function cs(e,t){try{var n="",i=t;do{n+=U(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:r,digest:null}}function ds(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function hs(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var fs="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,n){(n=za(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Gl||(Gl=!0,ql=i),hs(0,t)},n}function ms(e,t,n){(n=za(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){hs(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){hs(0,t),"function"!==typeof i&&(null===Zl?Zl=new Set([this]):Zl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ys(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new fs;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Su.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vs(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=za(-1,1)).tag=2,Da(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var _s=x.ReactCurrentOwner,xs=!1;function bs(e,t,n,i){t.child=null===e?Ja(t,null,n,i):Ya(t,e.child,n,i)}function ws(e,t,n,i,r){n=n.render;var a=t.ref;return Ta(t,r),i=To(e,t,n,i,a,r),n=Eo(),null===e||xs?(ra&&n&&ea(t),t.flags|=1,bs(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Gs(e,t,r))}function ks(e,t,n,i,r){if(null===e){var a=n.type;return"function"!==typeof a||zu(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ru(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ts(e,t,a,i,r))}if(a=e.child,0===(e.lanes&r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:li)(o,i)&&e.ref===t.ref)return Gs(e,t,r)}return t.flags|=1,(e=Du(a,i)).ref=t.ref,e.return=t,t.child=e}function Ts(e,t,n,i,r){if(null!==e){var a=e.memoizedProps;if(li(a,i)&&e.ref===t.ref){if(xs=!1,t.pendingProps=i=a,0===(e.lanes&r))return t.lanes=e.lanes,Gs(e,t,r);0!==(131072&e.flags)&&(xs=!0)}}return Ls(e,t,n,i,r)}function Es(e,t,n){var i=t.pendingProps,r=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Sr(Dl,zl),zl|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Sr(Dl,zl),zl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==a?a.baseLanes:n,Sr(Dl,zl),zl|=i}else null!==a?(i=a.baseLanes|n,t.memoizedState=null):i=n,Sr(Dl,zl),zl|=i;return bs(e,t,r,n),t.child}function Ss(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ls(e,t,n,i,r){var a=Pr(n)?Cr:Mr.current;return a=Ir(t,a),Ta(t,r),n=To(e,t,n,i,a,r),i=Eo(),null===e||xs?(ra&&i&&ea(t),t.flags|=1,bs(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Gs(e,t,r))}function Ms(e,t,n,i,r){if(Pr(n)){var a=!0;Br(t)}else a=!1;if(Ta(t,r),null===t.stateNode)Ws(e,t),Va(t,n,i),Ga(t,n,i,r),i=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,u=n.contextType;"object"===typeof u&&null!==u?u=Ea(u):u=Ir(t,u=Pr(n)?Cr:Mr.current);var c=n.getDerivedStateFromProps,d="function"===typeof c||"function"===typeof o.getSnapshotBeforeUpdate;d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==i||l!==u)&&Wa(t,o,i,u),Ca=!1;var h=t.memoizedState;o.state=h,Fa(t,i,o,r),l=t.memoizedState,s!==i||h!==l||Ar.current||Ca?("function"===typeof c&&(Ha(t,n,c,i),l=t.memoizedState),(s=Ca||ja(t,n,s,i,h,l,u))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),o.props=i,o.state=l,o.context=u,i=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,Pa(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:ya(t.type,s),o.props=u,d=t.pendingProps,h=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=Ea(l):l=Ir(t,l=Pr(n)?Cr:Mr.current);var f=n.getDerivedStateFromProps;(c="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==d||h!==l)&&Wa(t,o,i,l),Ca=!1,h=t.memoizedState,o.state=h,Fa(t,i,o,r);var p=t.memoizedState;s!==d||h!==p||Ar.current||Ca?("function"===typeof f&&(Ha(t,n,f,i),p=t.memoizedState),(u=Ca||ja(t,n,u,i,h,p,l)||!1)?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,p,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,p,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),o.props=i,o.state=p,o.context=l,i=u):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return As(e,t,n,i,a,r)}function As(e,t,n,i,r,a){Ss(e,t);var o=0!==(128&t.flags);if(!i&&!o)return r&&Fr(t,n,!1),Gs(e,t,a);i=t.stateNode,_s.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=Ya(t,e.child,null,a),t.child=Ya(t,null,s,a)):bs(e,t,s,a),t.memoizedState=i.state,r&&Fr(t,n,!0),t.child}function Cs(e){var t=e.stateNode;t.pendingContext?Dr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Dr(0,t.context,!1),io(e,t.containerInfo)}function Is(e,t,n,i,r){return fa(),pa(r),t.flags|=256,bs(e,t,n,i),t.child}var Ps,zs,Ds,Rs,Bs={dehydrated:null,treeContext:null,retryLane:0};function Fs(e){return{baseLanes:e,cachePool:null,transitions:null}}function Os(e,t,n){var i,r=t.pendingProps,o=so.current,s=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&o)),i?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Sr(so,1&o),null===e)return ua(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,s?(r=t.mode,s=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=l):s=Fu(l,r,0,null),e=Bu(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Fs(n),t.memoizedState=Bs,e):Ns(t,l));if(null!==(o=e.memoizedState)&&null!==(i=o.dehydrated))return function(e,t,n,i,r,o,s){if(n)return 256&t.flags?(t.flags&=-257,Hs(e,t,s,i=ds(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,r=t.mode,i=Fu({mode:"visible",children:i.children},r,0,null),(o=Bu(o,r,s,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,0!==(1&t.mode)&&Ya(t,e.child,null,s),t.child.memoizedState=Fs(s),t.memoizedState=Bs,o);if(0===(1&t.mode))return Hs(e,t,s,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,Hs(e,t,s,i=ds(o=Error(a(419)),i,void 0))}if(l=0!==(s&e.childLanes),xs||l){if(null!==(i=Cl)){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|s))?0:r)&&r!==o.retryLane&&(o.retryLane=r,Aa(e,r),iu(i,e,r,-1))}return yu(),Hs(e,t,s,i=ds(Error(a(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Mu.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,ia=ur(r.nextSibling),na=t,ra=!0,aa=null,null!==e&&(Zr[Xr++]=Yr,Zr[Xr++]=Jr,Zr[Xr++]=Kr,Yr=e.id,Jr=e.overflow,Kr=t),t=Ns(t,i.children),t.flags|=4096,t)}(e,t,l,r,i,o,n);if(s){s=r.fallback,l=t.mode,i=(o=e.child).sibling;var u={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==o?((r=t.child).childLanes=0,r.pendingProps=u,t.deletions=null):(r=Du(o,u)).subtreeFlags=14680064&o.subtreeFlags,null!==i?s=Du(i,s):(s=Bu(s,l,n,null)).flags|=2,s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,l=null===(l=e.child.memoizedState)?Fs(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~n,t.memoizedState=Bs,r}return e=(s=e.child).sibling,r=Du(s,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Ns(e,t){return(t=Fu({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Hs(e,t,n,i){return null!==i&&pa(i),Ya(t,e.child,null,n),(e=Ns(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Us(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),ka(e.return,t,n)}function js(e,t,n,i,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function Vs(e,t,n){var i=t.pendingProps,r=i.revealOrder,a=i.tail;if(bs(e,t,i.children,n),0!==(2&(i=so.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Us(e,n,t);else if(19===e.tag)Us(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Sr(so,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===lo(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),js(t,!1,r,n,a);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===lo(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}js(t,!0,n,null,a);break;case"together":js(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ws(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Gs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Fl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Du(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Du(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function qs(e,t){if(!ra)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Zs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Xs(e,t,n){var i=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zs(t),null;case 1:case 17:return Pr(t.type)&&zr(),Zs(t),null;case 3:return i=t.stateNode,ro(),Er(Ar),Er(Mr),co(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(da(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(su(aa),aa=null))),zs(e,t),Zs(t),null;case 5:oo(t);var r=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Ds(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(a(166));return Zs(t),null}if(e=no(Qa.current),da(t)){i=t.stateNode,n=t.type;var o=t.memoizedProps;switch(i[hr]=t,i[fr]=o,e=0!==(1&t.mode),n){case"dialog":Ni("cancel",i),Ni("close",i);break;case"iframe":case"object":case"embed":Ni("load",i);break;case"video":case"audio":for(r=0;r<Ri.length;r++)Ni(Ri[r],i);break;case"source":Ni("error",i);break;case"img":case"image":case"link":Ni("error",i),Ni("load",i);break;case"details":Ni("toggle",i);break;case"input":Y(i,o),Ni("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Ni("invalid",i);break;case"textarea":re(i,o),Ni("invalid",i)}for(var l in ve(n,o),r=null,o)if(o.hasOwnProperty(l)){var u=o[l];"children"===l?"string"===typeof u?i.textContent!==u&&(!0!==o.suppressHydrationWarning&&$i(i.textContent,u,e),r=["children",u]):"number"===typeof u&&i.textContent!==""+u&&(!0!==o.suppressHydrationWarning&&$i(i.textContent,u,e),r=["children",""+u]):s.hasOwnProperty(l)&&null!=u&&"onScroll"===l&&Ni("scroll",i)}switch(n){case"input":q(i),Q(i,o,!0);break;case"textarea":q(i),oe(i);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(i.onclick=Qi)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[hr]=t,e[fr]=i,Ps(e,t,!1,!1),t.stateNode=e;e:{switch(l=_e(n,i),n){case"dialog":Ni("cancel",e),Ni("close",e),r=i;break;case"iframe":case"object":case"embed":Ni("load",e),r=i;break;case"video":case"audio":for(r=0;r<Ri.length;r++)Ni(Ri[r],e);r=i;break;case"source":Ni("error",e),r=i;break;case"img":case"image":case"link":Ni("error",e),Ni("load",e),r=i;break;case"details":Ni("toggle",e),r=i;break;case"input":Y(e,i),r=K(e,i),Ni("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=F({},i,{value:void 0}),Ni("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Ni("invalid",e)}for(o in ve(n,r),u=r)if(u.hasOwnProperty(o)){var c=u[o];"style"===o?ye(e,c):"dangerouslySetInnerHTML"===o?null!=(c=c?c.__html:void 0)&&de(e,c):"children"===o?"string"===typeof c?("textarea"!==n||""!==c)&&he(e,c):"number"===typeof c&&he(e,""+c):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=c&&"onScroll"===o&&Ni("scroll",e):null!=c&&_(e,o,c,l))}switch(n){case"input":q(e),Q(e,i,!1);break;case"textarea":q(e),oe(e);break;case"option":null!=i.value&&e.setAttribute("value",""+W(i.value));break;case"select":e.multiple=!!i.multiple,null!=(o=i.value)?ne(e,!!i.multiple,o,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=Qi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Zs(t),null;case 6:if(e&&null!=t.stateNode)Rs(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(a(166));if(n=no(to.current),no(Qa.current),da(t)){if(i=t.stateNode,n=t.memoizedProps,i[hr]=t,(o=i.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:$i(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&$i(i.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[hr]=t,t.stateNode=i}return Zs(t),null;case 13:if(Er(so),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ra&&null!==ia&&0!==(1&t.mode)&&0===(128&t.flags))ha(),fa(),t.flags|=98560,o=!1;else if(o=da(t),null!==i&&null!==i.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[hr]=t}else fa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Zs(t),o=!1}else null!==aa&&(su(aa),aa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&so.current)?0===Rl&&(Rl=3):yu())),null!==t.updateQueue&&(t.flags|=4),Zs(t),null);case 4:return ro(),zs(e,t),null===e&&ji(t.stateNode.containerInfo),Zs(t),null;case 10:return wa(t.type._context),Zs(t),null;case 19:if(Er(so),null===(o=t.memoizedState))return Zs(t),null;if(i=0!==(128&t.flags),null===(l=o.rendering))if(i)qs(o,!1);else{if(0!==Rl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=lo(e))){for(t.flags|=128,qs(o,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Sr(so,1&so.current|2),t.child}e=e.sibling}null!==o.tail&&Je()>Vl&&(t.flags|=128,i=!0,qs(o,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=lo(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),qs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!ra)return Zs(t),null}else 2*Je()-o.renderingStartTime>Vl&&1073741824!==n&&(t.flags|=128,i=!0,qs(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=o.last)?n.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Je(),t.sibling=null,n=so.current,Sr(so,i?1&n|2:1&n),t):(Zs(t),null);case 22:case 23:return hu(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&zl)&&(Zs(t),6&t.subtreeFlags&&(t.flags|=8192)):Zs(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Ks(e,t){switch(ta(t),t.tag){case 1:return Pr(t.type)&&zr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ro(),Er(Ar),Er(Mr),co(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Er(so),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));fa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Er(so),null;case 4:return ro(),null;case 10:return wa(t.type._context),null;case 22:case 23:return hu(),null;default:return null}}Ps=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},zs=function(){},Ds=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,no(Qa.current);var a,o=null;switch(n){case"input":r=K(e,r),i=K(e,i),o=[];break;case"select":r=F({},r,{value:void 0}),i=F({},i,{value:void 0}),o=[];break;case"textarea":r=ie(e,r),i=ie(e,i),o=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=Qi)}for(c in ve(n,i),n=null,r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&null!=r[c])if("style"===c){var l=r[c];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(s.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in i){var u=i[c];if(l=null!=r?r[c]:void 0,i.hasOwnProperty(c)&&u!==l&&(null!=u||null!=l))if("style"===c)if(l){for(a in l)!l.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in u)u.hasOwnProperty(a)&&l[a]!==u[a]&&(n||(n={}),n[a]=u[a])}else n||(o||(o=[]),o.push(c,n)),n=u;else"dangerouslySetInnerHTML"===c?(u=u?u.__html:void 0,l=l?l.__html:void 0,null!=u&&l!==u&&(o=o||[]).push(c,u)):"children"===c?"string"!==typeof u&&"number"!==typeof u||(o=o||[]).push(c,""+u):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(s.hasOwnProperty(c)?(null!=u&&"onScroll"===c&&Ni("scroll",e),o||l===u||(o=[])):(o=o||[]).push(c,u))}n&&(o=o||[]).push("style",n);var c=o;(t.updateQueue=c)&&(t.flags|=4)}},Rs=function(e,t,n,i){n!==i&&(t.flags|=4)};var Ys=!1,Js=!1,$s="function"===typeof WeakSet?WeakSet:Set,Qs=null;function el(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Eu(e,t,i)}else n.current=null}function tl(e,t,n){try{n()}catch(i){Eu(e,t,i)}}var nl=!1;function il(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var a=r.destroy;r.destroy=void 0,void 0!==a&&tl(t,n,a)}r=r.next}while(r!==i)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function al(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ol(e){var t=e.alternate;null!==t&&(e.alternate=null,ol(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hr],delete t[fr],delete t[mr],delete t[yr],delete t[gr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ul(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Qi));else if(4!==i&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var dl=null,hl=!1;function fl(e,t,n){for(n=n.child;null!==n;)pl(e,t,n),n=n.sibling}function pl(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(rt,n)}catch(s){}switch(n.tag){case 5:Js||el(n,t);case 6:var i=dl,r=hl;dl=null,fl(e,t,n),hl=r,null!==(dl=i)&&(hl?(e=dl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dl.removeChild(n.stateNode));break;case 18:null!==dl&&(hl?(e=dl,n=n.stateNode,8===e.nodeType?lr(e.parentNode,n):1===e.nodeType&&lr(e,n),jt(e)):lr(dl,n.stateNode));break;case 4:i=dl,r=hl,dl=n.stateNode.containerInfo,hl=!0,fl(e,t,n),dl=i,hl=r;break;case 0:case 11:case 14:case 15:if(!Js&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var a=r,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&tl(n,t,o),r=r.next}while(r!==i)}fl(e,t,n);break;case 1:if(!Js&&(el(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){Eu(n,t,s)}fl(e,t,n);break;case 21:fl(e,t,n);break;case 22:1&n.mode?(Js=(i=Js)||null!==n.memoizedState,fl(e,t,n),Js=i):fl(e,t,n);break;default:fl(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new $s),t.forEach((function(t){var i=Au.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function yl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var o=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,hl=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,hl=!0;break e}l=l.return}if(null===dl)throw Error(a(160));pl(o,s,r),dl=null,hl=!1;var u=r.alternate;null!==u&&(u.return=null),r.return=null}catch(c){Eu(r,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(yl(t,e),vl(e),4&i){try{il(3,e,e.return),rl(3,e)}catch(y){Eu(e,e.return,y)}try{il(5,e,e.return)}catch(y){Eu(e,e.return,y)}}break;case 1:yl(t,e),vl(e),512&i&&null!==n&&el(n,n.return);break;case 5:if(yl(t,e),vl(e),512&i&&null!==n&&el(n,n.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(y){Eu(e,e.return,y)}}if(4&i&&null!=(r=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,l=e.type,u=e.updateQueue;if(e.updateQueue=null,null!==u)try{"input"===l&&"radio"===o.type&&null!=o.name&&J(r,o),_e(l,s);var c=_e(l,o);for(s=0;s<u.length;s+=2){var d=u[s],h=u[s+1];"style"===d?ye(r,h):"dangerouslySetInnerHTML"===d?de(r,h):"children"===d?he(r,h):_(r,d,h,c)}switch(l){case"input":$(r,o);break;case"textarea":ae(r,o);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?ne(r,!!o.multiple,p,!1):f!==!!o.multiple&&(null!=o.defaultValue?ne(r,!!o.multiple,o.defaultValue,!0):ne(r,!!o.multiple,o.multiple?[]:"",!1))}r[fr]=o}catch(y){Eu(e,e.return,y)}}break;case 6:if(yl(t,e),vl(e),4&i){if(null===e.stateNode)throw Error(a(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(y){Eu(e,e.return,y)}}break;case 3:if(yl(t,e),vl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{jt(t.containerInfo)}catch(y){Eu(e,e.return,y)}break;case 4:default:yl(t,e),vl(e);break;case 13:yl(t,e),vl(e),8192&(r=e.child).flags&&(o=null!==r.memoizedState,r.stateNode.isHidden=o,!o||null!==r.alternate&&null!==r.alternate.memoizedState||(jl=Je())),4&i&&ml(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Js=(c=Js)||d,yl(t,e),Js=c):yl(t,e),vl(e),8192&i){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!d&&0!==(1&e.mode))for(Qs=e,d=e.child;null!==d;){for(h=Qs=d;null!==Qs;){switch(p=(f=Qs).child,f.tag){case 0:case 11:case 14:case 15:il(4,f,f.return);break;case 1:el(f,f.return);var m=f.stateNode;if("function"===typeof m.componentWillUnmount){i=f,n=f.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(y){Eu(i,n,y)}}break;case 5:el(f,f.return);break;case 22:if(null!==f.memoizedState){wl(h);continue}}null!==p?(p.return=f,Qs=p):wl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{r=h.stateNode,c?"function"===typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=h.stateNode,s=void 0!==(u=h.memoizedProps.style)&&null!==u&&u.hasOwnProperty("display")?u.display:null,l.style.display=me("display",s))}catch(y){Eu(e,e.return,y)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(y){Eu(e,e.return,y)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:yl(t,e),vl(e),4&i&&ml(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sl(n)){var i=n;break e}n=n.return}throw Error(a(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(he(r,""),i.flags&=-33),cl(e,ll(e),r);break;case 3:case 4:var o=i.stateNode.containerInfo;ul(e,ll(e),o);break;default:throw Error(a(161))}}catch(s){Eu(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function _l(e,t,n){Qs=e,xl(e,t,n)}function xl(e,t,n){for(var i=0!==(1&e.mode);null!==Qs;){var r=Qs,a=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||Ys;if(!o){var s=r.alternate,l=null!==s&&null!==s.memoizedState||Js;s=Ys;var u=Js;if(Ys=o,(Js=l)&&!u)for(Qs=r;null!==Qs;)l=(o=Qs).child,22===o.tag&&null!==o.memoizedState?kl(r):null!==l?(l.return=o,Qs=l):kl(r);for(;null!==a;)Qs=a,xl(a,t,n),a=a.sibling;Qs=r,Ys=s,Js=u}bl(e)}else 0!==(8772&r.subtreeFlags)&&null!==a?(a.return=r,Qs=a):bl(e)}}function bl(e){for(;null!==Qs;){var t=Qs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Js||rl(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Js)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:ya(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Oa(t,o,i);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Oa(t,s,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var d=c.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&jt(h)}}}break;default:throw Error(a(163))}Js||512&t.flags&&al(t)}catch(f){Eu(t,t.return,f)}}if(t===e){Qs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Qs=n;break}Qs=t.return}}function wl(e){for(;null!==Qs;){var t=Qs;if(t===e){Qs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Qs=n;break}Qs=t.return}}function kl(e){for(;null!==Qs;){var t=Qs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){Eu(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){Eu(t,r,l)}}var a=t.return;try{al(t)}catch(l){Eu(t,a,l)}break;case 5:var o=t.return;try{al(t)}catch(l){Eu(t,o,l)}}}catch(l){Eu(t,t.return,l)}if(t===e){Qs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Qs=s;break}Qs=t.return}}var Tl,El=Math.ceil,Sl=x.ReactCurrentDispatcher,Ll=x.ReactCurrentOwner,Ml=x.ReactCurrentBatchConfig,Al=0,Cl=null,Il=null,Pl=0,zl=0,Dl=Tr(0),Rl=0,Bl=null,Fl=0,Ol=0,Nl=0,Hl=null,Ul=null,jl=0,Vl=1/0,Wl=null,Gl=!1,ql=null,Zl=null,Xl=!1,Kl=null,Yl=0,Jl=0,$l=null,Ql=-1,eu=0;function tu(){return 0!==(6&Al)?Je():-1!==Ql?Ql:Ql=Je()}function nu(e){return 0===(1&e.mode)?1:0!==(2&Al)&&0!==Pl?Pl&-Pl:null!==ma.transition?(0===eu&&(eu=mt()),eu):0!==(e=_t)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function iu(e,t,n,i){if(50<Jl)throw Jl=0,$l=null,Error(a(185));gt(e,n,i),0!==(2&Al)&&e===Cl||(e===Cl&&(0===(2&Al)&&(Ol|=n),4===Rl&&lu(e,Pl)),ru(e,i),1===n&&0===Al&&0===(1&t.mode)&&(Vl=Je()+500,Nr&&jr()))}function ru(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-ot(a),s=1<<o,l=r[o];-1===l?0!==(s&n)&&0===(s&i)||(r[o]=ft(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var i=ht(e,e===Cl?Pl:0);if(0===i)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){Nr=!0,Ur(e)}(uu.bind(null,e)):Ur(uu.bind(null,e)),or((function(){0===(6&Al)&&jr()})),n=null;else{switch(xt(i)){case 1:n=Qe;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Cu(n,au.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function au(e,t){if(Ql=-1,eu=0,0!==(6&Al))throw Error(a(327));var n=e.callbackNode;if(ku()&&e.callbackNode!==n)return null;var i=ht(e,e===Cl?Pl:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=gu(e,i);else{t=i;var r=Al;Al|=2;var o=mu();for(Cl===e&&Pl===t||(Wl=null,Vl=Je()+500,fu(e,t));;)try{_u();break}catch(l){pu(e,l)}ba(),Sl.current=o,Al=r,null!==Il?t=0:(Cl=null,Pl=0,t=Rl)}if(0!==t){if(2===t&&(0!==(r=pt(e))&&(i=r,t=ou(e,r))),1===t)throw n=Bl,fu(e,0),lu(e,i),ru(e,Je()),n;if(6===t)lu(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!si(a(),r))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gu(e,i))&&(0!==(o=pt(e))&&(i=o,t=ou(e,o))),1===t))throw n=Bl,fu(e,0),lu(e,i),ru(e,Je()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(a(345));case 2:case 5:wu(e,Ul,Wl);break;case 3:if(lu(e,i),(130023424&i)===i&&10<(t=jl+500-Je())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&i)!==i){tu(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(wu.bind(null,e,Ul,Wl),t);break}wu(e,Ul,Wl);break;case 4:if(lu(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-ot(i);o=1<<s,(s=t[s])>r&&(r=s),i&=~o}if(i=r,10<(i=(120>(i=Je()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*El(i/1960))-i)){e.timeoutHandle=ir(wu.bind(null,e,Ul,Wl),i);break}wu(e,Ul,Wl);break;default:throw Error(a(329))}}}return ru(e,Je()),e.callbackNode===n?au.bind(null,e):null}function ou(e,t){var n=Hl;return e.current.memoizedState.isDehydrated&&(fu(e,t).flags|=256),2!==(e=gu(e,t))&&(t=Ul,Ul=n,null!==t&&su(t)),e}function su(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function lu(e,t){for(t&=~Nl,t&=~Ol,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),i=1<<n;e[n]=-1,t&=~i}}function uu(e){if(0!==(6&Al))throw Error(a(327));ku();var t=ht(e,0);if(0===(1&t))return ru(e,Je()),null;var n=gu(e,t);if(0!==e.tag&&2===n){var i=pt(e);0!==i&&(t=i,n=ou(e,i))}if(1===n)throw n=Bl,fu(e,0),lu(e,t),ru(e,Je()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wu(e,Ul,Wl),ru(e,Je()),null}function cu(e,t){var n=Al;Al|=1;try{return e(t)}finally{0===(Al=n)&&(Vl=Je()+500,Nr&&jr())}}function du(e){null!==Kl&&0===Kl.tag&&0===(6&Al)&&ku();var t=Al;Al|=1;var n=Ml.transition,i=_t;try{if(Ml.transition=null,_t=1,e)return e()}finally{_t=i,Ml.transition=n,0===(6&(Al=t))&&jr()}}function hu(){zl=Dl.current,Er(Dl)}function fu(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Il)for(n=Il.return;null!==n;){var i=n;switch(ta(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&zr();break;case 3:ro(),Er(Ar),Er(Mr),co();break;case 5:oo(i);break;case 4:ro();break;case 13:case 19:Er(so);break;case 10:wa(i.type._context);break;case 22:case 23:hu()}n=n.return}if(Cl=e,Il=e=Du(e.current,null),Pl=zl=t,Rl=0,Bl=null,Nl=Ol=Fl=0,Ul=Hl=null,null!==Sa){for(t=0;t<Sa.length;t++)if(null!==(i=(n=Sa[t]).interleaved)){n.interleaved=null;var r=i.next,a=n.pending;if(null!==a){var o=a.next;a.next=r,i.next=o}n.pending=i}Sa=null}return e}function pu(e,t){for(;;){var n=Il;try{if(ba(),ho.current=os,vo){for(var i=mo.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}vo=!1}if(po=0,go=yo=mo=null,_o=!1,xo=0,Ll.current=null,null===n||null===n.return){Rl=1,Bl=t,Il=null;break}e:{var o=e,s=n.return,l=n,u=t;if(t=Pl,l.flags|=32768,null!==u&&"object"===typeof u&&"function"===typeof u.then){var c=u,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=gs(s);if(null!==p){p.flags&=-257,vs(p,s,l,0,t),1&p.mode&&ys(o,c,t),u=c;var m=(t=p).updateQueue;if(null===m){var y=new Set;y.add(u),t.updateQueue=y}else m.add(u);break e}if(0===(1&t)){ys(o,c,t),yu();break e}u=Error(a(426))}else if(ra&&1&l.mode){var g=gs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),vs(g,s,l,0,t),pa(cs(u,l));break e}}o=u=cs(u,l),4!==Rl&&(Rl=2),null===Hl?Hl=[o]:Hl.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Ba(o,ps(0,u,t));break e;case 1:l=u;var v=o.type,_=o.stateNode;if(0===(128&o.flags)&&("function"===typeof v.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===Zl||!Zl.has(_)))){o.flags|=65536,t&=-t,o.lanes|=t,Ba(o,ms(o,l,t));break e}}o=o.return}while(null!==o)}bu(n)}catch(x){t=x,Il===n&&null!==n&&(Il=n=n.return);continue}break}}function mu(){var e=Sl.current;return Sl.current=os,null===e?os:e}function yu(){0!==Rl&&3!==Rl&&2!==Rl||(Rl=4),null===Cl||0===(268435455&Fl)&&0===(268435455&Ol)||lu(Cl,Pl)}function gu(e,t){var n=Al;Al|=2;var i=mu();for(Cl===e&&Pl===t||(Wl=null,fu(e,t));;)try{vu();break}catch(r){pu(e,r)}if(ba(),Al=n,Sl.current=i,null!==Il)throw Error(a(261));return Cl=null,Pl=0,Rl}function vu(){for(;null!==Il;)xu(Il)}function _u(){for(;null!==Il&&!Ke();)xu(Il)}function xu(e){var t=Tl(e.alternate,e,zl);e.memoizedProps=e.pendingProps,null===t?bu(e):Il=t,Ll.current=null}function bu(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Xs(n,t,zl)))return void(Il=n)}else{if(null!==(n=Ks(n,t)))return n.flags&=32767,void(Il=n);if(null===e)return Rl=6,void(Il=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Il=t);Il=t=e}while(null!==t);0===Rl&&(Rl=5)}function wu(e,t,n){var i=_t,r=Ml.transition;try{Ml.transition=null,_t=1,function(e,t,n,i){do{ku()}while(null!==Kl);if(0!==(6&Al))throw Error(a(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-ot(n),a=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~a}}(e,o),e===Cl&&(Il=Cl=null,Pl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Xl||(Xl=!0,Cu(tt,(function(){return ku(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Ml.transition,Ml.transition=null;var s=_t;_t=1;var l=Al;Al|=4,Ll.current=null,function(e,t){if(er=Wt,fi(e=hi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(b){n=null;break e}var s=0,l=-1,u=-1,c=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||0!==r&&3!==h.nodeType||(l=s+r),h!==o||0!==i&&3!==h.nodeType||(u=s+i),3===h.nodeType&&(s+=h.nodeValue.length),null!==(p=h.firstChild);)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++c===r&&(l=s),f===o&&++d===i&&(u=s),null!==(p=h.nextSibling))break;f=(h=f).parentNode}h=p}n=-1===l||-1===u?null:{start:l,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},Wt=!1,Qs=t;null!==Qs;)if(e=(t=Qs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Qs=e;else for(;null!==Qs;){t=Qs;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var y=m.memoizedProps,g=m.memoizedState,v=t.stateNode,_=v.getSnapshotBeforeUpdate(t.elementType===t.type?y:ya(t.type,y),g);v.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(a(163))}}catch(b){Eu(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,Qs=e;break}Qs=t.return}m=nl,nl=!1}(e,n),gl(n,e),pi(tr),Wt=!!er,tr=er=null,e.current=n,_l(n,e,r),Ye(),Al=l,_t=s,Ml.transition=o}else e.current=n;if(Xl&&(Xl=!1,Kl=e,Yl=r),o=e.pendingLanes,0===o&&(Zl=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ru(e,Je()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Gl)throw Gl=!1,e=ql,ql=null,e;0!==(1&Yl)&&0!==e.tag&&ku(),o=e.pendingLanes,0!==(1&o)?e===$l?Jl++:(Jl=0,$l=e):Jl=0,jr()}(e,t,n,i)}finally{Ml.transition=r,_t=i}return null}function ku(){if(null!==Kl){var e=xt(Yl),t=Ml.transition,n=_t;try{if(Ml.transition=null,_t=16>e?16:e,null===Kl)var i=!1;else{if(e=Kl,Kl=null,Yl=0,0!==(6&Al))throw Error(a(331));var r=Al;for(Al|=4,Qs=e.current;null!==Qs;){var o=Qs,s=o.child;if(0!==(16&Qs.flags)){var l=o.deletions;if(null!==l){for(var u=0;u<l.length;u++){var c=l[u];for(Qs=c;null!==Qs;){var d=Qs;switch(d.tag){case 0:case 11:case 15:il(8,d,o)}var h=d.child;if(null!==h)h.return=d,Qs=h;else for(;null!==Qs;){var f=(d=Qs).sibling,p=d.return;if(ol(d),d===c){Qs=null;break}if(null!==f){f.return=p,Qs=f;break}Qs=p}}}var m=o.alternate;if(null!==m){var y=m.child;if(null!==y){m.child=null;do{var g=y.sibling;y.sibling=null,y=g}while(null!==y)}}Qs=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,Qs=s;else e:for(;null!==Qs;){if(0!==(2048&(o=Qs).flags))switch(o.tag){case 0:case 11:case 15:il(9,o,o.return)}var v=o.sibling;if(null!==v){v.return=o.return,Qs=v;break e}Qs=o.return}}var _=e.current;for(Qs=_;null!==Qs;){var x=(s=Qs).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,Qs=x;else e:for(s=_;null!==Qs;){if(0!==(2048&(l=Qs).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(w){Eu(l,l.return,w)}if(l===s){Qs=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,Qs=b;break e}Qs=l.return}}if(Al=r,jr(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(rt,e)}catch(w){}i=!0}return i}finally{_t=n,Ml.transition=t}}return!1}function Tu(e,t,n){e=Da(e,t=ps(0,t=cs(n,t),1),1),t=tu(),null!==e&&(gt(e,1,t),ru(e,t))}function Eu(e,t,n){if(3===e.tag)Tu(e,e,n);else for(;null!==t;){if(3===t.tag){Tu(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Zl||!Zl.has(i))){t=Da(t,e=ms(t,e=cs(n,e),1),1),e=tu(),null!==t&&(gt(t,1,e),ru(t,e));break}}t=t.return}}function Su(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tu(),e.pingedLanes|=e.suspendedLanes&n,Cl===e&&(Pl&n)===n&&(4===Rl||3===Rl&&(130023424&Pl)===Pl&&500>Je()-jl?fu(e,0):Nl|=n),ru(e,t)}function Lu(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var n=tu();null!==(e=Aa(e,t))&&(gt(e,t,n),ru(e,n))}function Mu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Lu(e,n)}function Au(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(a(314))}null!==i&&i.delete(t),Lu(e,n)}function Cu(e,t){return Ze(e,t)}function Iu(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pu(e,t,n,i){return new Iu(e,t,n,i)}function zu(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Du(e,t){var n=e.alternate;return null===n?((n=Pu(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ru(e,t,n,i,r,o){var s=2;if(i=e,"function"===typeof e)zu(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case k:return Bu(n.children,r,o,t);case T:s=8,r|=8;break;case E:return(e=Pu(12,n,t,2|r)).elementType=E,e.lanes=o,e;case A:return(e=Pu(13,n,t,r)).elementType=A,e.lanes=o,e;case C:return(e=Pu(19,n,t,r)).elementType=C,e.lanes=o,e;case z:return Fu(n,r,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case S:s=10;break e;case L:s=9;break e;case M:s=11;break e;case I:s=14;break e;case P:s=16,i=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Pu(s,n,t,r)).elementType=e,t.type=i,t.lanes=o,t}function Bu(e,t,n,i){return(e=Pu(7,e,i,t)).lanes=n,e}function Fu(e,t,n,i){return(e=Pu(22,e,i,t)).elementType=z,e.lanes=n,e.stateNode={isHidden:!1},e}function Ou(e,t,n){return(e=Pu(6,e,null,t)).lanes=n,e}function Nu(e,t,n){return(t=Pu(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Hu(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yt(0),this.expirationTimes=yt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Uu(e,t,n,i,r,a,o,s,l){return e=new Hu(e,t,n,s,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Pu(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ia(a),e}function ju(e){if(!e)return Lr;e:{if(je(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Pr(n))return Rr(e,n,t)}return t}function Vu(e,t,n,i,r,a,o,s,l){return(e=Uu(n,i,!0,e,0,a,0,s,l)).context=ju(null),n=e.current,(a=za(i=tu(),r=nu(n))).callback=void 0!==t&&null!==t?t:null,Da(n,a,r),e.current.lanes=r,gt(e,r,i),ru(e,i),e}function Wu(e,t,n,i){var r=t.current,a=tu(),o=nu(r);return n=ju(n),null===t.context?t.context=n:t.pendingContext=n,(t=za(a,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Da(r,t,o))&&(iu(e,r,o,a),Ra(e,r,o)),o}function Gu(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function qu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Zu(e,t){qu(e,t),(e=e.alternate)&&qu(e,t)}Tl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ar.current)xs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xs=!1,function(e,t,n){switch(t.tag){case 3:Cs(t),fa();break;case 5:ao(t);break;case 1:Pr(t.type)&&Br(t);break;case 4:io(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Sr(ga,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Sr(so,1&so.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Os(e,t,n):(Sr(so,1&so.current),null!==(e=Gs(e,t,n))?e.sibling:null);Sr(so,1&so.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Vs(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Sr(so,so.current),i)break;return null;case 22:case 23:return t.lanes=0,Es(e,t,n)}return Gs(e,t,n)}(e,t,n);xs=0!==(131072&e.flags)}else xs=!1,ra&&0!==(1048576&t.flags)&&Qr(t,qr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Ws(e,t),e=t.pendingProps;var r=Ir(t,Mr.current);Ta(t,n),r=To(null,t,i,e,r,n);var o=Eo();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pr(i)?(o=!0,Br(t)):o=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Ia(t),r.updater=Ua,t.stateNode=r,r._reactInternals=t,Ga(t,i,e,n),t=As(null,t,i,!0,o,n)):(t.tag=0,ra&&o&&ea(t),bs(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Ws(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return zu(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===M)return 11;if(e===I)return 14}return 2}(i),e=ya(i,e),r){case 0:t=Ls(null,t,i,e,n);break e;case 1:t=Ms(null,t,i,e,n);break e;case 11:t=ws(null,t,i,e,n);break e;case 14:t=ks(null,t,i,ya(i.type,e),n);break e}throw Error(a(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Ls(e,t,i,r=t.elementType===i?r:ya(i,r),n);case 1:return i=t.type,r=t.pendingProps,Ms(e,t,i,r=t.elementType===i?r:ya(i,r),n);case 3:e:{if(Cs(t),null===e)throw Error(a(387));i=t.pendingProps,r=(o=t.memoizedState).element,Pa(e,t),Fa(t,i,null,n);var s=t.memoizedState;if(i=s.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Is(e,t,i,n,r=cs(Error(a(423)),t));break e}if(i!==r){t=Is(e,t,i,n,r=cs(Error(a(424)),t));break e}for(ia=ur(t.stateNode.containerInfo.firstChild),na=t,ra=!0,aa=null,n=Ja(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fa(),i===r){t=Gs(e,t,n);break e}bs(e,t,i,n)}t=t.child}return t;case 5:return ao(t),null===e&&ua(t),i=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,s=r.children,nr(i,r)?s=null:null!==o&&nr(i,o)&&(t.flags|=32),Ss(e,t),bs(e,t,s,n),t.child;case 6:return null===e&&ua(t),null;case 13:return Os(e,t,n);case 4:return io(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Ya(t,null,i,n):bs(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,ws(e,t,i,r=t.elementType===i?r:ya(i,r),n);case 7:return bs(e,t,t.pendingProps,n),t.child;case 8:case 12:return bs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,o=t.memoizedProps,s=r.value,Sr(ga,i._currentValue),i._currentValue=s,null!==o)if(si(o.value,s)){if(o.children===r.children&&!Ar.current){t=Gs(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){s=o.child;for(var u=l.firstContext;null!==u;){if(u.context===i){if(1===o.tag){(u=za(-1,n&-n)).tag=2;var c=o.updateQueue;if(null!==c){var d=(c=c.shared).pending;null===d?u.next=u:(u.next=d.next,d.next=u),c.pending=u}}o.lanes|=n,null!==(u=o.alternate)&&(u.lanes|=n),ka(o.return,n,t),l.lanes|=n;break}u=u.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),ka(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}bs(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Ta(t,n),i=i(r=Ea(r)),t.flags|=1,bs(e,t,i,n),t.child;case 14:return r=ya(i=t.type,t.pendingProps),ks(e,t,i,r=ya(i.type,r),n);case 15:return Ts(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:ya(i,r),Ws(e,t),t.tag=1,Pr(i)?(e=!0,Br(t)):e=!1,Ta(t,n),Va(t,i,r),Ga(t,i,r,n),As(null,t,i,!0,e,n);case 19:return Vs(e,t,n);case 22:return Es(e,t,n)}throw Error(a(156,t.tag))};var Xu="function"===typeof reportError?reportError:function(e){console.error(e)};function Ku(e){this._internalRoot=e}function Yu(e){this._internalRoot=e}function Ju(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function $u(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Qu(){}function ec(e,t,n,i,r){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof r){var s=r;r=function(){var e=Gu(o);s.call(e)}}Wu(t,o,e,r)}else o=function(e,t,n,i,r){if(r){if("function"===typeof i){var a=i;i=function(){var e=Gu(o);a.call(e)}}var o=Vu(t,i,e,0,null,!1,0,"",Qu);return e._reactRootContainer=o,e[pr]=o.current,ji(8===e.nodeType?e.parentNode:e),du(),o}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var s=i;i=function(){var e=Gu(l);s.call(e)}}var l=Uu(e,0,!1,null,0,!1,0,"",Qu);return e._reactRootContainer=l,e[pr]=l.current,ji(8===e.nodeType?e.parentNode:e),du((function(){Wu(t,l,n,i)})),l}(n,t,e,r,i);return Gu(o)}Yu.prototype.render=Ku.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Wu(e,t,null,null)},Yu.prototype.unmount=Ku.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;du((function(){Wu(null,e,null,null)})),t[pr]=null}},Yu.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<zt.length&&0!==t&&t<zt[n].priority;n++);zt.splice(n,0,e),0===n&&Ft(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(vt(t,1|n),ru(t,Je()),0===(6&Al)&&(Vl=Je()+500,jr()))}break;case 13:du((function(){var t=Aa(e,1);if(null!==t){var n=tu();iu(t,e,1,n)}})),Zu(e,1)}},wt=function(e){if(13===e.tag){var t=Aa(e,134217728);if(null!==t)iu(t,e,134217728,tu());Zu(e,134217728)}},kt=function(e){if(13===e.tag){var t=nu(e),n=Aa(e,t);if(null!==n)iu(n,e,t,tu());Zu(e,t)}},Tt=function(){return _t},Et=function(e,t){var n=_t;try{return _t=e,t()}finally{_t=n}},we=function(e,t,n){switch(t){case"input":if($(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=br(i);if(!r)throw Error(a(90));Z(i),$(i,r)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Me=cu,Ae=du;var tc={usingClientEntryPoint:!1,Events:[_r,xr,br,Se,Le,cu]},nc={findFiberByHostInstance:vr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ic={bundleType:nc.bundleType,version:nc.version,rendererPackageName:nc.rendererPackageName,rendererConfig:nc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:nc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rc.isDisabled&&rc.supportsFiber)try{rt=rc.inject(ic),at=rc}catch(ce){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tc,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Ju(t))throw Error(a(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Ju(e))throw Error(a(299));var n=!1,i="",r=Xu;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Uu(e,1,!1,null,0,n,0,i,r),e[pr]=t.current,ji(8===e.nodeType?e.parentNode:e),new Ku(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return du(e)},t.hydrate=function(e,t,n){if(!$u(t))throw Error(a(200));return ec(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Ju(e))throw Error(a(405));var i=null!=n&&n.hydratedSources||null,r=!1,o="",s=Xu;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Vu(t,null,e,1,null!=n?n:null,r,0,o,s),e[pr]=t.current,ji(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Yu(t)},t.render=function(e,t,n){if(!$u(t))throw Error(a(200));return ec(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!$u(e))throw Error(a(40));return!!e._reactRootContainer&&(du((function(){ec(null,null,e,!1,(function(){e._reactRootContainer=null,e[pr]=null}))})),!0)},t.unstable_batchedUpdates=cu,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!$u(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return ec(e,t,n,!1,i)},t.version="18.2.0-next-9e3b772b8-20220608"},250:function(e,t,n){"use strict";var i=n(164);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(463)},374:function(e,t,n){"use strict";var i=n(791),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,n){var i,a={},u=null,c=null;for(i in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,i)&&!l.hasOwnProperty(i)&&(a[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===a[i]&&(a[i]=t[i]);return{$$typeof:r,type:e,key:u,ref:c,props:a,_owner:s.current}}t.Fragment=a,t.jsx=u,t.jsxs=u},117:function(e,t){"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,y={};function g(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||p}function v(){}function _(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=g.prototype;var x=_.prototype=new v;x.constructor=_,m(x,g.prototype),x.isPureReactComponent=!0;var b=Array.isArray,w=Object.prototype.hasOwnProperty,k={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,i){var r,a={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)w.call(t,r)&&!T.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(1===l)a.children=i;else if(1<l){for(var u=Array(l),c=0;c<l;c++)u[c]=arguments[c+2];a.children=u}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===a[r]&&(a[r]=l[r]);return{$$typeof:n,type:e,key:o,ref:s,props:a,_owner:k.current}}function S(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var L=/\/+/g;function M(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function A(e,t,r,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return o=o(l=e),e=""===a?"."+M(l,0):a,b(o)?(r="",null!=e&&(r=e.replace(L,"$&/")+"/"),A(o,t,r,"",(function(e){return e}))):null!=o&&(S(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,r+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(L,"$&/")+"/")+e)),t.push(o)),1;if(l=0,a=""===a?".":a+":",b(e))for(var u=0;u<e.length;u++){var c=a+M(s=e[u],u);l+=A(s,t,r,c,o)}else if(c=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof c)for(e=c.call(e),u=0;!(s=e.next()).done;)l+=A(s=s.value,t,r,c=a+M(s,u++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function C(e,t,n){if(null==e)return e;var i=[],r=0;return A(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function I(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},z={transition:null},D={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:z,ReactCurrentOwner:k};t.Children={map:C,forEach:function(e,t,n){C(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return C(e,(function(){t++})),t},toArray:function(e){return C(e,(function(e){return e}))||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=r,t.Profiler=o,t.PureComponent=_,t.StrictMode=a,t.Suspense=c,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=k.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(u in t)w.call(t,u)&&!T.hasOwnProperty(u)&&(r[u]=void 0===t[u]&&void 0!==l?l[u]:t[u])}var u=arguments.length-2;if(1===u)r.children=i;else if(1<u){l=Array(u);for(var c=0;c<u;c++)l[c]=arguments[c+2];r.children=l}return{$$typeof:n,type:e.type,key:a,ref:o,props:r,_owner:s}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:I}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=z.transition;z.transition={};try{e()}finally{z.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.2.0"},791:function(e,t,n){"use strict";e.exports=n(117)},184:function(e,t,n){"use strict";e.exports=n(374)},813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<a(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,o=r>>>1;i<o;){var s=2*(i+1)-1,l=e[s],u=s+1,c=e[u];if(0>a(l,n))u<r&&0>a(c,l)?(e[i]=c,e[u]=n,i=u):(e[i]=l,e[s]=n,i=s);else{if(!(u<r&&0>a(c,n)))break e;e[i]=c,e[u]=n,i=u}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var u=[],c=[],d=1,h=null,f=3,p=!1,m=!1,y=!1,g="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(c);null!==t;){if(null===t.callback)r(c);else{if(!(t.startTime<=e))break;r(c),t.sortIndex=t.expirationTime,n(u,t)}t=i(c)}}function b(e){if(y=!1,x(e),!m)if(null!==i(u))m=!0,z(w);else{var t=i(c);null!==t&&D(b,t.startTime-e)}}function w(e,n){m=!1,y&&(y=!1,v(S),S=-1),p=!0;var a=f;try{for(x(n),h=i(u);null!==h&&(!(h.expirationTime>n)||e&&!A());){var o=h.callback;if("function"===typeof o){h.callback=null,f=h.priorityLevel;var s=o(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?h.callback=s:h===i(u)&&r(u),x(n)}else r(u);h=i(u)}if(null!==h)var l=!0;else{var d=i(c);null!==d&&D(b,d.startTime-n),l=!1}return l}finally{h=null,f=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var k,T=!1,E=null,S=-1,L=5,M=-1;function A(){return!(t.unstable_now()-M<L)}function C(){if(null!==E){var e=t.unstable_now();M=e;var n=!0;try{n=E(!0,e)}finally{n?k():(T=!1,E=null)}}else T=!1}if("function"===typeof _)k=function(){_(C)};else if("undefined"!==typeof MessageChannel){var I=new MessageChannel,P=I.port2;I.port1.onmessage=C,k=function(){P.postMessage(null)}}else k=function(){g(C,0)};function z(e){E=e,T||(T=!0,k())}function D(e,n){S=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,z(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return i(u)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,r,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:r,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(c,e),null===i(u)&&e===i(c)&&(y?(v(S),S=-1):y=!0,D(b,a-o))):(e.sortIndex=s,n(u,e),m||p||(m=!0,z(w))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},296:function(e,t,n){"use strict";e.exports=n(813)},437:function(e,t,n){"use strict";function i(){return new Worker(n.p+"static/js/mapbox-gl-csp-worker.16b28fc3.worker.js")}n.d(t,{Z:function(){return i}})},897:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i},e.exports.__esModule=!0,e.exports.default=e.exports},372:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},405:function(e,t,n){var i=n(897);e.exports=function(e){if(Array.isArray(e))return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},115:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},690:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},515:function(e,t,n){var i=n(15),r=n(617);function a(t,n,o){return r()?(e.exports=a=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=a=function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&i(a,n.prototype),a},e.exports.__esModule=!0,e.exports.default=e.exports),a.apply(null,arguments)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},728:function(e,t,n){var i=n(62);function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},704:function(e,t,n){var i=n(116);e.exports=function(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}},e.exports.__esModule=!0,e.exports.default=e.exports},389:function(e,t,n){var i=n(808),r=n(617),a=n(993);e.exports=function(e){var t=r();return function(){var n,r=i(e);if(t){var o=i(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return a(this,n)}},e.exports.__esModule=!0,e.exports.default=e.exports},416:function(e,t,n){var i=n(62);e.exports=function(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},588:function(e,t,n){var i=n(753);function r(){return"undefined"!==typeof Reflect&&Reflect.get?(e.exports=r=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=r=function(e,t,n){var r=i(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},e.exports.__esModule=!0,e.exports.default=e.exports),r.apply(this,arguments)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},808:function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},655:function(e,t,n){var i=n(15);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},35:function(e){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports},617:function(e){e.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},498:function(e){e.exports=function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},872:function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw r}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports},218:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},281:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},993:function(e,t,n){var i=n(698).default,r=n(115);e.exports=function(e,t){if(t&&("object"===i(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},15:function(e){function t(n,i){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,i)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},424:function(e,t,n){var i=n(372),r=n(872),a=n(116),o=n(218);e.exports=function(e,t){return i(e)||r(e,t)||a(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},753:function(e,t,n){var i=n(808);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},589:function(e,t,n){var i=n(372),r=n(498),a=n(116),o=n(218);e.exports=function(e){return i(e)||r(e)||a(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},861:function(e,t,n){var i=n(405),r=n(498),a=n(116),o=n(281);e.exports=function(e){return i(e)||r(e)||a(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},36:function(e,t,n){var i=n(698).default;e.exports=function(e,t){if("object"!==i(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},62:function(e,t,n){var i=n(698).default,r=n(36);e.exports=function(e){var t=r(e,"string");return"symbol"===i(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},698:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},116:function(e,t,n){var i=n(897);e.exports=function(e,t){if(e){if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},496:function(e,t,n){var i=n(808),r=n(15),a=n(35),o=n(515);function s(t){var n="function"===typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!a(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return o(e,arguments,i(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,n),a.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/wheres-my-class/",function(){"use strict";var e=n(791),t=n(250);function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function r(e,t){if(e){if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw r}}return s}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var o=JSON.parse('[{"code":"AEP 1100","title":"Lasers and Photonics","name":"AEP 1100: Lasers and Photonics","desc":"Lasers have had an enormous impact on communications, medicine, remote sensing, and material processing. This course reviews the properties of light that are essential to understanding the underlying principles of lasers and these photonic technologies. There also is a strong, hands-on laboratory component in which the students build and operate a nitrogen laser and participate in several demonstration experiments such as holography, laser processing of materials, optical tweezers, and fiber optics.","locations":[{"bldg":"Physical Sciences Building","room":"Physical Sciences Building 131","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"M"},{"bldg":"Physical Sciences Building","room":"Physical Sciences Building 131","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"T"},{"bldg":"Physical Sciences Building","room":"Physical Sciences Building 131","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"W"},{"bldg":"Physical Sciences Building","room":"Physical Sciences Building 131","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"R"}]},{"code":"AEP 3620","title":"Intermediate Quantum Mechanics","name":"AEP 3620: Intermediate Quantum Mechanics","desc":"Continuation of AEP 3610\xa0covering more advanced material in quantum mechanics. Topics include operator formalism and matrix representation, angular momentum and spin, the hydrogen atom, techniques for solving Schrodinger\'s equation including perturbation theory, two- and three-level systems, interaction with radiation, and identical particles.","locations":[{"bldg":"Physical Sciences Building","room":"Physical Sciences Building 133","type":"DIS","typeLong":"Discussion","time":"01:25PM","days":"W"}]},{"code":"AEP 5620","title":"Intermediate Quantum Mechanics","name":"AEP 5620: Intermediate Quantum Mechanics","desc":"Continuation of AEP 5610\xa0covering more advanced material in quantum mechanics. Topics include operator formalism and matrix representation, angular momentum and spin, the hydrogen atom, techniques for solving Schrodinger\'s equation including perturbation theory, two- and three-level systems, interaction with radiation, and identical particles.","locations":[{"bldg":"Physical Sciences Building","room":"Physical Sciences Building 133","type":"DIS","typeLong":"Discussion","time":"01:25PM","days":"W"}]},{"code":"ALS 5800","title":"International Teaching Assistant Program: Directed Study","name":"ALS 5800: International Teaching Assistant Program: Directed Study","desc":"The International Teaching Assistant Program\'s Directed Study course, ALS 5800, is designed for multilingual graduate students working toward meeting the Language Proficiency requirement for teaching at Cornell University. Through regular interaction with the instructor, participants will set goals and develop a personal plan of study to advance their English oral communication skills.","locations":[{"bldg":"Computing & Communications Ctr","room":"Computing & Communications 421","type":"IND","typeLong":"Independent Study","time":"","days":""}]},{"code":"AMST 3131","title":"The Nature, Functions, and Limits of Law","name":"AMST 3131: The Nature, Functions, and Limits of Law","desc":"A general-education course to acquaint students with how our legal system pursues the goals of society. The course introduces students to various perspectives on the nature of law, what functions it ought to serve in society, and what it can and cannot accomplish. The course proceeds in the belief that such matters constitute a valuable and necessary part of a general education, not only for pre-law students but especially for students in other fields. Assigned readings comprise legal materials and also secondary sources on the legal process and the role of law in society. The classes include discussion and debate about current legal and social issues, including equality, safety, the environment, punishment, and autonomy.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 184","type":"LEC","typeLong":"Lecture","time":"02:55PM","days":"MW"}]},{"code":"ANSC 2410","title":"Biology of Reproduction Lab","name":"ANSC 2410: Biology of Reproduction Lab","desc":"Demonstrates fundamental principles and applied aspects of mammalian and avian reproduction. A limited number of live animals are used in some demonstrations. Dissection and examination of tissues from vertebrate animals are included in selected laboratories.","locations":[{"bldg":"Morrison Hall","room":"Morrison Hall 174","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"},{"bldg":"Morrison Hall","room":"Morrison Hall 174","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"W"}]},{"code":"ARCH 1102","title":"Design II","name":"ARCH 1102: Design II","desc":"Continuation of ARCH 1101. Covers human, social, technical, and aesthetic factors related to space and form. Design problems range from those of the immediate environment of the individual to that of small social groups.","locations":[{"bldg":"Milstein Hall","room":"Milstein Hall 201","type":"STU","typeLong":"Studio","time":"11:40AM","days":"MR"}]},{"code":"ARCH 1104","title":"Elective Design Studio","name":"ARCH 1104: Elective Design Studio","desc":"Non sequence design studio for students who are not architecture majors at Cornell and for department students taking design studio for non-sequence credit.","locations":[{"bldg":"Milstein Hall","room":"Milstein Hall 201","type":"STU","typeLong":"Studio","time":"11:40AM","days":"WF"}]},{"code":"ARCH 2102","title":"Design IV","name":"ARCH 2102: Design IV","desc":"In this Integrative Design Studio, the requirements of building systems are seen to both support and inform architectural concepts and form. One of the key design experiences during this semester will be the interaction of these concepts and building systems. Questions of energy, thermal comfort, sustainability, structure, material, and life safety will be addressed.","locations":[{"bldg":"Milstein Hall","room":"Milstein Hall 201","type":"STU","typeLong":"Studio","time":"11:40AM","days":"MR"}]},{"code":"ARCH 4101","title":"Design VII","name":"ARCH 4101: Design VII","desc":"Advanced programs in architectural design, with options in, but not limited to, urban design, architectural technology, computational design, ecology, culture, and representation.","locations":[{"bldg":"Milstein Hall","room":"Milstein Hall 201","type":"STU","typeLong":"Studio","time":"11:40AM","days":"TF"}]},{"code":"ARCH 4102","title":"Design VIII","name":"ARCH 4102: Design VIII","desc":"Advanced programs in architectural design, with options including, but not limited to, urban design, architectural technology, computational design, ecology, culture, and representation.","locations":[{"bldg":"Milstein Hall","room":"Milstein Hall 201","type":"STU","typeLong":"Studio","time":"11:40AM","days":"TF"}]},{"code":"ARCH 5101","title":"Design IX","name":"ARCH 5101: Design IX","desc":"Advanced programs in architectural design, with options in, but not limited to, urban design, architectural technology, computational design, ecology, culture, and representation.","locations":[{"bldg":"Milstein Hall","room":"Milstein Hall 201","type":"STU","typeLong":"Studio","time":"11:40AM","days":"TF"}]},{"code":"ARCH 5112","title":"Core Design Studio II: Relational and Ecological Design","name":"ARCH 5112: Core Design Studio II: Relational and Ecological Design","desc":"Focus on relational and ecological design thinking through interpretive, analytical, programmatic and generative uses of digital media. Emphasis on context, architectonics and systems in the design of a mid-scale building as informed by the analysis of precedents.","locations":[{"bldg":"Milstein Hall","room":"Milstein Hall 201","type":"STU","typeLong":"Studio","time":"11:40AM","days":"TF"}]},{"code":"ARCH 5114","title":"Core Design Studios IV: Integrative Design Practices","name":"ARCH 5114: Core Design Studios IV: Integrative Design Practices","desc":"Focus on the development of architectural ideas in constructed, material form. The studio explores emergent topics and constructive methods in contemporary architectural practice. Design study includes the creation of a comprehensive set of representations that describes an architectural project in detail. Students work in collaborative groups and in consultation with advisors drawn from professional practice to develop a project that engages a complex range of topical areas, including: structural and environmental systems, building envelope systems, materiality and construction, life-safety planning, and sustainability.","locations":[{"bldg":"Milstein Hall","room":"Milstein Hall 201","type":"STU","typeLong":"Studio","time":"11:40AM","days":"TF"}]},{"code":"ARCH 5115","title":"Vertical Design Option Studio","name":"ARCH 5115: Vertical Design Option Studio","desc":"The New York City vertical studios engage contemporary issues through examining urban and infrastructural issues in relation to ecological, technical, and cultural practices.","locations":[{"bldg":"Milstein Hall","room":"Milstein Hall 201","type":"STU","typeLong":"Studio","time":"11:40AM","days":"TF"}]},{"code":"ARCH 5116","title":"Vertical Design Option Studio II","name":"ARCH 5116: Vertical Design Option Studio II","desc":"The vertical studios are topical in nature and engage contemporary issues in architectural practice and research.","locations":[{"bldg":"Milstein Hall","room":"Milstein Hall 201","type":"STU","typeLong":"Studio","time":"11:40AM","days":"TF"}]},{"code":"ARCH 7112","title":"Design B: Topic Studio","name":"ARCH 7112: Design B: Topic Studio","desc":"Advanced programs in architectural design, with options in, but not limited to, urban design, architectural technology, computational design, ecology, culture, and representation.","locations":[{"bldg":"Milstein Hall","room":"Milstein Hall 201","type":"STU","typeLong":"Studio","time":"11:40AM","days":"TF"}]},{"code":"ARCH 7113","title":"Design C: Topic Studio","name":"ARCH 7113: Design C: Topic Studio","desc":"Advanced programs in architectural design, with options in, but not limited to, urban design, architectural technology, computational design, ecology, culture, and representation.","locations":[{"bldg":"Milstein Hall","room":"Milstein Hall 201","type":"STU","typeLong":"Studio","time":"11:40AM","days":"TF"}]},{"code":"ARCH 7152","title":"Design Topic Research Studio 2: Matter Design Computation","name":"ARCH 7152: Design Topic Research Studio 2: Matter Design Computation","desc":"Continuation of subjects developed in the first term. Focus is on research methods in matter design computation.","locations":[{"bldg":"Milstein Hall","room":"Milstein Hall 201","type":"STU","typeLong":"Studio","time":"11:40AM","days":"TF"}]},{"code":"ASTRO 3334","title":"Data Analysis and Research Techniques in Astronomy","name":"ASTRO 3334: Data Analysis and Research Techniques in Astronomy","desc":"Introduction to the tools of data processing and analysis for research in astronomy. \xa0The course reviews the techniques employed in astrophysical research, both observational and theoretical, to explore the universe.\xa0\xa0Methods and\xa0strategies of data acquisition and image and signal processing are discussed. Students gain hands-on experience with visualization techniques and methods of\xa0error analysis, data fitting, numerical simulation, and data scalability. \xa0Exercises address the processes by which astrophysicists piece together observations made with today\'s\xa0foremost astronomical instruments to solve questions concerning the origin of planets, stars, galaxies, and the universe itself. \xa0This course prepares students with the techniques and computing tools necessary to undertake research in astronomy\xa0and other data-driven fields.","locations":[{"bldg":"Space Sciences Building - Crsr","room":"Space Sciences Building 622","type":"LEC","typeLong":"Lecture","time":"08:40AM","days":"TR"}]},{"code":"ASTRO 6516","title":"Galactic Structure and Stellar Dynamics","name":"ASTRO 6516: Galactic Structure and Stellar Dynamics","desc":"Introduction to the study of the structure of galaxies via the laws of modern physics. Topics include the observed kinematics and spatial distribution of stars in the vicinity of the Sun, shapes and properties of stellar orbits, the gravitational N-body problem, collisional relaxation in stellar systems, spiral structure, galaxy classification and evolution, and cosmological results in galaxy formation.","locations":[{"bldg":"Space Sciences Building - Crsr","room":"Space Sciences Building 301","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"TR"}]},{"code":"ASTRO 6530","title":"Astrophysical Processes","name":"ASTRO 6530: Astrophysical Processes","desc":"This course focusses on radiative processes that are important for astrophysical applications, especially the effects of absorption, emission, scattering and refraction on the propagation of polarized radiation. Applications to specific astronomical phenomena will be discussed. Time permitting non-electromagnetic processes, such as neutrino production and transport and physics of dark matter, will be covered.","locations":[{"bldg":"Space Sciences Building - Crsr","room":"Space Sciences Building 301","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"MW"}]},{"code":"ASTRO 6575","title":"Planetary Atmospheres","name":"ASTRO 6575: Planetary Atmospheres","desc":"This course will provide an overview of fundamental physical processes that govern the structure and behavior of atmospheres in the solar system and beyond. Topics covered will include the basic principles of atmospheric statics, radiative transfer, dynamics, cloud physics, and chemistry to understand the diverse range of observable atmospheres.","locations":[{"bldg":"Space Sciences Building - Crsr","room":"Space Sciences Building 622","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MW"}]},{"code":"ASTRO 6577","title":"Planetary Surface Processes","name":"ASTRO 6577: Planetary Surface Processes","desc":"Survey of remote sensing techniques used to observe the surfaces of solar system bodies and the geomorphic processes involved in their formation and evolution. Surface morphology and landforms of terrestrial planets, satellites, asteroids, and comets. Fundamentals of impact cratering, volcanism, tectonism, and erosion, with significant emphasis on terrestrial field sites as analogs. Basic introduction to physical, geochemical, and \\"space\\" weathering of planetary surfaces. Basic introduction to field methods and remote sensing techniques/data sets (terrestrial, spacecraft).","locations":[{"bldg":"Space Sciences Building - Crsr","room":"Space Sciences Building 622","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"TR"}]},{"code":"BIOAP 3160","title":"Cellular Physiology","name":"BIOAP 3160: Cellular Physiology","desc":"A comprehensive course covering the general characteristics of eukaryotic cells; the structure, composition, and function of subcellular organelles; and the major signal transduction pathways regulating a variety of physiological cell activities. Among the main subjects covered are absorption and transport processes, mechanism of action of signaling molecules (hormones), the cell cycle and regulation of cell proliferation, cell-cell communication, extracellular matrix, stem cells, apoptosis, and carcinogenesis.","locations":[{"bldg":"CVM Center","room":"CVM Center S1226","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"MWF"}]},{"code":"BIOAP 4130","title":"Histology: The Biology of the Tissues","name":"BIOAP 4130: Histology: The Biology of the Tissues","desc":"Provides students with a basis for understanding the microscopic, fine-structural, and functional organization of vertebrates (primarily mammals), as well as methods of analytic morphology at the cell and tissue levels. Emphasizes dynamic interrelations of structure, composition, and function in cells and tissues.","locations":[{"bldg":"Vet Education Center","room":"Vet Education Center S1165-LH2","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"MW"},{"bldg":"Vet Medical Center","room":"Vet Medical Center C2029A wlab","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"MW"}]},{"code":"BIOAP 4140","title":"Principles of Pharmacology","name":"BIOAP 4140: Principles of Pharmacology","desc":"Undergraduate course surveying system- and organ-related aspects of pharmacology. Topics include mechanisms of drug action; drug disposition; pharmacokinetics; autonomic pharmacology; pharmacology of inflammation, allergy and platelet function; and endocrine, cardiovascular, respiratory, gastrointestinal, and renal pharmacology. The course is designed for undergraduate life science majors, particularly those interested in medical or veterinary school.","locations":[{"bldg":"Vet Research Tower","room":"Vet Research Tower T1003-LH3","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"MWF"}]},{"code":"BIOAP 7100","title":"By Scientific Design: Skill Building for a Career in the Life Sciences II","name":"BIOAP 7100: By Scientific Design: Skill Building for a Career in the Life Sciences II","desc":"A major goal in biomedical research is to translate advances in basic science into practically useful applications in clinical medicine. This class will provide graduate students with exposure to basic and clinical research, training in critical evaluation of the literature, foster creative thinking, and provide practice in oral defense.","locations":[{"bldg":"CVM Center","room":"CVM Center S1214 Hagan Rm","type":"LEC","typeLong":"Lecture","time":"02:45PM","days":"TR"}]},{"code":"BIOEE 2527","title":"Neotropical Wildlife Biology","name":"BIOEE 2527: Neotropical Wildlife Biology","desc":"This on-campus and international field course combination provides participating students with a broad introduction to the research process in field ecology, with literature and hands-on examples drawn from the fauna and flora of coastal Patagonia (Argentina), an area that provides us with unprecedented access to both marine and terrestrial wildlife as well as exposure to conservation challenges and success stories. The course begins in the latter part of the Fall semester (BIOEE 2525) when it meets twice weekly for seven weeks, largely to discuss relevant papers from the scientific literature with an emphasis on best practices in designing field studies to address questions in Neotropical ecology, behavioral ecology, conservation, and evolutionary biology. During the 2+ week field component in January (BIOEE 2526), students travel among field sites in Patagonia and put this knowledge to work in an experiential context by designing and implementing a series of research projects, including numerous short \'blitz\' projects and several longer, more intensive independent projects; many of these field studies involve close-hand observations of marine mammals, penguins, or other seabirds. This course (BIOEE 2527) is focused on building skills in data analysis and scientific writing, based on the data collected in the field by each student.","locations":[{"bldg":"Corson-Mudd","room":"Corson-Mudd A409","type":"LEC","typeLong":"Lecture","time":"09:05AM","days":"MW"}]},{"code":"BIOEE 4751","title":"Ornithology, Laboratory","name":"BIOEE 4751: Ornithology, Laboratory","desc":"This laboratory course covers many aspects of avian biology, including ecology, behavior, evolution, anatomy, physiology, and conservation. Some laboratory sessions will involve dissection of avian material, and the study of skeleton and scientific study skin specimens. Other sessions will involve outdoor activities including observations of avian behavior and demonstrations of standard ornithological field techniques, including methods of capturing, handling, and banding birds.","locations":[{"bldg":"Johnson Ctr - Lab of O","room":"Johnson Ctr - Lab of O 184","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"}]},{"code":"BIOEE 4940","title":"Special Topics in Ecology and Evolutionary Biology","name":"BIOEE 4940: Special Topics in Ecology and Evolutionary Biology","desc":"The department offers \\"trial\\" courses or seminars under this number. Offerings vary by semester. The same course is not to be offered more than twice under this number. For 2022-2023 descriptions, please go to the department website.","locations":[{"bldg":"Corson-Mudd","room":"Corson-Mudd A409","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"M"},{"bldg":"Corson-Mudd","room":"Corson-Mudd A409","type":"DIS","typeLong":"Discussion","time":"11:15AM","days":"W"},{"bldg":"Corson-Mudd","room":"Corson-Mudd A409","type":"LAB","typeLong":"Laboratory","time":"11:15AM","days":"R"}]},{"code":"BIOG 1440","title":"Introductory Biology: Comparative Physiology","name":"BIOG 1440: Introductory Biology: Comparative Physiology","desc":"An introductory physiology course intended for first-year and sophomore biological sciences majors and other students majoring in life sciences. The course integrates physiology from the cell to the organism with comparisons among animals, plants and microbes. Emphasis is on understanding of basic physiological concepts, stressing structure-function relationships and underlying physio-chemical mechanisms.","locations":[{"bldg":"Stimson Hall","room":"Stimson Hall 102","type":"DIS","typeLong":"Discussion","time":"09:05AM","days":"R"},{"bldg":"Stimson Hall","room":"Stimson Hall 104","type":"DIS","typeLong":"Discussion","time":"09:05AM","days":"R"},{"bldg":"Stimson Hall","room":"Stimson Hall 102","type":"DIS","typeLong":"Discussion","time":"10:10AM","days":"R"},{"bldg":"Stimson Hall","room":"Stimson Hall 104","type":"DIS","typeLong":"Discussion","time":"10:10AM","days":"R"},{"bldg":"Stimson Hall","room":"Stimson Hall 102","type":"DIS","typeLong":"Discussion","time":"11:15AM","days":"R"},{"bldg":"Stimson Hall","room":"Stimson Hall 104","type":"DIS","typeLong":"Discussion","time":"11:15AM","days":"R"},{"bldg":"Stimson Hall","room":"Stimson Hall 102","type":"DIS","typeLong":"Discussion","time":"12:20PM","days":"R"},{"bldg":"Stimson Hall","room":"Stimson Hall 104","type":"DIS","typeLong":"Discussion","time":"01:25PM","days":"R"},{"bldg":"Stimson Hall","room":"Stimson Hall 102","type":"DIS","typeLong":"Discussion","time":"01:25PM","days":"R"},{"bldg":"Stimson Hall","room":"Stimson Hall 104","type":"DIS","typeLong":"Discussion","time":"02:30PM","days":"R"},{"bldg":"Stimson Hall","room":"Stimson Hall 102","type":"DIS","typeLong":"Discussion","time":"02:30PM","days":"R"},{"bldg":"Stimson Hall","room":"Stimson Hall 104","type":"DIS","typeLong":"Discussion","time":"09:05AM","days":"F"},{"bldg":"Stimson Hall","room":"Stimson Hall 102","type":"DIS","typeLong":"Discussion","time":"10:10AM","days":"F"},{"bldg":"Stimson Hall","room":"Stimson Hall 104","type":"DIS","typeLong":"Discussion","time":"11:15AM","days":"F"},{"bldg":"Stimson Hall","room":"Stimson Hall 102","type":"DIS","typeLong":"Discussion","time":"11:15AM","days":"F"},{"bldg":"Stimson Hall","room":"Stimson Hall 104","type":"DIS","typeLong":"Discussion","time":"12:20PM","days":"F"},{"bldg":"Stimson Hall","room":"Stimson Hall 102","type":"DIS","typeLong":"Discussion","time":"01:25PM","days":"F"},{"bldg":"Stimson Hall","room":"Stimson Hall 104","type":"DIS","typeLong":"Discussion","time":"02:30PM","days":"F"}]},{"code":"BIOG 1500","title":"Investigative Biology Laboratory","name":"BIOG 1500: Investigative Biology Laboratory","desc":"Designed for biological sciences majors to provide lab experience with emphasis on processes of scientific investigations and to promote communication, literacy and collaboration in science. Students gain expertise in methods including instrumentation used by biologists to construct new knowledge. Lab topics include genetics, evolution, ecology, biochemistry, and molecular biology.","locations":[{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1104","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1108","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1112","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1116","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1120","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1108","type":"LAB","typeLong":"Laboratory","time":"09:05AM","days":"W"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1112","type":"LAB","typeLong":"Laboratory","time":"09:05AM","days":"W"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1104","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"W"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1108","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"W"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1112","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"W"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1116","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"W"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1120","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"W"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1104","type":"LAB","typeLong":"Laboratory","time":"07:30PM","days":"W"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1108","type":"LAB","typeLong":"Laboratory","time":"07:30PM","days":"W"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1112","type":"LAB","typeLong":"Laboratory","time":"07:30PM","days":"W"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1104","type":"LAB","typeLong":"Laboratory","time":"09:05AM","days":"R"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1108","type":"LAB","typeLong":"Laboratory","time":"09:05AM","days":"R"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1112","type":"LAB","typeLong":"Laboratory","time":"09:05AM","days":"R"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1120","type":"LAB","typeLong":"Laboratory","time":"09:05AM","days":"R"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1104","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1108","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1112","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1116","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II 1120","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"}]},{"code":"BIOMG 4400","title":"Laboratory in Biochemistry and Molecular Biology","name":"BIOMG 4400: Laboratory in Biochemistry and Molecular Biology","desc":"Students in this course will carry out experiments in protein biochemistry and molecular biology in an engaging laboratory environment. The protein biochemistry projects include protein purification (salt fractionation, ion exchange chromatography, affinity chromatography, size exclusion chromatography, and immunoprecipitation), protein analysis (SDS PAGE, BN PAGE, immunoblotting, and activity assays), and determination of enzyme kinetic parameters (Vmax, KM, and kcat). The molecular biology projects include CRISPR-mediated genome editing, nucleic acid purifications (plasmid DNA and RNA), gene expression analysis (RT-PCR and splicing), agarose gel electrophoresis, restriction endonuclease digestion, PCR, DNA cloning, transformation, and DNA sequence analysis. The course is organized around interesting projects that illustrate how different techniques are uniquely suited to answer a scientific question.","locations":[{"bldg":"Wing Hall","room":"Wing Hall 301","type":"LAB","typeLong":"Laboratory","time":"12:20PM","days":"MW"},{"bldg":"Wing Hall","room":"Wing Hall 301","type":"LAB","typeLong":"Laboratory","time":"12:20PM","days":"TR"}]},{"code":"BIOMG 6400","title":"Laboratory in Biochemistry and Molecular Biology","name":"BIOMG 6400: Laboratory in Biochemistry and Molecular Biology","desc":"Students in this course will carry out experiments in protein biochemistry and molecular biology in an engaging laboratory environment. The protein biochemistry projects include protein purification (salt fractionation, ion exchange chromatography, affinity chromatography, size exclusion chromatography, and immunoprecipitation), protein analysis (SDS PAGE, BN PAGE, immunoblotting, and activity assays), and determination of enzyme kinetic parameters (Vmax, KM, and kcat). The molecular biology projects include CRISPR-mediated genome editing, nucleic acid purifications (plasmid DNA and RNA), gene expression analysis (RT-PCR and splicing), agarose gel electrophoresis, restriction endonuclease digestion, PCR, DNA cloning, transformation, and DNA sequence analysis. The course is organized around interesting projects that illustrate how different techniques are uniquely suited to answer a scientific question.","locations":[{"bldg":"Wing Hall","room":"Wing Hall 301","type":"LAB","typeLong":"Laboratory","time":"12:20PM","days":"MW"},{"bldg":"Wing Hall","room":"Wing Hall 301","type":"LAB","typeLong":"Laboratory","time":"12:20PM","days":"TR"}]},{"code":"BIOMG 6980","title":"Graduate Student Teaching Assistant Experience in Molecular Biology and Genetics","name":"BIOMG 6980: Graduate Student Teaching Assistant Experience in Molecular Biology and Genetics","desc":"This course is designed for graduate students in Graduate Fields of Biochemistry, Molecular and Cell Biology (BMCB) and Genetics, Genomics, and Development (GGD) who will serve as teaching assistants (TA) in undergraduate courses offered in the Department of Molecular Biology and Genetics (MBG). BMCB and GGD teaching assistants will take this course concurrently with their first TA assignment. The goal of the course is to provide teaching assistants with pedagogical skills in active learning, assessing student learning, leading discussions, grading, and best teaching practices for TA\'ing MBG courses. Students will discuss their teaching experiences with their peers and gain feedback on their teaching effectiveness. An initial class meeting will help prepare students for the first day of class and provide tips for working with a teaching team. Throughout the semester, semi-weekly milestone meetings will focus on issues pertaining to graduate TAs, such as balancing research with teaching, interacting with students and course instructor, and special circumstances that may arise throughout the semester. Students will be encouraged to meet with their course instructor to gain feedback and to share their experiences with members of the course.","locations":[{"bldg":"Wing Hall","room":"Wing Hall 301","type":"IND","typeLong":"Independent Study","time":"07:00PM","days":"R"}]},{"code":"BIOMI 2911","title":"General Microbiology Laboratory","name":"BIOMI 2911: General Microbiology Laboratory","desc":"This class will introduce you to current concepts and laboratory techniques in microbiology. Our goal is to show you how scientists use experiments to learn about the microbes around us, with an emphasis on bacteria. This course complements the Microbiology lecture by providing students with hands-on investigations into the microbial world.","locations":[{"bldg":"Wing Hall","room":"Wing Hall 108","type":"LAB","typeLong":"Laboratory","time":"12:20PM","days":"MW"},{"bldg":"Wing Hall","room":"Wing Hall 114","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"MW"},{"bldg":"Wing Hall","room":"Wing Hall 108","type":"LAB","typeLong":"Laboratory","time":"10:10AM","days":"TR"},{"bldg":"Wing Hall","room":"Wing Hall 114","type":"LAB","typeLong":"Laboratory","time":"12:20PM","days":"TR"},{"bldg":"Wing Hall","room":"Wing Hall 114","type":"LAB","typeLong":"Laboratory","time":"10:10AM","days":"MW"}]},{"code":"BIOMS 3160","title":"Cellular Physiology","name":"BIOMS 3160: Cellular Physiology","desc":"A comprehensive course covering the general characteristics of eukaryotic cells; the structure, composition, and function of subcellular organelles; and the major signal transduction pathways regulating a variety of physiological cell activities. Among the main subjects covered are absorption and transport processes, mechanism of action of signaling molecules (hormones), the cell cycle and regulation of cell proliferation, cell-cell communication, extracellular matrix, stem cells, apoptosis, and carcinogenesis.","locations":[{"bldg":"CVM Center","room":"CVM Center S1226","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"MWF"}]},{"code":"BIOMS 4130","title":"Histology: The Biology of the Tissues","name":"BIOMS 4130: Histology: The Biology of the Tissues","desc":"Provides students with a basis for understanding the microscopic, fine-structural, and functional organization of vertebrates (primarily mammals), as well as methods of analytic morphology at the cell and tissue levels. Emphasizes dynamic interrelations of structure, composition, and function in cells and tissues.","locations":[{"bldg":"Vet Education Center","room":"Vet Education Center S1165-LH2","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"MW"},{"bldg":"Vet Medical Center","room":"Vet Medical Center C2029A wlab","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"MW"}]},{"code":"BIOMS 4140","title":"Principles of Pharmacology","name":"BIOMS 4140: Principles of Pharmacology","desc":"Undergraduate course surveying system- and organ-related aspects of pharmacology. Topics include mechanisms of drug action; drug disposition; pharmacokinetics; autonomic pharmacology; pharmacology of inflammation, allergy and platelet function; and endocrine, cardiovascular, respiratory, gastrointestinal, and renal pharmacology. The course is designed for undergraduate life science majors, particularly those interested in medical or veterinary school.","locations":[{"bldg":"Vet Research Tower","room":"Vet Research Tower T1003-LH3","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"MWF"}]},{"code":"BIOMS 7900","title":"Seminars in Stem Cell Research","name":"BIOMS 7900: Seminars in Stem Cell Research","desc":"This course is organized as work-in-progress presentations by faculty, post-docs, and students participating in stem cell research. Each student in the Cornell Training Program in Stem Cell Research presents one seminar per year based on their research. The student then meets with the thesis committee members for an evaluation of the presentation.","locations":[{"bldg":"Vet Education Center","room":"Vet Education Center S1165-LH2","type":"SEM","typeLong":"Seminar","time":"12:20PM","days":"T"}]},{"code":"BIONB 1100","title":"Natural History of the Magic Kingdom: Understanding Animal Behavior through Animated Films","name":"BIONB 1100: Natural History of the Magic Kingdom: Understanding Animal Behavior through Animated Films","desc":"Animals are frequently used to tell children\'s stories, especially in animated cinema. For the most part depictions of animals in classic films such as Lion King, Finding Nemo, or The Land Before Time are clearly not intended to depict an accurate natural history of their subjects. However, the ways in which movies get things wrong by having animals portray human roles opens an opportunity to explore the diversity of animal behavior. This course focuses on understanding the evolution, ecology, and natural history of diverse animals portrayed in films. It will cover a range of topics that apply generally to animated animal movies (e.g., Do animals use language?) as well as issues raised by specific movies (Does it make any sense for Scar to kill Mufasa in Lion King?). During this course students will engage with data and analyses used in the field of animal behavior, appreciate the diversity of experiences among animals, and consider our own biology and behavior in the light of the natural world.","locations":[{"bldg":"Corson-Mudd","room":"Corson-Mudd W358","type":"DIS","typeLong":"Discussion","time":"10:10AM","days":"F"},{"bldg":"Corson-Mudd","room":"Corson-Mudd W358","type":"DIS","typeLong":"Discussion","time":"10:10AM","days":"R"},{"bldg":"Corson-Mudd","room":"Corson-Mudd W358","type":"DIS","typeLong":"Discussion","time":"11:15AM","days":"F"}]},{"code":"BIONB 1220","title":"FWS: Special Topics in Neurobiology and Behavior","name":"BIONB 1220: FWS: Special Topics in Neurobiology and Behavior","desc":"The First-Year Writing Seminar is about introducing concepts in neuroscience and behavior and writing extensively about them. Topics vary by section.","locations":[{"bldg":"Corson-Mudd","room":"Corson-Mudd W358","type":"SEM","typeLong":"Seminar","time":"10:10AM","days":"MW"}]},{"code":"BIONB 3215","title":"Gender and the Brain","name":"BIONB 3215: Gender and the Brain","desc":"Why are boys more likely than girls to be diagnosed with autism, and why are women more likely than men to be diagnosed with depression? Are there different \\"gay\\" and \\"straight\\" brains? And how does brain science interact with gender and sexuality in popular debate? Reading and discussing the original scientific papers and related critical texts, we will delve into the neuroscience of gender. In this course, we will delve into the neuroscience of gender difference. Reading the original scientific papers and related critical texts, we will ask whether we can find measurable physical differences in male and female brains, and what these differences might be. Do men and women solve spatial puzzles differently, as measured physiologically? Do nonhuman animals display sex-specific behaviors mediated by brain structure, and can we extrapolate these findings to human behavior? Why are boys three times more likely than girls to be diagnosed as autistic, and is there any connection between the predominantly male phenomenon of autism and other stereotypically male mental traits? Are there physical representations of sexual orientation in the brain, and how are these related to gender identity? And how are scientific studies represented and misrepresented in popular debate?","locations":[{"bldg":"Corson-Mudd","room":"Corson-Mudd W364","type":"LEC","typeLong":"Lecture","time":"02:55PM","days":"MW"}]},{"code":"BIONB 4140","title":"Principles of Pharmacology","name":"BIONB 4140: Principles of Pharmacology","desc":"Undergraduate course surveying system- and organ-related aspects of pharmacology. Topics include mechanisms of drug action; drug disposition; pharmacokinetics; autonomic pharmacology; pharmacology of inflammation, allergy and platelet function; and endocrine, cardiovascular, respiratory, gastrointestinal, and renal pharmacology. The course is designed for undergraduate life science majors, particularly those interested in medical or veterinary school.","locations":[{"bldg":"Vet Research Tower","room":"Vet Research Tower T1003-LH3","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"MWF"}]},{"code":"BIONB 4200","title":"Topics in Neurobiology and Behavior","name":"BIONB 4200: Topics in Neurobiology and Behavior","desc":"Courses on selected topics in neurobiology and behavior; can include lecture and seminar courses. Topics vary by section; see Class Roster.","locations":[{"bldg":"Corson-Mudd","room":"Corson-Mudd W364","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"T"}]},{"code":"BIONB 4260","title":"Animal Communication","name":"BIONB 4260: Animal Communication","desc":"Communication is the \\"glue\\" that holds societies together. This course examines how and why animals communicate. Topics include the role of the environment in shaping animal signals, whether animals tell the truth to each other, why some bird songs are simple and others complex, and what kinds of signals might be exchanged between species.","locations":[{"bldg":"Corson-Mudd","room":"Corson-Mudd W364","type":"DIS","typeLong":"Discussion","time":"02:30PM","days":"R"},{"bldg":"Corson-Mudd","room":"Corson-Mudd W364","type":"DIS","typeLong":"Discussion","time":"12:20PM","days":"F"},{"bldg":"Corson-Mudd","room":"Corson-Mudd W364","type":"DIS","typeLong":"Discussion","time":"01:25PM","days":"F"}]},{"code":"BIONB 4300","title":"Experimental Molecular Neurobiology","name":"BIONB 4300: Experimental Molecular Neurobiology","desc":"Experiments include PCR, western blots, RNAi, antibody staining, optogenetics, calcium imaging of neurons and behavioral assays. Students will also construct their own epifluoresence microscope. Experiments emphasize how molecular techniques can be applied to studying neurobiological problems and will culminate in designing your own experiments.\xa0If you have additional questions please contact dld14@cornell.edu.","locations":[{"bldg":"Wing Hall","room":"Wing Hall 302","type":"DIS","typeLong":"Discussion","time":"09:05AM","days":"R"},{"bldg":"Wing Hall","room":"Wing Hall 302","type":"LAB","typeLong":"Laboratory","time":"08:30AM","days":"T"}]},{"code":"BIONB 4560","title":"Neural Control of Food Intake and Energy Metabolism","name":"BIONB 4560: Neural Control of Food Intake and Energy Metabolism","desc":"Food intake is a complex behavior that is strictly regulated by sensory, homeostatic, and hedonic neural circuits, which balance energy intake with energy expenditure. An integrated system of external sensory information works together with peripheral body organs and the central nervous system to produce the sensation of food and the drive to consume. The balanced functioning of this interconnected physiological system is critical for humans and other organisms to control the nutrient intake and maintain stable body weight. In eating disorders, such as anorexia nervosa, or in metabolic syndromes, such as obesity, the perception of food and the homeostatic balance between hunger and satiety is dysregulated leading to weight loss or gain and associated health problems. In this course, students will learn about the current and past research on neural control of food intake and energy metabolism. I will introduce the topic and cover the main discoveries in a discussion-based lecture. After the lecture, each week, students will collaboratively present a topic. The first student will present an overview of the research topic. The second student will present the research article for the week. Each student will present twice (once in each slot). Everyone must do the readings each week and come prepared to discuss the science. There will be ample time for discussion and questions, which are strongly encouraged.","locations":[{"bldg":"Corson-Mudd","room":"Corson-Mudd W358","type":"LEC","typeLong":"Lecture","time":"02:55PM","days":"TR"}]},{"code":"BIONB 4750","title":"Sleep \u2013 Evolution and Neural Basis","name":"BIONB 4750: Sleep \u2013 Evolution and Neural Basis","desc":"This class examines the neural circuits that regulate sleep and how sleep changes or preserves across different species. It will help students to extract critical information from research literature regarding sleep and related biological rhythms. Topics will range from comparison of sleep in different animals, description of the different sleep stages, brain computations during different sleep phases and pathological implications of sleep associated disorders.","locations":[{"bldg":"Corson-Mudd","room":"Corson-Mudd W364","type":"LEC","typeLong":"Lecture","time":"08:40AM","days":"MW"}]},{"code":"BIONB 4910","title":"Principles of Neurophysiology","name":"BIONB 4910: Principles of Neurophysiology","desc":"Laboratory-oriented course designed to teach the concepts and tools of cellular neurophysiology through hands-on experience with extracellular and intracellular electrophysiological techniques, and computer acquisition and analysis of laboratory results. Students explore signal transmission in the nervous system by examining the cellular basis of resting and action potentials, and synaptic transmission\xa0and optogenetic control of behavior and physiology. Lecture time is used to review nervous system physiology, introduce laboratory exercises, discuss lab results and primary research papers, and for presentation of additional experimental preparations and methods. Invertebrate preparations are used as model systems.","locations":[{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"11:20AM","days":"M"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"11:20AM","days":"T"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"08:00AM","days":"R"}]},{"code":"BIONB 5910","title":"Principles of Neurophysiology","name":"BIONB 5910: Principles of Neurophysiology","desc":"Laboratory-oriented course designed to teach the concepts and tools of cellular neurophysiology through hands-on experience with extracellular and intracellular electrophysiological techniques, and computer acquisition and analysis of laboratory results. Students explore signal transmission in the nervous system by examining the cellular basis of resting and action potentials, and synaptic transmission. Lecture time is used to review nervous system physiology, introduce laboratory exercises, discuss lab results and primary research papers, and for presentation of additional experimental preparations and methods. Invertebrate preparations are used as model systems.","locations":[{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"11:20AM","days":"M"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"11:20AM","days":"T"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"08:00AM","days":"R"}]},{"code":"BIONB 7202","title":"Topics in Neural Basis of Behavior","name":"BIONB 7202: Topics in Neural Basis of Behavior","desc":"A weekly journal club-style discussion. Graduate students may be expected to present a summary of their research or a summary of research in the literature related to their thesis once per year.","locations":[{"bldg":"Corson-Mudd","room":"Corson-Mudd A305","type":"SEM","typeLong":"Seminar","time":"10:10AM","days":"F"}]},{"code":"BME 4910","title":"Principles of Neurophysiology","name":"BME 4910: Principles of Neurophysiology","desc":"Laboratory-oriented course designed to teach the concepts and tools of cellular neurophysiology through hands-on experience with extracellular and intracellular electrophysiological techniques, and computer acquisition and analysis of laboratory results. Students explore signal transmission in the nervous system by examining the cellular basis of resting and action potentials, and synaptic transmission\xa0and optogenetic control of behavior and physiology. Lecture time is used to review nervous system physiology, introduce laboratory exercises, discuss lab results and primary research papers, and for presentation of additional experimental preparations and methods. Invertebrate preparations are used as model systems.","locations":[{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"11:20AM","days":"M"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"11:20AM","days":"T"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"08:00AM","days":"R"}]},{"code":"BME 5320","title":"Principles of Neurophysiology","name":"BME 5320: Principles of Neurophysiology","desc":"Laboratory-oriented course designed to teach the concepts and tools of cellular neurophysiology through hands-on experience with extracellular and intracellular electrophysiological techniques, and computer acquisition and analysis of laboratory results. Students explore signal transmission in the nervous system by examining the cellular basis of resting and action potentials, and synaptic transmission. Lecture time is used to review nervous system physiology, introduce laboratory exercises, discuss lab results and primary research papers, and for presentation of additional experimental preparations and methods. Invertebrate preparations are used as model systems.","locations":[{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"11:20AM","days":"M"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"11:20AM","days":"T"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"08:00AM","days":"R"}]},{"code":"CEE 4370","title":"Experimental Methods in Fluid Dynamics","name":"CEE 4370: Experimental Methods in Fluid Dynamics","desc":"Introduction to experimental techniques, data collection, and data analysis, in particular as they pertain to fluid flows. Introduces theory and use of analog transducers, acoustic Doppler velocimetry (ADV), full-field (2-D) quantitative imaging techniques such as particle image velocimetry (PIV) and laser induced fluorescence (LIF). Additional topics include computer-based experimental control, analog and digital data acquisition, discrete sampling theory, digital signal processing, and uncertainty analysis. The canonical flows of the turbulent flat plate boundary layer and the neutrally buoyant turbulent round jet are introduced theoretically and the subject of three major laboratory experiments using ADV, PIV and LIF. In CEE 6370/MAE6270 There is a final group project on a flow of the students choosing.","locations":[{"bldg":"Hollister Hall","room":"Hollister Hall B52","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"M"},{"bldg":"Hollister Hall","room":"Hollister Hall B52","type":"LAB","typeLong":"Laboratory","time":"10:10AM","days":"T"}]},{"code":"CEE 4740","title":"Introduction to the Behavior of Metal Structures","name":"CEE 4740: Introduction to the Behavior of Metal Structures","desc":"Introductory course focused on the use of solid and structural mechanics to quantify elementary behavior of metal structures in order to enable design. The course is project focused; with the students preparing a complete and detailed design deliverable. The course considers applications from civil structures, naval architecture, and aerospace engineering.","locations":[{"bldg":"Thurston Hall","room":"Thurston Hall B02A","type":"DIS","typeLong":"Discussion","time":"03:35PM","days":"R"},{"bldg":"Thurston Hall","room":"Thurston Hall B02A","type":"DIS","typeLong":"Discussion","time":"11:15AM","days":"F"}]},{"code":"CEE 6021","title":"Seminar: Environmental Engineering and Water Resources","name":"CEE 6021: Seminar: Environmental Engineering and Water Resources","desc":"Graduate students and faculty members give informal lectures on various topics related to ongoing research in environmental engineering or water resources.","locations":[{"bldg":"Hollister Hall","room":"Hollister Hall B52","type":"SEM","typeLong":"Seminar","time":"04:20PM","days":"T"}]},{"code":"CEE 6370","title":"Experimental Methods in Fluid Dynamics","name":"CEE 6370: Experimental Methods in Fluid Dynamics","desc":"Introduction to experimental techniques, data collection, and data analysis, in particular as they pertain to fluid flows. Introduces theory and use of\xa0analog transducers, acoustic Doppler velocimetry (ADV), full-field (2-D) quantitative imaging techniques such as particle image velocimetry (PIV) and laser induced fluorescence (LIF). Additional topics include\xa0computer-based experimental control, analog and digital data acquisition, discrete sampling theory, digital signal processing, and uncertainty analysis. The canonical flows of the turbulent flat plate boundary layer and the neutrally buoyant turbulent round jet are introduced theoretically and the subject of three major laboratory experiments using ADV, PIV and LIF. There is a final group project on a flow of the students choosing.","locations":[{"bldg":"Hollister Hall","room":"Hollister Hall B52","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"M"},{"bldg":"Hollister Hall","room":"Hollister Hall B52","type":"LAB","typeLong":"Laboratory","time":"10:10AM","days":"T"}]},{"code":"CHEM 4980","title":"Honors Seminar","name":"CHEM 4980: Honors Seminar","desc":"In the Chemistry Honors Seminar students will present their research in written and oral form. The course will also include a broader discussion of professional issues and life skills in the world of chemistry.","locations":[{"bldg":"Olin Chemistry Research Wing","room":"Olin Chemistry Rsrch Wing 458","type":"RSC","typeLong":"Research","time":"07:30PM","days":"W"}]},{"code":"CHIN 4412","title":"Advanced Mandarin II","name":"CHIN 4412: Advanced Mandarin II","desc":"Reading, discussion, and composition at advanced levels.","locations":[{"bldg":"Rockefeller Hall","room":"Rockefeller Hall 360","type":"SEM","typeLong":"Seminar","time":"12:20PM","days":"MWF"}]},{"code":"EAS 2500","title":"Meteorological Observations and Instruments","name":"EAS 2500: Meteorological Observations and Instruments","desc":"Covers methods and principles of atmospheric measurements and observations including in situ surface, free-air, and remote systems. Students will gain practical experience in analysis of atmospheric data, and use of state-of-the-art instrumentation.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2161A","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"TR"},{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2161A","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"}]},{"code":"EAS 3090","title":"Earth Materials","name":"EAS 3090: Earth Materials","desc":"Materials of the solid Earth (minerals, rocks) record the formation and evolution of our planet and the solar systems. This course will prepare students to identify minerals, understand their significance as a record of fundamental processes for our planet, and other rocky worlds in the solar system. This course will introduce geochemical concepts that include: element formation in the solar nebula, thermodynamic and kinetic properties that control the formation and chemical diversity of minerals, the mineral and rock record of deep Earth and surface processes. The lectures will be complemented by labs where students will learn to identify minerals using crystallography and polarized microscopy techniques. The labs will also include an introduction to modern analytical methods such as Raman and infrared spectroscopy, scanning electron microscopy, mass spectrometry, with hands-on projects where the students will collect and interpret their own data.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 1149","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"},{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 1149","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"F"}]},{"code":"EAS 3420","title":"Atmospheric Dynamics","name":"EAS 3420: Atmospheric Dynamics","desc":"Introduction to the basic equations and techniques used to understand motion in the atmosphere, with an emphasis on the space and time scales typical of storm systems (the synoptic scale). Derives the governing equations of atmospheric flow from first principles and applies them to middle latitude and tropical meteorology. Topics include balanced flow, atmospheric waves, circulation, and vorticity.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2161A","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"MWF"}]},{"code":"EAS 3520","title":"Synoptic Meteorology I","name":"EAS 3520: Synoptic Meteorology I","desc":"Study of weather map analysis and forecasting techniques by applying the principles of fluid and heat flow. Strengthens previously introduced meteorological concepts that are applied to forecasting midlatitude synoptic scale weather systems, such as cyclones, anticyclones, jet streams, fronts, and waves.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2161A","type":"LEC","typeLong":"Lecture","time":"09:05AM","days":"MWF"}]},{"code":"EAS 3540","title":"Ocean Satellite Remote Sensing","name":"EAS 3540: Ocean Satellite Remote Sensing","desc":"The goal of the course is to teach participants the basic skills needed to work independently to acquire, analyze and visualize data sets derived from a variety of satellite sensors that provide global estimates of phytoplankton abundance, sea surface temperature ocean wind speeds, and geostrophic currents. An important feature of the course is to develop good Python programming skills that are needed to effectively analyze and visualize satellite data to answer important oceanographic questions. Background lectures will cover the fundamentals of bio-optics, phytoplankton pigment algorithms and, to a lesser extent, the underlying physical principals leading to the measurement of sea surface temperature, ocean wind speed and geostrophic currents. The 3-credit class is taught in an intensive format for 9 weeks with 150 minutes of lecture time and 4hr and 50min of computer lab time each week.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2161A","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MW"},{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2161A","type":"LAB","typeLong":"Laboratory","time":"11:40AM","days":"MW"}]},{"code":"EAS 3880","title":"Global Geophysics","name":"EAS 3880: Global Geophysics","desc":"Covers global tectonics and the deep structure of the solid Earth as revealed by investigations of earthquakes, earthquake waves, the Earth\'s gravitational and magnetic fields, and heat flow. Students are highly encouraged to have either the math/phys prerequisites OR an introductory geologic sciences course before taking this class.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2154","type":"LEC","typeLong":"Lecture","time":"12:20PM","days":"MWF"}]},{"code":"EAS 4700","title":"Advanced Weather Forecasting and Analysis","name":"EAS 4700: Advanced Weather Forecasting and Analysis","desc":"Applied course focusing on weather forecasting and analysis techniques for various regions around the world. Lectures emphasize the application of student\'s knowledge of atmospheric dynamics, thermodynamics, and computer-data analysis to forecast the development and movement of multiscale weather systems. Students participate in weekly forecast discussions; write daily forecasts that include a synoptic discussion, quantitative precipitation forecasts, and severe weather outlook for the forecast region; and lead class discussion on assigned readings.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 1149","type":"LEC","typeLong":"Lecture","time":"08:40AM","days":"MWF"}]},{"code":"EAS 4820","title":"Seismology","name":"EAS 4820: Seismology","desc":"This course presents an overview of observations and methods in seismology. Topics include techniques necessary for understanding elastic wave propagation in layered media and what these waves teach us about Earth\'s composition and structure. This course introduces concepts in earthquake and reflection seismology and seismic hazard.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2154","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MWF"}]},{"code":"EAS 4940","title":"Special Topics in Earth and Atmospheric Sciences","name":"EAS 4940: Special Topics in Earth and Atmospheric Sciences","desc":"The department teaches \\"trial\\" courses under this number. Offerings vary by semester and are advertised by the department before the beginning of the semester.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2161A","type":"SEM","typeLong":"Seminar","time":"11:40AM","days":"TR"},{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2154","type":"SEM","typeLong":"Seminar","time":"08:40AM","days":"TR"}]},{"code":"EAS 5090","title":"Earth Materials","name":"EAS 5090: Earth Materials","desc":"Materials of the solid Earth (minerals, rocks) record the formation and evolution of our planet and the solar systems. This course will prepare students to identify minerals, understand their significance as a record of fundamental processes for our planet, and other rocky worlds in the solar system. This course will introduce geochemical concepts that include: element formation in the solar nebula, thermodynamic and kinetic properties that control the formation and chemical diversity of minerals, the mineral and rock record of deep Earth and surface processes. The lectures will be complemented by labs where students will learn to identify minerals using crystallography and polarized microscopy techniques. The labs will also include an introduction to modern analytical methods such as Raman and infrared spectroscopy, scanning electron microscopy, mass spectrometry, with hands-on projects where the students will collect and interpret their own data.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 1149","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"},{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 1149","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"F"}]},{"code":"EAS 5420","title":"Atmospheric Dynamics","name":"EAS 5420: Atmospheric Dynamics","desc":"Introduction to the basic equations and techniques used to understand motion in the atmosphere, with an emphasis on the space and time scales typical of storm systems (the \\"synoptic\\" scale). Derives the governing equations of atmospheric flow from first principles and applies them to mid-latitude meteorology. Topics include balanced flow, atmospheric waves, vorticity, and baroclinic instability. Students taking this course at the graduate level (EAS 5420) will have to complete additional questions on the biweekly problem sets and on the prelim and final exams.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2161A","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"MWF"}]},{"code":"EAS 5555","title":"Numerical Techniques for Weather and Climate Modeling","name":"EAS 5555: Numerical Techniques for Weather and Climate Modeling","desc":"This class will present an introductory overview of the common methodological approaches used today for numerical weather prediction and global climate modeling. Technical skills and in-depth understanding of the approaches will be emphasized through short weekly reading assignments and programming activities. An historical perspective on weather and climate modeling will be covered as well in the scope of this course because it helps put state-of-the-art numerical modeling in an appropriate context. Final projects will include running a weather or climate model on the National Center for Atmospheric Research\'s Cheyenne supercomputer, or other supercomputing facilities if students have access to other resources they would like to use. Cloud computing based solutions to numerical weather and climate modeling will also be covered. \xa0\xa0\xa0","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2161A","type":"LEC","typeLong":"Lecture","time":"08:40AM","days":"TR"}]},{"code":"EAS 5750","title":"Planetary Atmospheres","name":"EAS 5750: Planetary Atmospheres","desc":"This course will provide an overview of fundamental physical processes that govern the structure and behavior of atmospheres in the solar system and beyond. Topics covered will include the basic principles of atmospheric statics, radiative transfer, dynamics, cloud physics, and chemistry to understand the diverse range of observable atmospheres.","locations":[{"bldg":"Space Sciences Building - Crsr","room":"Space Sciences Building 622","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MW"}]},{"code":"EAS 5770","title":"Planetary Surface Processes","name":"EAS 5770: Planetary Surface Processes","desc":"Survey of remote sensing techniques used to observe the surfaces of solar system bodies and the geomorphic processes involved in their formation and evolution. Surface morphology and landforms of terrestrial planets, satellites, asteroids, and comets. Fundamentals of impact cratering, volcanism, tectonism, and erosion, with significant emphasis on terrestrial field sites as analogs. Basic introduction to physical, geochemical, and \\"space\\" weathering of planetary surfaces. Basic introduction to field methods and remote sensing techniques/data sets (terrestrial, spacecraft).","locations":[{"bldg":"Space Sciences Building - Crsr","room":"Space Sciences Building 622","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"TR"}]},{"code":"EAS 5850","title":"Global Geophysics","name":"EAS 5850: Global Geophysics","desc":"Covers global tectonics and the deep structure of the solid Earth as revealed by investigations of earthquakes, earthquake waves, the Earth\'s gravitational and magnetic fields, and heat flow. Students are highly encouraged to have either the math/phys prerequisites OR an introductory geologic sciences course before taking this class.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2154","type":"LEC","typeLong":"Lecture","time":"12:20PM","days":"MWF"}]},{"code":"EAS 6540","title":"Ocean Satellite Remote Sensing","name":"EAS 6540: Ocean Satellite Remote Sensing","desc":"The goal of the course is to teach participants the basic skills needed to work independently to acquire, analyze and visualize data sets derived from a variety of satellite sensors that provide global estimates of phytoplankton abundance, sea surface temperature ocean wind speeds, and geostrophic currents. An important feature of the course is to develop good Python programming skills that are needed to effectively analyze and visualize satellite data to answer important oceanographic questions. Background lectures will cover the fundamentals of bio-optics, phytoplankton pigment algorithms and, to a lesser extent, the underlying physical principals leading to the measurement of sea surface temperature, ocean wind speed and geostrophic currents. The 3-credit class is taught in an intensive format for 9 weeks with 150 minutes of lecture time and 4hr and 50min of computer lab time each week.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2161A","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MW"},{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2161A","type":"LAB","typeLong":"Laboratory","time":"11:40AM","days":"MW"}]},{"code":"EAS 6820","title":"Seismology","name":"EAS 6820: Seismology","desc":"This course presents an overview of observations and methods in seismology. Topics include techniques necessary for understanding elastic wave propagation in layered media and what these waves teach us about Earth\'s composition and structure. This course introduces concepts in earthquake and reflection seismology and seismic hazard.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2154","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MWF"}]},{"code":"EAS 6920","title":"Special Topics in Earth and Atmospheric Sciences","name":"EAS 6920: Special Topics in Earth and Atmospheric Sciences","desc":"Study of topics in earth and atmospheric science that are more specialized or different from other courses. Special topics depend on staff and student interests.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2161A","type":"SEM","typeLong":"Seminar","time":"11:40AM","days":"TR"},{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2154","type":"SEM","typeLong":"Seminar","time":"08:40AM","days":"TR"}]},{"code":"EAS 7930","title":"Earth Science Seminar","name":"EAS 7930: Earth Science Seminar","desc":"Seminar course for graduate students in geological sciences with topics in tectonics, seismology, petrology, and similar disciplines. Emphasis on mountain belts, but other topics entertained.","locations":[{"bldg":"Snee Hall Geological Science","room":"Snee Hall Geological Sci 2154","type":"SEM","typeLong":"Seminar","time":"03:35PM","days":"F"}]},{"code":"ECE 4361","title":"Nanofabrication and Characterization of Electronics Laboratory","name":"ECE 4361: Nanofabrication and Characterization of Electronics Laboratory","desc":"This course provides an introduction to nanofabrication technologies with emphasis on Si-based integrated circuits manufacturing as well as modern electronics based on GaN, 2D materials etc. The lab, primarily taught in the Cornell Teaching Cleanroom, includes basic fabrication steps of lithography, metallization, plasma etching and annealing. A series of devices will be fabricated: solar cells, MOS capacitors and transistors, 2D transistors, GaN HEMTs and LEDs.","locations":[{"bldg":"Phillips Hall","room":"Phillips Hall 236","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"},{"bldg":"Phillips Hall","room":"Phillips Hall 236","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"W"},{"bldg":"Phillips Hall","room":"Phillips Hall 236","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"}]},{"code":"ECE 4910","title":"Principles of Neurophysiology","name":"ECE 4910: Principles of Neurophysiology","desc":"Laboratory-oriented course designed to teach the concepts and tools of cellular neurophysiology through hands-on experience with extracellular and intracellular electrophysiological techniques, and computer acquisition and analysis of laboratory results. Students explore signal transmission in the nervous system by examining the cellular basis of resting and action potentials, and synaptic transmission\xa0and optogenetic control of behavior and physiology. Lecture time is used to review nervous system physiology, introduce laboratory exercises, discuss lab results and primary research papers, and for presentation of additional experimental preparations and methods. Invertebrate preparations are used as model systems.","locations":[{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"11:20AM","days":"M"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"11:20AM","days":"T"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"08:00AM","days":"R"}]},{"code":"ECE 5090","title":"Principles of Neurophysiology","name":"ECE 5090: Principles of Neurophysiology","desc":"Laboratory-oriented course designed to teach the concepts and tools of cellular neurophysiology through hands-on experience with extracellular and intracellular electrophysiological techniques, and computer acquisition and analysis of laboratory results. Students explore signal transmission in the nervous system by examining the cellular basis of resting and action potentials, and synaptic transmission. Lecture time is used to review nervous system physiology, introduce laboratory exercises, discuss lab results and primary research papers, and for presentation of additional experimental preparations and methods. Invertebrate preparations are used as model systems.","locations":[{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"11:20AM","days":"M"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"11:20AM","days":"T"},{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B150","type":"LAB","typeLong":"Laboratory","time":"08:00AM","days":"R"}]},{"code":"ECON 3710","title":"The Economics of Risky Health Behaviors","name":"ECON 3710: The Economics of Risky Health Behaviors","desc":"Risky health behaviors such as cigarette smoking, alcohol abuse, risky sex, drug use, poor diet and physical inactivity (leading to obesity), and self-harm are responsible for hundreds of thousands of preventable deaths and impose billions of dollars in medical care costs each year in the United States. This course teaches the economic approach to studying risky health behaviors. The research literature on the economic causes and correlates of risky health behaviors will be studied in detail. Numerous policies to modify risky health behaviors, such as the minimum legal drinking age and recreational marijuana use laws, will be debated in class. A policy wargame is conducted, with students creating advertisements, giving oral presentations, and lobbying policymakers to advocate a specific policy position.\\n\xa0","locations":[{"bldg":"Wolpe Center","room":"Wolpe Center 118","type":"LEC","typeLong":"Lecture","time":"06:30PM","days":"W"}]},{"code":"ECON 7851","title":"Third Year Research Seminar II","name":"ECON 7851: Third Year Research Seminar II","desc":"Ph.D. students in the Field of Economics are required to take this year-long research seminar, and receive a grade of Satisfactory, in order to remain in good standing in the Ph.D. program. Students present and discuss each second-year paper, which must be completed before the semester opens and Economics 7850 meets for the first time. Students also present at least two additional papers or paper plans. These are intended to be part of the core of the student\'s thesis proposal, which must be given as part of the student\'s A Exam prior to the start of the fourth year of graduate study in the economics Ph.D. program. Economics 7851 ends with a mini-conference, attended by faculty and other Ph.D. students, in which each student makes a formal presentation in standard economics conference format, and each student discusses one of these presentations. Professional writing and presentation coaching is also provided.","locations":[{"bldg":"Uris Hall","room":"Uris Hall 488","type":"SEM","typeLong":"Seminar","time":"04:30PM","days":"TR"},{"bldg":"Uris Hall","room":"Uris Hall 488","type":"SEM","typeLong":"Seminar","time":"04:30PM","days":"R"}]},{"code":"EDUC 4826","title":"Leading Dialogue Across Difference: Practicum in Intergroup Relations","name":"EDUC 4826: Leading Dialogue Across Difference: Practicum in Intergroup Relations","desc":"Through theoretical and experiential learning, students in EDUC 4826 will further develop knowledge and skills gained in EDUC 2610\xa0for leadership across social, cultural, and political differences. Through weekly seminar sessions, students gain a working knowledge of scholarly literature drawn from the fields of critical intergroup dialogue, practice theory, social identity theory, and social justice education. Students learn about the theories and empirical evidence on why and how communication and collaboration across difference work. Moreover, through unique experiential learning opportunities in the classroom, students practice communication and collaboration across difference, as well as facilitation skills fundamental to leading intergroup dialogue processes.","locations":[{"bldg":"Computing & Communications Ctr","room":"Computing & Communications 121","type":"SEM","typeLong":"Seminar","time":"10:10AM","days":"W"},{"bldg":"Computing & Communications Ctr","room":"Computing & Communications 121","type":"SEM","typeLong":"Seminar","time":"02:30PM","days":"W"}]},{"code":"ENGL 6050","title":"Archives and Artifacts","name":"ENGL 6050: Archives and Artifacts","desc":"Taught by curators and archivists in Cornell Library\'s Division of Rare and Manuscript Collections, this seminar provides an introduction to the analysis of books and unique archival documents as physical objects. Students will work hands-on with rare materials in the Carl A. Kroch Library to learn the skills necessary to pursue original research dependent upon locating and studying primary sources such as rare books, archival collections, photographs, and other unique artifacts. Topics covered will include descriptive bibliography and the analysis of books (their manufacture, distribution, and audiences), an introduction to archival arrangement and description, and how to navigate institutional repositories of rare materials. Students will also have the opportunity to discuss strategies and methods for locating materials related to their own projects or areas of study.","locations":[{"bldg":"Kroch,Carl A Library","room":"Kroch, Carl A Library 2B49","type":"SEM","typeLong":"Seminar","time":"04:00PM","days":"T"}]},{"code":"ENGRD 2620","title":"Electronic Materials for the Information Age","name":"ENGRD 2620: Electronic Materials for the Information Age","desc":"Examines the electrical and optical properties of materials. Topics include the mechanism of electrical conduction in metals, semiconductors and insulators; tuning of electrical properties in semiconductors, charge transport across metal/semiconductor and semiconductor/semiconductor junctions, and the interaction of materials with light; semiconductor electronic devices; and the materials science of device fabrication. Applications in microelectronics, solar cells, electronics, and display technologies are discussed. Semiweekly labs provide hands-on experience characterizing electronic materials and devices.","locations":[{"bldg":"Phillips Hall","room":"Phillips Hall 237","type":"LAB","typeLong":"Laboratory","time":"08:30AM","days":"R"},{"bldg":"Phillips Hall","room":"Phillips Hall 237","type":"LAB","typeLong":"Laboratory","time":"11:15AM","days":"S"}]},{"code":"ENGRI 1100","title":"Lasers and Photonics","name":"ENGRI 1100: Lasers and Photonics","desc":"Lasers have had an enormous impact on communications, medicine, remote sensing, and material processing. This course reviews the properties of light that are essential to understanding the underlying principles of lasers and these photonic technologies. There also is a strong, hands-on laboratory component in which the students build and operate a nitrogen laser and participate in several demonstration experiments such as holography, laser processing of materials, optical tweezers, and fiber optics.","locations":[{"bldg":"Physical Sciences Building","room":"Physical Sciences Building 131","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"M"},{"bldg":"Physical Sciences Building","room":"Physical Sciences Building 131","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"T"},{"bldg":"Physical Sciences Building","room":"Physical Sciences Building 131","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"W"},{"bldg":"Physical Sciences Building","room":"Physical Sciences Building 131","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"R"}]},{"code":"ENTOM 4440","title":"Integrated Pest Management","name":"ENTOM 4440: Integrated Pest Management","desc":"Lectures integrate the principles of pest control, ecology, and economics in the management of pests across multiple systems. Labs consist of exercises to reinforce concepts presented in lecture and demonstrate pest monitoring techniques and the application of computer technology to management problems.","locations":[{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B146","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"}]},{"code":"ENTOM 4830","title":"Insect Physiology","name":"ENTOM 4830: Insect Physiology","desc":"Introduction to the often unique ways in which insects have met their basic needs. Examines each organ system with emphasis on basic principles and specific examples. Also introduces students to some common methods used in physiological research and to the critical reading of scientific literature.","locations":[{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B146","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"W"}]},{"code":"ENTOM 5440","title":"Integrated Pest Management","name":"ENTOM 5440: Integrated Pest Management","desc":"Lectures integrate the principles of pest control, ecology, and economics in the management of pests across multiple systems. Labs consist of exercises to reinforce concepts presented in lecture and demonstrate pest monitoring techniques and the application of computer technology to management problems.","locations":[{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B146","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"}]},{"code":"ENVS 3260","title":"Applied Conservation Ecology","name":"ENVS 3260: Applied Conservation Ecology","desc":"An interactive-field and lab course designed to provide direct experience with some of the most important field methods and analytical techniques used to examine species, ecosystem and community-level function, structure, and value, especially within the context of contemporary conservation ecology and evolutionary theory. Tools include field sampling techniques, resource and conservation mapping, spatial referencing, GIS, measures of biodiversity, and manual and automated techniques for studying soil, stream, forest, terrestrial, and marine biota and related physical factors. The class is designed to provide a strong background in field research methods and theory related to ecological conservation.","locations":[{"bldg":"Rice Hall","room":"Rice Hall 301","type":"LAB","typeLong":"Laboratory","time":"12:25PM","days":"F"}]},{"code":"FDSC 2110","title":"Food Analysis Laboratory","name":"FDSC 2110: Food Analysis Laboratory","desc":"The experiments conducted in Food Analysis lab provide context for the application of principles of food analysis. Students will analyze complex food products for lipids, minerals, carbohydrates, proteins and other components, and through this process, hone their basic lab skills, including organization and time management. Experiments are designed to introduce a variety of techniques commonly used in food science and nutrition analytical labs. The techniques, process, and problems presented to students in this lab will have application for career paths in product development, research and development, quality control, food safety, and industry regulations, among others.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall M31","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"M"},{"bldg":"Stocking Hall","room":"Stocking Hall M31","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"}]},{"code":"FDSC 2300","title":"Culinary Science","name":"FDSC 2300: Culinary Science","desc":"Learn the science behind some favorite and new foods. Working with chefs from Cornell Dining, the underlying principles of the foods prepared in class are explained. The final exam is the preparation of a class dinner.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall 158","type":"LAB","typeLong":"Laboratory","time":"10:10AM","days":"W"},{"bldg":"Stocking Hall","room":"Stocking Hall 158","type":"LAB","typeLong":"Laboratory","time":"12:20PM","days":"W"},{"bldg":"Stocking Hall","room":"Stocking Hall 158","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"W"},{"bldg":"Stocking Hall","room":"Stocking Hall 158","type":"LAB","typeLong":"Laboratory","time":"07:30PM","days":"W"}]},{"code":"FDSC 2400","title":"Wines and Grapes: Composition and Analysis","name":"FDSC 2400: Wines and Grapes: Composition and Analysis","desc":"Investigates the composition of grapes and wine and the most common analytical tools used in their evaluation. Both the theoretical and practical aspects of grape and wine analyses are considered.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall M31","type":"LEC","typeLong":"Lecture","time":"12:20PM","days":"W"},{"bldg":"Stocking Hall","room":"Stocking Hall M31","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"W"}]},{"code":"FDSC 4190","title":"Food Chemistry Laboratory","name":"FDSC 4190: Food Chemistry Laboratory","desc":"Deals with the chemical properties of food components and changes they undergo in processing and storage. Stresses relationships between the chemical composition of foods and functional, nutritional, and sensory properties. Introduces lab techniques commonly used in food research. Requires a lab research project that involves writing a research proposal for the project, conducting laboratory research to test hypotheses described in the proposal, analyzing the data, and writing a paper following the format used by the Journal of Food Science.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall M31","type":"LAB","typeLong":"Laboratory","time":"12:20PM","days":"R"}]},{"code":"FDSC 4340","title":"Cider Production Laboratory","name":"FDSC 4340: Cider Production Laboratory","desc":"Cider is a fermented beverage made from apples. Students in this course are immersed in cider production and analysis practices through activities in the teaching winery and by visiting commercial cideries. Readings and discussions support the hands-on learning focus in this laboratory course. Significant winery time between weekly class sessions is required.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"W"}]},{"code":"FDSC 4360","title":"Distillation Principles and Practices Laboratory","name":"FDSC 4360: Distillation Principles and Practices Laboratory","desc":"As an introduction to the science of distillation this course uses the study of pre-fermentation and fermentation biology, phase separation and vapor-liquid equilibrium, and sensory perception as a vehicle to explore the role of science and technology in the production and enjoyment of distilled beverages. Sensory samples and commercial samples of spirits will be used to illustrate the sensory properties and chemical components which define different types of distilled spirits, with the goal of understanding how different raw materials, processing, and aging impact these sensory properties.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"F"},{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LAB","typeLong":"Laboratory","time":"11:15AM","days":"F"}]},{"code":"FDSC 4710","title":"Advanced Winemaking Theory and Practice II Laboratory","name":"FDSC 4710: Advanced Winemaking Theory and Practice II Laboratory","desc":"In the laboratory of part II of the Winemaking Theory and Practice, students continue working with wines produced in the preceding fall term, focusing on aging options, stabilization, fining, and packaging. The laboratory also provides advanced training in wine chemical and sensory analysis. Students must develop their own winemaking finishing plan for several different young wines, and participate in self-guided wine production activities, thus previous experience in wine production is highly recommended.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"}]},{"code":"FDSC 5400","title":"Wine and Grapes: Composition and Analysis","name":"FDSC 5400: Wine and Grapes: Composition and Analysis","desc":"VIEN 5400 is a 2-credit course (1 credit lecture, 1 credit lab) with an emphasis on understanding the practice and theory behind analytical techniques routinely used in the wine and grape industries, and the statistical tools used to evaluate the effectiveness of both analyst and assay. The course is designed to provide practical skills complementary to other courses. VIEN 5400 is restricted to graduate students; undergraduates should enroll in VIEN 2400.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall M31","type":"LEC","typeLong":"Lecture","time":"12:20PM","days":"W"},{"bldg":"Stocking Hall","room":"Stocking Hall M31","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"W"}]},{"code":"FDSC 6340","title":"Cider Production Laboratory","name":"FDSC 6340: Cider Production Laboratory","desc":"Cider is a fermented beverage made from apples. Students in this course are immersed in cider production and analysis practices through activities in the teaching winery and by visiting commercial cideries. Readings and discussions support the hands-on learning focus in this laboratory course. Significant winery time between weekly class sessions is required.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"W"}]},{"code":"FDSC 6360","title":"Distillation Principles and Practices Laboratory","name":"FDSC 6360: Distillation Principles and Practices Laboratory","desc":"As an introduction to the science of distillation this course uses the study of pre-fermentation and fermentation biology, phase separation and vapor-liquid equilibrium, and sensory perception as a vehicle to explore the role of science and technology in the production and enjoyment of distilled beverages. Sensory samples and commercial samples of spirits will be used to illustrate the sensory properties and chemical components which define different types of distilled spirits, with the goal of understanding how different raw materials, processing, and aging impact these sensory properties.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"F"},{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LAB","typeLong":"Laboratory","time":"11:15AM","days":"F"}]},{"code":"FDSC 6710","title":"Advanced Winemaking Theory and Practice II Laboratory","name":"FDSC 6710: Advanced Winemaking Theory and Practice II Laboratory","desc":"In the laboratory of part II of the Winemaking Theory and Practice, students continue working with wines produced in the preceding fall term, focusing on aging options, stabilization, fining, and packaging. The laboratory also provides advanced training in wine chemical and sensory analysis. Students must develop their own winemaking finishing plan for several different young wines, and participate in self-guided wine production activities, thus previous experience in wine production is highly recommended.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"}]},{"code":"FGSS 3210","title":"Gender and the Brain","name":"FGSS 3210: Gender and the Brain","desc":"Why are boys more likely than girls to be diagnosed with autism, and why are women more likely than men to be diagnosed with depression? Are there different \\"gay\\" and \\"straight\\" brains? And how does brain science interact with gender and sexuality in popular debate? Reading and discussing the original scientific papers and related critical texts, we will delve into the neuroscience of gender. In this course, we will delve into the neuroscience of gender difference. Reading the original scientific papers and related critical texts, we will ask whether we can find measurable physical differences in male and female brains, and what these differences might be. Do men and women solve spatial puzzles differently, as measured physiologically? Do nonhuman animals display sex-specific behaviors mediated by brain structure, and can we extrapolate these findings to human behavior? Why are boys three times more likely than girls to be diagnosed as autistic, and is there any connection between the predominantly male phenomenon of autism and other stereotypically male mental traits? Are there physical representations of sexual orientation in the brain, and how are these related to gender identity? And how are scientific studies represented and misrepresented in popular debate?","locations":[{"bldg":"Corson-Mudd","room":"Corson-Mudd W364","type":"LEC","typeLong":"Lecture","time":"02:55PM","days":"MW"}]},{"code":"FGSS 4000","title":"Senior Seminar in Feminist, Gender, and Sexuality Studies","name":"FGSS 4000: Senior Seminar in Feminist, Gender, and Sexuality Studies","desc":"This senior seminar constitutes the culmination of the FGSS major-it provides a unique opportunity to come together with all the other FGSS seniors to both put to use what has been learned and explore new aspects of feminist, gender, and sexuality studies. In this particular seminar, we will attempt to answer, in short, the question of what it means to be a feminist today, at this point in time and place. Pursuing the intersections of theory and practice, we will explore issues and concerns in the areas that you have identified as central to your concept and/or critique of feminism.","locations":[{"bldg":"Rockefeller Hall","room":"Rockefeller Hall 190","type":"SEM","typeLong":"Seminar","time":"02:00PM","days":"W"}]},{"code":"GOVT 3087","title":"International Human Rights Law and Advocacy","name":"GOVT 3087: International Human Rights Law and Advocacy","desc":"This course will introduce students to the law and practice of international human rights. Students will think critically about the effectiveness of the international human rights system by examining its successes, failures, and dilemmas in preventing and responding to human rights abuse. Topics covered include the origins of international human rights; the role of international, regional, and domestic institutions and actors in enforcing human rights; critiques of the human rights movement; challenges encountered in human rights advocacy; and the relationship of the United States to the international system for the protection of human rights. The course will also explore issues such as the immigration, the death penalty, gender justice, climate change, global poverty, racism and xenophobia, and responses to mass atrocities. Throughout this interactive course, students will have frequent opportunities to step into the shoes of a human rights advocate and work individually and with their classmates to address simulated human rights problems.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 184","type":"LEC","typeLong":"Lecture","time":"01:00PM","days":"MW"}]},{"code":"GOVT 3131","title":"The Nature, Functions, and Limits of Law","name":"GOVT 3131: The Nature, Functions, and Limits of Law","desc":"A general-education course to acquaint students with how our legal system pursues the goals of society. The course introduces students to various perspectives on the nature of law, what functions it ought to serve in society, and what it can and cannot accomplish. The course proceeds in the belief that such matters constitute a valuable and necessary part of a general education, not only for pre-law students but especially for students in other fields. Assigned readings comprise legal materials and also secondary sources on the legal process and the role of law in society. The classes include discussion and debate about current legal and social issues, including equality, safety, the environment, punishment, and autonomy.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 184","type":"LEC","typeLong":"Lecture","time":"02:55PM","days":"MW"}]},{"code":"GREEK 7161","title":"Greek Philosophical Texts","name":"GREEK 7161: Greek Philosophical Texts","desc":"Reading and translation of Greek Philosophical texts.","locations":[{"bldg":"Goldwin Smith Hall","room":"Goldwin Smith Hall 327","type":"SEM","typeLong":"Seminar","time":"12:20PM","days":"F"}]},{"code":"HADM 1361","title":"Principles of Food and Beverage Operations Management","name":"HADM 1361: Principles of Food and Beverage Operations Management","desc":"In this course students are introduced to the principles of food and beverage operations management. Attention is focused on market segments and industry structure with an emphasis on product and systems differentiation. Course goals include a conceptual understanding of, and the practical application of (e.g., lab activities), the components of foodservice systems: menu and product development and management, production, service, controls, financial analysis, food safety, ethics, and quality assurance.","locations":[{"bldg":"Statler Hall","room":"Statler Hall 280","type":"LAB","typeLong":"Laboratory","time":"08:00AM","days":"T"},{"bldg":"Statler Hall","room":"Statler Hall 280","type":"LAB","typeLong":"Laboratory","time":"11:40AM","days":"T"},{"bldg":"Statler Hall","room":"Statler Hall 280","type":"LAB","typeLong":"Laboratory","time":"08:00AM","days":"R"},{"bldg":"Statler Hall","room":"Statler Hall 280","type":"LAB","typeLong":"Laboratory","time":"11:40AM","days":"R"},{"bldg":"Statler Hall","room":"Statler Hall 280","type":"LAB","typeLong":"Laboratory","time":"08:00AM","days":"F"}]},{"code":"HADM 1740","title":"Business Computing","name":"HADM 1740: Business Computing","desc":"Provides a foundation in information technology (IT) and how it relates to everyday business computing. Students learn IT concepts during lectures, and these concepts are reinforced in practical lab sessions using current standards of business computing. Topics include fundamental IT concepts; proficiency in Microsoft Office; understanding the issues of tool selection, standardization, and efficiency; integration of applications; and recognizing the importance of good computer management.","locations":[{"bldg":"Statler Hall","room":"Statler Hall 365","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MW"},{"bldg":"Statler Hall","room":"Statler Hall 365","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"TR"}]},{"code":"HADM 2351","title":"Restaurant Management","name":"HADM 2351: Restaurant Management","desc":"This course covers concepts, issues, and business principles relevant to the restaurant industry, including market analysis, menu and service systems, and financial and operational management and applies them in a real-life restaurant setting. Students conceptualize and manage the operations of an in-person restaurant open to the Cornell community and evaluate the process and outcomes. Successful completion of the course requires students to complete TiPS and ServSafe certifications shortly after the start of the semester.","locations":[{"bldg":"Statler Hall","room":"Statler Hall 280","type":"LAB","typeLong":"Laboratory","time":"02:55PM","days":"M"},{"bldg":"Statler Hall","room":"Statler Hall 280","type":"LAB","typeLong":"Laboratory","time":"02:55PM","days":"W"}]},{"code":"HADM 2740","title":"Business Computing","name":"HADM 2740: Business Computing","desc":"Provides a foundation in information technology (IT) and how it relates to everyday business computing. Students learn IT concepts during lectures, and these concepts are reinforced in practical lab sessions using current standards of business computing. Topics include fundamental IT concepts; proficiency in Microsoft Office; understanding the issues of tool selection, standardization, and efficiency; integration of applications; and recognizing the importance of good computer management.","locations":[{"bldg":"Statler Hall","room":"Statler Hall 365","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MW"},{"bldg":"Statler Hall","room":"Statler Hall 365","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"TR"}]},{"code":"HADM 3350","title":"Restaurant Management","name":"HADM 3350: Restaurant Management","desc":"This course covers concepts, issues, and business principles relevant to the restaurant industry, including market analysis, menu and service systems, and financial and operational management and applies them in a real-life restaurant setting. Students conceptualize and manage the operations of an in-person restaurant open to the Cornell community and evaluate the process and outcomes.\xa0 Successful completion of the course requires students to complete TiPS and ServSafe certifications shortly after the start of the semester.","locations":[{"bldg":"Statler Hall","room":"Statler Hall 280","type":"LAB","typeLong":"Laboratory","time":"02:55PM","days":"T"},{"bldg":"Statler Hall","room":"Statler Hall 280","type":"LAB","typeLong":"Laboratory","time":"02:55PM","days":"R"},{"bldg":"Statler Hall","room":"Statler Hall 280","type":"LAB","typeLong":"Laboratory","time":"02:55PM","days":"F"}]},{"code":"HADM 4335","title":"Contemporary Issues in Food","name":"HADM 4335: Contemporary Issues in Food","desc":"This course intends to build awareness among the public regarding nutrition, food ethics, policy, insecurity, and sustainability. Sophisticated consumers and business operators are increasing the embrace of environmental health, customer health, and food sourcing. Students will explore the everchanging landscape of the food and beverage industry as seen through this societal lens. Discussion and lab topics include sustainable farming and consumer health needs, the power of food marketing, merchandising, and the \\"selling\\" of healthy menus in restaurants.\\n\xa0","locations":[{"bldg":"Statler Hall","room":"Statler Hall 278","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"MW"}]},{"code":"ILRID 4826","title":"Leading Dialogue Across Difference: Practicum in Intergroup Relations","name":"ILRID 4826: Leading Dialogue Across Difference: Practicum in Intergroup Relations","desc":"Through theoretical and experiential learning, students in EDUC 4826 will further develop knowledge and skills gained in EDUC 2610\xa0for leadership across social, cultural, and political differences. Through weekly seminar sessions, students gain a working knowledge of scholarly literature drawn from the fields of critical intergroup dialogue, practice theory, social identity theory, and social justice education. Students learn about the theories and empirical evidence on why and how communication and collaboration across difference work. Moreover, through unique experiential learning opportunities in the classroom, students practice communication and collaboration across difference, as well as facilitation skills fundamental to leading intergroup dialogue processes.","locations":[{"bldg":"Computing & Communications Ctr","room":"Computing & Communications 121","type":"SEM","typeLong":"Seminar","time":"10:10AM","days":"W"},{"bldg":"Computing & Communications Ctr","room":"Computing & Communications 121","type":"SEM","typeLong":"Seminar","time":"02:30PM","days":"W"}]},{"code":"ILRLR 6189","title":"Current Issues in Collective Bargaining","name":"ILRLR 6189: Current Issues in Collective Bargaining","desc":"This advanced level mini-course examines several key issues in today\'s collective bargaining between US private sector employers and unions. Through extensive pre-class readings and podcasts, and during four 3 hour classes, we will trace key developments that have set the table for today\'s bargaining environment, eg., the deindustrialization of the American economy, the decline of union workforce density, and the rise of defensive collective bargaining; examine resultant wage stagnation and troubled health care and defined benefit pension plans; investigate the effects and intersection of employment law and legislation on collective bargaining and dispute resolution; and consider the emerging arena of unionization in higher education.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 182","type":"LEC","typeLong":"Lecture","time":"06:00PM","days":"MTWR"}]},{"code":"LA 5900","title":"Theoretical Foundations","name":"LA 5900: Theoretical Foundations","desc":"This seminar is intended to provide Landscape Architecture Students (as well as Architecture, Planning students) with knowledge of the most relevant histories, theories and critical discourses related to the field from the scope of Landscape Design.\xa0 We tend to think that theories provide the insight to embitter practice.\xa0 However, there has been practice that provoked and enhanced disciplinary debate and actually generated a \\"paradigm shift\\".\xa0 The course launches a research question: it is only through the examination of influential design works that we can build the multiple dialogues between theory and practice: explore how theory is embedded into disciplinary production and study how pioneer works create specific and innovative disciplinary literature.","locations":[{"bldg":"Kennedy Hall","room":"Kennedy Hall 119","type":"SEM","typeLong":"Seminar","time":"02:30PM","days":"T"},{"bldg":"Kennedy Hall","room":"Kennedy Hall 119","type":"SEM","typeLong":"Seminar","time":"12:20PM","days":"M"}]},{"code":"LATIN 7222","title":"Latin Paleography","name":"LATIN 7222: Latin Paleography","desc":"This course is an introduction to and survey of Latin scripts from Roman antiquity through the early Renaissance, with an emphasis on the identification, localization, and reading of scripts. Class meetings will combine practical study of Latin scripts through medieval manuscripts in the Kroch library, facsimiles, and online digital reproductions with instruction in the cultural-historical background to manuscript production, library practices, and bibliographical resources. Students will also be introduced to basic techniques for codicological description and the principles of textual criticism.","locations":[{"bldg":"Kroch,Carl A Library","room":"Kroch, Carl A Library 2B49","type":"SEM","typeLong":"Seminar","time":"01:25PM","days":"W"}]},{"code":"LATIN 7262","title":"Latin Philosophical Texts","name":"LATIN 7262: Latin Philosophical Texts","desc":"Reading and translation of Latin philosophical texts.","locations":[{"bldg":"Hans Bethe House","room":"Hans Bethe House 125","type":"SEM","typeLong":"Seminar","time":"07:30PM","days":"T"}]},{"code":"LAW 4081","title":"International Human Rights Law and Advocacy","name":"LAW 4081: International Human Rights Law and Advocacy","desc":"This course will introduce students to the law and practice of international human rights. Students will think critically about the effectiveness of the international human rights system by examining its successes, failures, and dilemmas in preventing and responding to human rights abuse. Topics covered include the origins of international human rights; the role of international, regional, and domestic institutions and actors in enforcing human rights; critiques of the human rights movement; challenges encountered in human rights advocacy; and the relationship of the United States to the international system for the protection of human rights. The course will also explore issues such as the immigration, the death penalty, gender justice, climate change, global poverty, racism and xenophobia, and responses to mass atrocities. Throughout this interactive course, students will have frequent opportunities to step into the shoes of a human rights advocate and work individually and with their classmates to address simulated human rights problems.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 184","type":"LEC","typeLong":"Lecture","time":"01:00PM","days":"MW"}]},{"code":"LAW 4131","title":"The Nature, Functions, and Limits of Law","name":"LAW 4131: The Nature, Functions, and Limits of Law","desc":"A general-education course to acquaint students with how our legal system pursues the goals of society. The course introduces students to various perspectives on the nature of law, what functions it ought to serve in society, and what it can and cannot accomplish. The course proceeds in the belief that such matters constitute a valuable and necessary part of a general education, not only for pre-law students but especially for students in other fields. Assigned readings comprise legal materials and also secondary sources on the legal process and the role of law in society. The classes include discussion and debate about current legal and social issues, including equality, safety, the environment, punishment, and autonomy.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 184","type":"LEC","typeLong":"Lecture","time":"02:55PM","days":"MW"}]},{"code":"LAW 5001","title":"Civil Procedure","name":"LAW 5001: Civil Procedure","desc":"An introduction to civil litigation, from commencement of an action through disposition on appeal, studied in the context of the federal procedural system. Also, a detailed consideration of federalism and ascertainment of applicable law; jurisdiction, process, and venue; and former adjudication.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 290","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"MTW"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 290","type":"LEC","typeLong":"Lecture","time":"09:05AM","days":"MTW"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 182","type":"LEC","typeLong":"Lecture","time":"09:05AM","days":"TWR"}]},{"code":"LAW 5061","title":"Criminal Law","name":"LAW 5061: Criminal Law","desc":"An introductory study of the criminal law, including theories of punishment, analysis of the elements of criminal liability and available defenses, and consideration of specific crimes as defined by statute and the common law.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 184","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"WRF"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G90","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"MTW"}]},{"code":"LAW 5081","title":"Lawyering","name":"LAW 5081: Lawyering","desc":"Lawyering is a full-year course designed to introduce first-year students to lawyering skills, with primary emphasis on legal writing, analysis, research, and oral presentations. Assignments are usually set in the context of a simulated law office (or judge\'s chambers). In the fall semester, students write predictive memoranda that point out the strengths and weaknesses of their client\'s case. To prepare the memoranda, students may need to determine the facts of the case by conducting interviews or depositions. Acting as junior attorneys, students will also make an oral presentation to a supervising attorney. The spring semester focuses on persuasive advocacy. Students prepare a memorandum, motion, or brief for submission to a court and, later, orally argue for their positions in a simulated court session. Throughout the year, students also learn the fundamentals of legal research. Instruction occurs not only in full-class sessions but also in individual conferences. Students receive extensive feedback on each major assignment.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G90","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"RF"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 182","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"MT"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 184","type":"LEC","typeLong":"Lecture","time":"09:05AM","days":"RF"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 182","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"RF"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 182","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"MT"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 285","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"MT"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 186","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"M"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 186","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"F"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 277","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"T"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 277","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"F"}]},{"code":"LAW 5121","title":"Property","name":"LAW 5121: Property","desc":"This is a course in basic property law. It covers acquisitions of rights in property, estates in land, concurrent ownership, landlord/tenant relations, and regulation of land use.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G90","type":"LEC","typeLong":"Lecture","time":"09:05AM","days":"TWRF"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 186","type":"LEC","typeLong":"Lecture","time":"01:05PM","days":"WR"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 186","type":"LEC","typeLong":"Lecture","time":"08:45AM","days":"F"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G90","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"TWRF"}]},{"code":"LAW 6001","title":"Accounting for Lawyers","name":"LAW 6001: Accounting for Lawyers","desc":"This course is designed to introduce students to the basic concepts and fundamentals of financial accounting. It will focus on (1) accrual accounting concepts, principles and conventions, (2) the presentation of financial statements (balance sheets, income statements, statements of cash flow), (3) the interpretation and analysis of financial statements, and (4) the use and misuse of accounting information. The goal of the course is to enable students to critically review a company\'s financial statements. The course is intended for students with no prior background in accounting and is limited to students who have had no college accounting courses (or equivalent). Students with one or two college level accounting courses or other modest accounting background may take this course for a JD letter grade only with permission of the instructor.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 182","type":"LEC","typeLong":"Lecture","time":"01:05PM","days":"W"}]},{"code":"LAW 6011","title":"Administrative Law","name":"LAW 6011: Administrative Law","desc":"An introduction to the constitutional and other legal issues posed by the modern administrative state. Topics include: procedural due process, separation of powers, procedural modes of administrative policymaking; judicial review of agency action; and the oversight and control relationships between agencies and Congress or the President. The course provides a working familiarity with the fundamentals of administrative procedure, as well as a larger inquiry into the role of agencies in our constitutional system - and the effect of legal doctrine on shaping that role.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 182","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MTW"}]},{"code":"LAW 6025","title":"Private Funds","name":"LAW 6025: Private Funds","desc":"Private equity funds, hedge funds and other alternative investments are a significant segment of investment activity worldwide. They are often the subjects of rigorous debate as to the potential benefits and costs they deliver to the global economy and the appropriate levels of regulations and controls. This course introduces private equity and hedge funds, their respective historical background, structure and business and regulatory considerations. Students will learn the basic framework applicable to the structuring and ongoing matters relating to funds and fund managers. Through reading materials, interactive class discussions and guest lectures students will explore the perspectives of fund managers, investors, regulators and other industry participants.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 390","type":"LEC","typeLong":"Lecture","time":"02:55PM","days":"R"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 390","type":"LEC","typeLong":"Lecture","time":"09:05AM","days":"F"}]},{"code":"LAW 6067","title":"Compliance Systems","name":"LAW 6067: Compliance Systems","desc":"This course is designed to introduce students to the basic concepts and fundamentals of the compliance function within a company or organization. It will focus on (1) the drivers behind the development of rules (2) practical issues involved in rule creation (3) the process of training, or \\"selling,\\" rule systems to the appropriate people (4) policing compliance, including investigations and enforcement of rules, and (5) the consequences of failing to operate a compliance program or doing it wrong. The course relies upon case studies from businesses and organizations, with an emphasis on real life situations and problem solving techniques. A primary argument of the course is that appropriate and efficient internal compliance will support the central mission of the business and control costs.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G85","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MWF"}]},{"code":"LAW 6081","title":"Animal Law","name":"LAW 6081: Animal Law","desc":"This course will examine a cutting-edge and constantly evolving field of law, exploring the statutory and case law in which the legal, social, or biological nature of nonhuman animals is an important factor. The course encompasses companion animals, wildlife, and animals raised for food, entertainment, and research, and will survey traditional law topics like torts, contracts, criminal law, constitutional law and federal laws as they intersect with animals. It will also explore the normative and legal ramifications of new food technologies including plant-based and cell-based meat. Grade will be based on participation in open-minded discussions, submission of short (1\u20132 page) weekly reflection papers that account for 15% of the final grade, and a take-home examination.\\n\xa0","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 387","type":"SEM","typeLong":"Seminar","time":"10:10AM","days":"R"}]},{"code":"LAW 6085","title":"Law Practice Technology","name":"LAW 6085: Law Practice Technology","desc":"Rapidly evolving technologies are undoubtedly transforming the traditional law practice. The purpose of this course is to explore and investigate the use and impact of current technologies in the practice of law. The focus will be on large practice groups with discussions on smaller to mid-sized law firms. \xa0Tools for client management, electronic discovery, competitive intelligence, document and knowledge management will be analyzed. Ethical issues relating to proper use of technology and data management will be discussed. Electronic communications, social networking tools and emerging technologies including artificial intelligence, wearable technologies and autonomous vehicles, will also be explored.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G85","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"T"}]},{"code":"LAW 6131","title":"Business Organizations","name":"LAW 6131: Business Organizations","desc":"An introduction to the legal rules, principles, and economic factors that influence the governance of business enterprises in the United States. While the principal focus of the course will be the governance of large, publicly-traded corporations, we will also devote some attention to agency relationships, partnerships, and closely-held corporations. Legal topics will include business formation and capitalization, fiduciary obligations, shareholder voting, derivative suits, corporate control transactions, and the purpose of the firm.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 290","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MTWR"}]},{"code":"LAW 6135","title":"Bioethics Mediation and Resolution of Ethical Dilemmas in Health Care","name":"LAW 6135: Bioethics Mediation and Resolution of Ethical Dilemmas in Health Care","desc":"The course will introduce students to the key ethical and legal principles that underlay this unique and important form of mediation. It will also provide a foundational understanding of bioethics and its interplay with law and medicine in clinical medicine. Topics to be discussed will include informed consent, health-care decision making, advance directives (health care proxies and living wills), surrogate decision-making for incapacitated adults and children, and end-of-life treatment issues, including medical futility.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 186","type":"SEM","typeLong":"Seminar","time":"01:25PM","days":"F"}]},{"code":"LAW 6138","title":"Blockchain, DeFi and Evolving Regulatory Issues","name":"LAW 6138: Blockchain, DeFi and Evolving Regulatory Issues","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 182","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"F"}]},{"code":"LAW 6158","title":"Client Counseling","name":"LAW 6158: Client Counseling","desc":"Clients come to lawyers seeking problem-solving advice. This course follows a \\"client-centered\\" approach to counseling that will examine techniques lawyers can use to help clients make good decisions. Class sessions will incorporate role plays that cover different stages of the counseling process, including clarifying clients\' objectives and identifying alternatives and consequences, in litigation and transactional contexts.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 277","type":"LEC","typeLong":"Lecture","time":"04:15PM","days":"MW"}]},{"code":"LAW 6192","title":"Conflict of Laws Seminar","name":"LAW 6192: Conflict of Laws Seminar","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 279","type":"SEM","typeLong":"Seminar","time":"04:30PM","days":"T"}]},{"code":"LAW 6264","title":"Criminal Procedures: Investigations","name":"LAW 6264: Criminal Procedures: Investigations","desc":"Criminal Procedure: Investigations examines the constitutional law that governs police attempts to solve crime and bring perpetrators to justice. The course considers the role of the Fourth Amendment prohibition against unreasonable searches and seizures as well as the Fifth Amendment ban on compelled self-incrimination, in guiding police behavior and in structuring the trials that follow constitutional violations. Students will evaluate the wisdom and constitutional validity of the Fourth Amendment exclusionary rule, which prohibits the introduction of evidence obtained as a result of an unreasonable search, and the well-known Miranda v. Arizona decision as it has evolved over time.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 390","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"MW"}]},{"code":"LAW 6331","title":"Employment Law","name":"LAW 6331: Employment Law","desc":"Survey of major statutory schemes and common law doctrines that regulate the employer-employee relationship, other than laws regulating union formation and collective bargaining, which are covered in Labor Law. Topics covered include the common law of unjust dismissal, trade secrets, restrictive covenants, drug testing, free speech, and privacy. Major statutory schemes covered include Title VII and other antidiscrimination laws, the Fair Labor Standards Act, the Family and Medical Leave Act, and ERISA.\xa0\\n\xa0","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 285","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"TWR"}]},{"code":"LAW 6401","title":"Evidence","name":"LAW 6401: Evidence","desc":"The rules of evidence in civil and criminal cases with emphasis on relevance, hearsay, authentication, witnesses, experts, and confrontation. The course focuses on the Federal Rules of Evidence, with some attention to how they diverge from the common law.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 290","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"MTWR"}]},{"code":"LAW 6431","title":"Federal Courts","name":"LAW 6431: Federal Courts","desc":"This course examines the various constitutional, statutory, and judge-made doctrines that control access to the federal courts to vindicate federal rights. It is particularly valuable for those planning a career in public interest or the public sector, anyone else expecting to litigate extensively in federal court, and students who have or hope to obtain a judicial clerkship. Topics covered include: case or controversy limitations, including standing; constitutional and statutory limits on jurisdiction; causes of action for constitutional and statutory rights, including 42 U.S.C. \xa71983 and Bivens actions; bars to such actions, including sovereign immunity and abstention doctrines; and habeas corpus.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 285","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"MTWR"}]},{"code":"LAW 6436","title":"Practicing Criminal Defense in Federal Court","name":"LAW 6436: Practicing Criminal Defense in Federal Court","desc":"Whether you were a student in the Fall session looking to continue on our journey, or you are with us for the first time, this course takes you into the courtroom and the conference room to provide you with a real-world experience in defending a federal criminal case. Working off of real cases with an emphasis on role-playing - both as defense counsel and government prosecutors -we will get you ready to successfully prepare for and navigate the busy streets of a federal criminal case. From the very beginning \u2013 whether your client has been taken into custody or has been visited by government agents \u2013 right through to the sentencing hearing, we will cover what \\"really happens.\\"","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 285","type":"LEC","typeLong":"Lecture","time":"09:00AM","days":"F"}]},{"code":"LAW 6441","title":"Federal Income Taxation","name":"LAW 6441: Federal Income Taxation","desc":"A basic course designed to develop understanding of tax concepts and ability to work effectively with the Internal Revenue Code, regulations, cases, and other tax materials.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 186","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"TWR"}]},{"code":"LAW 6465","title":"Global M and A Practice","name":"LAW 6465: Global M and A Practice","desc":"It will provide a guidance on M&amp;A practices in various jurisdictions, including the US, Europe, Japan and other emerging countries.\xa0 The course will address global M&amp;A trends, various transaction structures, terms of acquisition agreements and a comparison of different M&amp;A practices (e.g., US-style and UK-style), as well as other legal issues such as merger filings and anti-corruption.\xa0 The course will also introduce various aspects of Japanese corporates, including corporate governance, business cultures and commercial trends.\xa0","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G90","type":"LEC","typeLong":"Lecture","time":"04:30PM","days":"MTWRF"}]},{"code":"LAW 6471","title":"Health Law","name":"LAW 6471: Health Law","desc":"This course will consider legal aspects of the organization, financing, and distribution of health care in the United States. It will emphasize issues of access, costs, and quality, and address the use of regulation, litigation and market-driven strategies to confront emerging problems. Readings will be from a health law casebook, supplemented by occasional handouts of current materials. The goal is to convey an appreciation of the challenges involved in providing health care to those in need and of the role of law and lawyers in meeting these challenges.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G85","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"MT"}]},{"code":"LAW 6511","title":"Intellectual Property","name":"LAW 6511: Intellectual Property","desc":"A survey of legal mechanisms for protecting intellectual property including patent, trademark, copyright, trade secret and related state law doctrines.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 277","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MTW"}]},{"code":"LAW 6569","title":"Introduction to Depositions","name":"LAW 6569: Introduction to Depositions","desc":"Depositions are a critical component of pretrial discovery. Indeed, many cases are lost, won, or settled because of information gleaned at a deposition. Attorneys also often modify trial strategies because of a witness\'s performance at a deposition. Because depositions play such an important role in litigation, the majority of junior litigation attorneys can expect to deal with depositions in some manner from the very start of their careers. This introductory course will expose students to several facets of a deposition: preparing for deposition, asking questions at a deposition, defending the witness at a deposition, using documents at a deposition, and reviewing the transcript of a deposition. Students can expect to take and defend mock depositions and to observe and critique their fellow students\' deposition skills. The course will culminate in a three-hour deposition in which students will team up to depose and defend two witnesses. Students must set aside one Saturday morning at the end of the semester for this deposition.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 182","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"TR"}]},{"code":"LAW 6592","title":"Labor Law, Practice and Policy","name":"LAW 6592: Labor Law, Practice and Policy","desc":"This course will focus on the federal laws regulating the organization of private-sector workers and unions and the process of collective bargaining in addition to addressing protected concerted activity unrelated to union organizing.\xa0 Issues of race, economic justice and immigrant workers will also be addressed. Practice in the field of labor and employment law will be highlighted along with important and timely public policy issues.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 184","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"TR"}]},{"code":"LAW 6616","title":"Law and Development","name":"LAW 6616: Law and Development","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 186","type":"LEC","typeLong":"Lecture","time":"04:45PM","days":"MTWR"}]},{"code":"LAW 6641","title":"Professional Responsibility","name":"LAW 6641: Professional Responsibility","desc":"This course is intended to provide a comprehensive overview of the law governing lawyers in a variety of practice settings, including transactional, counseling, and civil and criminal litigation. The course is not focused merely on the ABA\'s Model Rules, but draws extensively from judicial decisions in malpractice and disqualification cases, the new Restatement of the Law Governing Lawyers, and other sources of law. A major theme is the relationship between state bar disciplinary rules and the generally applicable law of tort, contracts, agency, procedure, and crimes. Another significant theme is the prevention of attorney discipline and malpractice liability through advance planning.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G90","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"MTW"}]},{"code":"LAW 6661","title":"Constitutional Law of the European Union","name":"LAW 6661: Constitutional Law of the European Union","desc":"This course introduces students to the law and institutions of the European Union. It examines the composition, organization, functions and powers of the Union\'s governing bodies; analyzes the Union\'s governing treaties and constitutional law; and studies the Union\'s decision-making processes. The course also explores broader questions of political, economic and legal integration, such as the proper relation between the Union\'s law and the domestic law of the Union\'s Member states, and the desirability and feasibility of using the E.U. as a model on which to pattern other transnational agreements.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 277","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"TR"}]},{"code":"LAW 6681","title":"International Law and Foreign Direct Investment","name":"LAW 6681: International Law and Foreign Direct Investment","desc":"This course studies legal aspects of direct foreign investments. It seeks to identify legal problems that are likely to affect a commercial investment in a foreign country. Inter alia, it deals with the public international law principles and rules governing the establishment by foreign businesses of various factors of production (persons and capital) on the territory of other states and the protection of such investments. Thus, the course includes a discussion of the following topics: economic development and foreign capital; obstacles to the flow of investments to developing countries; guarantees to investors and investment codes; bilateral treaties; nationalization; joint ventures; project financing; transfer of technology; arbitration; investment insurance; unification of trade law; and the settlement of investment disputes.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 285","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"MTW"}]},{"code":"LAW 6734","title":"Music Law","name":"LAW 6734: Music Law","desc":"Music Law will be practical look at representing performers, bands, song writers, and others in the music industry. We will look at both the law and the industry, exploring the agreements that transfer rights between the various players and case law affecting those rights, as well as examining the industry itself and who those players are. Taught by Howard Leib, who has over thirty years experience in the music industry, having worked with artists such as Whitney Houston, B.B. King, Kiss, BeBe &amp; CeCe Winans, Bobby McFerrin, and more.. Corporate clients have included MCA, BMG, Atlantic Records, Arista Records, Rhino Entertainment, Shout Factory Entertainment and 20th Century Fox. Students will also benefit from the insight of guest speakers from various areas of the industry. Topics are expected to include recording agreements, band agreements, touring, merchandising, licensing, songwriting, music publishing, management and others.\\n\xa0","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 276","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"MW"}]},{"code":"LAW 6743","title":"Conflicts in Patent Law and Practice","name":"LAW 6743: Conflicts in Patent Law and Practice","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G81","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"M"}]},{"code":"LAW 6761","title":"Principles of American Legal Writing","name":"LAW 6761: Principles of American Legal Writing","desc":"This course provides foreign-trained lawyers with an introduction to the American legal system and essential principles of legal writing, analysis and legal research skills in the United States. Students are afforded an opportunity to practice some of the forms of writing common to American legal practice by drafting documents such as memoranda and briefs in the context of representing hypothetical clients. Students are given the opportunity to conference individually with the instructor and to re-write assignments after receiving the instructor\'s comments.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G85","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"MW"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 276","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"TR"}]},{"code":"LAW 6768","title":"Public Finance","name":"LAW 6768: Public Finance","desc":"In the U.S., federal government expenditures represent over one-third of the nation\'s GDP annually. Yet few seem to know much about the law-governed processes of federal budgeting, appropriating funds for, or otherwise financing US government operations. Still less do they generally understand the aims or consequences - short term and longer term - of these essential public sector activities economy-wide.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 285","type":"LEC","typeLong":"Lecture","time":"04:30PM","days":"WR"}]},{"code":"LAW 6784","title":"Professional Responsibility for LLMs","name":"LAW 6784: Professional Responsibility for LLMs","desc":"This course explores ethical issues relating to the legal profession. It has two aims\u2014one immediate, the other more lofty. The immediate aim is to help prepare students for the MPRE. The loftier aim, by contrast, is to investigate the ways in which one\'s professional responsibilities might conflict with one\'s personal obligations or self-interest, and to consider the societal implications of the regulatory regime governing lawyers. What should a lawyer do when her professional duties conflict with her financial interests or obligations to friends or family? How does the legal profession\'s monopoly on the right to give legal advice shape the justice system? We will investigate such questions by reading relevant legal materials as well as work by legal academics. Students will take several smaller exams to test their mastery of central ethical rules governing the conduct of lawyers, and complete short writing assignments on topics discussed in class.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 184","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"TWR"}]},{"code":"LAW 6791","title":"Public International Law","name":"LAW 6791: Public International Law","desc":"An introduction to the legal rules governing the conduct of states vis-\xe0-vis other states, individuals, and international organizations, with reference to major current events and issues. Topics include the nature, sources, and effectiveness of international law; the establishment and recognition of states; principles concerning state sovereignty, territory, and jurisdiction; the law of treaties; state responsibility; international criminal and humanitarian law; terrorism; and human rights. Special attention is given to the law governing the use of force.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 186","type":"LEC","typeLong":"Lecture","time":"08:30AM","days":"MT"}]},{"code":"LAW 6811","title":"Secured Transactions","name":"LAW 6811: Secured Transactions","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 277","type":"LEC","typeLong":"Lecture","time":"09:05AM","days":"WR"}]},{"code":"LAW 6821","title":"Securities Regulation","name":"LAW 6821: Securities Regulation","desc":"This course analyzes key issues under the U.S. federal securities laws, principally the Securities Act of 1933 and the Securities Exchange Act of 1934, with respect to the domestic and international offer and sale of securities. It includes a study of what constitutes a security, the public offering process, mandatory disclosure requirements for public companies, exemptions from registration (including exempt global offerings), and potential liabilities and sanctions.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 290","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"MTWR"}]},{"code":"LAW 6822","title":"Social Science and the Law","name":"LAW 6822: Social Science and the Law","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 186","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"TWR"}]},{"code":"LAW 6925","title":"Mass Torts","name":"LAW 6925: Mass Torts","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 285","type":"LEC","typeLong":"Lecture","time":"04:30PM","days":"MT"}]},{"code":"LAW 6935","title":"Structural Inequality and Social Change: Theory and Practice","name":"LAW 6935: Structural Inequality and Social Change: Theory and Practice","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 279","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"TW"}]},{"code":"LAW 6985","title":"Becoming Thriving Lawyers","name":"LAW 6985: Becoming Thriving Lawyers","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 389","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MTWRF"}]},{"code":"LAW 7011","title":"Antitrust Law Seminar","name":"LAW 7011: Antitrust Law Seminar","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G81","type":"SEM","typeLong":"Seminar","time":"02:30PM","days":"T"}]},{"code":"LAW 7022","title":"Advanced Topics in Property Theory","name":"LAW 7022: Advanced Topics in Property Theory","desc":"This seminar will explore what the idea of property means, and its usefulness in resolving issues of intense social conflict.\xa0 Seminar sessions will encourage student participation, with the instructor guiding that discussion.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 279","type":"SEM","typeLong":"Seminar","time":"04:30PM","days":"R"}]},{"code":"LAW 7030","title":"Biblical Law and Its Modern Interpreters","name":"LAW 7030: Biblical Law and Its Modern Interpreters","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 276","type":"SEM","typeLong":"Seminar","time":"02:30PM","days":"T"}]},{"code":"LAW 7034","title":"First Amendment Law Clinic III","name":"LAW 7034: First Amendment Law Clinic III","desc":"A continuation of the First Amendment Clinic for advanced students, with emphasis on leadership roles and advanced litigation skills.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 276","type":"CLN","typeLong":"Clinical","time":"10:10AM","days":"M"}]},{"code":"LAW 7035","title":"First Amendment Law Clinic IV","name":"LAW 7035: First Amendment Law Clinic IV","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 276","type":"CLN","typeLong":"Clinical","time":"10:10AM","days":"M"}]},{"code":"LAW 7077","title":"Critical Evaluation of Legal Information","name":"LAW 7077: Critical Evaluation of Legal Information","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 387","type":"SEM","typeLong":"Seminar","time":"02:30PM","days":"T"}]},{"code":"LAW 7130","title":"The Constitution in Times of War and Conflict","name":"LAW 7130: The Constitution in Times of War and Conflict","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 277","type":"SEM","typeLong":"Seminar","time":"04:30PM","days":"R"}]},{"code":"LAW 7140","title":"Complex Litigation","name":"LAW 7140: Complex Litigation","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G81","type":"SEM","typeLong":"Seminar","time":"04:30PM","days":"W"}]},{"code":"LAW 7157","title":"Comparative Middle Eastern Law: Contemporary Issues","name":"LAW 7157: Comparative Middle Eastern Law: Contemporary Issues","desc":"This course addresses students to key issues in Middle East legal systems and politics today. It introduces the current Middle East by drawing upon cutting-edge scholarships written from a diversity of disciplinary views. These include history, law, political science, as well as studies of religion, gender, mass media, sexuality, human rights, and urban life. It will emphasize the main tendencies and movements in modern Arabian World history. It will analyze both groundwork (basics) in Middle Eastern research and a common sense of modern directions and tracks in the field. It examines the people, traditions, society and politics of the area and the role that religion, gender, culture have played in designing and influencing contemporary issues. It discusses the fundamental internal and external performers in the region; peace and conflict (Israel/Palestine); the geo-strategic significance of the region; political economy matters; political transformation and development; the problem of identities in the Middle East and legal philosophies around this; family law issues (inheritance); the politics of religion (appearance of political Islam); Arab constitutionalism, September 11 and the fall-out in the region from the US-led \\"war on terrorism,\\" the \\"Arab Spring,\\" and the unfolding uprisings in the Arab World. \xa0Also, this course will introduce the field of Islamic law.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 389","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"TW"},{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 389","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"R"}]},{"code":"LAW 7178","title":"Moral Foundations of Anti-Discrimination","name":"LAW 7178: Moral Foundations of Anti-Discrimination","desc":"What makes discrimination wrongful, when it is? Does its wrongness depend on social context and historical background? Does it depend on harmful consequences? What makes a certain ground of discrimination an improper ground? Is indirect discrimination (\\"disparate impact\\") really a form of discrimination or perhaps a mild form of affirmative action? What should be the reach and scope of anti-discrimination law? Should it allow for exemptions on religious or free speech grounds? We will address these and similar questions at a fairly abstract level, trying to understand the philosophical principles that might explain the various aspects of anti-discrimination law. Most of the legal examples will be focused on discrimination cases in the context of employment and service provision (Title VII), \xa0but we will also consider racial profiling, disability cases, and some others.\xa0","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G81","type":"SEM","typeLong":"Seminar","time":"02:30PM","days":"W"}]},{"code":"LAW 7189","title":"Current Issues in Collective Bargaining","name":"LAW 7189: Current Issues in Collective Bargaining","desc":"This advanced level mini-course examines several key issues in today\'s collective bargaining between US private sector employers and unions. Through extensive pre-class readings and podcasts, and during four 3 hour classes, we will trace key developments that have set the table for today\'s bargaining environment, eg., the deindustrialization of the American economy, the decline of union workforce density, and the rise of defensive collective bargaining; examine resultant wage stagnation and troubled health care and defined benefit pension plans; investigate the effects and intersection of employment law and legislation on collective bargaining and dispute resolution; and consider the emerging arena of unionization in higher education.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 182","type":"LEC","typeLong":"Lecture","time":"06:00PM","days":"MTWR"}]},{"code":"LAW 7194","title":"Empirical Studies of the Legal System","name":"LAW 7194: Empirical Studies of the Legal System","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 276","type":"SEM","typeLong":"Seminar","time":"11:15AM","days":"T"}]},{"code":"LAW 7273","title":"Form and Substance in Corporate Law and Capital Markets Regulation","name":"LAW 7273: Form and Substance in Corporate Law and Capital Markets Regulation","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 279","type":"SEM","typeLong":"Seminar","time":"04:30PM","days":"M"}]},{"code":"LAW 7282","title":"Gender and International Human Rights","name":"LAW 7282: Gender and International Human Rights","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 276","type":"SEM","typeLong":"Seminar","time":"04:30PM","days":"W"}]},{"code":"LAW 7286","title":"Gender and Sexual Minorities and the Law","name":"LAW 7286: Gender and Sexual Minorities and the Law","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 387","type":"SEM","typeLong":"Seminar","time":"04:30PM","days":"T"}]},{"code":"LAW 7295","title":"Global Labor and Employment Law","name":"LAW 7295: Global Labor and Employment Law","desc":"The legal framework governing the employment relationship in most of the world is dramatically different from that of the US, reflecting differences between the civil law and common law systems as well as contrasting historical and cultural contexts. In this seminar, we will review the most important concepts of labor and employment law outside the US, including formation and termination of the employment relationship (\\"just cause\\" protections vs. US \\"employment at will\\"); the concept of \\"information and consultation\\" of works councils and other employee representative bodies; global discrimination and diversity matters; international labor standards; special employee protections which impact multinational corporate restructurings and transactions; non-competes and other restrictive covenants; and litigation of employment claims in systems which do not have US discovery and trial processes.\xa0","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 276","type":"SEM","typeLong":"Seminar","time":"04:30PM","days":"M"}]},{"code":"LAW 7321","title":"International Criminal Law","name":"LAW 7321: International Criminal Law","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 389","type":"SEM","typeLong":"Seminar","time":"04:30PM","days":"M"}]},{"code":"LAW 7358","title":"International Environmental Law","name":"LAW 7358: International Environmental Law","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 390","type":"LEC","typeLong":"Lecture","time":"01:25PM","days":"TR"}]},{"code":"LAW 7572","title":"Litigation Drafting","name":"LAW 7572: Litigation Drafting","desc":"This course focuses on drafting documents typically encountered during the pretrial phase of civil litigation. As drafters, lawyers must think strategically about, and understand the conventions unique to, each document. Students will have repeated opportunities to develop essential drafting and professional skills through a combination of in-class exercises and take-home writing assignments related to pleadings, motions, discovery requests, affidavits, demand letters, and settlement agreements.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 276","type":"SEM","typeLong":"Seminar","time":"02:30PM","days":"R"}]},{"code":"LAW 7590","title":"Mortgage and Asset Securitization","name":"LAW 7590: Mortgage and Asset Securitization","desc":"This course analyzes the structure of mortgage- and other asset-backed securities, as well as the participants in their creation, distribution, trading and regulation. The financial and legal characteristics of the underlying assets will be considered, including a basic understanding of the asset cash flows, and factors that vary those flows. Securities and Tax Law aspects of the creation, marketing and trading of these securities will be reviewed, with particular emphasis on the REMIC structure. There will be review of the secondary markets, including Government-sponsored Enterprises and \\"Private Label\\" securities issuers; the credit rating agencies; and private mortgage insurers. Lastly, there will be consideration of the laws currently governing the GSEs and what future changes they and the broader market might anticipate for those laws.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 279","type":"SEM","typeLong":"Seminar","time":"10:10AM","days":"M"}]},{"code":"LAW 7652","title":"Education Law Practicum","name":"LAW 7652: Education Law Practicum","desc":"This course has two components\u2014a seminar component and casework. The Education Law Practicum offers students the opportunity to engage in experiential learning while providing legal services to individual organizations that provide educational programming. Students will learn fundamental practical skills necessary to represent clients in the educational and non-profit sector.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 387","type":"CLN","typeLong":"Clinical","time":"04:30PM","days":"R"}]},{"code":"LAW 7748","title":"Selected Topics on Business Bankruptcy","name":"LAW 7748: Selected Topics on Business Bankruptcy","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 279","type":"SEM","typeLong":"Seminar","time":"02:30PM","days":"M"}]},{"code":"LAW 7760","title":"Movement Lawyering Clinic I","name":"LAW 7760: Movement Lawyering Clinic I","desc":"This course gives students the opportunity to engage in the movement lawyering. The course hasboth a classroom component and a community component. This course gives students the opportunity to engage in the movement lawyering. The course has both a classroom component and a community component.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 387","type":"CLN","typeLong":"Clinical","time":"01:05PM","days":"M"}]},{"code":"LAW 7762","title":"Movement Lawyering Clinic II","name":"LAW 7762: Movement Lawyering Clinic II","desc":"This course gives students the opportunity to engage in the movement lawyering. The course has both a classroom component and a community component. Clinic participants will gain first hand experience, knowledge, and skills in how to work with organizers to use the law to support and defend justice movements. Students will work with lawyers, community organizations, and activists to understand strategies and tactics of movement legal work. They will follow the lead of movement participants and community members to build power and assist in creating lasting change.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G80","type":"CLN","typeLong":"Clinical","time":"04:15PM","days":"M"}]},{"code":"LAW 7763","title":"Movement Lawyering Clinic III","name":"LAW 7763: Movement Lawyering Clinic III","desc":"This course gives students the opportunity to engage in the movement lawyering. The course has both a classroom component and a community component. Clinic participants will gain first hand experience, knowledge, and skills in how to work with organizers to use the law to support and defend justice movements. Students will work with lawyers, community organizations, and activists to understand strategies and tactics of movement legal work. They will follow the lead of movement participants and community members to build power and assist in creating lasting change.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G80","type":"CLN","typeLong":"Clinical","time":"04:15PM","days":"M"}]},{"code":"LAW 7767","title":"Movement Lawyering Clinic IV","name":"LAW 7767: Movement Lawyering Clinic IV","desc":"This course gives students the opportunity to engage in the movement lawyering. The course has both a classroom component and a community component. Clinic participants will gain first hand experience, knowledge, and skills in how to work with organizers to use the law to support and defend justice movements. Students will work with lawyers, community organizations, and activists to understand strategies and tactics of movement legal work. They will follow the lead of movement participants and community members to build power and assist in creating lasting change.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G80","type":"CLN","typeLong":"Clinical","time":"04:15PM","days":"M"}]},{"code":"LAW 7777","title":"Why and How Do We Punish?","name":"LAW 7777: Why and How Do We Punish?","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G80","type":"SEM","typeLong":"Seminar","time":"04:30PM","days":"R"}]},{"code":"LAW 7783","title":"Topics in Intellectual Property","name":"LAW 7783: Topics in Intellectual Property","desc":"Sizable disagreement and controversy surround many areas of intellectual property. This seminar explores these disputes. By surveying the academic literature the seminar aims to introduce, understand, and ultimately critique the arguments being made for and against various aspects of intellectual property.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 389","type":"SEM","typeLong":"Seminar","time":"02:30PM","days":"M"}]},{"code":"LAW 7801","title":"Asylum and Convention Against Torture Appellate Clinic","name":"LAW 7801: Asylum and Convention Against Torture Appellate Clinic","desc":"Students will learn asylum, Convention Against Torture, and immigration law in class lectures, readings, and while representing clients. Most students will represent clients on appeal before the Board of Immigration Appeals, although the Clinic does accept federal petitions for review and cases before asylum officers from time to time. Students will also learn advanced legal writing techniques, including appellate strategies, persuasive storytelling, the use of expert reports, and effective argument within complex legal frameworks. Students will work in teams to complete all tasks necessary to zealously represent their client, including drafting an appellate brief, affidavits, and motions; maintaining client contact; and locating expert and other witnesses. In addition, students will develop litigation skills such as advanced legal research, case theory development, factual development and analysis (including interviewing, transcript review, and international human rights research), collaboration, cultural competency, and self-evaluation. Students will learn to overcome the unique challenges attorneys face when representing clients from diverse economic and cultural backgrounds, as well as clients who are incarcerated. The instructors will consider the following factors (in no particular order) when admitting students: commitment to public interest or immigration law work, legal writing and research ability, and collegiality. For more information about the Clinic, visit the clinic website: http://www.lawschool.cornell.edu/academics/clinicalprogram/Asylum-Clinic/index.cfm","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 387","type":"CLN","typeLong":"Clinical","time":"04:30PM","days":"W"}]},{"code":"LAW 7811","title":"Capital Punishment Clinic I","name":"LAW 7811: Capital Punishment Clinic I","desc":"Death penalty litigation: investigation and the preparation of petitions and briefs. Case selection and student assignments depend on both pedagogical factors and litigation needs of clinic clients. Students read the trial and lower court record and research legal issues. Some students are involved in investigation, while others primarily assist in the preparation of briefs, petitions and other case documents. No student will be required to participate in investigation. All students are included in discussions regarding the necessary investigation, research, and strategy for the cases.\xa0","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 279","type":"CLN","typeLong":"Clinical","time":"02:30PM","days":"W"}]},{"code":"LAW 7814","title":"Advanced Transnational Disputes Clinic","name":"LAW 7814: Advanced Transnational Disputes Clinic","desc":"In this course, students\xa0learn to use strategic litigation to influence the progressive development of the law. Clinic clients and partners include those appearing before international investor-state arbitral tribunals, national courts,such as U.S. federal courts, and other fora. Students learn key skills through acting as counsel for parties as well as for amici curiae in disputes that implicate the protection of fundamental rights. The course\xa0includes a seminar component as well as extensive, supervised work as part of a case team.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 387","type":"CLN","typeLong":"Clinical","time":"01:25PM","days":"WF"}]},{"code":"LAW 7817","title":"Child Advocacy Practicum","name":"LAW 7817: Child Advocacy Practicum","desc":"Each student in the Child Advocacy Clinic is assigned to a local attorney who has been appointed to represent children (and in some cases, parents) in Family Court in Tompkins County or surrounding areas. The attorneys and students work together on all aspects of representation, including home visits, pre-trial conferences, negotiation sessions, client and parent interviews, litigation documents, and hearings. The student may also help the attorney with appellate work. A classroom component of the Clinic allows students to learn the substantive law of Family Court and to share their insights and experiences with one another.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 389","type":"CLN","typeLong":"Clinical","time":"05:15PM","days":"W"}]},{"code":"LAW 7840","title":"Estate Planning Practicum","name":"LAW 7840: Estate Planning Practicum","desc":"The newest addition to Cornell Law School\'s Clinical Programs, the Estate Planning Clinic aims to provide students with the unique opportunity of enriching and furthering their legal awareness and experience beyond the classroom environment.Participants will gain valuable, practical experience by assisting people from the local community with some of their more basic estate planning needs, thereby applying their theoretical knowledge to real-world scenarios. The students\' best skills will be put to practice while they work towards creating an atmosphere of trust and comfort for their clients and learning the essentials of establishing solid attorney-client relationships. Specifically, students will be working in pairs under supervision of faculty to prepare an actual estate plan for the client which includes a last will and testament, a living will, a health care proxy and a power of attorney along with the statutory major gifts rider (if applicable). Students will take part in the entire estate planning process from the initial informational intake meeting, to the preparation of the client\'s estate planning documents, to discussing the drafts with the clients along with addressing their comments and changes and to preparing and assisting with the execution of the client\'s estate planning documents. To further enhance the learning experience, lectures will be provided on the fundamentals of estate planning from establishing a healthy attorney-client relationship, drafting considerations for the client\'s last will and testament, basic related estate and income tax issues, ethical issues and the administration of the client\'s estate upon death. The classroom component of the course ensures that students understand not only the legal issues but also the practical and human issues involved in a trusts and estates practice.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G81","type":"CLN","typeLong":"Clinical","time":"01:05PM","days":"M"}]},{"code":"LAW 7841","title":"1L Immigration Law and Advocacy Clinic","name":"LAW 7841: 1L Immigration Law and Advocacy Clinic","desc":"This course provides students the unique opportunity to engage in direct services with clients in their first year of law school.\xa0Students will learn substantive immigration law and develop practical skills including client interviewing, persuasive writing, community-based lawyering, and case management by representing clients in immigration applications.\xa0Further, students will engage in community advocacy through presentations on campus and in the community.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 387","type":"CLN","typeLong":"Clinical","time":"04:30PM","days":"M"}]},{"code":"LAW 7854","title":"Tenants Advocacy Practicum I","name":"LAW 7854: Tenants Advocacy Practicum I","desc":"In this course, students will provide information, legal advice, and representation to tenants. The student work in this practicum will directly address the needs of local residents financially impacted by the current pandemic. Students will work on cases for tenants facing a wide variety of housing issues (including but not limited to habitability issues, payment disputes, lease violations, unlawful lockouts, and small claims actions) or seeking eviction defense and homelessness prevention.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 279","type":"CLN","typeLong":"Clinical","time":"01:05PM","days":"T"}]},{"code":"LAW 7857","title":"Farmworker Legal Assistance Clinic I","name":"LAW 7857: Farmworker Legal Assistance Clinic I","desc":"Permission of instructor required. Students who wish to apply to the clinic should submit a resume, transcript, and short statement of interest (no more than two pages) to Prof. Lyon. For more information about the clinic, email Prof. Lyon (beth.lyon@cornell.edu) and schedule a meeting. This course requires off premises travel to meet with clients and participate in hearings. Employment on a farm is one of the worlds\' most difficult and dangerous occupations. Farmworkers experience geographic, linguistic, and cultural isolation, separation from family, immigration insecurity reinforced by policing practices, workplace sexual violence, and exclusion from protective employment laws. Working with the new clinic\'s community partners, Farmworker Legal Assistance Clinic I student attorneys will handle immigration and employment matters on behalf of farmworkers in the region, work that will typically involve negotiation and often require litigation. Students will also work in brief advice and referral outreach sessions in farmworker communities. Clinic participants may also have the opportunity to work on research and writing projects with civil rights, environmental protection, and farmworker rights organizations. Farmworker Clinic students will participate in a lawyering seminar and work with a clinic partner on their assigned cases. The lawyering seminar will focus on skills students need for effective client representation. Students will develop key lawyering skills, including interviewing, counseling, fact investigation, drafting, negotiation, language accessible practice, and, in some cases, trial advocacy.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 387","type":"CLN","typeLong":"Clinical","time":"10:10AM","days":"T"}]},{"code":"LAW 7858","title":"Farmworker Legal Assistance Clinic II","name":"LAW 7858: Farmworker Legal Assistance Clinic II","desc":"Students collaborate with farmworkers, farmworker families, and partner organizations to use the law in service of their clients\' goals. Students who have completed the first semester of any clinical course can seek the instructors\' permission to enroll in Farmworker Clinic II, for 1, 2, 3, 4, 5 or 6 credits, depending on the number of projects undertaken. Students in Farmworker Clinic II work on individual cases for clients and/or non-litigation advocacy projects. They attend roughly four one-hour seminar class \\"case rounds\\" meetings during the semester, usually at the same time that Farmworker Clinic I meets. Other multi-clinic classes and trainings will be made available as well.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 387","type":"CLN","typeLong":"Clinical","time":"11:10AM","days":"T"}]},{"code":"LAW 7859","title":"Farmworker Legal Assistance Clinic III","name":"LAW 7859: Farmworker Legal Assistance Clinic III","desc":"Students collaborate with farmworkers, farmworker families, and partner organizations to use the law in service of their clients\' goals. Students who have completed the first semester of any clinical course can seek the instructors\' permission to enroll in Farmworker Clinic III, for 1, 2, 3, 4, 5 or 6 credits, depending on the number of projects undertaken. Students in Farmworker Clinic II work on individual cases for clients and/or non-litigation advocacy projects. They attend roughly four one-hour seminar class \\"case rounds\\" meetings during the semester, usually at the same time that Farmworker Clinic I meets. Other multi-clinic classes and trainings will be made available as well.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 387","type":"CLN","typeLong":"Clinical","time":"11:10AM","days":"T"}]},{"code":"LAW 7860","title":"International Human Rights: Litigation and Advocacy II","name":"LAW 7860: International Human Rights: Litigation and Advocacy II","desc":"In this clinical course, students will work on projects that will expose them to diverse forms of human rights advocacy. The clinic is litigation-oriented, although clinic students may have the opportunity to engage in fact-finding and research regarding human rights violations abroad. A current sampling of projects includes: (1) Advocacy on behalf of prisoners in Tanzania and Malawi whose legal rights have been violated. \xa0Our work in Malawi has already resulted in the release of 250 prisoners, and a number of clinic students have traveled to both countries in connection with this project; (2) Representation of a Mexican national sentenced to death in the state of Ohio, including litigation of treaty violations in his case; and (3) Advocacy before the United Nations regarding human rights violations committed by Israel in the Occupied Syrian Golan.\xa0","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 389","type":"CLN","typeLong":"Clinical","time":"04:30PM","days":"T"}]},{"code":"LAW 7864","title":"Farmworker Legal Assistance Clinic IV","name":"LAW 7864: Farmworker Legal Assistance Clinic IV","desc":"Students collaborate with farmworkers, farmworker families, and partner organizations to use the law in service of their clients\' goals. Students who have completed the first semester of any clinical course can seek the instructors\' permission to enroll in Farmworker Clinic IV, for 1, 2, 3, 4, 5 or 6 credits, depending on the number of projects undertaken. Students in Farmworker Clinic II work on individual cases for clients and/or non-litigation advocacy projects. They attend roughly four one-hour seminar class \\"case rounds\\" meetings during the semester, usually at the same time that Farmworker Clinic I meets. Other multi-clinic classes and trainings will be made available as well.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 387","type":"CLN","typeLong":"Clinical","time":"11:10AM","days":"T"}]},{"code":"LAW 7867","title":"First Amendment Law Clinic","name":"LAW 7867: First Amendment Law Clinic","desc":"This will be the first semester of the newly-created First Amendment Clinic. Students will engage in litigation and policy analysis supporting the interests of news outlets, journalists, researchers, and other newsgatherers in aid of their critical function of reporting and communicating important news and information, as well as human rights advocates, political activists, and other individuals targeted based on their expression. The Clinic\'s cases involve the intersection of Freedom of Information laws or the First Amendment with several substantive areas of law related to the promotion of social justice: immigration, criminal justice, scientific integrity, democratic institutions and norms, human rights, journalism, and internet speech. Students will have the opportunity to vet potential cases, conduct offensive and defensive legal research, write party and amicus briefs, and, if they continue in the clinic next year, may have the possibility of conducting oral argument. The First Amendment Clinic is committed to teamwork and developing student\'s collaborative skills, and students will have the opportunity to work on these skills in tandem with members of other clinics with which we are co-counseling. In addition, in the clinic seminar, practitioners in the field will speak to the class to provide additional practical insight to students. Finally, students will have the option to visit a newsroom as part of the clinic\'s \\"field trip\\" toward the end of the semester. Students who sign up for the clinic will be required to participate in a \\"bootcamp\\" to take place the weekend after the first week of classes. To apply, please submit a resume, statement of interest, short writing sample, and a transcript.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 276","type":"CLN","typeLong":"Clinical","time":"10:10AM","days":"M"}]},{"code":"LAW 7868","title":"First Amendment Law Clinic 2","name":"LAW 7868: First Amendment Law Clinic 2","desc":"A continuation of the First Amendment Clinic for advanced students, with emphasis on leadership roles and advanced litigation skills.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 276","type":"CLN","typeLong":"Clinical","time":"10:10AM","days":"M"}]},{"code":"LAW 7870","title":"Juvenile Justice Clinic","name":"LAW 7870: Juvenile Justice Clinic","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 279","type":"CLN","typeLong":"Clinical","time":"02:30PM","days":"W"}]},{"code":"LAW 7875","title":"Low-Income Taxpayer Law and Accounting Practicum","name":"LAW 7875: Low-Income Taxpayer Law and Accounting Practicum","desc":"Working with College of Business faculty, the law school has established this new practicum course to bring accounting and law students together in a law school clinic to provide inter-professional services to the community. The course carries two credits, one credit for thirteen hours of seminar meeting time, and one credit for forty hours of casework. Up to two additional credits can be earned with further casework.\xa0","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 290","type":"CLN","typeLong":"Clinical","time":"10:10AM","days":"F"}]},{"code":"LAW 7876","title":"Low-Income Taxpayer Law and Accounting Practicum II","name":"LAW 7876: Low-Income Taxpayer Law and Accounting Practicum II","desc":"Working with College of Business faculty, the law school has established this new practicum course to bring accounting and law students together in a law school clinic to provide inter-professional services to the community. The course carries two credits, one credit for thirteen hours of seminar meeting time, and one credit for forty hours of casework. Up to two additional credits can be earned with further casework. Our client base includes low-income immigrants and other communities in need of our services. Students will work with casework supervisors from private practice.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 290","type":"CLN","typeLong":"Clinical","time":"10:10AM","days":"F"}]},{"code":"LAW 7877","title":"Low-Income Taxpayer Law and Accounting Practicum III","name":"LAW 7877: Low-Income Taxpayer Law and Accounting Practicum III","desc":"Working with College of Business faculty, the law school has established this new practicum course to bring accounting and law students together in a law school clinic to provide inter-professional services to the community. The course carries two credits, one credit for thirteen hours of seminar meeting time, and one credit for forty hours of casework. Up to two additional credits can be earned with further casework. Our client base includes low-income immigrants and other communities in need of our services. Students will work with casework supervisors from private practice.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 290","type":"CLN","typeLong":"Clinical","time":"10:10AM","days":"F"}]},{"code":"LAW 7878","title":"International Human Rights Clinic: Litigation and Advocacy III","name":"LAW 7878: International Human Rights Clinic: Litigation and Advocacy III","desc":"In this clinical course, students will work on projects that will expose them to diverse forms of human rights advocacy. The clinic is litigation-oriented, although clinic students may have the opportunity to engage in fact-finding and research regarding human rights violations abroad.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 389","type":"CLN","typeLong":"Clinical","time":"04:30PM","days":"T"}]},{"code":"LAW 7879","title":"International Human Rights: Litigation and Advocacy IV","name":"LAW 7879: International Human Rights: Litigation and Advocacy IV","desc":"In this clinical course, students will work on projects that will expose them to diverse forms of human rights advocacy. The clinic is litigation-oriented, although clinic students may have the opportunity to engage in fact-finding and research regarding human rights violations abroad.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 389","type":"CLN","typeLong":"Clinical","time":"04:30PM","days":"T"}]},{"code":"LAW 7891","title":"Tenants Advocacy Practicum II","name":"LAW 7891: Tenants Advocacy Practicum II","desc":"In this course, students will continue to provide information, legal advice, and representation to tenants. Students will work on cases for tenants facing a wide variety of housing issues (including but not limited to habitability issues, payment disputes, lease violations, unlawful lockouts, and small claims actions) or seeking eviction defense and homelessness prevention.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 279","type":"CLN","typeLong":"Clinical","time":"01:05PM","days":"T"}]},{"code":"LAW 7892","title":"Tenants Advocacy Practicum III","name":"LAW 7892: Tenants Advocacy Practicum III","desc":"In this course, students will continue to provide information, legal advice, and representation to tenants. Students will work on cases for tenants facing a wide variety of housing issues (including but not limited to habitability issues, payment disputes, lease violations, unlawful lockouts, and small claims actions) or seeking eviction defense and homelessness prevention. Students will draft legal memoranda and may prepare pleadings for town, village, and city court cases. Students may have the opportunity to appear (likely virtually) in court.\xa0","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 279","type":"CLN","typeLong":"Clinical","time":"01:05PM","days":"T"}]},{"code":"LAW 7893","title":"Tenants Advocacy Practicum IV","name":"LAW 7893: Tenants Advocacy Practicum IV","desc":"In this course, students will continue to provide information, legal advice, and representation to tenants. Students will work on cases for tenants facing a wide variety of housing issues (including but not limited to habitability issues, payment disputes, lease violations, unlawful lockouts, and small claims actions) or seeking eviction defense and homelessness prevention. Students will draft legal memoranda and may prepare pleadings for town, village, and city court cases. Students may have the opportunity to appear (likely virtually) in court. The students may also circulate tenants\' rights information to the community in conjunction with the Ithaca Tenants Union.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 279","type":"CLN","typeLong":"Clinical","time":"01:05PM","days":"T"}]},{"code":"LAW 7925","title":"New York Attorney General Practicum I","name":"LAW 7925: New York Attorney General Practicum I","desc":"The New York State Attorney General offers a clinic in which law students work 12-15 hours per week in the Attorney General\'s Syracuse Regional Office and attend a weekly class at Cornell. Under the supervision of an Assistant Attorney General, students perform legal research, writing, analysis, draft original legal documents and provide trial support. Students will have an opportunity to attend hearings, trials, court arguments, and pre-trial proceedings. Students will acquire litigation skills as well as specialized knowledge of public advocacy litigation. The class will focus on legal and ethical issues seen in litigation and review student experiences working in the Attorney General\'s office. Each week there will be a different subject area of Attorney General practice discussed or there will be a guest speaker. Topics include medical malpractice, defective highway design, 1983 civil rights actions in Federal Court, petitions in State Court seeking to overturn state actions, prisoner claims public advocacy litigation. Guest speakers will be attorneys serving in various capacities in State or Federal government and often include a judge or court attorney. There will also be a pro bono opportunity to accompany an attorney to a volunteer legal services clinics operated by the Onondaga County Bar Association.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 285","type":"CLN","typeLong":"Clinical","time":"06:15PM","days":"R"}]},{"code":"LAW 7927","title":"Appellate Criminal Defense Clinic","name":"LAW 7927: Appellate Criminal Defense Clinic","desc":"In this one-semester clinical course, students will take on the professional responsibilities of handling a criminal appeal in New York State. Students will work in pairs to review the full appellate record, research and select the most salient appealable issues, and draft the opening appellate brief on behalf of an indigent client convicted of a felony in Manhattan or the Bronx. Throughout the process, students will collaborate with their incarcerated client.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G81","type":"CLN","typeLong":"Clinical","time":"10:10AM","days":"T"}]},{"code":"LAW 7945","title":"Federal Indian Law Practicum I","name":"LAW 7945: Federal Indian Law Practicum I","desc":"This ongoing practicum course represents tribes and tribal members in matters involving federal Indian law, large or small, and regardless of forum or the location of the tribe. One current case involves pursuing a claim against the Department of the Interior under The Judgment Funds Act on behalf of disenrolled members of the Saginaw Chippewa Indian Tribe of Michigan. Student work on that matter includes research and document preparation related to filing an appeal of a decision of the Assistant Secretary of Indian Affairs in federal court, while concurrently developing a broad-based knowledge of a voluminous historical and administrative record, which includes expert reports, research memoranda, client declarations and interview transcripts.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 479","type":"CLN","typeLong":"Clinical","time":"02:30PM","days":"W"}]},{"code":"LAW 7946","title":"Federal Indian Law Practicum II","name":"LAW 7946: Federal Indian Law Practicum II","desc":"This ongoing clinical course is pursuing a claim against the Department of the Interior under The Judgment Funds Act on behalf of disenrolled members of the Saginaw Chippewa tribe. We have filed a complaint asking the Secretary to perform a non-discretionary action to re-enroll our clients. Because the tribe is not a necessary party we have avoided issues of sovereign immunity, but expect that it may be raised in an attempt to join the tribe. The Department has filed a motion to dismiss and we responded and are awaiting judgment. We will continue to develop strategies that will permit us to go forward regardless of the decision. Student work will entail designing an administrative appeal and preparing documents for a motion for summary judgment. Students will continue gathering and preparing evidence as well as preparing memoranda on the various tactics. The voluminous historical record remains to be fully cataloged and exhibits for the client declarations also remain to be prepared.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 479","type":"CLN","typeLong":"Clinical","time":"02:30PM","days":"W"}]},{"code":"LAW 7949","title":"Federal Indian Law Practicum III","name":"LAW 7949: Federal Indian Law Practicum III","desc":"This ongoing practicum course represents tribes and tribal members in matters involving federal Indian law, large or small, and regardless of forum or the location of the tribe.\xa0One current case involves pursuing a claim against the Department of the Interior under The Judgment Funds Act on behalf of disenrolled members of the Saginaw Chippewa Indian Tribe of Michigan.\xa0Student work on that matter includes research and document preparation related to ongoing federal court litigation, while concurrently developing a broad-based knowledge of a voluminous historical and administrative record, which includes expert reports, research memoranda, client declarations and interview transcripts.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 479","type":"CLN","typeLong":"Clinical","time":"02:30PM","days":"W"}]},{"code":"LAW 7950","title":"Federal Indian Law Practicum IV","name":"LAW 7950: Federal Indian Law Practicum IV","desc":"This ongoing practicum course represents tribes and tribal members in matters involving federal Indian law, large or small, regardless of forum or the location of the tribe.\xa0One current case involves pursuing a claim against the Department of the Interior under The Judgment Funds Act on behalf of disenrolled members of the Saginaw Chippewa Indian Tribe of Michigan.\xa0Student work on that matter includes research and document preparation related to ongoing federal court litigation, while concurrently developing a broad-based knowledge of a voluminous historical and administrative record, which includes expert reports, research memoranda, client declarations and interview transcripts.\xa0LAW 7946,\xa0LAW 7949, and LAW 7950 are advanced courses for students who have completed previous semesters in the practicum.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 479","type":"CLN","typeLong":"Clinical","time":"02:30PM","days":"W"}]},{"code":"LAW 7953","title":"Securities Law Clinic I","name":"LAW 7953: Securities Law Clinic I","desc":"The course will focus on fundamental investigatory and advocacy skills applicable to representation of public investors in disputes subject to arbitration at the Financial Industry Regulatory Authority (f/k/a National Association of Securities Dealers), with particular attention to the elderly and to small investors. Substantive legal topics will include the scope and nature of binding arbitration under the Federal Arbitration Act and New York law, and the legal and regulatory remedies available to defrauded investors. Coursework will include training in skills such as interviewing potential clients, evaluating potential claims, preparing pleadings, conducting discovery, representing clients at hearings and negotiating settlements. Class work will include presentations by nationally-recognized experts on topics applicable to evaluation of securities accounts, trading, and products. Students will have the opportunity under faculty supervision to represent investors, to provide public education to community groups as to investment frauds, to draft position statements to regulatory authorities, and/or to participate in preparing amicus briefs, in support of public investors.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 277","type":"CLN","typeLong":"Clinical","time":"01:25PM","days":"M"}]},{"code":"LAW 7959","title":"Transnational Disputes Clinic","name":"LAW 7959: Transnational Disputes Clinic","desc":"Students in this course learn to use strategic litigation to influence the progressive development of the law. Clinic clients and partners include those appearing before international investor-state arbitral tribunals, national courts, such as U.S. federal courts, and other fora. Students learn key skills through acting as counsel for parties as well as for amici curiae in disputes that implicate the protection of fundamental rights. This course\xa0includes a seminar component as well as extensive, supervised work as part of a case team.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall 387","type":"CLN","typeLong":"Clinical","time":"01:25PM","days":"WF"}]},{"code":"LAW 7964","title":"Veterans Practicum","name":"LAW 7964: Veterans Practicum","desc":"In the Veterans Law Practicum I, students will provide information, legal advice, and representation to veterans. The student work in this practicum will directly address the gaps in legal representation for veterans seeking access to various veteran-specific benefits programs. Obtaining and accessing benefits can impact the lives of veterans in many ways: by preventing homelessness, improving a veteran\'s economic security and wellbeing, and providing access to medical care. Students will work on cases to secure service-connected disability compensation, discharge upgrades, overpayment issues, and other related claims. The students will interview veterans and conduct substantive research into the applicable law, including Title 38 Code of Federal Regulations, Uniform Code of Military Justice, and Federal Legislation. Students will draft legal memoranda and may prepare briefings for Veteran District Offices and/or the Board of Veterans Affairs. Students may have the opportunity to appear virtually at hearings. The students may also circulate veterans benefits information to the community in conjunction with the Tompkins County Department of Veterans Services. Students will develop key lawyering skills (including interviewing, client counseling, fact investigation, drafting, and oral advocacy), gain substantive and procedural knowledge of veteran benefits laws and regulations, and engage with the ethical implications of creating an attorney-client relationship. Students are requested to submit a statement of interest.","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G80","type":"CLN","typeLong":"Clinical","time":"04:30PM","days":"T"}]},{"code":"LAW 7965","title":"Veterans Practicum II","name":"LAW 7965: Veterans Practicum II","desc":null,"locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G80","type":"CLN","typeLong":"Clinical","time":"04:30PM","days":"T"}]},{"code":"LGBT 3210","title":"Gender and the Brain","name":"LGBT 3210: Gender and the Brain","desc":"Why are boys more likely than girls to be diagnosed with autism, and why are women more likely than men to be diagnosed with depression? Are there different \\"gay\\" and \\"straight\\" brains? And how does brain science interact with gender and sexuality in popular debate? Reading and discussing the original scientific papers and related critical texts, we will delve into the neuroscience of gender. In this course, we will delve into the neuroscience of gender difference. Reading the original scientific papers and related critical texts, we will ask whether we can find measurable physical differences in male and female brains, and what these differences might be. Do men and women solve spatial puzzles differently, as measured physiologically? Do nonhuman animals display sex-specific behaviors mediated by brain structure, and can we extrapolate these findings to human behavior? Why are boys three times more likely than girls to be diagnosed as autistic, and is there any connection between the predominantly male phenomenon of autism and other stereotypically male mental traits? Are there physical representations of sexual orientation in the brain, and how are these related to gender identity? And how are scientific studies represented and misrepresented in popular debate?","locations":[{"bldg":"Corson-Mudd","room":"Corson-Mudd W364","type":"LEC","typeLong":"Lecture","time":"02:55PM","days":"MW"}]},{"code":"LING 6402","title":"Phonology II","name":"LING 6402: Phonology II","desc":"A continuation of LING 6401\xa0with a focus on developing research skills.","locations":[{"bldg":"Morrill Hall","room":"Morrill Hall B11","type":"LEC","typeLong":"Lecture","time":"02:55PM","days":"MW"}]},{"code":"LING 6601","title":"Topics in Phonetics-Phonological Theory","name":"LING 6601: Topics in Phonetics-Phonological Theory","desc":"Examination of recent developments in the core areas of phonetics and phonology as well as its interfaces with other components of the grammar (e.g., morphosyntax, semantics or pragmatics). Topics covered include current approaches and relevant theoretical and historical perspectives.","locations":[{"bldg":"Morrill Hall","room":"Morrill Hall B11","type":"SEM","typeLong":"Seminar","time":"11:40AM","days":"TR"}]},{"code":"LING 6692","title":"Phonetic Data Analysis Workshop","name":"LING 6692: Phonetic Data Analysis Workshop","desc":"The phonetics data analysis workshop provides students with practice in analysis and visualization of phonetic data, using Matlab, R, and Praat. Experiment design and statistical methods are emphasized.","locations":[{"bldg":"Morrill Hall","room":"Morrill Hall B11","type":"SEM","typeLong":"Seminar","time":"12:20PM","days":"W"},{"bldg":"Morrill Hall","room":"Morrill Hall B11","type":"SEM","typeLong":"Seminar","time":"12:20PM","days":"F"}]},{"code":"MAE 2250","title":"Mechanical Synthesis","name":"MAE 2250: Mechanical Synthesis","desc":"This is a course focused on design.\xa0 Students will learn methods that will help them create and select good solutions and skills that permit them to generalize ideas and try them out.\xa0 They will cultivate an ability to work with teammates and to function in a project with open-ended objectives.\xa0 Design education is challenged by a qualitative nature, a wide-ranging breadth of technical content and personal preferences of individual designers.","locations":[{"bldg":"Upson Hall","room":"Upson Hall 242","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"M"},{"bldg":"Upson Hall","room":"Upson Hall 242","type":"LAB","typeLong":"Laboratory","time":"12:20PM","days":"M"},{"bldg":"Upson Hall","room":"Upson Hall 242","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"T"},{"bldg":"Upson Hall","room":"Upson Hall 242","type":"LAB","typeLong":"Laboratory","time":"12:20PM","days":"T"},{"bldg":"Upson Hall","room":"Upson Hall 242","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"W"},{"bldg":"Upson Hall","room":"Upson Hall 242","type":"LAB","typeLong":"Laboratory","time":"12:20PM","days":"W"},{"bldg":"Upson Hall","room":"Upson Hall 242","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"R"},{"bldg":"Upson Hall","room":"Upson Hall 242","type":"LAB","typeLong":"Laboratory","time":"12:20PM","days":"R"},{"bldg":"Upson Hall","room":"Upson Hall 242","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"F"},{"bldg":"Upson Hall","room":"Upson Hall 242","type":"LAB","typeLong":"Laboratory","time":"12:20PM","days":"F"}]},{"code":"MAE 6270","title":"Experimental Methods in Fluid Dynamics","name":"MAE 6270: Experimental Methods in Fluid Dynamics","desc":"Introduction to experimental techniques, data collection, and data analysis, in particular as they pertain to fluid flows. Introduces theory and use of\xa0analog transducers, acoustic Doppler velocimetry (ADV), full-field (2-D) quantitative imaging techniques such as particle image velocimetry (PIV) and laser induced fluorescence (LIF). Additional topics include\xa0computer-based experimental control, analog and digital data acquisition, discrete sampling theory, digital signal processing, and uncertainty analysis. The canonical flows of the turbulent flat plate boundary layer and the neutrally buoyant turbulent round jet are introduced theoretically and the subject of three major laboratory experiments using ADV, PIV and LIF. There is a final group project on a flow of the students choosing.","locations":[{"bldg":"Hollister Hall","room":"Hollister Hall B52","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"M"},{"bldg":"Hollister Hall","room":"Hollister Hall B52","type":"LAB","typeLong":"Laboratory","time":"10:10AM","days":"T"}]},{"code":"MEDVL 6020","title":"Latin Philosophical Texts","name":"MEDVL 6020: Latin Philosophical Texts","desc":"Reading and translation of Latin philosophical texts.","locations":[{"bldg":"Hans Bethe House","room":"Hans Bethe House 125","type":"SEM","typeLong":"Seminar","time":"07:30PM","days":"T"}]},{"code":"MEDVL 6102","title":"Latin Paleography","name":"MEDVL 6102: Latin Paleography","desc":"This course is an introduction to and survey of Latin scripts from Roman antiquity through the early Renaissance, with an emphasis on the identification, localization, and reading of scripts. Class meetings will combine practical study of Latin scripts through medieval manuscripts in the Kroch library, facsimiles, and online digital reproductions with instruction in the cultural-historical background to manuscript production, library practices, and bibliographical resources. Students will also be introduced to basic techniques for codicological description and the principles of textual criticism.","locations":[{"bldg":"Kroch,Carl A Library","room":"Kroch, Carl A Library 2B49","type":"SEM","typeLong":"Seminar","time":"01:25PM","days":"W"}]},{"code":"MSE 2620","title":"Electronic Materials for the Information Age","name":"MSE 2620: Electronic Materials for the Information Age","desc":"Examines the electrical and optical properties of materials. Topics include the mechanism of electrical conduction in metals, semiconductors and insulators; tuning of electrical properties in semiconductors, charge transport across metal/semiconductor and semiconductor/semiconductor junctions, and the interaction of materials with light; semiconductor electronic devices; and the materials science of device fabrication. Applications in microelectronics, solar cells, electronics, and display technologies are discussed. Semiweekly labs provide hands-on experience characterizing electronic materials and devices.","locations":[{"bldg":"Phillips Hall","room":"Phillips Hall 237","type":"LAB","typeLong":"Laboratory","time":"08:30AM","days":"R"},{"bldg":"Phillips Hall","room":"Phillips Hall 237","type":"LAB","typeLong":"Laboratory","time":"11:15AM","days":"S"}]},{"code":"MSE 3120","title":"Junior Laboratory II","name":"MSE 3120: Junior Laboratory II","desc":"Practical laboratory covering the characterization of material, analysis of data, and proper presentation of results. Labs are based on materials from courses in kinetics, diffusion and phase transformations (MSE 3040) and electronic, magnetic and dielectric properties (MSE 3050). Experiments include spectroscopic determination of a diffusion constants, thin film growth kinetics, anisotropic resistivity in polycrystalline materials, and characterization of magnetic properties. Data analysis is extended to include experimental design, use of custom model equations, and precision measurement techniques. Includes also continued development of technical writing skills.","locations":[{"bldg":"Bard Hall","room":"Bard Hall 247","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"W"},{"bldg":"Bard Hall","room":"Bard Hall 247","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"F"}]},{"code":"MSE 5411","title":"Nanofabrication and Characterization of Electronics Laboratory","name":"MSE 5411: Nanofabrication and Characterization of Electronics Laboratory","desc":"This course provides an introduction to nanofabrication technologies with emphasis on Si-based integrated circuits manufacturing as well as modern electronics based on GaN, 2D materials etc. The lab, primarily taught in the Cornell Teaching Cleanroom, includes basic fabrication steps of lithography, metallization, plasma etching and annealing. A series of devices will be fabricated: solar cells, MOS capacitors and transistors, 2D transistors, GaN HEMTs and LEDs.","locations":[{"bldg":"Phillips Hall","room":"Phillips Hall 236","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"},{"bldg":"Phillips Hall","room":"Phillips Hall 236","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"W"},{"bldg":"Phillips Hall","room":"Phillips Hall 236","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"}]},{"code":"NAVS 3310","title":"Evolution of Warfare","name":"NAVS 3310: Evolution of Warfare","desc":"A study of warfare that examines the relationship of military strategy to geography, economics, sociology, technology, and governing policy. This course examines the historical evolution of warfare, including principles of war, development of weapons and their effects on warfare, and the political goals associated with specific adversaries through history.","locations":[{"bldg":"Barton Hall","room":"Barton Hall 249","type":"LEC","typeLong":"Lecture","time":"08:40AM","days":"TR"}]},{"code":"NTRES 3260","title":"Applied Conservation Ecology","name":"NTRES 3260: Applied Conservation Ecology","desc":"An interactive-field and lab course designed to provide direct experience with some of the most important field methods and analytical techniques used to examine species, ecosystem and community-level function, structure, and value, especially within the context of contemporary conservation ecology and evolutionary theory. Tools include field sampling techniques, resource and conservation mapping, spatial referencing, GIS, measures of biodiversity, and manual and automated techniques for studying soil, stream, forest, terrestrial, and marine biota and related physical factors. The class is designed to provide a strong background in field research methods and theory related to ecological conservation.","locations":[{"bldg":"Rice Hall","room":"Rice Hall 301","type":"LAB","typeLong":"Laboratory","time":"12:25PM","days":"F"}]},{"code":"NTRES 6000","title":"Introduction to Graduate Study in Natural Resources","name":"NTRES 6000: Introduction to Graduate Study in Natural Resources","desc":"Students will attend weekly seminar in Natural Resources and engage in follow up discussion of the scientific content presented and implications for the management and conservation of resources. Additional goal of the course is to examine\xa0how scientists pursue career paths toward effective participation in this realm. Discussions focus on the practices of scientists and institutions that provide a framework for scientific endeavors.","locations":[{"bldg":"Fernow Hall","room":"Fernow Hall 110","type":"DIS","typeLong":"Discussion","time":"02:30PM","days":"T"}]},{"code":"NTRES 6260","title":"Applied Conservation Ecology","name":"NTRES 6260: Applied Conservation Ecology","desc":"An interactive-field and lab course designed to provide direct experience with some of the most important field methods and analytical techniques used to examine species, ecosystem and community-level function, structure, and value, especially within the context of contemporary conservation ecology and evolutionary theory. Tools include field sampling techniques, resource and conservation mapping, spatial referencing, GIS, measures of biodiversity, and manual and automated techniques for studying soil, stream, forest, terrestrial, and marine biota and related physical factors. The class is designed to provide a strong background in field research methods and theory related to ecological conservation.","locations":[{"bldg":"Rice Hall","room":"Rice Hall 301","type":"LAB","typeLong":"Laboratory","time":"12:25PM","days":"F"}]},{"code":"PE 1100","title":"Beginning Swimming","name":"PE 1100: Beginning Swimming","desc":"An entry level class for those with little or no swimming experience. Instruction and practice in the basic skills necessary\xa0to meet the University Swim Requirement. Areas of emphasis are: developing proper body position on the front and back, proper breathing technique, Front Crawl, Elementary Backstroke, treading and swimming in deep water.","locations":[{"bldg":"Teagle Hall","room":"Teagle Hall 151B","type":"LEC","typeLong":"Lecture","time":"09:05AM","days":"MW"},{"bldg":"Teagle Hall","room":"Teagle Hall 151B","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MW"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 201","type":"LEC","typeLong":"Lecture","time":"06:40PM","days":"MW"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 201","type":"LEC","typeLong":"Lecture","time":"07:40PM","days":"MW"},{"bldg":"Teagle Hall","room":"Teagle Hall 151B","type":"LEC","typeLong":"Lecture","time":"09:05AM","days":"TR"},{"bldg":"Teagle Hall","room":"Teagle Hall 151B","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"TR"}]},{"code":"PE 1101","title":"Advanced Beginner Swimming","name":"PE 1101: Advanced Beginner Swimming","desc":"Ideal for all who have taken Beginning Swimming or have some basic knowledge of how to swim, regardless of whether the University Swim Requirement was successfully met. Areas of emphasis are the Front Crawl with rotary breathing, Back Crawl, Elementary Backstroke, diving, treading water, and underwater swimming. The primary objective is to strengthen the student\'s confidence and competence.","locations":[{"bldg":"Teagle Hall","room":"Teagle Hall 151","type":"LEC","typeLong":"Lecture","time":"02:15PM","days":"MW"},{"bldg":"Teagle Hall","room":"Teagle Hall 151B","type":"LEC","typeLong":"Lecture","time":"02:15PM","days":"TR"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 201","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"MW"}]},{"code":"PE 1103","title":"Advanced Swimming","name":"PE 1103: Advanced Swimming","desc":"Practice and perfection of the techniques of the 9 strokes: Front Crawl, Back Crawl, Butterfly, Breaststroke, Elementary Backstroke, Sidestroke, Overarm Sidestroke, Trudgeon, and Inverted Breaststroke. This class may also cover turns, diving and an introduction to a swimming workout. Students should be able to easily swim a minimum of 300 yds (12 lengths of the pool). Please note: this course is primarily designed as a stroke technique course, not a conditioning course.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 201","type":"LEC","typeLong":"Lecture","time":"03:30PM","days":"TR"}]},{"code":"PE 1104","title":"Swim Conditioning","name":"PE 1104: Swim Conditioning","desc":"Introduction to and practice of different types of training methods. Final objectives: 2,500 yards in one class period. This is primarily a conditioning course and not an instructional course on stroke technique. The focus will be on workouts, workout planning and different types of training methods. This course is intended for more advanced swimmers. Students who have completed Beginning or Advanced Beginner Swimming may have a very difficult time in this course.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 201","type":"LEC","typeLong":"Lecture","time":"09:05AM","days":"MW"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 201","type":"LEC","typeLong":"Lecture","time":"08:00AM","days":"TR"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 201","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"TR"}]},{"code":"PE 1110","title":"Lifeguarding","name":"PE 1110: Lifeguarding","desc":"This is the current A.R.C. Lifeguarding Course. It is designed for pool guarding. Emphasis is on preventative lifeguarding, surveillance methods and equipment rescues. This course also includes instruction and certification in A.R.C. First Aid, C.P.R. for the Professional Rescuer, and Automated External Defibrillator use. An option will be available for those interested in the Waterfront Lifeguarding certification. Note: this course is not for the casual participant as it will require 36 hours of scheduled class time.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 201","type":"LEC","typeLong":"Lecture","time":"01:00PM","days":"F"}]},{"code":"PE 1130","title":"Open Water Scuba","name":"PE 1130: Open Water Scuba","desc":"Program includes knowledge development and skill training in the pool. All classes are referral only (no open water dives), meaning students will need to pickup their paperwork and complete four additional dives in open water within one year from the last training section to receive a\xa0PADI Open Water Diver certification.\xa0For more information, please see:\xa0www.pe.cornell.edu/.","locations":[{"bldg":"Teagle Hall","room":"Teagle Hall 151","type":"LEC","typeLong":"Lecture","time":"01:30PM","days":"R"}]},{"code":"PE 1150","title":"Ballroom Dancing","name":"PE 1150: Ballroom Dancing","desc":"This is a beginning level class introducing students to Social Ballroom Dance. Participants can expect to have fun, learn some history of American Social Dance, learn about movement - how to move with your partner, how to move to the music, and enough \'moves\' in five different dances (Waltz, Foxtrot, Tango, Rumba and Cha Cha) to get a taste of and a general feel for each dance. Please note: The Sunday section is for students enrolling with a partner and there is limited rotation of partners during class. Partners should enroll via Student Center at the same time to ensure that both partners get into the Sunday section. The Wednesday section is for students who either don\'t have a partner or don\'t mind rotating partners in the class. Changing partners generally results in improved mastery.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"06:00PM","days":"Su"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"07:30PM","days":"W"}]},{"code":"PE 1153","title":"Beginning Ballroom Dance Rhythm","name":"PE 1153: Beginning Ballroom Dance Rhythm","desc":"Offered during the spring semester, this is a beginning level class that introduces students to four American Rhythm Style ballroom dances \u2013 Rumba, Cha Cha, Mambo and Swing. This class will go further in depth than the Beginning Social Ballroom Dance class (PE1150). This class is appropriate for either beginners or students with some experience who wish to further develop their knowledge and skill in the dances covered. Participants will gain some mastery of each dance, develop partnering skills, technique, movement, styling and musicality. It is not necessary to sign up with a partner, however it is recommended to ensure balance between leads and follows. Participants will change partners throughout the class. \xa0\xa0 \xa0\xa0","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"07:30PM","days":"M"}]},{"code":"PE 1160","title":"Latin Dance","name":"PE 1160: Latin Dance","desc":"This class introduces Salsa, Bachata, Merengue, Cha Cha Cha, Son and Comparsa. Salsa derives from the Cuban rhythm of Son. As a music and dance form, it has acquired regional variations and absorbed influences from different parts of Latin America and other continents. Bachata and Merengue are quintessential dances of the Dominican Republic. Comparsa is a form of carnival line dance. Cha Cha Cha originates in Cuba, finds expression in Rock n\' Roll and western pop music, and is traditionally danced \\"contratiempo.\\" In this course, we learn the basics of all of these dances. Instruction emphasizes the development of foundations in musical timing, rhythm, body movement, lead-follow connection and space use. Class begins with a stretch and body movement warm-up. We then teach dance step sequences across the floor, in rotating lines, as freestyle and in partner format. The skills learned in each dance are interrelated - as you improve in one you develop a sensibility for the others. By the end of this course you will be able to take Latin dance to a higher level and learn other partnered dances. No partner is necessary to register. Couple sign-up is encouraged. Partners rotate. This class is gender-free: each student is free to learn the lead or follow role.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"09:15PM","days":"M"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"12:00PM","days":"F"}]},{"code":"PE 1162","title":"Salsa","name":"PE 1162: Salsa","desc":"This class covers beginner through advanced beginner Salsa moves. Students learn step variations and turn patterns as seen in Latin social dance and nightclub settings. Class begins with a warm-up of Salsa step patterns, also known as \\"shines.\\" We then move into combinations for couples and learn patterns with rotating partners. Latin body movement and rhythm is taught in the warm-up and partner sections. In partner work, emphasis is placed on: lead-follow connection; frame and tension; spatial awareness; nuance and flow. Salsa in Rueda de Casino format will be introduced later in the semester as an additional way to enjoy Salsa. In Rueda, dancers change partners within a circle and perform dynamic combinations to the arrangement of a caller. Rueda is also a teaching tool used to improve timing and release energy. Learning aids include a syllabus, music, smartphone application and video tutorial. No partner is necessary to register. Couple sign-up is encouraged. This class is gender-free: each student is free to choose the lead or follow role.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"08:00PM","days":"Su"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"01:45PM","days":"F"}]},{"code":"PE 1167","title":"Introduction to Tango","name":"PE 1167: Introduction to Tango","desc":"Introduction to the fundamentals of Tango dancing and its origins. Focus is on movement on the dance floor and how to be connected to your partner. Other aspects include learning to differentiate between the genres of Tango music (Tango, Milonga, Candombe, and Vals).","locations":[{"bldg":"Teagle Hall","room":"Teagle Hall 138","type":"LEC","typeLong":"Lecture","time":"07:15PM","days":"W"}]},{"code":"PE 1170","title":"Introduction to Swing Dance","name":"PE 1170: Introduction to Swing Dance","desc":"In this class you will learn the basics of Lindy Hop (also called Jitterbug and East Coast Swing), a social dance originated by Black Americans in the early twentieth century that is still popular today all around the world. We will work on footwork, timing, partnering, and musicality, with the goal of empowering you to have fun on the social dance floor\u2014at weddings, parties, and wherever there\'s good rythmic music playing! You\'ll learn to improvise and have the opportunity to create short choreographs too. No dance experience or partner is necessary. In fact, you will change partners frequently in class. Wear clothes you are comfortable moving in. Shoes must have leather soles OR be white-soled sneakers with the treads worn smooth, or you can dance in socks.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"Su"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"04:15PM","days":"Su"}]},{"code":"PE 1233","title":"Bootcamp","name":"PE 1233: Bootcamp","desc":"This course is designed as a modern military style workout program with an emphasis on both aerobic and anaerobic fitness. Each workout session will consist of stretching, warm-up calisthenics, cardio training, full body resistance training, core activation and cool down stretching. This is a high energy course that will teach students the importance of motivation, enthusiasm and teamwork while familiarizing them with total-fitness techniques and concepts. If you are ready to push yourself and train hard, Bootcamp is for you. Students of all fitness levels will benefit greatly from this course.","locations":[{"bldg":"Toni Morrison Hall","room":"Toni Morrison Hall B04","type":"LEC","typeLong":"Lecture","time":"11:20AM","days":"F"}]},{"code":"PE 1235","title":"8 O\'Clock Rock","name":"PE 1235: 8 O\'Clock Rock","desc":"This class combines the best of the Principals of Weight Training and Cardio Crazy to get your day off to a rocking and rolling great start. Students will use resistance and cardio equipment to create the perfect morning wake-up call.","locations":[{"bldg":"Appel","room":"Appel 101 Fitness Center","type":"LEC","typeLong":"Lecture","time":"08:00AM","days":"TR"}]},{"code":"PE 1237","title":"Yasaride","name":"PE 1237: Yasaride","desc":"This class combines two wonderful activities, indoor cycling and yoga into a mindful stress reducing hour of fitness. The yoga portion will focus on full body stretching as well as areas that need more attention after cycling such as hamstrings, hips, and the spine.\xa0 The class will also include work on breath, alignment, and mindfulness in both the cycling and yoga portions of the class. The length of time for each activity will vary from class to class.\xa0","locations":[{"bldg":"Noyes Community and Rec Center","room":"Noyes Community and Rec G06","type":"LEC","typeLong":"Lecture","time":"09:30AM","days":"Su"}]},{"code":"PE 1241","title":"Mobility and Core Training","name":"PE 1241: Mobility and Core Training","desc":"Mobility and stability are fundamental components of our daily movement. Whether you are highly active, not active at all, or somewhere in between, this course will teach you about these subtle yet critical details of exercise. Through various mobility and flexibility exercises, you will learn how to tune your muscles for optimal length-tension relationships, while at the same time learning core strengthening exercises to help counter faulty postures from long hours of sitting.","locations":[{"bldg":"Appel","room":"Appel 101 Fitness Center","type":"LEC","typeLong":"Lecture","time":"09:15AM","days":"TR"}]},{"code":"PE 1245","title":"Indoor Stationary Cycling","name":"PE 1245: Indoor Stationary Cycling","desc":"Based on the foundation of the Spinning\xae Program this indoor stationary cycling class combines basic cycling movements with motivational coaching, breathing awareness, and heart rate training. This non-impact, individually paced, cardiovascular fitness class is held in a fun environment with music that will move you! A great alternative to traditional group fitness classes.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"08:00AM","days":"TR"},{"bldg":"Noyes Community and Rec Center","room":"Noyes Community and Rec G06","type":"LEC","typeLong":"Lecture","time":"08:00AM","days":"MW"}]},{"code":"PE 1261","title":"Fitness and Conditioning","name":"PE 1261: Fitness and Conditioning","desc":"Fitness and conditioning is designed to familiarize the student with several different forms of exercise. Facilities used include the track, the gymnasium and other places around campus. The components of physical fitness include cardiovascular endurance, muscular strength, general flexibility and agility. The course will offer activities that enhance each component and help the individual to design a personal conditioning program for future fitness and well-being.","locations":[{"bldg":"Barton Hall","room":"Barton Hall 100-Gym Floor","type":"LEC","typeLong":"Lecture","time":"11:50AM","days":"TR"}]},{"code":"PE 1262","title":"Fitness for Women","name":"PE 1262: Fitness for Women","desc":"The design of this course includes both lecture and physical activity. Students are presented with a variety of topics and information that involves physical fitness and health. Each student will learn to design a fitness program that is geared toward her own interests and abilities. Topics include: nutrition, time management, relaxation techniques, and stress management. Activities will include aerobic dance, walking, jogging, weight training, flexibility exercises, relaxation and stress management routines, and yoga techniques.","locations":[{"bldg":"Appel","room":"Appel 101 Fitness Center","type":"LEC","typeLong":"Lecture","time":"01:00PM","days":"MW"}]},{"code":"PE 1265","title":"Wellness and Fitness","name":"PE 1265: Wellness and Fitness","desc":"\\"Here\'s to a Healthier You\\" - A wellness experience for the busy student. This course will assess the student\'s physical fitness status, and overall lifestyle health habits. Strength training basics emphasize how to properly perform exercises for each of the major muscle groups of the body.\xa0 Program Planning, Nutrition and Stress Management are also presented.\xa0","locations":[{"bldg":"Appel","room":"Appel 101 Fitness Center","type":"LEC","typeLong":"Lecture","time":"12:00PM","days":"TR"},{"bldg":"Appel","room":"Appel 101 Fitness Center","type":"LEC","typeLong":"Lecture","time":"01:15PM","days":"TR"}]},{"code":"PE 1270","title":"Introduction to Jogging","name":"PE 1270: Introduction to Jogging","desc":"Covers running and stretching techniques. It comprises a conditioning program with the objective to develop the capacity to run 3 miles after 12 weeks of training.","locations":[{"bldg":"Barton Hall","room":"Barton Hall 100-Gym Floor","type":"LEC","typeLong":"Lecture","time":"10:40AM","days":"TR"}]},{"code":"PE 1272","title":"Walking Tours","name":"PE 1272: Walking Tours","desc":"A series of walking tours around the Cornell Campus and beyond. Class will meet regardless of weather, so please come prepared.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B16","type":"LEC","typeLong":"Lecture","time":"03:00PM","days":"M"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B16","type":"LEC","typeLong":"Lecture","time":"03:00PM","days":"T"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B16","type":"LEC","typeLong":"Lecture","time":"03:00PM","days":"R"}]},{"code":"PE 1273","title":"Walking Meditation","name":"PE 1273: Walking Meditation","desc":"This course combines walking and meditation, two life-enhancing activities that can help students create balance in their hectic lives. Walking is the optimum exercise for good health and meditation offers the opportunity to calm an active and busy mind. Drawing on the teachings from the Vietnamese Zen Buddist monk, Thich Nhat Hanh, will involve meditating in motion.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B16","type":"LEC","typeLong":"Lecture","time":"12:20PM","days":"TR"}]},{"code":"PE 1300","title":"Introduction to Bowling","name":"PE 1300: Introduction to Bowling","desc":"Instruction available during each class session for the Beginning or Intermediate level bowler. Choice of two 45 minute classes per week or one class for 90 minutes. Shoe rental included in course fee which covers approximately 72 games.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"09:45AM","days":"MW"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"11:00AM","days":"MW"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"12:15PM","days":"MW"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"01:30PM","days":"MW"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"02:45PM","days":"MW"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"04:00PM","days":"MW"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"09:45AM","days":"TR"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"11:00AM","days":"TR"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"12:15PM","days":"TR"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"01:30PM","days":"TR"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"04:00PM","days":"TR"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"10:00AM","days":"F"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"11:45AM","days":"F"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B22","type":"LEC","typeLong":"Lecture","time":"01:30PM","days":"F"}]},{"code":"PE 1311","title":"Fly Tying and Fishing","name":"PE 1311: Fly Tying and Fishing","desc":"This course introduces the student to the beautiful sport of fly fishing. Topics covered include fly tying, knots and rigging, casting and presentation, and what species of fish you can catch locally. Students will tie fly patterns that are appropriate for fishing opportunities in this region. The course will feature classroom sessions and fishing on Beebe Lake as well. Students will primarily be fishing for\xa0cold and warm water species including trout, bass and pan fish. All fly fishing tackle, fly tying materials and tools are included. The goal is for the student to catch a fish on a fly they tied.","locations":[{"bldg":"Teagle Hall","room":"Teagle Hall 210","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"W"}]},{"code":"PE 1312","title":"Ultimate Bass Fishing","name":"PE 1312: Ultimate Bass Fishing","desc":"This class is for anyone who wants to learn more about North America\'s most popular fish, the bass. Whether you just want to fish from the bank, a kayak or a professional bass boat, this class is aimed for anyone from a beginner to an avid angler. The course will feature classroom sessions and fishing on Beebe Lake as well. Students will enjoy hands-on procedures such as knot tying, the newest and hottest lure rigging, learning to cast spinning and casting combos, along with other bass catching techniques.\xa0Topics such as bass habits, habitats, seasonal patterns, the differences between smallmouth and largemouth bass, and good area bass waters will be covered.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B16","type":"LEC","typeLong":"Lecture","time":"01:00PM","days":"F"}]},{"code":"PE 1320","title":"Professional Instructional Golf","name":"PE 1320: Professional Instructional Golf","desc":"Equipment furnished. PGA program of instruction geared to all levels of experience and ability. The objective is to give beginners enough skill to play, and to give more advanced players direction in their thinking, practice, and play, through a thorough understanding of fundamentals.","locations":[{"bldg":"Cornell Golf Center","room":"Cornell Golf Center 101","type":"LEC","typeLong":"Lecture","time":"09:00AM","days":"MWF"},{"bldg":"Cornell Golf Center","room":"Cornell Golf Center 101","type":"LEC","typeLong":"Lecture","time":"10:15AM","days":"MWF"},{"bldg":"Cornell Golf Center","room":"Cornell Golf Center 101","type":"LEC","typeLong":"Lecture","time":"11:30AM","days":"MWF"},{"bldg":"Cornell Golf Center","room":"Cornell Golf Center 101","type":"LEC","typeLong":"Lecture","time":"01:00PM","days":"MWF"}]},{"code":"PE 1321","title":"Advanced Golf","name":"PE 1321: Advanced Golf","desc":"Students must be experienced\xa0golfers\xa0(i.e. they MUST have golf playing experience on a course) and have their own set of clubs. Students who do not have the appropriate skills will be removed from the course and will not receive a refund.\xa0 The objective is to give advanced players instruction and practice to improve golfing skills.\xa0\xa0","locations":[{"bldg":"Cornell Golf Center","room":"Cornell Golf Center 101","type":"LEC","typeLong":"Lecture","time":"02:15PM","days":"MWF"}]},{"code":"PE 1340","title":"Juggling","name":"PE 1340: Juggling","desc":"The class focuses on teaching 3 ball juggling patterns as well as introducing a wide variety of other props which may include: rings, clubs, diabolo, flower sticks, poi, and spinning plates. Advanced students will also be able to learn club passing, 4 and 5 balls and advance tricks. Instruction will be given both as a group and on an individual basis. The course fee includes 3 high quality juggling balls of your own for class and future practice!","locations":[{"bldg":"Noyes Community and Rec Center","room":"Noyes Community and Rec G06","type":"LEC","typeLong":"Lecture","time":"08:45PM","days":"MW"},{"bldg":"Noyes Community and Rec Center","room":"Noyes Community and Rec G06","type":"LEC","typeLong":"Lecture","time":"09:45AM","days":"MW"}]},{"code":"PE 1345","title":"Introduction to Boxing","name":"PE 1345: Introduction to Boxing","desc":"One of the oldest forms of competition known, boxing has become the sport of choice for many people. Boxing\'s simplistic method has few techniques, yet the application of these techniques is the true art and science of the sport. Kevin Seaman has over 30 years of experience as a boxing participant, trainer and coach. He has coached dozens of competitors, several Golden Gloves champions and hundreds of enthusiasts in this ring sport. His proven training methods are sure to improve and develop your defensive and offensive skills, cardiovascular endurance, footwork, agility, speed, timing and power. Training will include shadow boxing, jump rope, two person drills, focus glove and heavy bag work. Learn the fundamentals of one of the world\'s most popular sports.","locations":[{"bldg":"Bartels Hall","room":"Bartels Hall 101","type":"LEC","typeLong":"Lecture","time":"09:00AM","days":"T"},{"bldg":"Bartels Hall","room":"Bartels Hall 101","type":"LEC","typeLong":"Lecture","time":"09:00AM","days":"R"},{"bldg":"Bartels Hall","room":"Bartels Hall 101","type":"LEC","typeLong":"Lecture","time":"10:45AM","days":"R"}]},{"code":"PE 1346","title":"Intermediate Boxing","name":"PE 1346: Intermediate Boxing","desc":"Covers the basic skills of footwork, defensive, and offensive techniques. Skipping rope, shadow boxing, and heavy bag work are taught as methods for individual aerobic conditioning.","locations":[{"bldg":"Bartels Hall","room":"Bartels Hall 101","type":"LEC","typeLong":"Lecture","time":"10:45AM","days":"T"}]},{"code":"PE 1347","title":"Brazilian Jiu Jitsu Fundamentals","name":"PE 1347: Brazilian Jiu Jitsu Fundamentals","desc":"Brazilian Jiu Jitsu, known as BJJ was developed by Helio Gracie, and continues to develop as one of the most popular forms of grappling in the world today. This class focuses on learning and applying fundamental techniques of Brazilian Jiu Jitsu. Students practice various techniques using a traditional GI/kimono. Students will learn and practice positioning, escapes, submissions, and self-defense. The fundamentals class is directed not only for the beginner but also for students who would like to sharpen basic techniques.","locations":[{"bldg":"Bartels Hall","room":"Bartels Hall 101","type":"LEC","typeLong":"Lecture","time":"09:00AM","days":"W"},{"bldg":"Bartels Hall","room":"Bartels Hall 101","type":"LEC","typeLong":"Lecture","time":"10:45AM","days":"W"}]},{"code":"PE 1350","title":"HIIT Boxing","name":"PE 1350: HIIT Boxing","desc":"Burn a ton of calories, get stronger, and punch out your stress! Learn how to move with power and confidence. Not only do participants get a fitness/cardio workout, they also learn to use real kickboxing techniques on a heavy bag. Kickboxing will help you build a great body, power, confidence, and self defense skills!","locations":[{"bldg":"Teagle Hall","room":"Teagle Hall 210","type":"LEC","typeLong":"Lecture","time":"04:00PM","days":"TR"},{"bldg":"Teagle Hall","room":"Teagle Hall 210","type":"LEC","typeLong":"Lecture","time":"05:10PM","days":"TR"}]},{"code":"PE 1365","title":"Karate Basics","name":"PE 1365: Karate Basics","desc":"This class is meant for those that want to start studying Karate or have not studied in a while.\xa0 Students learn about traditional Okinawan Karate (Shito Ryu) by practicing self-defense combinations that involve blocks, strikes, kicks, joint locks and throws.\xa0 Along the way we will work on stances, body positioning/mechanics and conditioning.\xa0 There is strong emphasis on partner work as a mechanism to practice what is being taught in a safe and controlled environment.\xa0 Free sparring and competition are not\xa0part of this class.\xa0 The last day of class students are encouraged to participate in that semester\'s belt test.\xa0 Passing this test sets you up to continue studying with the next class, should you decide to continue your studies of Karate.","locations":[{"bldg":"Teagle Hall","room":"Teagle Hall 201","type":"LEC","typeLong":"Lecture","time":"07:00PM","days":"MW"}]},{"code":"PE 1366","title":"Karate","name":"PE 1366: Karate","desc":"This class is meant for those that have recently studied Karate at Cornell or somewhere else and wish to continue their study of Karate.\xa0 Primary instruction is in the Shito Ryu style.\xa0 Every semester a different kata is presented along with the applicable self-defense techniques associated with that kata and there is an opportunity to test for a new rank/belt. \xa0Bo staff is used as part of one kata in the curriculum.","locations":[{"bldg":"Teagle Hall","room":"Teagle Hall 201","type":"LEC","typeLong":"Lecture","time":"07:45PM","days":"MW"}]},{"code":"PE 1371","title":"Okinawan Karate-do","name":"PE 1371: Okinawan Karate-do","desc":"Explosive strikes, strong stances, and controlled footwork make Okinawan Karate-do an effective form of self-defense for men and women of all ages and body types. The physical practice of Okinawan Karate-do is an excellent pathway to increased fitness and improved holistic health. Practiced as a traditional martial art, Okinawan Karate-do facilitates personal development and greater well-being.","locations":[{"bldg":"Teagle Hall","room":"Teagle Hall 210","type":"LEC","typeLong":"Lecture","time":"01:00PM","days":"MW"}]},{"code":"PE 1375","title":"Beginning Tae Kwon Do","name":"PE 1375: Beginning Tae Kwon Do","desc":"C.W. (Cho Whang) TaeKwonDo of Ithaca conducts the course. The purpose of the program is to teach TaeKwonDo in its diverse aspects as a form of self-defense, as an art form, and as a competitive sport. Classes will consist of extensive stretching, the teaching of basics to beginners, forms of self-defense, and sparring techniques. TaeKwonDo emphasizes the use of the whole body, enhances flexibility and coordination and increases aerobic capability. Promotional tests are held at the end of each semester. Han Cho may be reached at 257-7810.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"03:30PM","days":"T"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"03:30PM","days":"R"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"03:30PM","days":"F"}]},{"code":"PE 1376","title":"Intermediate Tae Kwon Do","name":"PE 1376: Intermediate Tae Kwon Do","desc":"C.W. (Cho Whang) TaeKwonDo of Ithaca conducts the course. At least one semester of PE TaeKwonDo or equivalent is required.\xa0 The purpose of the program is to teach TaeKwonDo in its diverse aspects as a form of self-defense, as an art form, and as a competitive sport. Classes will consist of extensive stretching, the teaching of basics to beginners, forms of self-defense, and sparring techniques. TaeKwonDo emphasizes the use of the whole body, enhances flexibility and coordination and increases aerobic capability. Promotional tests are held at the end of each semester. Han Cho may be reached at 257-7810.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 235","type":"LEC","typeLong":"Lecture","time":"05:00PM","days":"T"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 235","type":"LEC","typeLong":"Lecture","time":"05:00PM","days":"R"}]},{"code":"PE 1380","title":"Tai Chi Chuan","name":"PE 1380: Tai Chi Chuan","desc":"Fundamentally, Tai Chi is an integrative exercise that joins the various elements of functional fitness into a single, organically connected whole. Through a rich vocabulary of movements that enhance spatial and body awareness, Tai Chi provides a medium for harmonizing balance, coordination, flexibility, and supple strength. This course will consist of warm-ups, stretching, an introduction to the 24 Movement Form, and 2 person interactive exercises. Please loose, comfortable clothing. Students must be in bare or sock feet during class.","locations":[{"bldg":"Barton Hall","room":"Barton Hall 100-Gym Floor","type":"LEC","typeLong":"Lecture","time":"12:45PM","days":"M"},{"bldg":"Barton Hall","room":"Barton Hall 100-Gym Floor","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"M"}]},{"code":"PE 1385","title":"Thai Boxing","name":"PE 1385: Thai Boxing","desc":"This martial art system, developed from the unique culture of Thailand, is a blend of art, science and sport. The Thai art is a very powerful ring fighting method, yet is also an excellent form of physical conditioning and street self-defense. The fighting techniques taught in Thai boxing include; the Western Boxing method, elbow -knee strikes, and the powerful Thai style of kicking. This combined with the unique training method and discipline makes Thai Boxing one of the most effective systems in the world. Kevin Seaman is the New York State Representative for the Thai Boxing Association USA.","locations":[{"bldg":"Bartels Hall","room":"Bartels Hall 101","type":"LEC","typeLong":"Lecture","time":"12:30PM","days":"W"}]},{"code":"PE 1396","title":"Filipino Kali","name":"PE 1396: Filipino Kali","desc":"This is an eclectic form of Filipino stick fighting and self defense that evolved as a means of preservation in the hostile environment of the Jungles of the Philippines. Having roots in the 9th century, this is one martial art that truly equalizes your chances of survival in even the most dangerous circumstances, yet is also an amazing method of increasing your coordination and fitness, keeping both your mind and your body SHARP! Kali/Escrima addresses empty hand and kicking, grappling, and tools of the jungle warrior. Kevin Seaman has studied with many of the leading exponents of this amazing Martial Art for nearly 30 years. His skill in this art made him a regional, National and World Champion, competing Full Contact in Asia\xa0in 1992.","locations":[{"bldg":"Bartels Hall","room":"Bartels Hall 101","type":"LEC","typeLong":"Lecture","time":"12:30PM","days":"T"}]},{"code":"PE 1405","title":"Living Routines","name":"PE 1405: Living Routines","desc":"Once a week you will participate in a health routine. After a short brisk walk, (inside in poor weather) you will engage in an energizing stretching session, followed by a short meditation. In addition to being introduced to stretching and meditation, the class will offer you the opportunity to get to know your classmates through partnered self-awareness exercises and group sharing.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B16","type":"LEC","typeLong":"Lecture","time":"05:00PM","days":"M"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B16","type":"LEC","typeLong":"Lecture","time":"05:00PM","days":"R"}]},{"code":"PE 1420","title":"Introduction to Meditation","name":"PE 1420: Introduction to Meditation","desc":"This course provides the opportunity to explore a variety of ancient and modern methods designed to bring one to the state of meditation. The methods serve to evoke the deep relaxation from which heightened awareness and creativity arise. If these classes do not fit your schedule, try Body-Mind, Living Routines or Moving into the Moment which have meditation in them.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B16","type":"LEC","typeLong":"Lecture","time":"01:30PM","days":"TR"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall B16","type":"LEC","typeLong":"Lecture","time":"11:30AM","days":"W"}]},{"code":"PE 1421","title":"Relaxation and Stress Management","name":"PE 1421: Relaxation and Stress Management","desc":"This course offers a mind/body approach to gaining realization and managing the stress in our lives. Participants will leave this course with a greater understanding and appreciation of their own unique ways of coping with stressful situations. We will explore a variety of techniques which can be used to ease the pressures of student life. A sample of these activities includes; stretching (Yoga), creative art, conversation, new games and meditation.","locations":[{"bldg":"Noyes Community and Rec Center","room":"Noyes Community and Rec G06","type":"LEC","typeLong":"Lecture","time":"10:20AM","days":"R"}]},{"code":"PE 1422","title":"Meditation and Relaxation","name":"PE 1422: Meditation and Relaxation","desc":"This course is designed to assist you in learning to meditate, or to deepen your existing practice. As you learn to practice meditation and relaxation exercises, you will find that as little as 15 minutes a day can benefit your physical, mental, emotional and spiritual health. With some assistance, we are all capable of learning to relax deeply, sleep better, detach from the mind\'s chatter, focus with renewed concentration and become aware of the joy and energy that is deep within us. If these classes do not fit your schedule, try Body-Mind or Living Routines which both have meditation in them.","locations":[{"bldg":"Teagle Hall","room":"Teagle Hall 138","type":"LEC","typeLong":"Lecture","time":"04:00PM","days":"T"},{"bldg":"Teagle Hall","room":"Teagle Hall 138","type":"LEC","typeLong":"Lecture","time":"08:30AM","days":"F"}]},{"code":"PE 1424","title":"Yoga Trapeze","name":"PE 1424: Yoga Trapeze","desc":"Yoga Trapeze combines the traditional yoga practice with TRX strength training as well as the fun and physical benefits of inversion therapy. Hanging upside down can relieve tension\xa0and compression in the neck and spine, while other hanging postures develop grip and pull strength in the hands and shoulders. Other full-body exercises will not only build strength, but will be a great way to advance their yoga practice of backbends, arm balances, and inversions. This course combines strength-building, flexibility, stress-reduction, and fun all in one!","locations":[{"bldg":"Noyes Community and Rec Center","room":"Noyes Community and Rec G06","type":"LEC","typeLong":"Lecture","time":"10:30AM","days":"F"}]},{"code":"PE 1427","title":"Ashtanga Yoga Foundations","name":"PE 1427: Ashtanga Yoga Foundations","desc":"This beginner\'s class will introduce Ashtanga Yoga to the new student. With asanas (poses) from the Primary Series we will focus on using the breath, core engagement, and gaze point to begin your own home-based practice. We will also introduce breath work and meditation. Leave the class feeling energized, refreshed, and strong.\xa0","locations":[{"bldg":"Teagle Hall","room":"Teagle Hall 210","type":"LEC","typeLong":"Lecture","time":"12:00PM","days":"F"}]},{"code":"PE 1429","title":"Vinyasa Yoga","name":"PE 1429: Vinyasa Yoga","desc":"This course teaches the practice of Vinyasa Yoga. It explores postures flowing from one to the next (breath to movement) and also includes study of philosophy, meditation, breath-work, and alignment.\xa0","locations":[{"bldg":"Teagle Hall","room":"Teagle Hall 138","type":"LEC","typeLong":"Lecture","time":"09:00AM","days":"M"},{"bldg":"Teagle Hall","room":"Teagle Hall 210","type":"LEC","typeLong":"Lecture","time":"12:00PM","days":"T"},{"bldg":"Teagle Hall","room":"Teagle Hall 210","type":"LEC","typeLong":"Lecture","time":"01:45PM","days":"T"}]},{"code":"PE 1430","title":"Introduction to Yoga","name":"PE 1430: Introduction to Yoga","desc":"Learn the alignment foundations of yoga while building strength, flexibility, and vitality! This class is for those who are new to yoga or those looking to fine tune their practice. Students will learn the \\"ins and outs\\" of a variety of standing poses, back bends, and maybe even a few inversions or arm balances! Modifications will be given to accommodate all levels. Each class will also include breath instruction and poses for stress reduction. ","locations":[{"bldg":"Noyes Community and Rec Center","room":"Noyes Community and Rec G06","type":"LEC","typeLong":"Lecture","time":"11:45AM","days":"MW"},{"bldg":"Noyes Community and Rec Center","room":"Noyes Community and Rec G06","type":"LEC","typeLong":"Lecture","time":"08:00AM","days":"TR"},{"bldg":"Noyes Community and Rec Center","room":"Noyes Community and Rec G06","type":"LEC","typeLong":"Lecture","time":"09:10AM","days":"TR"},{"bldg":"Noyes Community and Rec Center","room":"Noyes Community and Rec G06","type":"LEC","typeLong":"Lecture","time":"02:00PM","days":"R"},{"bldg":"Noyes Community and Rec Center","room":"Noyes Community and Rec G06","type":"LEC","typeLong":"Lecture","time":"01:00PM","days":"M"}]},{"code":"PE 1431","title":"Intermediate Yoga","name":"PE 1431: Intermediate Yoga","desc":"The course covers more of the fundamentals of Hatha Yoga, including basic postures, breathing techniques, and deep relaxation and chanting techniques.","locations":[{"bldg":"Noyes Community and Rec Center","room":"Noyes Community and Rec G06","type":"LEC","typeLong":"Lecture","time":"01:00PM","days":"W"},{"bldg":"Teagle Hall","room":"Teagle Hall 210","type":"LEC","typeLong":"Lecture","time":"10:00AM","days":"W"}]},{"code":"PE 1439","title":"HIIT Yoga","name":"PE 1439: HIIT Yoga","desc":"HIIT yoga is a great way to get your heart rate up, burn calories, and have a mind-body connection. This 90 minutes course will have 60 minutes of HIIT and 30 minutes of yoga.\xa0","locations":[{"bldg":"Appel","room":"Appel 101 Fitness Center","type":"LEC","typeLong":"Lecture","time":"11:45AM","days":"MW"}]},{"code":"PE 1440","title":"Introduction to Badminton","name":"PE 1440: Introduction to Badminton","desc":"Instruction and practice in the basic skills and rules for both singles and doubles play.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 235","type":"LEC","typeLong":"Lecture","time":"09:15AM","days":"TR"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 235","type":"LEC","typeLong":"Lecture","time":"10:30AM","days":"TR"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 235","type":"LEC","typeLong":"Lecture","time":"12:00PM","days":"TR"}]},{"code":"PE 1441","title":"Intermediate Badminton","name":"PE 1441: Intermediate Badminton","desc":"Should have past experience in badminton. Strategies are taught for both singles and doubles play.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 235","type":"LEC","typeLong":"Lecture","time":"01:15PM","days":"TR"}]},{"code":"PE 1445","title":"Outdoor Beginning Tennis","name":"PE 1445: Outdoor Beginning Tennis","desc":"Instruction and practice in the basic skills of the game. Grip, serve, forehand, backhand, and lob are areas covered along with scoring systems. All equipment is furnished.","locations":[{"bldg":"Barbara McClintock Hall","room":"McClintock Tennis Court","type":"LEC","typeLong":"Lecture","time":"09:00AM","days":"MWF"},{"bldg":"Barbara McClintock Hall","room":"McClintock Tennis Court","type":"LEC","typeLong":"Lecture","time":"10:15AM","days":"MWF"},{"bldg":"Barbara McClintock Hall","room":"McClintock Tennis Court","type":"LEC","typeLong":"Lecture","time":"04:00PM","days":"MWF"},{"bldg":"Barbara McClintock Hall","room":"McClintock Tennis Court","type":"LEC","typeLong":"Lecture","time":"08:30AM","days":"TR"},{"bldg":"Barbara McClintock Hall","room":"McClintock Tennis Court","type":"LEC","typeLong":"Lecture","time":"10:15AM","days":"TR"}]},{"code":"PE 1446","title":"Outdoor Intermediate Tennis","name":"PE 1446: Outdoor Intermediate Tennis","desc":"Review and further instruction in strokes: forehand, backhand, serve, volley, and lob. Topspin and underspin are covered along with doubles strategy. All equipment is furnished.","locations":[{"bldg":"Barbara McClintock Hall","room":"McClintock Tennis Court","type":"LEC","typeLong":"Lecture","time":"11:30AM","days":"MWF"},{"bldg":"Barbara McClintock Hall","room":"McClintock Tennis Court","type":"LEC","typeLong":"Lecture","time":"02:45PM","days":"MWF"},{"bldg":"Barbara McClintock Hall","room":"McClintock Tennis Court","type":"LEC","typeLong":"Lecture","time":"12:15PM","days":"TR"},{"bldg":"Barbara McClintock Hall","room":"McClintock Tennis Court","type":"LEC","typeLong":"Lecture","time":"04:00PM","days":"TR"}]},{"code":"PE 1447","title":"Outdoor Advanced Tennis","name":"PE 1447: Outdoor Advanced Tennis","desc":"For players with high school team or tournament experience. Skills emphasized are spins, serve and return of serve, volley, overhead smash, court positioning, and playing strategies. Class will meet twice a week for 1 1/2 hours.","locations":[{"bldg":"Barbara McClintock Hall","room":"McClintock Tennis Court","type":"LEC","typeLong":"Lecture","time":"01:00PM","days":"MWF"},{"bldg":"Barbara McClintock Hall","room":"McClintock Tennis Court","type":"LEC","typeLong":"Lecture","time":"02:00PM","days":"TR"}]},{"code":"PE 1448","title":"Pickleball","name":"PE 1448: Pickleball","desc":"Pickleball is fun, social and friendly sport that combines elements of tennis, badminton and ping-pong. It can be played both indoors and outdoors on a badminton-sized court and a slightly modified tennis net. The rules are simple and the game is easy for beginners to learn, but can develop into a fast-paced, competitive game. Class includes equipment, instruction and practice in the basic skills and rules for both singles and doubles play.\xa0","locations":[{"bldg":"Risley Tennis Court","room":"Risley Tennis Court","type":"LEC","typeLong":"Lecture","time":"11:30AM","days":"MW"}]},{"code":"PE 1465","title":"Introduction to Squash","name":"PE 1465: Introduction to Squash","desc":"A beginner\'s course where rules of the game, basic strokes and strategies are taught. This class will also provide students with an invigorating cardio workout which may necessitate a shower following class. Please note: a pair of non-marking court shoes will be needed. All other equipment is provided, including safety glasses that are required to be worn at all times.","locations":[{"bldg":"Grumman Squash Courts","room":"Grumman Squash Courts B08","type":"LEC","typeLong":"Lecture","time":"01:00PM","days":"MW"},{"bldg":"Grumman Squash Courts","room":"Grumman Squash Courts B08","type":"LEC","typeLong":"Lecture","time":"02:15PM","days":"MW"},{"bldg":"Grumman Squash Courts","room":"Grumman Squash Courts B08","type":"LEC","typeLong":"Lecture","time":"03:30PM","days":"MW"}]},{"code":"PE 1466","title":"Intermediate Squash","name":"PE 1466: Intermediate Squash","desc":"More advanced techniques than beginning squash.\xa0This class will also provide students with an invigorating cardio workout which may necessitate a shower following class. Please note: a pair of non-marking court shoes will be needed. All other equipment is provided, including safety glasses that are required to be worn at all times.","locations":[{"bldg":"Grumman Squash Courts","room":"Grumman Squash Courts B08","type":"LEC","typeLong":"Lecture","time":"11:45AM","days":"MW"},{"bldg":"Grumman Squash Courts","room":"Grumman Squash Courts B08","type":"LEC","typeLong":"Lecture","time":"01:20PM","days":"TR"}]},{"code":"PE 1482","title":"Basic Keelboat Sailing","name":"PE 1482: Basic Keelboat Sailing","desc":"This course teaches the basic skills necessary to sail 18 - 26 foot keelboats. Skills learned include: sailing terminology, knots, safety and etiquette, boat handling, sail trimming and heavy wind considerations. There are a total of eighteen hours of instruction on shore or Cayuga Lake depending on weather. Course fee includes all equipment. Come dressed for the weather, as we will sail rain or shine. Open to sailors of all skill levels.","locations":[{"bldg":"Merrill Family Sailing Center","room":"Merrill Family Sailing Ctr 103","type":"LEC","typeLong":"Lecture","time":"02:00PM","days":"W"},{"bldg":"Merrill Family Sailing Center","room":"Merrill Family Sailing Ctr 103","type":"LEC","typeLong":"Lecture","time":"02:00PM","days":"R"},{"bldg":"Merrill Family Sailing Center","room":"Merrill Family Sailing Ctr 103","type":"LEC","typeLong":"Lecture","time":"02:00PM","days":"F"},{"bldg":"Merrill Family Sailing Center","room":"Merrill Family Sailing Ctr 103","type":"LEC","typeLong":"Lecture","time":"10:00AM","days":"S"},{"bldg":"Merrill Family Sailing Center","room":"Merrill Family Sailing Ctr 103","type":"LEC","typeLong":"Lecture","time":"02:00PM","days":"S"},{"bldg":"Merrill Family Sailing Center","room":"Merrill Family Sailing Ctr 103","type":"LEC","typeLong":"Lecture","time":"10:00AM","days":"Su"},{"bldg":"Merrill Family Sailing Center","room":"Merrill Family Sailing Ctr 103","type":"LEC","typeLong":"Lecture","time":"02:00PM","days":"Su"}]},{"code":"PE 1520","title":"Introduction to Archery","name":"PE 1520: Introduction to Archery","desc":"Archery has a long tradition across many cultures and is a competitive sport all over the world. This class offers exposure to archery theory and shooting technique, emphasizing safe range practices, proper equipment setup, and practice shooting. Class meets once a week. Attendance for first two classes is mandatory for safety reasons. If these classes are missed, the student can no longer continue to attend and will be responsible for dropping themselves from the course.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 235","type":"LEC","typeLong":"Lecture","time":"02:30PM","days":"T"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 235","type":"LEC","typeLong":"Lecture","time":"10:00AM","days":"F"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 235","type":"LEC","typeLong":"Lecture","time":"11:45AM","days":"F"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 235","type":"LEC","typeLong":"Lecture","time":"04:15PM","days":"T"}]},{"code":"PE 1527","title":"Fencing","name":"PE 1527: Fencing","desc":"This course is a modern type of fencing that belongs to the family of combat sports using bladed weapons and refers to the fencing seen in most current competitions, including the Olympic Games and the World Cup. Originating in the 19th century, as a direct continuation of the 18th century French school of fencing which had in turn been influenced by the Italian school of the Renaissance. Includes warm-up exercises and all basic offensive and defensive moves.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"12:00PM","days":"MW"},{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 230","type":"LEC","typeLong":"Lecture","time":"01:15PM","days":"MW"}]},{"code":"PE 1540","title":"Introduction to Skating","name":"PE 1540: Introduction to Skating","desc":"For the novice. Course will cover basic skills of forward and backward skating, turns and stops.","locations":[{"bldg":"Lynah Rink","room":"Lynah Rink G19","type":"LEC","typeLong":"Lecture","time":"01:30PM","days":"MW"}]},{"code":"PE 1545","title":"Beginning Figure Skating","name":"PE 1545: Beginning Figure Skating","desc":"No previous instruction necessary. For the beginning skater or skater with no previous formal instruction. Students will learn basic forward and backward skating skills, including stopping and turning, while also covering skate safety, proper fitting, and body mechanics of skating. An assessment will be done the first day of class and students grouped accordingly.\\nSkate rental available for $2.00 per session.","locations":[{"bldg":"Lynah Rink","room":"Lynah Rink G19","type":"LEC","typeLong":"Lecture","time":"02:45PM","days":"MW"},{"bldg":"Lynah Rink","room":"Lynah Rink G19","type":"LEC","typeLong":"Lecture","time":"08:30AM","days":"MW"}]},{"code":"PE 1546","title":"Intermediate Figure Skating","name":"PE 1546: Intermediate Figure Skating","desc":"Students in this class should have\xa0previous experience (ability to skate forward and backward and safely stop). The course will review the skills taught in the PE1545 and PE1540, as a foundation, and move into learning more advanced turns, stops, and basic jumps and spins.\xa0Course will also cover skate safety, proper fitting, and body mechanics of skating. An assessment will be done the first day of class and students grouped accordingly.","locations":[{"bldg":"Lynah Rink","room":"Lynah Rink G19","type":"LEC","typeLong":"Lecture","time":"11:00AM","days":"MW"}]},{"code":"PE 1547","title":"Advanced Figure Skating","name":"PE 1547: Advanced Figure Skating","desc":"This course is for the advanced figure skater. Permission of instructor if haven\'t previously taken PE1546 or PE1547 in 2021-2022. Skaters will be learning advanced skills including jumps, spins, turns, edge moves, step sequences, and ice dance patterns. Students will be working independently on ice at times, as well as, group instruction, TBD by instructor based on level of participants enrolled.","locations":[{"bldg":"Lynah Rink","room":"Lynah Rink G19","type":"LEC","typeLong":"Lecture","time":"11:00AM","days":"MW"}]},{"code":"PE 1550","title":"Introduction to Ice Hockey","name":"PE 1550: Introduction to Ice Hockey","desc":"Organized on a team practice basis. Skills to be taught include: skating, stick handling, shooting, passing, personal and team strategy and scrimmaging. Skates and hockey sticks must be supplied by the participants. All other necessary equipment will be supplied by the Physical Education Department.","locations":[{"bldg":"Lynah Rink","room":"Lynah Rink G19","type":"LEC","typeLong":"Lecture","time":"09:00AM","days":"T"}]},{"code":"PE 1551","title":"Intermediate Ice Hockey","name":"PE 1551: Intermediate Ice Hockey","desc":"This course is designed for the intermediate hockey player. Advanced techniques taught include positioning, power play, penalty killing, and offensive and defensive attack. Each session emphasizes game situations and scrimmaging.","locations":[{"bldg":"Lynah Rink","room":"Lynah Rink G19","type":"LEC","typeLong":"Lecture","time":"01:00PM","days":"T"}]},{"code":"PE 1560","title":"Basketball","name":"PE 1560: Basketball","desc":"Fundamentals of passing, dribbling and shooting are stressed. Offensive and defensive patterns are taught. Intra-class team competition is a part of the course. It is recommended that students wear high-top basketball shoes and not\xa0running shoes for the class due to the risk of ankle injuries.","locations":[{"bldg":"Barton Hall","room":"Barton Hall 100-Gym Floor","type":"LEC","typeLong":"Lecture","time":"11:00AM","days":"MW"}]},{"code":"PE 1561","title":"Advanced Basketball","name":"PE 1561: Advanced Basketball","desc":"Advanced fundamentals of passing, dribbling, shooting, and offensive/defensive patterns are taught. Intra-class team competition is a part of the course. It is recommended that students wear high-top basketball shoes and not\xa0running shoes for the class due to the risk of ankle injuries.","locations":[{"bldg":"Barton Hall","room":"Barton Hall 100-Gym Floor","type":"LEC","typeLong":"Lecture","time":"11:15AM","days":"MW"}]},{"code":"PE 1580","title":"Principles of Weight Training","name":"PE 1580: Principles of Weight Training","desc":"A comprehensive understanding of weight training and its place in the world of fitness. Topics to be covered include: selectorized equipment, free weight exercises, isometrics, circuit training, toning, stretching, strength development, and program design based on goal setting.","locations":[{"bldg":"Appel","room":"Appel 101 Fitness Center","type":"LEC","typeLong":"Lecture","time":"08:00AM","days":"MW"},{"bldg":"Appel","room":"Appel 101 Fitness Center","type":"LEC","typeLong":"Lecture","time":"09:00AM","days":"TR"}]},{"code":"PE 1581","title":"Weight Training for Women","name":"PE 1581: Weight Training for Women","desc":"This class will focus on the basics of weight lifting. Topics covered will include: toning vs. building, theory of program design, training with dumbbells, selectorized equipment, free weight exercises for all muscle groups, flexibility, and proper nutrition for weight training.","locations":[{"bldg":"Teagle Hall","room":"Teagle Hall 145","type":"LEC","typeLong":"Lecture","time":"09:00AM","days":"MW"}]},{"code":"PE 1582","title":"Advanced Weight Training","name":"PE 1582: Advanced Weight Training","desc":"The primary focus of this course will be learning and practicing the Olympic lifts (the snatch, clean and jerk and related exercises). We will study these lifts in detail while working on building the strength and flexibility necessary for their proper performance. Additional topics will be determined based on the interests of the class. Possible topics might include: advanced programming for strength training, kettlebell training, training for sport performance, advanced muscle-building strategies and splits.","locations":[{"bldg":"Toni Morrison Hall","room":"Toni Morrison Hall B04","type":"LEC","typeLong":"Lecture","time":"10:15AM","days":"TR"}]},{"code":"PE 1674","title":"Introduction to Sea Kayaking","name":"PE 1674: Introduction to Sea Kayaking","desc":"Learn the basics to get you started with sea kayaking out on the lake. This course covers information about equipment, loading, launching &amp; landing your kayak, exiting and re-entering your kayak in open water, and basic paddling stroke technique. Practice skills in the pool, spend a day paddling out on the lake and participate in a weekend camping trip where you paddle out to a primitive campsite carrying all of you gear in your kayak.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 201","type":"LEC","typeLong":"Lecture","time":"07:00PM","days":"T"},{"bldg":"Bartels Hall","room":"Bartels Hall B01","type":"LEC","typeLong":"Lecture","time":"04:45PM","days":"TR"}]},{"code":"PE 1680","title":"Pool Paddling","name":"PE 1680: Pool Paddling","desc":"Learn the fundamentals of kayaking in the controlled environment of the pool. This course will give you a solid progression of skills that will be easily transferable to an open water or river experience. Learn and practice a wide range of skills in whitewater kayaks including fundamental paddling strokes, bracing, rolling and boat handling skills like edging and carving. Paddling games and focused exercises will provide a fun and interactive group learning experience.","locations":[{"bldg":"Helen Newman Hall","room":"Helen Newman Hall 201","type":"LEC","typeLong":"Lecture","time":"07:00PM","days":"T"}]},{"code":"PHIL 6010","title":"Greek Philosophical Texts","name":"PHIL 6010: Greek Philosophical Texts","desc":"Reading and translation of Greek Philosophical texts.","locations":[{"bldg":"Goldwin Smith Hall","room":"Goldwin Smith Hall 327","type":"SEM","typeLong":"Seminar","time":"12:20PM","days":"F"}]},{"code":"PHIL 6020","title":"Latin Philosophical Texts","name":"PHIL 6020: Latin Philosophical Texts","desc":"Reading and translation of Latin philosophical texts.","locations":[{"bldg":"Hans Bethe House","room":"Hans Bethe House 125","type":"SEM","typeLong":"Seminar","time":"07:30PM","days":"T"}]},{"code":"PHIL 6417","title":"Moral Foundations of Anti-Discrimination","name":"PHIL 6417: Moral Foundations of Anti-Discrimination","desc":"What makes discrimination wrongful, when it is? Does its wrongness depend on social context and historical background? Does it depend on harmful consequences? What makes a certain ground of discrimination an improper ground? Is indirect discrimination (\\"disparate impact\\") really a form of discrimination or perhaps a mild form of affirmative action? What should be the reach and scope of anti-discrimination law? Should it allow for exemptions on religious or free speech grounds? We will address these and similar questions at a fairly abstract level, trying to understand the philosophical principles that might explain the various aspects of anti-discrimination law. Most of the legal examples will be focused on discrimination cases in the context of employment and service provision (Title VII), \xa0but we will also consider racial profiling, disability cases, and some others.\xa0","locations":[{"bldg":"Myron Taylor Hall","room":"Myron Taylor Hall G81","type":"SEM","typeLong":"Seminar","time":"02:30PM","days":"W"}]},{"code":"PLSCS 4440","title":"Integrated Pest Management","name":"PLSCS 4440: Integrated Pest Management","desc":"Lectures integrate the principles of pest control, ecology, and economics in the management of pests across multiple systems. Labs consist of exercises to reinforce concepts presented in lecture and demonstrate pest monitoring techniques and the application of computer technology to management problems.","locations":[{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B146","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"}]},{"code":"PLSCS 5440","title":"Integrated Pest Management","name":"PLSCS 5440: Integrated Pest Management","desc":"Lectures integrate the principles of pest control, ecology, and economics in the management of pests across multiple systems. Labs consist of exercises to reinforce concepts presented in lecture and demonstrate pest monitoring techniques and the application of computer technology to management problems.","locations":[{"bldg":"Comstock Hall-Academic II","room":"Comstock Hall-Academic II B146","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"T"}]},{"code":"PUBPOL 3270","title":"Constitutional Law: An Introduction","name":"PUBPOL 3270: Constitutional Law: An Introduction","desc":"In this course, we will examine one of the most important documents in American history \u2013 our Constitution. \xa0Course topics will include the historical background of the document from the Magna Carta to the Declaration of Independence and the Articles of Confederation. \xa0We will look at the creation of the Constitution, including the conflict between strong supporters of this proposed new Constitution (Federalists) and their opponents (Anti-Federalists). How did the Founders resolve their differences and what led the States to adopt a document limiting and balancing the powers of the President, Congress, and the Judiciary? We shall look at the constant tension (from the beginning to the present) over the balance of power between the three co-equal branches. \xa0We shall discuss the role of the Constitution from both empirical and theoretical perspectives and look at how it has evolved from 1788 to the present day. Special attention will be paid to the use of Amendments, particularly the Bill of Rights, to address events/circumstances unforeseen by the drafters. \xa0Finally, the course will discuss critical cases where the Supreme Court defined and redefined what the Constitution meant.","locations":[{"bldg":"Wolpe Center","room":"Wolpe Center 118","type":"LEC","typeLong":"Lecture","time":"09:30AM","days":"R"}]},{"code":"PUBPOL 4280","title":"The Economics of Risky Health Behaviors","name":"PUBPOL 4280: The Economics of Risky Health Behaviors","desc":"Risky health behaviors such as cigarette smoking, alcohol abuse, risky sex, drug use, poor diet and physical inactivity (leading to obesity), and self-harm are responsible for hundreds of thousands of preventable deaths and impose billions of dollars in medical care costs each year in the United States. This course teaches the economic approach to studying risky health behaviors. The research literature on the economic causes and correlates of risky health behaviors will be studied in detail. Numerous policies to modify risky health behaviors, such as the minimum legal drinking age and recreational marijuana use laws, will be debated in class. A policy wargame is conducted, with students creating advertisements, giving oral presentations, and lobbying policymakers to advocate a specific policy position.\\n\xa0","locations":[{"bldg":"Wolpe Center","room":"Wolpe Center 118","type":"LEC","typeLong":"Lecture","time":"06:30PM","days":"W"}]},{"code":"PUBPOL 5270","title":"Constitutional Law: An Introduction","name":"PUBPOL 5270: Constitutional Law: An Introduction","desc":"In this course, we will examine one of the most important documents in American history \u2013 our Constitution. \xa0Course topics will include the historical background of the document from the Magna Carta to the Declaration of Independence and the Articles of Confederation. \xa0We will look at the creation of the Constitution, including the conflict between strong supporters of this proposed new Constitution (Federalists) and their opponents (Anti-Federalists). How did the Founders resolve their differences and what led the States to adopt a document limiting and balancing the powers of the President, Congress, and the Judiciary? We shall look at the constant tension (from the beginning to the present) over the balance of power between the three co-equal branches. \xa0We shall discuss the role of the Constitution from both empirical and theoretical perspectives and look at how it has evolved from 1788 to the present day. Special attention will be paid to the use of Amendments, particularly the Bill of Rights, to address events/circumstances unforeseen by the drafters. \xa0Finally, the course will discuss critical cases where the Supreme Court defined and redefined what the Constitution meant.\\n\xa0","locations":[{"bldg":"Wolpe Center","room":"Wolpe Center 118","type":"LEC","typeLong":"Lecture","time":"09:30AM","days":"R"}]},{"code":"PUBPOL 5290","title":"The Economics and Regulation of Risky Health Behaviors","name":"PUBPOL 5290: The Economics and Regulation of Risky Health Behaviors","desc":"Risky health behaviors such as cigarette smoking, alcohol abuse, risky sex, drug use, poor diet and physical inactivity (leading to obesity), and self-harm are responsible for hundreds of thousands of preventable deaths and impose billions of dollars in medical care costs each year in the United States. This course teaches the economic approach to studying risky health behaviors. The research literature on the economic causes and correlates of risky health behaviors will be studied. Numerous policies to modify risky health behaviors, such as the minimum legal drinking age and recreational marijuana laws, will be debated in class. We will conduct a policy wargame, with students creating advertisements and giving oral presentations to advocate a specific policy position.\xa0\xa0","locations":[{"bldg":"Wolpe Center","room":"Wolpe Center 118","type":"LEC","typeLong":"Lecture","time":"06:30PM","days":"W"}]},{"code":"RELST 6020","title":"Latin Philosophical Texts","name":"RELST 6020: Latin Philosophical Texts","desc":"Reading and translation of Latin philosophical texts.","locations":[{"bldg":"Hans Bethe House","room":"Hans Bethe House 125","type":"SEM","typeLong":"Seminar","time":"07:30PM","days":"T"}]},{"code":"SOC 5190","title":"Workshop on Social Inequality","name":"SOC 5190: Workshop on Social Inequality","desc":"This course provides a forum in which students and others can present, discuss, and receive instant feedback on their inequality-related research. Its primary goals is to help students advance their own research; its secondary goal is to introduce selected debates in the contemporary inequality literature in a more comprehensive fashion that is possible in the introductory graduate-level seminar on inequality.","locations":[{"bldg":"Uris Hall","room":"Uris Hall 360","type":"SEM","typeLong":"Seminar","time":"03:35PM","days":"W"}]},{"code":"UNILWYL 1160","title":"Saute\xe9d Science and Edible Engineering","name":"UNILWYL 1160: Saute\xe9d Science and Edible Engineering","desc":"This class will experimentally investigate the science that underlies food preparation techniques and the tastes they produce. We will read about and discuss the relevant science for different culinary techniques, and then take things into the kitchen for \\"food labs,\\" where we will explore how the science and culinary approaches we learned about impact how things taste (while we prepare a meal we will share together). Topics include the neuroscience of seasoning and spices, the chemistry of browning and carmalization, and the polymer physics of emulsions and meringues. Working in teams of two, students will also research and present to the class on the science of a food preparation technique of their choice, and then design and conduct food lab experiments for us all to taste and learn from. There will be three hour-long meetings and four three-hour food labs over the course of the term.","locations":[{"bldg":"Barbara McClintock Hall","room":"Barbara McClintock Hall 127","type":"SEM","typeLong":"Seminar","time":"07:00PM","days":"W"},{"bldg":"Barbara McClintock Hall","room":"Barbara McClintock Hall 127","type":"SEM","typeLong":"Seminar","time":"06:00PM","days":"W"}]},{"code":"UNILWYL 1408","title":"Carl Becker Caf\xe9","name":"UNILWYL 1408: Carl Becker Caf\xe9","desc":"The caf\xe9 series is a weekly informal discussion held every Wednesday evening. The caf\xe9 features guest speakers who share their experience and expertise and often speak to challenging issues of our time. Our guests are eloquent, committed people leading very interesting lives. Hosted in the Becker House Professor\'s apartment, at caf\xe9 you\'ll enjoy great conversation in a relaxed environment with coffee and treats provided! You may join the caf\xe9 on a drop-in basis or take it as a 1-credit S/U course.","locations":[{"bldg":"Carl Becker House","room":"Carl Becker House G50","type":"SEM","typeLong":"Seminar","time":"07:15PM","days":"W"}]},{"code":"UNILWYL 1416","title":"Socially Just Leadership Development","name":"UNILWYL 1416: Socially Just Leadership Development","desc":"\\"Socially Just Leadership Development\\" will provide students an opportunity to use an enhanced social justice lens to nurture their leadership development and push past performative allyship. This interactive 12-week class will challenge students to reflect critically on their identities, learn the path from diversity to inclusion and justice, develop tangible skills and tools to interrupt injustice, and further their learning and understanding of social justice. Students will engage in small and large group discussions, guided activities, and will submit a reflection paper at the end of the semester to outline tangible action steps they can take in their time at Cornell and beyond.","locations":[{"bldg":"Hans Bethe House","room":"Hans Bethe House 125","type":"SEM","typeLong":"Seminar","time":"07:30PM","days":"W"}]},{"code":"VIEN 2400","title":"Wines and Grapes: Composition and Analysis","name":"VIEN 2400: Wines and Grapes: Composition and Analysis","desc":"Investigates the composition of grapes and wine and the most common analytical tools used in their evaluation. Both the theoretical and practical aspects of grape and wine analyses are considered.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall M31","type":"LEC","typeLong":"Lecture","time":"12:20PM","days":"W"},{"bldg":"Stocking Hall","room":"Stocking Hall M31","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"W"}]},{"code":"VIEN 4340","title":"Cider Production Laboratory","name":"VIEN 4340: Cider Production Laboratory","desc":"Cider is a fermented beverage made from apples. Students in this course are immersed in cider production and analysis practices through activities in the teaching winery and by visiting commercial cideries. Readings and discussions support the hands-on learning focus in this laboratory course. Significant winery time between weekly class sessions is required.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"W"}]},{"code":"VIEN 4360","title":"Distillation Principles and Practices Laboratory","name":"VIEN 4360: Distillation Principles and Practices Laboratory","desc":"As an introduction to the science of distillation this course uses the study of pre-fermentation and fermentation biology, phase separation and vapor-liquid equilibrium, and sensory perception as a vehicle to explore the role of science and technology in the production and enjoyment of distilled beverages. Sensory samples and commercial samples of spirits will be used to illustrate the sensory properties and chemical components which define different types of distilled spirits, with the goal of understanding how different raw materials, processing, and aging impact these sensory properties.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"F"},{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LAB","typeLong":"Laboratory","time":"11:15AM","days":"F"}]},{"code":"VIEN 4710","title":"Advanced Winemaking Theory and Practice II Laboratory","name":"VIEN 4710: Advanced Winemaking Theory and Practice II Laboratory","desc":"In the laboratory of part II of the Winemaking Theory and Practice, students continue working with wines produced in the preceding fall term, focusing on aging options, stabilization, fining, and packaging. The laboratory also provides advanced training in wine chemical and sensory analysis. Students must develop their own winemaking finishing plan for several different young wines, and participate in self-guided wine production activities, thus previous experience in wine production is highly recommended.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"}]},{"code":"VIEN 5400","title":"Wine and Grapes: Composition and Analysis","name":"VIEN 5400: Wine and Grapes: Composition and Analysis","desc":"VIEN 5400 is a 2-credit course (1 credit lecture, 1 credit lab) with an emphasis on understanding the practice and theory behind analytical techniques routinely used in the wine and grape industries, and the statistical tools used to evaluate the effectiveness of both analyst and assay. The course is designed to provide practical skills complementary to other courses. VIEN 5400 is restricted to graduate students; undergraduates should enroll in VIEN 2400.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall M31","type":"LEC","typeLong":"Lecture","time":"12:20PM","days":"W"},{"bldg":"Stocking Hall","room":"Stocking Hall M31","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"W"}]},{"code":"VIEN 6340","title":"Cider Production Laboratory","name":"VIEN 6340: Cider Production Laboratory","desc":"Cider is a fermented beverage made from apples. Students in this course are immersed in cider production and analysis practices through activities in the teaching winery and by visiting commercial cideries. Readings and discussions support the hands-on learning focus in this laboratory course. Significant winery time between weekly class sessions is required.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LAB","typeLong":"Laboratory","time":"02:30PM","days":"W"}]},{"code":"VIEN 6360","title":"Distillation Principles and Practices Laboratory","name":"VIEN 6360: Distillation Principles and Practices Laboratory","desc":"As an introduction to the science of distillation this course uses the study of pre-fermentation and fermentation biology, phase separation and vapor-liquid equilibrium, and sensory perception as a vehicle to explore the role of science and technology in the production and enjoyment of distilled beverages. Sensory samples and commercial samples of spirits will be used to illustrate the sensory properties and chemical components which define different types of distilled spirits, with the goal of understanding how different raw materials, processing, and aging impact these sensory properties.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LEC","typeLong":"Lecture","time":"10:10AM","days":"F"},{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LAB","typeLong":"Laboratory","time":"11:15AM","days":"F"}]},{"code":"VIEN 6710","title":"Advanced Winemaking Theory and Practice II Laboratory","name":"VIEN 6710: Advanced Winemaking Theory and Practice II Laboratory","desc":"In the laboratory of part II of the Winemaking Theory and Practice, students continue working with wines produced in the preceding fall term, focusing on aging options, stabilization, fining, and packaging. The laboratory also provides advanced training in wine chemical and sensory analysis. Students must develop their own winemaking finishing plan for several different young wines, and participate in self-guided wine production activities, thus previous experience in wine production is highly recommended.","locations":[{"bldg":"Stocking Hall","room":"Stocking Hall 156","type":"LAB","typeLong":"Laboratory","time":"01:25PM","days":"R"}]}]');function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function l(){l=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",u=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(C){c=function(e,t,n){return e[t]=n}}function d(e,t,n,r){var a=t&&t.prototype instanceof p?t:p,o=Object.create(a.prototype),s=new L(r||[]);return i(o,"_invoke",{value:k(e,n,s)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(C){return{type:"throw",arg:C}}}e.wrap=d;var f={};function p(){}function m(){}function y(){}var g={};c(g,a,(function(){return this}));var v=Object.getPrototypeOf,_=v&&v(v(M([])));_&&_!==t&&n.call(_,a)&&(g=_);var x=y.prototype=p.prototype=Object.create(g);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function r(i,a,o,l){var u=h(e[i],e,a);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"==s(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,l)}),(function(e){r("throw",e,o,l)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return r("throw",e,o,l)}))}l(u.arg)}var a;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return a=a?a.then(i,i):i()}})}function k(e,t,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return A()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=T(o,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=h(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}function T(e,t){var n=t.method,i=e.iterator[n];if(void 0===i)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var r=h(i,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,f;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function M(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:A}}function A(){return{value:void 0,done:!0}}return m.prototype=y,i(x,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:m,configurable:!0}),m.displayName=c(y,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,u,"GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},b(w.prototype),c(w.prototype,o,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var o=new w(d(t,n,i,r),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(x),c(x,u,"Generator"),c(x,a,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=M,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return o.type="throw",o.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;S(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},e}function u(e){var t=function(e,t){if("object"!==s(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===s(t)?t:String(t)}function c(e,t,n){return(t=u(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}function h(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(u){return void n(u)}s.done?t(l):Promise.resolve(l).then(i,r)}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var y="function"===typeof Symbol&&Symbol.observable||"@@observable",g=function(){return Math.random().toString(36).substring(7).split("").join(".")},v={INIT:"@@redux/INIT"+g(),REPLACE:"@@redux/REPLACE"+g(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+g()}};function _(e){if("object"!==typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function x(e,t,n){var i;if("function"===typeof t&&"function"===typeof n||"function"===typeof n&&"function"===typeof arguments[3])throw new Error(m(0));if("function"===typeof t&&"undefined"===typeof n&&(n=t,t=void 0),"undefined"!==typeof n){if("function"!==typeof n)throw new Error(m(1));return n(x)(e,t)}if("function"!==typeof e)throw new Error(m(2));var r=e,a=t,o=[],s=o,l=!1;function u(){s===o&&(s=o.slice())}function c(){if(l)throw new Error(m(3));return a}function d(e){if("function"!==typeof e)throw new Error(m(4));if(l)throw new Error(m(5));var t=!0;return u(),s.push(e),function(){if(t){if(l)throw new Error(m(6));t=!1,u();var n=s.indexOf(e);s.splice(n,1),o=null}}}function h(e){if(!_(e))throw new Error(m(7));if("undefined"===typeof e.type)throw new Error(m(8));if(l)throw new Error(m(9));try{l=!0,a=r(a,e)}finally{l=!1}for(var t=o=s,n=0;n<t.length;n++){(0,t[n])()}return e}return h({type:v.INIT}),(i={dispatch:h,subscribe:d,getState:c,replaceReducer:function(e){if("function"!==typeof e)throw new Error(m(10));r=e,h({type:v.REPLACE})}})[y]=function(){var e,t=d;return(e={subscribe:function(e){if("object"!==typeof e||null===e)throw new Error(m(11));function n(){e.next&&e.next(c())}return n(),{unsubscribe:t(n)}}})[y]=function(){return this},e},i}var b=[];var w=x((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;return"setClicked"===t.type?t.payload:e})),k={};var T=x((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;return"setDivMap"===t.type?t.payload:e})),E={paths:[],index:0,lastAction:""};var S=x((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"addPath":return p(p({},e),{},{paths:e.paths.concat([t.payload]),lastAction:"addPath"});case"setPaths":return p(p({},e),{},{paths:t.payload,lastAction:"setPaths"});case"setIndex":return p(p({},e),{},{index:t.payload,lastAction:"setIndex"});default:return e}})),L={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},M=e.createContext&&e.createContext(L),A=function(){return A=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},A.apply(this,arguments)},C=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};function I(t){return t&&t.map((function(t,n){return e.createElement(t.tag,A({key:n},t.attr),I(t.child))}))}function P(t){return function(n){return e.createElement(z,A({attr:A({},t.attr)},n),I(t.child))}}function z(t){var n=function(n){var i,r=t.attr,a=t.size,o=t.title,s=C(t,["attr","size","title"]),l=a||n.size||"1em";return n.className&&(i=n.className),t.className&&(i=(i?i+" ":"")+t.className),e.createElement("svg",A({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,s,{className:i,style:A(A({color:t.color||n.color},n.style),t.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),o&&e.createElement("title",null,o),t.children)};return void 0!==M?e.createElement(M.Consumer,null,(function(e){return n(e)})):n(L)}function D(e){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3L1 9l11 6 9-4.91V17h2V9L12 3z"}}]})(e)}function R(e){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"}},{tag:"path",attr:{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}}]})(e)}var B=n(483),F=n.n(B),O=JSON.parse('{"Statler Hall":[-76.48276137,42.44593160007002],"Bill and Melinda Gates Hall":[-76.48080362,42.44493946],"M Van Rensselaer Hall":[-76.47863835773283,42.45015981137076],"Comstock Hall-Academic II":[-76.47938348,42.44661462],"Mann Library":[-76.47629454,42.44892972],"Judith Eissner Pavillion":[-76.48542858,42.44275962],"A D White House":[-76.48193373,42.44834393],"Bondareff Raptor Facility":[-76.44980958,42.44280384],"Africana Ctr":[-76.48227725,42.45753301],"Foundry":[-76.48356654,42.45152068],"Kroch,Carl A Library":[-76.48413814,42.44787696],"Academic Surge A":[-76.4783,42.44835255],"CVM Center":[-76.46575005,42.44751074],"Vet Medical Center":[-76.46486291,42.44640286],"Stimson Hall":[-76.48342881,42.44786477],"Johnson Ctr - Lab of O":[-76.45130948,42.480066],"Wing Hall":[-76.47142517,42.44668289],"Vet Research Tower":[-76.46633606,42.44740459],"Vet Education Center":[-76.46487,42.4475052],"Breazzano Family Ctr for BusEd":[-76.48472642,42.4416316],"Robert Purcell Community Ctr":[-76.477645192,42.45605901],"Rice Hall":[-76.47406545,42.44797618],"Olin Chemistry Research Wing":[-76.48101724,42.4507692],"Ives Hall Faculty Wing":[-76.4810487,42.44736539],"Sage Chapel":[-76.48440084,42.44740759],"Toni Morrison Hall":[-76.47940638,42.45577706],"Appel":[-76.47610731,42.45366539],"Noyes Community and Rec Center":[-76.48803891,42.4466132],"Cornell Golf Center":[-76.4675593,42.45837105],"Barbara McClintock Hall":[-76.4744427,42.45380797],"Risley Tennis Court":[-76.48319054,42.45339442],"Grumman Squash Courts":[-76.47997686,42.44514698],"Merrill Family Sailing Center":[-76.50307113,42.47038742],"Nevin Welcome Center":[-76.47250423,42.44966968],"Guterman Bioclimatic Lab":[-76.4605012,42.44756229],"Love Laboratory":[-76.46176451,42.44935369],"North Campus Low Rise 7":[-76.47522522,42.45636427],"Alice H. Cook House":[-76.48961391,42.44905958],"Moore Laboratory":[-76.46563481,42.44822383]}'),N=n(184);F().workerClass=n(437).Z;var H=[0,Math.PI,Math.PI/2,Math.PI/2*3,Math.PI/4*5,Math.PI/4,Math.PI/4*3,Math.PI/4*7,Math.PI/3*5,Math.PI/6*11],U=25e-6;function j(n){var i=n.selected,r=n.setSelected,o=(0,e.useRef)(null),s=(0,e.useRef)(null),u=-76.483448,f=42.449052,m=a((0,e.useState)(u),2),y=m[0],g=m[1],v=a((0,e.useState)(f),2),_=v[0],x=v[1],b=a((0,e.useState)(16),2),k=b[0],E=b[1],L=a((0,e.useState)(new Map),2),M=L[0],A=L[1];function C(){w.dispatch({type:"setClicked",payload:[]})}function I(e,t){var n=w.getState();n.some((function(t){return t[0].key===e.key}))?C():w.dispatch({type:"setClicked",payload:n.concat([[e,t]])})}function P(){var e=w.getState();if(!(e.length<2)){var t=e[0][1],n=e[1][1],i=e[0][0],r=e[1][0],a=i.key+" to "+r.key;if(t.toString()===n.toString()||s.current.getLayer(a))C();else{var o="https://api.mapbox.com/directions/v5/mapbox/walking/"+t[0]+","+t[1]+";"+n[0]+","+n[1]+"?geometries=geojson&overview=full&steps=true&access_token="+F().accessToken;fetch(o).then((function(e){return e.json()})).then((function(e){s.current.addSource(a,{type:"geojson",data:{type:"Feature",properties:{},geometry:e.routes[0].geometry}}),s.current.addLayer({id:a,type:"line",source:a,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#6464ff","line-width":8}});var t=p(p({},e.routes[0].legs[0]),{},{origin:i,destination:r});S.dispatch({type:"addPath",payload:[a,t,function(){return s.current.setLayoutProperty(a,"visibility","none")},function(){s.current.setLayoutProperty(a,"visibility","visible")},function(){s.current.removeLayer(a),s.current.removeSource(a);var e=S.getState().paths;S.dispatch({type:"setPaths",payload:e.filter((function(e){return e[0]!==a}))})}]}),C()}))}}}function z(){var n;return n=l().mark((function n(){var a,h,m;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:s.current?s.current.resize():(s.current=new(F().Map)({container:o.current,style:"mapbox://styles/polybeandip/cll8k7mvf00b101po9jsfdcyz",attributionControl:!1,center:[y,_],zoom:k,pitch:45,minZoom:14.5,maxBounds:[[-76.4977,42.436908],[-76.45095,42.455924]]}),s.current.addControl(new(F().NavigationControl)({showCompass:!0,showZoom:!0,visualizePitch:!0})),s.current.on("move",(function(){g(s.current.getCenter().lng.toFixed(6)),x(s.current.getCenter().lat.toFixed(6)),E(s.current.getZoom().toFixed(2))}))),a=d(i),n.prev=2,m=l().mark((function n(){var i,a,o,m,y,g,v,_,x,b,k,E,L;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(L=function(){var t=(0,e.useReducer)((function(e){return e+1}),0)[1],n=w.getState();function a(){I(i,m),P()}function o(){var e=w.getState();E.remove(),r((function(e){return e.filter((function(e){return e.key!==i.key}))})),w.dispatch({type:"setClicked",payload:e.filter((function(e){return e[0].key!==i.key}))});var t,n=S.getState().paths,a=n,o=d(n);try{var l=function(){var e=t.value;e[0].includes(i.name)&&(s.current.removeLayer(e[0]),s.current.removeSource(e[0]),a=a.filter((function(t){return t[0]!==e[0]})))};for(o.s();!(t=o.n()).done;)l()}catch(u){o.e(u)}finally{o.f()}S.dispatch({type:"setPaths",payload:a})}return(0,e.useEffect)((function(){w.subscribe(t);var e=T.getState();T.dispatch({type:"setDivMap",payload:p(p({},e),{},c({},i.key,[a,o]))})}),[]),(0,N.jsx)("div",{className:n.some((function(e){return e[0].key===i.key}))?"marker-clicked":"marker",onClick:function(e){e.stopPropagation(),a()},style:{color:i.color},children:(0,N.jsx)(D,{})})},!(i=h.value).drawn_on_map){n.next=4;break}return n.abrupt("return","continue");case 4:if(i.drawn_on_map=!0,a=(i.location+", Cornell University").replace(" ","%20"),o="https://api.mapbox.com/geocoding/v5/mapbox.places/"+a+".json?proximity="+u+","+f+"&access_token="+F().accessToken,!O[i.location]){n.next=11;break}m=O[i.location],n.next=18;break;case 11:return n.next=13,fetch(o);case 13:return y=n.sent,n.next=16,y.json();case 16:g=n.sent,m=g.features[0].center;case 18:v=m,_=m.toString(),x=0,M.has(_)&&(x=M.get(_)),v=[v[0]+U*Math.sin(H[x]),v[1]+U*Math.cos(H[x])],b=new Map(M).set(_,x+1),A(b),k=document.createElement("div"),E=new(F().Marker)(k),t.createRoot(k).render((0,N.jsx)(L,{})),E.setLngLat(v).addTo(s.current),s.current.flyTo({center:m,zoom:17,duration:5e3,essential:!0});case 31:case"end":return n.stop()}}),n)})),a.s();case 5:if((h=a.n()).done){n.next=12;break}return n.delegateYield(m(),"t0",7);case 7:if("continue"!==n.t0){n.next=10;break}return n.abrupt("continue",10);case 10:n.next=5;break;case 12:n.next=17;break;case 14:n.prev=14,n.t1=n.catch(2),a.e(n.t1);case 17:return n.prev=17,a.f(),n.finish(17);case 20:case"end":return n.stop()}}),n,null,[[2,14,17,20]])})),z=function(){var e=this,t=arguments;return new Promise((function(i,r){var a=n.apply(e,t);function o(e){h(a,i,r,o,s,"next",e)}function s(e){h(a,i,r,o,s,"throw",e)}o(void 0)}))},z.apply(this,arguments)}return(0,e.useEffect)((function(){!function(){z.apply(this,arguments)}()})),(0,N.jsx)("div",{ref:o,style:{height:"100%"},onClick:C})}function V(e){return P({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505.04 442.66l-99.71-99.69c-4.5-4.5-10.6-7-17-7h-16.3c27.6-35.3 44-79.69 44-127.99C416.03 93.09 322.92 0 208.02 0S0 93.09 0 207.98s93.11 207.98 208.02 207.98c48.3 0 92.71-16.4 128.01-44v16.3c0 6.4 2.5 12.5 7 17l99.71 99.69c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.59.1-33.99zm-297.02-90.7c-79.54 0-144-64.34-144-143.98 0-79.53 64.35-143.98 144-143.98 79.54 0 144 64.34 144 143.98 0 79.53-64.35 143.98-144 143.98zm.02-239.96c-40.78 0-73.84 33.05-73.84 73.83 0 32.96 48.26 93.05 66.75 114.86a9.24 9.24 0 0 0 14.18 0c18.49-21.81 66.75-81.89 66.75-114.86 0-40.78-33.06-73.83-73.84-73.83zm0 96c-13.26 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"}}]})(e)}F().accessToken="pk.eyJ1IjoicG9seWJlYW5kaXAiLCJhIjoiY2xrd2ZlbW94MDJ6dDNwdDQweWQyZnVsZCJ9.7L7RWu5Du9O0ZDxO8aXQow";var W=["red","green","blue","orange","purple","violet","chocolate","hotpink"],G={M:"Monday",T:"Tuesday",W:"Wednesday",R:"Thursday",F:"Friday",S:"Saturday",Su:"Sunday"};function q(e){var t=e.results,n=e.setSelected,i=e.selected,r=e.setResults;function a(){var e,t=d(W);try{var n=function(){var t=e.value;if(!i.some((function(e){return e.color===t})))return{v:t}};for(t.s();!(e=t.n()).done;){var r=n();if("object"===typeof r)return r.v}}catch(a){t.e(a)}finally{t.f()}}var o=t.map((function(e){var t=e.locations.length>1;return(0,N.jsxs)("li",{onClick:function(){return function(e,t){if(t){var o=e.locations.map((function(t){var n=G[t.days]?G[t.days]:t.days;return{name:t.typeLong+" on "+n+" at "+t.time+" ("+t.room+")",dt:t.days+" "+t.time,type:t.type,locations:[t],room:t.room,class:e}}));r(o)}else{var s;s=e.class?p(p({},e.class),{},{room:e.room,code:e.class.code+" ("+e.type+")",dt:e.dt}):p(p({},e),{},{room:e.locations[0].room});var l=(s=p(p({},s),{},{location:e.locations[0].bldg,drawn_on_map:!1})).name+", "+s.room+(s.dt?", "+s.dt:"");if(s=p(p({},s),{},{key:l}),i.length>=8||(u=s,i.some((function(e){return e.key===u.key}))))return;s=p(p({},s),{},{color:a()}),n(i.concat(s)),r([])}var u}(e,t)},children:[(0,N.jsx)("div",{children:e.name}),t&&(0,N.jsx)("div",{children:(0,N.jsx)(R,{})})]},e.name)}));return(0,N.jsx)("div",{id:"results-container",children:(0,N.jsx)("ul",{children:o})})}function Z(t){var n=t.classes,i=t.setSelected,r=t.selected,o=a((0,e.useState)([]),2),s=o[0],l=o[1];return(0,N.jsxs)("div",{children:[(0,N.jsxs)("div",{id:"bar-container",children:[(0,N.jsx)("div",{id:"spotlight",children:(0,N.jsx)(V,{})}),(0,N.jsx)("input",{placeholder:'"CS 3110", "Functional Programming", etc',onChange:function(e){var t=e.target.value.toLowerCase(),i=[],r=100;if(t){var a,o=d(n);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.name.toLowerCase().includes(t)&&(i.push(s),r--),0===r)break}}catch(u){o.e(u)}finally{o.f()}}l(i)}})]}),(0,N.jsx)(q,{results:s,setSelected:i,selected:r,setResults:l})]})}function X(e){return P({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"}}]})(e)}function K(t){var n=t.selected,i=(0,e.useReducer)((function(e){return e+1}),0)[1];(0,e.useEffect)((function(){w.subscribe(i),S.subscribe(i)}),[]);var r=n.map((function(e){var t=w.getState();return(0,N.jsxs)("li",{className:t.some((function(t){return t[0].key===e.key}))?"clicked":"",onClick:function(){T.getState()[e.key][0](),i()},children:[(0,N.jsx)("div",{className:"color",style:{backgroundColor:e.color}}),(0,N.jsxs)("div",{className:"content",children:[(0,N.jsxs)("p",{className:"title",children:[(0,N.jsx)("b",{className:"code",children:e.code})," "," "+e.title]}),(0,N.jsxs)("p",{className:"loc",children:[e.room+(e.dt?" ("+e.dt+")":""),(0,N.jsx)("span",{id:"trash-icon",onClick:function(t){T.getState()[e.key][1](),i(),t.stopPropagation()},children:(0,N.jsx)(X,{})})]})]})]},e.key)}));return(0,N.jsxs)("div",{children:[n.length>0?(0,N.jsx)("h1",{children:"Classes"}):(0,N.jsx)("h1",{children:"Look up a class"}),(0,N.jsx)("div",{id:"eli5",children:n.length>0?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("p",{children:"Search for another class"}),(0,N.jsx)("p",{children:"OR select two class icons (on the map or sidebar) to show the route between them"})]}):(0,N.jsx)("p",{children:"Use the search bar to look for a class"})}),(0,N.jsxs)("ul",{id:"class-display",children:[r,S.getState().paths.length>0&&(0,N.jsx)("hr",{id:"line"})]})]})}function Y(e){return P({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"}}]})(e)}function J(e){return P({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"}}]})(e)}function $(){var t=S.getState(),n=t.index,i=t.paths,r=(0,e.useReducer)((function(e){return e+1}),0)[1];if((0,e.useEffect)((function(){S.subscribe((function(){r();var e=S.getState(),t=e.paths,n=e.index;"addPath"===e.lastAction&&n!==t.length-1&&(t[n][2](),S.dispatch({type:"setIndex",payload:t.length-1}))}))}),[]),0!==i.length){if(!(n>i.length-1)){var a=i[n][1],o=a.steps.map((function(e,t){var n=Math.round(3.28084*e.distance),i=Math.round(621371e-9*e.distance*100)/100;return(0,N.jsxs)("li",{children:[(0,N.jsx)("div",{className:"direction",children:e.maneuver.instruction}),t<a.steps.length-1&&(0,N.jsx)("fieldset",{children:(0,N.jsx)("legend",{children:n<1056?n+" feet":i+(1===i?" mile":" miles")})})]},t)})),s=Math.round(3.28084*a.distance),l=Math.round(621371e-9*a.distance*100)/100;return(0,N.jsxs)("div",{id:"directions-container",children:[(0,N.jsxs)("h1",{children:[i.length>1&&(0,N.jsx)("div",{id:"left",onClick:c,children:(0,N.jsx)(Y,{})}),"Directions",i.length>1&&(0,N.jsx)("div",{id:"right",onClick:function(){u(n<i.length-1?n+1:0)},children:(0,N.jsx)(J,{})})]}),i.length>1&&(0,N.jsx)("p",{id:"eli5-arrows",children:"Use the arrows to switch paths"}),(0,N.jsxs)("div",{id:"time",children:[a.duration<60?Math.round(a.duration)+" sec":Math.round(a.duration/60)+" min"," ",(0,N.jsxs)("span",{children:["(",s<1056?s+" feet":l+(1===l?" mile":" miles"),")"]})]}),(0,N.jsxs)("div",{id:"from-to",children:[(0,N.jsxs)("div",{children:[(0,N.jsxs)("span",{style:{color:a.origin.color},children:[" ",a.origin.code," "]}),"to",(0,N.jsxs)("span",{style:{color:a.destination.color},children:[" ",a.destination.code," "]})]}),(0,N.jsx)("div",{id:"trash-icon",onClick:function(){var e=S.getState().paths[n][4];c(),e()},children:(0,N.jsx)(X,{})})]}),(0,N.jsx)("ul",{children:o})]})}S.dispatch({type:"setIndex",payload:i.length-1})}function u(e){var t=S.getState().index;i[t][2](),i[e][3](),S.dispatch({type:"setIndex",payload:e})}function c(){u(n>0?n-1:i.length-1)}}function Q(){var t=a((0,e.useState)([]),2),n=t[0],i=t[1];return(0,N.jsx)("div",{id:"App",children:(0,N.jsxs)("div",{id:"container",children:[(0,N.jsxs)("div",{id:"sidebar",children:[(0,N.jsx)(K,{selected:n,setSelected:i}),(0,N.jsx)($,{})]}),(0,N.jsxs)("div",{children:[(0,N.jsx)("div",{id:"search",children:(0,N.jsx)(Z,{classes:o,setSelected:i,selected:n})}),(0,N.jsx)(j,{selected:n,setSelected:i})]})]})})}t.createRoot(document.getElementById("root")).render((0,N.jsx)(e.StrictMode,{children:(0,N.jsx)(Q,{})}))}()}();
//# sourceMappingURL=main.294ebfa6.js.map